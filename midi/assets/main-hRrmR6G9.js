var e4=Object.defineProperty;var t4=(e,t,n)=>t in e?e4(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var ee=(e,t,n)=>t4(e,typeof t!="symbol"?t+"":t,n);import{n as J,k as ss,r as p,R as it,m as Vr,o as Dt,t as Mn,c as yr,a as Rn,b as ud,d as ks,g as yt,e as n4,f as r4,h as o4,i as s4,j as ba,l as Tf,p as a4,q as i4,O as ag,s as ig,u as cg,T as c4,v as $t,w as Fe,x as Wi,_ as l4,G as g_,y as v_,z as u4,A as d4,B as f4,C as h4}from"./index-BqMDePRV.js";import{j as G,a as u,L as Vt,M as Ma,b as Ja,f as dd,c as p4,t as b_,u as er,d as N,F as Ke,W as __,e as m4,S as g4,g as v4,G as b4}from"./GlobalCSS--4pqnocH.js";import{C as gt,O as _4,c as Jt,a as y4,D as S4,b as k4,P as w4,R as x4,d as C4,l as Qe,u as T4,_ as M4,k as E4,i as I4,e as A4,f as y_,g as R4,h as O4,j as P4,m as B4,n as D4,o as N4,S as Bp,p as Dp,t as L4,q as z4,r as F4,s as W4,v as $4,w as Ll,x as lg,y as V4,N as j4,z as H4,M as Zr,A as Io,B as U4,E as Gl,F as tr,G as G4,H as X4,I as K4,J as S_,K as Y4,T as q4,L as Z4,Q as pr,U as fd,V as Pc,W as hd,X as k_,Y as w_,Z as Q4,$ as Np,a0 as x_,a1 as C_,a2 as pd,a3 as T_,a4 as M_,a5 as J4,a6 as e5,a7 as t5,a8 as n5,a9 as E_,aa as r5,ab as I_,ac as o5,ad as A_,ae as R_,af as Ch,ag as s5,ah as a5,ai as i5,aj as c5,ak as l5,al as Th,am as O_,an as P_,ao as u5,ap as d5,aq as f5,ar as h5,as as p5,at as m5,au as g5,av as v5,aw as b5,ax as _5,ay as y5,az as S5,aA as k5,aB as w5,aC as x5,aD as B_,aE as C5,aF as T5,aG as M5,aH as E5,aI as I5,aJ as A5,aK as R5}from"./CheckCircleIcon-Dj4MnA5J.js";const pt=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,ws="8.55.0",Ot=globalThis;function md(e,t,n){const r=n||Ot,o=r.__SENTRY__=r.__SENTRY__||{},s=o[ws]=o[ws]||{};return s[e]||(s[e]=t())}const as=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,O5="Sentry Logger ",Mh=["debug","info","warn","error","log","assert","trace"],Xl={};function Ys(e){if(!("console"in Ot))return e();const t=Ot.console,n={},r=Object.keys(Xl);r.forEach(o=>{const s=Xl[o];n[o]=t[o],t[o]=s});try{return e()}finally{r.forEach(o=>{t[o]=n[o]})}}function P5(){let e=!1;const t={enable:()=>{e=!0},disable:()=>{e=!1},isEnabled:()=>e};return as?Mh.forEach(n=>{t[n]=(...r)=>{e&&Ys(()=>{Ot.console[n](`${O5}[${n}]:`,...r)})}}):Mh.forEach(n=>{t[n]=()=>{}}),t}const Xe=md("logger",P5),D_=50,Ps="?",ug=/\(error: (.*)\)/,dg=/captureMessage|captureException/;function N_(...e){const t=e.sort((n,r)=>n[0]-r[0]).map(n=>n[1]);return(n,r=0,o=0)=>{const s=[],a=n.split(`
`);for(let i=r;i<a.length;i++){const c=a[i];if(c.length>1024)continue;const l=ug.test(c)?c.replace(ug,"$1"):c;if(!l.match(/\S*Error: /)){for(const f of t){const d=f(l);if(d){s.push(d);break}}if(s.length>=D_+o)break}}return D5(s.slice(o))}}function B5(e){return Array.isArray(e)?N_(...e):e}function D5(e){if(!e.length)return[];const t=Array.from(e);return/sentryWrapped/.test(pl(t).function||"")&&t.pop(),t.reverse(),dg.test(pl(t).function||"")&&(t.pop(),dg.test(pl(t).function||"")&&t.pop()),t.slice(0,D_).map(n=>({...n,filename:n.filename||pl(t).filename,function:n.function||Ps}))}function pl(e){return e[e.length-1]||{}}const Mf="<anonymous>";function So(e){try{return!e||typeof e!="function"?Mf:e.name||Mf}catch{return Mf}}function fg(e){const t=e.exception;if(t){const n=[];try{return t.values.forEach(r=>{r.stacktrace.frames&&n.push(...r.stacktrace.frames)}),n}catch{return}}}const zl={},hg={};function is(e,t){zl[e]=zl[e]||[],zl[e].push(t)}function cs(e,t){if(!hg[e]){hg[e]=!0;try{t()}catch(n){as&&Xe.error(`Error while instrumenting ${e}`,n)}}}function kr(e,t){const n=e&&zl[e];if(n)for(const r of n)try{r(t)}catch(o){as&&Xe.error(`Error while triggering instrumentation handler.
Type: ${e}
Name: ${So(r)}
Error:`,o)}}let Ef=null;function L_(e){const t="error";is(t,e),cs(t,N5)}function N5(){Ef=Ot.onerror,Ot.onerror=function(e,t,n,r,o){return kr("error",{column:r,error:o,line:n,msg:e,url:t}),Ef?Ef.apply(this,arguments):!1},Ot.onerror.__SENTRY_INSTRUMENTED__=!0}let If=null;function z_(e){const t="unhandledrejection";is(t,e),cs(t,L5)}function L5(){If=Ot.onunhandledrejection,Ot.onunhandledrejection=function(e){return kr("unhandledrejection",e),If?If.apply(this,arguments):!0},Ot.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}function qs(){return Lp(Ot),Ot}function Lp(e){const t=e.__SENTRY__=e.__SENTRY__||{};return t.version=t.version||ws,t[ws]=t[ws]||{}}const F_=Object.prototype.toString;function zp(e){switch(F_.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object WebAssembly.Exception]":return!0;default:return ko(e,Error)}}function ei(e,t){return F_.call(e)===`[object ${t}]`}function W_(e){return ei(e,"ErrorEvent")}function pg(e){return ei(e,"DOMError")}function z5(e){return ei(e,"DOMException")}function go(e){return ei(e,"String")}function Fp(e){return typeof e=="object"&&e!==null&&"__sentry_template_string__"in e&&"__sentry_template_values__"in e}function Wp(e){return e===null||Fp(e)||typeof e!="object"&&typeof e!="function"}function Ea(e){return ei(e,"Object")}function gd(e){return typeof Event<"u"&&ko(e,Event)}function F5(e){return typeof Element<"u"&&ko(e,Element)}function W5(e){return ei(e,"RegExp")}function vd(e){return!!(e&&e.then&&typeof e.then=="function")}function $5(e){return Ea(e)&&"nativeEvent"in e&&"preventDefault"in e&&"stopPropagation"in e}function ko(e,t){try{return e instanceof t}catch{return!1}}function $_(e){return!!(typeof e=="object"&&e!==null&&(e.__isVue||e._isVue))}const _a=Ot,V5=80;function Bs(e,t={}){if(!e)return"<unknown>";try{let n=e;const r=5,o=[];let s=0,a=0;const i=" > ",c=i.length;let l;const f=Array.isArray(t)?t:t.keyAttrs,d=!Array.isArray(t)&&t.maxStringLength||V5;for(;n&&s++<r&&(l=j5(n,f),!(l==="html"||s>1&&a+o.length*c+l.length>=d));)o.push(l),a+=l.length,n=n.parentNode;return o.reverse().join(i)}catch{return"<unknown>"}}function j5(e,t){const n=e,r=[];if(!n||!n.tagName)return"";if(_a.HTMLElement&&n instanceof HTMLElement&&n.dataset){if(n.dataset.sentryComponent)return n.dataset.sentryComponent;if(n.dataset.sentryElement)return n.dataset.sentryElement}r.push(n.tagName.toLowerCase());const o=t&&t.length?t.filter(a=>n.getAttribute(a)).map(a=>[a,n.getAttribute(a)]):null;if(o&&o.length)o.forEach(a=>{r.push(`[${a[0]}="${a[1]}"]`)});else{n.id&&r.push(`#${n.id}`);const a=n.className;if(a&&go(a)){const i=a.split(/\s+/);for(const c of i)r.push(`.${c}`)}}const s=["aria-label","type","name","title","alt"];for(const a of s){const i=n.getAttribute(a);i&&r.push(`[${a}="${i}"]`)}return r.join("")}function H5(){try{return _a.document.location.href}catch{return""}}function U5(e){return _a.document&&_a.document.querySelector?_a.document.querySelector(e):null}function V_(e){if(!_a.HTMLElement)return null;let t=e;const n=5;for(let r=0;r<n;r++){if(!t)return null;if(t instanceof HTMLElement){if(t.dataset.sentryComponent)return t.dataset.sentryComponent;if(t.dataset.sentryElement)return t.dataset.sentryElement}t=t.parentNode}return null}function ya(e,t=0){return typeof e!="string"||t===0||e.length<=t?e:`${e.slice(0,t)}...`}function mg(e,t){if(!Array.isArray(e))return"";const n=[];for(let r=0;r<e.length;r++){const o=e[r];try{$_(o)?n.push("[VueViewModel]"):n.push(String(o))}catch{n.push("[value cannot be serialized]")}}return n.join(t)}function G5(e,t,n=!1){return go(e)?W5(t)?t.test(e):go(t)?n?e===t:e.includes(t):!1:!1}function xs(e,t=[],n=!1){return t.some(r=>G5(e,r,n))}function ur(e,t,n){if(!(t in e))return;const r=e[t],o=n(r);typeof o=="function"&&j_(o,r);try{e[t]=o}catch{as&&Xe.log(`Failed to replace method "${t}" in object`,e)}}function xr(e,t,n){try{Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0})}catch{as&&Xe.log(`Failed to add non-enumerable property "${t}" to object`,e)}}function j_(e,t){try{const n=t.prototype||{};e.prototype=t.prototype=n,xr(e,"__sentry_original__",t)}catch{}}function $p(e){return e.__sentry_original__}function H_(e){if(zp(e))return{message:e.message,name:e.name,stack:e.stack,...vg(e)};if(gd(e)){const t={type:e.type,target:gg(e.target),currentTarget:gg(e.currentTarget),...vg(e)};return typeof CustomEvent<"u"&&ko(e,CustomEvent)&&(t.detail=e.detail),t}else return e}function gg(e){try{return F5(e)?Bs(e):Object.prototype.toString.call(e)}catch{return"<unknown>"}}function vg(e){if(typeof e=="object"&&e!==null){const t={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}else return{}}function X5(e,t=40){const n=Object.keys(H_(e));n.sort();const r=n[0];if(!r)return"[object has no keys]";if(r.length>=t)return ya(r,t);for(let o=n.length;o>0;o--){const s=n.slice(0,o).join(", ");if(!(s.length>t))return o===n.length?s:ya(s,t)}return""}function En(e){return Eh(e,new Map)}function Eh(e,t){if(K5(e)){const n=t.get(e);if(n!==void 0)return n;const r={};t.set(e,r);for(const o of Object.getOwnPropertyNames(e))typeof e[o]<"u"&&(r[o]=Eh(e[o],t));return r}if(Array.isArray(e)){const n=t.get(e);if(n!==void 0)return n;const r=[];return t.set(e,r),e.forEach(o=>{r.push(Eh(o,t))}),r}return e}function K5(e){if(!Ea(e))return!1;try{const t=Object.getPrototypeOf(e).constructor.name;return!t||t==="Object"}catch{return!0}}const U_=1e3;function Bc(){return Date.now()/U_}function Y5(){const{performance:e}=Ot;if(!e||!e.now)return Bc;const t=Date.now()-e.now(),n=e.timeOrigin==null?t:e.timeOrigin;return()=>(n+e.now())/U_}const Wn=Y5(),Zn=(()=>{const{performance:e}=Ot;if(!e||!e.now)return;const t=3600*1e3,n=e.now(),r=Date.now(),o=e.timeOrigin?Math.abs(e.timeOrigin+n-r):t,s=o<t,a=e.timing&&e.timing.navigationStart,c=typeof a=="number"?Math.abs(a+n-r):t,l=c<t;return s||l?o<=c?e.timeOrigin:a:r})();function wr(){const e=Ot,t=e.crypto||e.msCrypto;let n=()=>Math.random()*16;try{if(t&&t.randomUUID)return t.randomUUID().replace(/-/g,"");t&&t.getRandomValues&&(n=()=>{const r=new Uint8Array(1);return t.getRandomValues(r),r[0]})}catch{}return("10000000100040008000"+1e11).replace(/[018]/g,r=>(r^(n()&15)>>r/4).toString(16))}function G_(e){return e.exception&&e.exception.values?e.exception.values[0]:void 0}function $o(e){const{message:t,event_id:n}=e;if(t)return t;const r=G_(e);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||n||"<unknown>":n||"<unknown>"}function Ih(e,t,n){const r=e.exception=e.exception||{},o=r.values=r.values||[],s=o[0]=o[0]||{};s.value||(s.value=t||""),s.type||(s.type="Error")}function Ia(e,t){const n=G_(e);if(!n)return;const r={type:"generic",handled:!0},o=n.mechanism;if(n.mechanism={...r,...o,...t},t&&"data"in t){const s={...o&&o.data,...t.data};n.mechanism.data=s}}function bg(e){if(q5(e))return!0;try{xr(e,"__sentry_captured__",!0)}catch{}return!1}function q5(e){try{return e.__sentry_captured__}catch{}}var lo;(function(e){e[e.PENDING=0]="PENDING";const n=1;e[e.RESOLVED=n]="RESOLVED";const r=2;e[e.REJECTED=r]="REJECTED"})(lo||(lo={}));function Ds(e){return new Sr(t=>{t(e)})}function Kl(e){return new Sr((t,n)=>{n(e)})}class Sr{constructor(t){Sr.prototype.__init.call(this),Sr.prototype.__init2.call(this),Sr.prototype.__init3.call(this),Sr.prototype.__init4.call(this),this._state=lo.PENDING,this._handlers=[];try{t(this._resolve,this._reject)}catch(n){this._reject(n)}}then(t,n){return new Sr((r,o)=>{this._handlers.push([!1,s=>{if(!t)r(s);else try{r(t(s))}catch(a){o(a)}},s=>{if(!n)o(s);else try{r(n(s))}catch(a){o(a)}}]),this._executeHandlers()})}catch(t){return this.then(n=>n,t)}finally(t){return new Sr((n,r)=>{let o,s;return this.then(a=>{s=!1,o=a,t&&t()},a=>{s=!0,o=a,t&&t()}).then(()=>{if(s){r(o);return}n(o)})})}__init(){this._resolve=t=>{this._setResult(lo.RESOLVED,t)}}__init2(){this._reject=t=>{this._setResult(lo.REJECTED,t)}}__init3(){this._setResult=(t,n)=>{if(this._state===lo.PENDING){if(vd(n)){n.then(this._resolve,this._reject);return}this._state=t,this._value=n,this._executeHandlers()}}}__init4(){this._executeHandlers=()=>{if(this._state===lo.PENDING)return;const t=this._handlers.slice();this._handlers=[],t.forEach(n=>{n[0]||(this._state===lo.RESOLVED&&n[1](this._value),this._state===lo.REJECTED&&n[2](this._value),n[0]=!0)})}}}function Z5(e){const t=Wn(),n={sid:wr(),init:!0,timestamp:t,started:t,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>J5(n)};return e&&Aa(n,e),n}function Aa(e,t={}){if(t.user&&(!e.ipAddress&&t.user.ip_address&&(e.ipAddress=t.user.ip_address),!e.did&&!t.did&&(e.did=t.user.id||t.user.email||t.user.username)),e.timestamp=t.timestamp||Wn(),t.abnormal_mechanism&&(e.abnormal_mechanism=t.abnormal_mechanism),t.ignoreDuration&&(e.ignoreDuration=t.ignoreDuration),t.sid&&(e.sid=t.sid.length===32?t.sid:wr()),t.init!==void 0&&(e.init=t.init),!e.did&&t.did&&(e.did=`${t.did}`),typeof t.started=="number"&&(e.started=t.started),e.ignoreDuration)e.duration=void 0;else if(typeof t.duration=="number")e.duration=t.duration;else{const n=e.timestamp-e.started;e.duration=n>=0?n:0}t.release&&(e.release=t.release),t.environment&&(e.environment=t.environment),!e.ipAddress&&t.ipAddress&&(e.ipAddress=t.ipAddress),!e.userAgent&&t.userAgent&&(e.userAgent=t.userAgent),typeof t.errors=="number"&&(e.errors=t.errors),t.status&&(e.status=t.status)}function Q5(e,t){let n={};e.status==="ok"&&(n={status:"exited"}),Aa(e,n)}function J5(e){return En({sid:`${e.sid}`,init:e.init,started:new Date(e.started*1e3).toISOString(),timestamp:new Date(e.timestamp*1e3).toISOString(),status:e.status,errors:e.errors,did:typeof e.did=="number"||typeof e.did=="string"?`${e.did}`:void 0,duration:e.duration,abnormal_mechanism:e.abnormal_mechanism,attrs:{release:e.release,environment:e.environment,ip_address:e.ipAddress,user_agent:e.userAgent}})}function Yo(){return wr()}function qo(){return wr().substring(16)}function bd(e,t,n=2){if(!t||typeof t!="object"||n<=0)return t;if(e&&t&&Object.keys(t).length===0)return e;const r={...e};for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=bd(r[o],t[o],n-1));return r}const Ah="_sentrySpan";function Qi(e,t){t?xr(e,Ah,t):delete e[Ah]}function Yl(e){return e[Ah]}const ex=100;class Vp{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:Yo(),spanId:qo()}}clone(){const t=new Vp;return t._breadcrumbs=[...this._breadcrumbs],t._tags={...this._tags},t._extra={...this._extra},t._contexts={...this._contexts},this._contexts.flags&&(t._contexts.flags={values:[...this._contexts.flags.values]}),t._user=this._user,t._level=this._level,t._session=this._session,t._transactionName=this._transactionName,t._fingerprint=this._fingerprint,t._eventProcessors=[...this._eventProcessors],t._requestSession=this._requestSession,t._attachments=[...this._attachments],t._sdkProcessingMetadata={...this._sdkProcessingMetadata},t._propagationContext={...this._propagationContext},t._client=this._client,t._lastEventId=this._lastEventId,Qi(t,Yl(this)),t}setClient(t){this._client=t}setLastEventId(t){this._lastEventId=t}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(t){this._scopeListeners.push(t)}addEventProcessor(t){return this._eventProcessors.push(t),this}setUser(t){return this._user=t||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&Aa(this._session,{user:t}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(t){return this._requestSession=t,this}setTags(t){return this._tags={...this._tags,...t},this._notifyScopeListeners(),this}setTag(t,n){return this._tags={...this._tags,[t]:n},this._notifyScopeListeners(),this}setExtras(t){return this._extra={...this._extra,...t},this._notifyScopeListeners(),this}setExtra(t,n){return this._extra={...this._extra,[t]:n},this._notifyScopeListeners(),this}setFingerprint(t){return this._fingerprint=t,this._notifyScopeListeners(),this}setLevel(t){return this._level=t,this._notifyScopeListeners(),this}setTransactionName(t){return this._transactionName=t,this._notifyScopeListeners(),this}setContext(t,n){return n===null?delete this._contexts[t]:this._contexts[t]=n,this._notifyScopeListeners(),this}setSession(t){return t?this._session=t:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(t){if(!t)return this;const n=typeof t=="function"?t(this):t,[r,o]=n instanceof Ns?[n.getScopeData(),n.getRequestSession()]:Ea(n)?[t,t.requestSession]:[],{tags:s,extra:a,user:i,contexts:c,level:l,fingerprint:f=[],propagationContext:d}=r||{};return this._tags={...this._tags,...s},this._extra={...this._extra,...a},this._contexts={...this._contexts,...c},i&&Object.keys(i).length&&(this._user=i),l&&(this._level=l),f.length&&(this._fingerprint=f),d&&(this._propagationContext=d),o&&(this._requestSession=o),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._session=void 0,Qi(this,void 0),this._attachments=[],this.setPropagationContext({traceId:Yo()}),this._notifyScopeListeners(),this}addBreadcrumb(t,n){const r=typeof n=="number"?n:ex;if(r<=0)return this;const o={timestamp:Bc(),...t};return this._breadcrumbs.push(o),this._breadcrumbs.length>r&&(this._breadcrumbs=this._breadcrumbs.slice(-r),this._client&&this._client.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(t){return this._attachments.push(t),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:Yl(this)}}setSDKProcessingMetadata(t){return this._sdkProcessingMetadata=bd(this._sdkProcessingMetadata,t,2),this}setPropagationContext(t){return this._propagationContext={spanId:qo(),...t},this}getPropagationContext(){return this._propagationContext}captureException(t,n){const r=n&&n.event_id?n.event_id:wr();if(!this._client)return Xe.warn("No client configured on scope - will not capture exception!"),r;const o=new Error("Sentry syntheticException");return this._client.captureException(t,{originalException:t,syntheticException:o,...n,event_id:r},this),r}captureMessage(t,n,r){const o=r&&r.event_id?r.event_id:wr();if(!this._client)return Xe.warn("No client configured on scope - will not capture message!"),o;const s=new Error(t);return this._client.captureMessage(t,n,{originalException:t,syntheticException:s,...r,event_id:o},this),o}captureEvent(t,n){const r=n&&n.event_id?n.event_id:wr();return this._client?(this._client.captureEvent(t,{...n,event_id:r},this),r):(Xe.warn("No client configured on scope - will not capture event!"),r)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(t=>{t(this)}),this._notifyingListeners=!1)}}const Ns=Vp;function tx(){return md("defaultCurrentScope",()=>new Ns)}function nx(){return md("defaultIsolationScope",()=>new Ns)}class rx{constructor(t,n){let r;t?r=t:r=new Ns;let o;n?o=n:o=new Ns,this._stack=[{scope:r}],this._isolationScope=o}withScope(t){const n=this._pushScope();let r;try{r=t(n)}catch(o){throw this._popScope(),o}return vd(r)?r.then(o=>(this._popScope(),o),o=>{throw this._popScope(),o}):(this._popScope(),r)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const t=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:t}),t}_popScope(){return this._stack.length<=1?!1:!!this._stack.pop()}}function Ra(){const e=qs(),t=Lp(e);return t.stack=t.stack||new rx(tx(),nx())}function ox(e){return Ra().withScope(e)}function sx(e,t){const n=Ra();return n.withScope(()=>(n.getStackTop().scope=e,t(e)))}function _g(e){return Ra().withScope(()=>e(Ra().getIsolationScope()))}function ax(){return{withIsolationScope:_g,withScope:ox,withSetScope:sx,withSetIsolationScope:(e,t)=>_g(t),getCurrentScope:()=>Ra().getScope(),getIsolationScope:()=>Ra().getIsolationScope()}}function ti(e){const t=Lp(e);return t.acs?t.acs:ax()}function Kt(){const e=qs();return ti(e).getCurrentScope()}function ls(){const e=qs();return ti(e).getIsolationScope()}function ix(){return md("globalScope",()=>new Ns)}function jp(...e){const t=qs(),n=ti(t);if(e.length===2){const[r,o]=e;return r?n.withSetScope(r,o):n.withScope(o)}return n.withScope(e[0])}function Nt(){return Kt().getClient()}function cx(e){const t=e.getPropagationContext(),{traceId:n,spanId:r,parentSpanId:o}=t;return En({trace_id:n,span_id:r,parent_span_id:o})}const lx="_sentryMetrics";function Rh(e){const t=e[lx];if(!t)return;const n={};for(const[,[r,o]]of t)(n[r]||(n[r]=[])).push(En(o));return n}const po="sentry.source",X_="sentry.sample_rate",Ls="sentry.op",xn="sentry.origin",Oh="sentry.idle_span_finish_reason",_d="sentry.measurement_unit",yd="sentry.measurement_value",yg="sentry.custom_span_name",ux="sentry.profile_id",Hp="sentry.exclusive_time",dx=0,K_=1,Sn=2;function fx(e){if(e<400&&e>=100)return{code:K_};if(e>=400&&e<500)switch(e){case 401:return{code:Sn,message:"unauthenticated"};case 403:return{code:Sn,message:"permission_denied"};case 404:return{code:Sn,message:"not_found"};case 409:return{code:Sn,message:"already_exists"};case 413:return{code:Sn,message:"failed_precondition"};case 429:return{code:Sn,message:"resource_exhausted"};case 499:return{code:Sn,message:"cancelled"};default:return{code:Sn,message:"invalid_argument"}}if(e>=500&&e<600)switch(e){case 501:return{code:Sn,message:"unimplemented"};case 503:return{code:Sn,message:"unavailable"};case 504:return{code:Sn,message:"deadline_exceeded"};default:return{code:Sn,message:"internal_error"}}return{code:Sn,message:"unknown_error"}}function Y_(e,t){e.setAttribute("http.response.status_code",t);const n=fx(t);n.message!=="unknown_error"&&e.setStatus(n)}const Up="sentry-",hx=/^sentry-/,px=8192;function q_(e){const t=gx(e);if(!t)return;const n=Object.entries(t).reduce((r,[o,s])=>{if(o.match(hx)){const a=o.slice(Up.length);r[a]=s}return r},{});if(Object.keys(n).length>0)return n}function mx(e){if(!e)return;const t=Object.entries(e).reduce((n,[r,o])=>(o&&(n[`${Up}${r}`]=o),n),{});return vx(t)}function gx(e){if(!(!e||!go(e)&&!Array.isArray(e)))return Array.isArray(e)?e.reduce((t,n)=>{const r=Sg(n);return Object.entries(r).forEach(([o,s])=>{t[o]=s}),t},{}):Sg(e)}function Sg(e){return e.split(",").map(t=>t.split("=").map(n=>decodeURIComponent(n.trim()))).reduce((t,[n,r])=>(n&&r&&(t[n]=r),t),{})}function vx(e){if(Object.keys(e).length!==0)return Object.entries(e).reduce((t,[n,r],o)=>{const s=`${encodeURIComponent(n)}=${encodeURIComponent(r)}`,a=o===0?s:`${t},${s}`;return a.length>px?(as&&Xe.warn(`Not adding key: ${n} with val: ${r} to baggage header due to exceeding baggage size limits.`),t):a},"")}const Z_=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function bx(e){if(!e)return;const t=e.match(Z_);if(!t)return;let n;return t[3]==="1"?n=!0:t[3]==="0"&&(n=!1),{traceId:t[1],parentSampled:n,parentSpanId:t[2]}}function _x(e,t){const n=bx(e),r=q_(t);if(!n||!n.traceId)return{traceId:Yo(),spanId:qo()};const{traceId:o,parentSpanId:s,parentSampled:a}=n,i=qo();return{traceId:o,parentSpanId:s,spanId:i,sampled:a,dsc:r||{}}}function Q_(e=Yo(),t=qo(),n){let r="";return n!==void 0&&(r=n?"-1":"-0"),`${e}-${t}${r}`}const J_=0,e2=1;let kg=!1;function yx(e){const{spanId:t,traceId:n}=e.spanContext(),{data:r,op:o,parent_span_id:s,status:a,origin:i}=Bt(e);return En({parent_span_id:s,span_id:t,trace_id:n,data:r,op:o,status:a,origin:i})}function Sx(e){const{spanId:t,traceId:n,isRemote:r}=e.spanContext(),o=r?t:Bt(e).parent_span_id,s=r?qo():t;return En({parent_span_id:o,span_id:s,trace_id:n})}function kx(e){const{traceId:t,spanId:n}=e.spanContext(),r=Zs(e);return Q_(t,n,r)}function Cs(e){return typeof e=="number"?wg(e):Array.isArray(e)?e[0]+e[1]/1e9:e instanceof Date?wg(e.getTime()):Wn()}function wg(e){return e>9999999999?e/1e3:e}function Bt(e){if(xx(e))return e.getSpanJSON();try{const{spanId:t,traceId:n}=e.spanContext();if(wx(e)){const{attributes:r,startTime:o,name:s,endTime:a,parentSpanId:i,status:c}=e;return En({span_id:t,trace_id:n,data:r,description:s,parent_span_id:i,start_timestamp:Cs(o),timestamp:Cs(a)||void 0,status:t2(c),op:r[Ls],origin:r[xn],_metrics_summary:Rh(e)})}return{span_id:t,trace_id:n}}catch{return{}}}function wx(e){const t=e;return!!t.attributes&&!!t.startTime&&!!t.name&&!!t.endTime&&!!t.status}function xx(e){return typeof e.getSpanJSON=="function"}function Zs(e){const{traceFlags:t}=e.spanContext();return t===e2}function t2(e){if(!(!e||e.code===dx))return e.code===K_?"ok":e.message||"unknown_error"}const Ts="_sentryChildSpans",Ph="_sentryRootSpan";function n2(e,t){const n=e[Ph]||e;xr(t,Ph,n),e[Ts]?e[Ts].add(t):xr(e,Ts,new Set([t]))}function Cx(e,t){e[Ts]&&e[Ts].delete(t)}function Fl(e){const t=new Set;function n(r){if(!t.has(r)&&Zs(r)){t.add(r);const o=r[Ts]?Array.from(r[Ts]):[];for(const s of o)n(s)}}return n(e),Array.from(t)}function Pn(e){return e[Ph]||e}function Dn(){const e=qs(),t=ti(e);return t.getActiveSpan?t.getActiveSpan():Yl(Kt())}function r2(){kg||(Ys(()=>{console.warn("[Sentry] Deprecation warning: Returning null from `beforeSendSpan` will be disallowed from SDK version 9.0.0 onwards. The callback will only support mutating spans. To drop certain spans, configure the respective integrations directly.")}),kg=!0)}let xg=!1;function Tx(){xg||(xg=!0,L_(Bh),z_(Bh))}function Bh(){const e=Dn(),t=e&&Pn(e);if(t){const n="internal_error";pt&&Xe.log(`[Tracing] Root span: ${n} -> Global error occurred`),t.setStatus({code:Sn,message:n})}}Bh.tag="sentry_tracingErrorCallback";const o2="_sentryScope",s2="_sentryIsolationScope";function Mx(e,t,n){e&&(xr(e,s2,n),xr(e,o2,t))}function Cg(e){return{scope:e[o2],isolationScope:e[s2]}}function Zo(e){if(typeof __SENTRY_TRACING__=="boolean"&&!__SENTRY_TRACING__)return!1;const t=Nt(),n=e||t&&t.getOptions();return!!n&&(n.enableTracing||"tracesSampleRate"in n||"tracesSampler"in n)}class ni{constructor(t={}){this._traceId=t.traceId||Yo(),this._spanId=t.spanId||qo()}spanContext(){return{spanId:this._spanId,traceId:this._traceId,traceFlags:J_}}end(t){}setAttribute(t,n){return this}setAttributes(t){return this}setStatus(t){return this}updateName(t){return this}isRecording(){return!1}addEvent(t,n,r){return this}addLink(t){return this}addLinks(t){return this}recordException(t,n){}}const Gp="production",a2="_frozenDsc";function Tg(e,t){xr(e,a2,t)}function i2(e,t){const n=t.getOptions(),{publicKey:r}=t.getDsn()||{},o=En({environment:n.environment||Gp,release:n.release,public_key:r,trace_id:e});return t.emit("createDsc",o),o}function c2(e,t){const n=t.getPropagationContext();return n.dsc||i2(n.traceId,e)}function ri(e){const t=Nt();if(!t)return{};const n=Pn(e),r=n[a2];if(r)return r;const o=n.spanContext().traceState,s=o&&o.get("sentry.dsc"),a=s&&q_(s);if(a)return a;const i=i2(e.spanContext().traceId,t),c=Bt(n),l=c.data||{},f=l[X_];f!=null&&(i.sample_rate=`${f}`);const d=l[po],m=c.description;return d!=="url"&&m&&(i.transaction=m),Zo()&&(i.sampled=String(Zs(n))),t.emit("createDsc",i,n),i}function Ex(e){if(!pt)return;const{description:t="< unknown name >",op:n="< unknown op >",parent_span_id:r}=Bt(e),{spanId:o}=e.spanContext(),s=Zs(e),a=Pn(e),i=a===e,c=`[Tracing] Starting ${s?"sampled":"unsampled"} ${i?"root ":""}span`,l=[`op: ${n}`,`name: ${t}`,`ID: ${o}`];if(r&&l.push(`parent ID: ${r}`),!i){const{op:f,description:d}=Bt(a);l.push(`root ID: ${a.spanContext().spanId}`),f&&l.push(`root op: ${f}`),d&&l.push(`root description: ${d}`)}Xe.log(`${c}
  ${l.join(`
  `)}`)}function Ix(e){if(!pt)return;const{description:t="< unknown name >",op:n="< unknown op >"}=Bt(e),{spanId:r}=e.spanContext(),s=Pn(e)===e,a=`[Tracing] Finishing "${n}" ${s?"root ":""}span "${t}" with ID ${r}`;Xe.log(a)}function l2(e){if(typeof e=="boolean")return Number(e);const t=typeof e=="string"?parseFloat(e):e;if(typeof t!="number"||isNaN(t)||t<0||t>1){pt&&Xe.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(e)} of type ${JSON.stringify(typeof e)}.`);return}return t}function Ax(e,t){if(!Zo(e))return[!1];const n=ls().getScopeData().sdkProcessingMetadata.normalizedRequest,r={...t,normalizedRequest:t.normalizedRequest||n};let o;typeof e.tracesSampler=="function"?o=e.tracesSampler(r):r.parentSampled!==void 0?o=r.parentSampled:typeof e.tracesSampleRate<"u"?o=e.tracesSampleRate:o=1;const s=l2(o);return s===void 0?(pt&&Xe.warn("[Tracing] Discarding transaction because of invalid sample rate."),[!1]):s?Math.random()<s?[!0,s]:(pt&&Xe.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(o)})`),[!1,s]):(pt&&Xe.log(`[Tracing] Discarding transaction because ${typeof e.tracesSampler=="function"?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0"}`),[!1,s])}const Rx=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function Ox(e){return e==="http"||e==="https"}function Dc(e,t=!1){const{host:n,path:r,pass:o,port:s,projectId:a,protocol:i,publicKey:c}=e;return`${i}://${c}${t&&o?`:${o}`:""}@${n}${s?`:${s}`:""}/${r&&`${r}/`}${a}`}function Px(e){const t=Rx.exec(e);if(!t){Ys(()=>{console.error(`Invalid Sentry Dsn: ${e}`)});return}const[n,r,o="",s="",a="",i=""]=t.slice(1);let c="",l=i;const f=l.split("/");if(f.length>1&&(c=f.slice(0,-1).join("/"),l=f.pop()),l){const d=l.match(/^\d+/);d&&(l=d[0])}return u2({host:s,pass:o,path:c,projectId:l,port:a,protocol:n,publicKey:r})}function u2(e){return{protocol:e.protocol,publicKey:e.publicKey||"",pass:e.pass||"",host:e.host,port:e.port||"",path:e.path||"",projectId:e.projectId}}function Bx(e){if(!as)return!0;const{port:t,projectId:n,protocol:r}=e;return["protocol","publicKey","host","projectId"].find(a=>e[a]?!1:(Xe.error(`Invalid Sentry Dsn: ${a} missing`),!0))?!1:n.match(/^\d+$/)?Ox(r)?t&&isNaN(parseInt(t,10))?(Xe.error(`Invalid Sentry Dsn: Invalid port ${t}`),!1):!0:(Xe.error(`Invalid Sentry Dsn: Invalid protocol ${r}`),!1):(Xe.error(`Invalid Sentry Dsn: Invalid projectId ${n}`),!1)}function Dx(e){const t=typeof e=="string"?Px(e):u2(e);if(!(!t||!Bx(t)))return t}function Nx(){const e=typeof WeakSet=="function",t=e?new WeakSet:[];function n(o){if(e)return t.has(o)?!0:(t.add(o),!1);for(let s=0;s<t.length;s++)if(t[s]===o)return!0;return t.push(o),!1}function r(o){if(e)t.delete(o);else for(let s=0;s<t.length;s++)if(t[s]===o){t.splice(s,1);break}}return[n,r]}function uo(e,t=100,n=1/0){try{return Dh("",e,t,n)}catch(r){return{ERROR:`**non-serializable** (${r})`}}}function d2(e,t=3,n=100*1024){const r=uo(e,t);return Wx(r)>n?d2(e,t-1,n):r}function Dh(e,t,n=1/0,r=1/0,o=Nx()){const[s,a]=o;if(t==null||["boolean","string"].includes(typeof t)||typeof t=="number"&&Number.isFinite(t))return t;const i=Lx(e,t);if(!i.startsWith("[object "))return i;if(t.__sentry_skip_normalization__)return t;const c=typeof t.__sentry_override_normalization_depth__=="number"?t.__sentry_override_normalization_depth__:n;if(c===0)return i.replace("object ","");if(s(t))return"[Circular ~]";const l=t;if(l&&typeof l.toJSON=="function")try{const v=l.toJSON();return Dh("",v,c-1,r,o)}catch{}const f=Array.isArray(t)?[]:{};let d=0;const m=H_(t);for(const v in m){if(!Object.prototype.hasOwnProperty.call(m,v))continue;if(d>=r){f[v]="[MaxProperties ~]";break}const _=m[v];f[v]=Dh(v,_,c-1,r,o),d++}return a(t),f}function Lx(e,t){try{if(e==="domain"&&t&&typeof t=="object"&&t._events)return"[Domain]";if(e==="domainEmitter")return"[DomainEmitter]";if(typeof global<"u"&&t===global)return"[Global]";if(typeof window<"u"&&t===window)return"[Window]";if(typeof document<"u"&&t===document)return"[Document]";if($_(t))return"[VueViewModel]";if($5(t))return"[SyntheticEvent]";if(typeof t=="number"&&!Number.isFinite(t))return`[${t}]`;if(typeof t=="function")return`[Function: ${So(t)}]`;if(typeof t=="symbol")return`[${String(t)}]`;if(typeof t=="bigint")return`[BigInt: ${String(t)}]`;const n=zx(t);return/^HTML(\w*)Element$/.test(n)?`[HTMLElement: ${n}]`:`[object ${n}]`}catch(n){return`**non-serializable** (${n})`}}function zx(e){const t=Object.getPrototypeOf(e);return t?t.constructor.name:"null prototype"}function Fx(e){return~-encodeURI(e).split(/%..|./).length}function Wx(e){return Fx(JSON.stringify(e))}function oi(e,t=[]){return[e,t]}function $x(e,t){const[n,r]=e;return[n,[...r,t]]}function Mg(e,t){const n=e[1];for(const r of n){const o=r[0].type;if(t(r,o))return!0}return!1}function Nh(e){return Ot.__SENTRY__&&Ot.__SENTRY__.encodePolyfill?Ot.__SENTRY__.encodePolyfill(e):new TextEncoder().encode(e)}function Vx(e){const[t,n]=e;let r=JSON.stringify(t);function o(s){typeof r=="string"?r=typeof s=="string"?r+s:[Nh(r),s]:r.push(typeof s=="string"?Nh(s):s)}for(const s of n){const[a,i]=s;if(o(`
${JSON.stringify(a)}
`),typeof i=="string"||i instanceof Uint8Array)o(i);else{let c;try{c=JSON.stringify(i)}catch{c=JSON.stringify(uo(i))}o(c)}}return typeof r=="string"?r:jx(r)}function jx(e){const t=e.reduce((o,s)=>o+s.length,0),n=new Uint8Array(t);let r=0;for(const o of e)n.set(o,r),r+=o.length;return n}function Hx(e){return[{type:"span"},e]}function Ux(e){const t=typeof e.data=="string"?Nh(e.data):e.data;return[En({type:"attachment",length:t.length,filename:e.filename,content_type:e.contentType,attachment_type:e.attachmentType}),t]}const Gx={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",statsd:"metric_bucket",raw_security:"security"};function Eg(e){return Gx[e]}function f2(e){if(!e||!e.sdk)return;const{name:t,version:n}=e.sdk;return{name:t,version:n}}function Xx(e,t,n,r){const o=e.sdkProcessingMetadata&&e.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:e.event_id,sent_at:new Date().toISOString(),...t&&{sdk:t},...!!n&&r&&{dsn:Dc(r)},...o&&{trace:En({...o})}}}function Kx(e,t){return t&&(e.sdk=e.sdk||{},e.sdk.name=e.sdk.name||t.name,e.sdk.version=e.sdk.version||t.version,e.sdk.integrations=[...e.sdk.integrations||[],...t.integrations||[]],e.sdk.packages=[...e.sdk.packages||[],...t.packages||[]]),e}function Yx(e,t,n,r){const o=f2(n),s={sent_at:new Date().toISOString(),...o&&{sdk:o},...!!r&&t&&{dsn:Dc(t)}},a="aggregates"in e?[{type:"sessions"},e]:[{type:"session"},e.toJSON()];return oi(s,[a])}function qx(e,t,n,r){const o=f2(n),s=e.type&&e.type!=="replay_event"?e.type:"event";Kx(e,n&&n.sdk);const a=Xx(e,o,r,t);return delete e.sdkProcessingMetadata,oi(a,[[{type:s},e]])}function Zx(e,t){function n(f){return!!f.trace_id&&!!f.public_key}const r=ri(e[0]),o=t&&t.getDsn(),s=t&&t.getOptions().tunnel,a={sent_at:new Date().toISOString(),...n(r)&&{trace:r},...!!s&&o&&{dsn:Dc(o)}},i=t&&t.getOptions().beforeSendSpan,c=i?f=>{const d=i(Bt(f));return d||r2(),d}:f=>Bt(f),l=[];for(const f of e){const d=c(f);d&&l.push(Hx(d))}return oi(a,l)}function Qx(e,t,n,r=Dn()){const o=r&&Pn(r);o&&(pt&&Xe.log(`[Measurement] Setting measurement on root span: ${e} = ${t} ${n}`),o.addEvent(e,{[yd]:t,[_d]:n}))}function Ig(e){if(!e||e.length===0)return;const t={};return e.forEach(n=>{const r=n.attributes||{},o=r[_d],s=r[yd];typeof o=="string"&&typeof s=="number"&&(t[n.name]={value:s,unit:o})}),t}const Ag=1e3;class Xp{constructor(t={}){this._traceId=t.traceId||Yo(),this._spanId=t.spanId||qo(),this._startTime=t.startTimestamp||Wn(),this._attributes={},this.setAttributes({[xn]:"manual",[Ls]:t.op,...t.attributes}),this._name=t.name,t.parentSpanId&&(this._parentSpanId=t.parentSpanId),"sampled"in t&&(this._sampled=t.sampled),t.endTimestamp&&(this._endTime=t.endTimestamp),this._events=[],this._isStandaloneSpan=t.isStandalone,this._endTime&&this._onSpanEnded()}addLink(t){return this}addLinks(t){return this}recordException(t,n){}spanContext(){const{_spanId:t,_traceId:n,_sampled:r}=this;return{spanId:t,traceId:n,traceFlags:r?e2:J_}}setAttribute(t,n){return n===void 0?delete this._attributes[t]:this._attributes[t]=n,this}setAttributes(t){return Object.keys(t).forEach(n=>this.setAttribute(n,t[n])),this}updateStartTime(t){this._startTime=Cs(t)}setStatus(t){return this._status=t,this}updateName(t){return this._name=t,this.setAttribute(po,"custom"),this}end(t){this._endTime||(this._endTime=Cs(t),Ix(this),this._onSpanEnded())}getSpanJSON(){return En({data:this._attributes,description:this._name,op:this._attributes[Ls],parent_span_id:this._parentSpanId,span_id:this._spanId,start_timestamp:this._startTime,status:t2(this._status),timestamp:this._endTime,trace_id:this._traceId,origin:this._attributes[xn],_metrics_summary:Rh(this),profile_id:this._attributes[ux],exclusive_time:this._attributes[Hp],measurements:Ig(this._events),is_segment:this._isStandaloneSpan&&Pn(this)===this||void 0,segment_id:this._isStandaloneSpan?Pn(this).spanContext().spanId:void 0})}isRecording(){return!this._endTime&&!!this._sampled}addEvent(t,n,r){pt&&Xe.log("[Tracing] Adding an event to span:",t);const o=Rg(n)?n:r||Wn(),s=Rg(n)?{}:n||{},a={name:t,time:Cs(o),attributes:s};return this._events.push(a),this}isStandaloneSpan(){return!!this._isStandaloneSpan}_onSpanEnded(){const t=Nt();if(t&&t.emit("spanEnd",this),!(this._isStandaloneSpan||this===Pn(this)))return;if(this._isStandaloneSpan){this._sampled?eC(Zx([this],t)):(pt&&Xe.log("[Tracing] Discarding standalone span because its trace was not chosen to be sampled."),t&&t.recordDroppedEvent("sample_rate","span"));return}const r=this._convertSpanToTransaction();r&&(Cg(this).scope||Kt()).captureEvent(r)}_convertSpanToTransaction(){if(!Og(Bt(this)))return;this._name||(pt&&Xe.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this._name="<unlabeled transaction>");const{scope:t,isolationScope:n}=Cg(this),o=(t||Kt()).getClient()||Nt();if(this._sampled!==!0){pt&&Xe.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled."),o&&o.recordDroppedEvent("sample_rate","transaction");return}const a=Fl(this).filter(d=>d!==this&&!Jx(d)).map(d=>Bt(d)).filter(Og),i=this._attributes[po];delete this._attributes[yg],a.forEach(d=>{d.data&&delete d.data[yg]});const c={contexts:{trace:yx(this)},spans:a.length>Ag?a.sort((d,m)=>d.start_timestamp-m.start_timestamp).slice(0,Ag):a,start_timestamp:this._startTime,timestamp:this._endTime,transaction:this._name,type:"transaction",sdkProcessingMetadata:{capturedSpanScope:t,capturedSpanIsolationScope:n,...En({dynamicSamplingContext:ri(this)})},_metrics_summary:Rh(this),...i&&{transaction_info:{source:i}}},l=Ig(this._events);return l&&Object.keys(l).length&&(pt&&Xe.log("[Measurements] Adding measurements to transaction event",JSON.stringify(l,void 0,2)),c.measurements=l),c}}function Rg(e){return e&&typeof e=="number"||e instanceof Date||Array.isArray(e)}function Og(e){return!!e.start_timestamp&&!!e.timestamp&&!!e.span_id&&!!e.trace_id}function Jx(e){return e instanceof Xp&&e.isStandaloneSpan()}function eC(e){const t=Nt();if(!t)return;const n=e[1];if(!n||n.length===0){t.recordDroppedEvent("before_send","span");return}t.sendEnvelope(e)}const h2="__SENTRY_SUPPRESS_TRACING__";function Nc(e){const t=m2();if(t.startInactiveSpan)return t.startInactiveSpan(e);const n=nC(e),{forceTransaction:r,parentSpan:o}=e;return(e.scope?a=>jp(e.scope,a):o!==void 0?a=>p2(o,a):a=>a())(()=>{const a=Kt(),i=oC(a);return e.onlyIfParent&&!i?new ni:tC({parentSpan:i,spanArguments:n,forceTransaction:r,scope:a})})}function p2(e,t){const n=m2();return n.withActiveSpan?n.withActiveSpan(e,t):jp(r=>(Qi(r,e||void 0),t(r)))}function tC({parentSpan:e,spanArguments:t,forceTransaction:n,scope:r}){if(!Zo())return new ni;const o=ls();let s;if(e&&!n)s=rC(e,r,t),n2(e,s);else if(e){const a=ri(e),{traceId:i,spanId:c}=e.spanContext(),l=Zs(e);s=Pg({traceId:i,parentSpanId:c,...t},r,l),Tg(s,a)}else{const{traceId:a,dsc:i,parentSpanId:c,sampled:l}={...o.getPropagationContext(),...r.getPropagationContext()};s=Pg({traceId:a,parentSpanId:c,...t},r,l),i&&Tg(s,i)}return Ex(s),Mx(s,r,o),s}function nC(e){const n={isStandalone:(e.experimental||{}).standalone,...e};if(e.startTime){const r={...n};return r.startTimestamp=Cs(e.startTime),delete r.startTime,r}return n}function m2(){const e=qs();return ti(e)}function Pg(e,t,n){const r=Nt(),o=r&&r.getOptions()||{},{name:s="",attributes:a}=e,[i,c]=t.getScopeData().sdkProcessingMetadata[h2]?[!1]:Ax(o,{name:s,parentSampled:n,attributes:a,transactionContext:{name:s,parentSampled:n}}),l=new Xp({...e,attributes:{[po]:"custom",...e.attributes},sampled:i});return c!==void 0&&l.setAttribute(X_,c),r&&r.emit("spanStart",l),l}function rC(e,t,n){const{spanId:r,traceId:o}=e.spanContext(),s=t.getScopeData().sdkProcessingMetadata[h2]?!1:Zs(e),a=s?new Xp({...n,parentSpanId:r,traceId:o,sampled:s}):new ni({traceId:o});n2(e,a);const i=Nt();return i&&(i.emit("spanStart",a),n.endTimestamp&&i.emit("spanEnd",a)),a}function oC(e){const t=Yl(e);if(!t)return;const n=Nt();return(n?n.getOptions():{}).parentSpanIsAlwaysRootSpan?Pn(t):t}const Wl={idleTimeout:1e3,finalTimeout:3e4,childSpanTimeout:15e3},sC="heartbeatFailed",aC="idleTimeout",iC="finalTimeout",cC="externalFinish";function g2(e,t={}){const n=new Map;let r=!1,o,s=cC,a=!t.disableAutoFinish;const i=[],{idleTimeout:c=Wl.idleTimeout,finalTimeout:l=Wl.finalTimeout,childSpanTimeout:f=Wl.childSpanTimeout,beforeSpanEnd:d}=t,m=Nt();if(!m||!Zo())return new ni;const v=Kt(),_=Dn(),y=lC(e);y.end=new Proxy(y.end,{apply(w,I,M){d&&d(y);const[H,...j]=M,W=H||Wn(),A=Cs(W),L=Fl(y).filter(X=>X!==y);if(!L.length)return x(A),Reflect.apply(w,I,[A,...j]);const B=L.map(X=>Bt(X).timestamp).filter(X=>!!X),P=B.length?Math.max(...B):void 0,V=Bt(y).start_timestamp,U=Math.min(V?V+l/1e3:1/0,Math.max(V||-1/0,Math.min(A,P||1/0)));return x(U),Reflect.apply(w,I,[U,...j])}});function k(){o&&(clearTimeout(o),o=void 0)}function g(w){k(),o=setTimeout(()=>{!r&&n.size===0&&a&&(s=aC,y.end(w))},c)}function b(w){o=setTimeout(()=>{!r&&a&&(s=sC,y.end(w))},f)}function h(w){k(),n.set(w,!0);const I=Wn();b(I+f/1e3)}function S(w){if(n.has(w)&&n.delete(w),n.size===0){const I=Wn();g(I+c/1e3)}}function x(w){r=!0,n.clear(),i.forEach(A=>A()),Qi(v,_);const I=Bt(y),{start_timestamp:M}=I;if(!M)return;(I.data||{})[Oh]||y.setAttribute(Oh,s),Xe.log(`[Tracing] Idle span "${I.op}" finished`);const j=Fl(y).filter(A=>A!==y);let W=0;j.forEach(A=>{A.isRecording()&&(A.setStatus({code:Sn,message:"cancelled"}),A.end(w),pt&&Xe.log("[Tracing] Cancelling span since span ended early",JSON.stringify(A,void 0,2)));const L=Bt(A),{timestamp:B=0,start_timestamp:P=0}=L,V=P<=w,U=(l+c)/1e3,X=B-P<=U;if(pt){const te=JSON.stringify(A,void 0,2);V?X||Xe.log("[Tracing] Discarding span since it finished after idle span final timeout",te):Xe.log("[Tracing] Discarding span since it happened after idle span was finished",te)}(!X||!V)&&(Cx(y,A),W++)}),W>0&&y.setAttribute("sentry.idle_span_discarded_spans",W)}return i.push(m.on("spanStart",w=>{if(r||w===y||Bt(w).timestamp)return;Fl(y).includes(w)&&h(w.spanContext().spanId)})),i.push(m.on("spanEnd",w=>{r||S(w.spanContext().spanId)})),i.push(m.on("idleSpanEnableAutoFinish",w=>{w===y&&(a=!0,g(),n.size&&b())})),t.disableAutoFinish||g(),setTimeout(()=>{r||(y.setStatus({code:Sn,message:"deadline_exceeded"}),s=iC,y.end())},l),y}function lC(e){const t=Nc(e);return Qi(Kt(),t),pt&&Xe.log("[Tracing] Started span is an idle span"),t}function Lh(e,t,n,r=0){return new Sr((o,s)=>{const a=e[r];if(t===null||typeof a!="function")o(t);else{const i=a({...t},n);pt&&a.id&&i===null&&Xe.log(`Event processor "${a.id}" dropped event`),vd(i)?i.then(c=>Lh(e,c,n,r+1).then(o)).then(null,s):Lh(e,i,n,r+1).then(o).then(null,s)}})}let ml,Bg,gl;function uC(e){const t=Ot._sentryDebugIds;if(!t)return{};const n=Object.keys(t);return gl&&n.length===Bg||(Bg=n.length,gl=n.reduce((r,o)=>{ml||(ml={});const s=ml[o];if(s)r[s[0]]=s[1];else{const a=e(o);for(let i=a.length-1;i>=0;i--){const c=a[i],l=c&&c.filename,f=t[o];if(l&&f){r[l]=f,ml[o]=[l,f];break}}}return r},{})),gl}function dC(e,t){const{fingerprint:n,span:r,breadcrumbs:o,sdkProcessingMetadata:s}=t;fC(e,t),r&&mC(e,r),gC(e,n),hC(e,o),pC(e,s)}function Dg(e,t){const{extra:n,tags:r,user:o,contexts:s,level:a,sdkProcessingMetadata:i,breadcrumbs:c,fingerprint:l,eventProcessors:f,attachments:d,propagationContext:m,transactionName:v,span:_}=t;vl(e,"extra",n),vl(e,"tags",r),vl(e,"user",o),vl(e,"contexts",s),e.sdkProcessingMetadata=bd(e.sdkProcessingMetadata,i,2),a&&(e.level=a),v&&(e.transactionName=v),_&&(e.span=_),c.length&&(e.breadcrumbs=[...e.breadcrumbs,...c]),l.length&&(e.fingerprint=[...e.fingerprint,...l]),f.length&&(e.eventProcessors=[...e.eventProcessors,...f]),d.length&&(e.attachments=[...e.attachments,...d]),e.propagationContext={...e.propagationContext,...m}}function vl(e,t,n){e[t]=bd(e[t],n,1)}function fC(e,t){const{extra:n,tags:r,user:o,contexts:s,level:a,transactionName:i}=t,c=En(n);c&&Object.keys(c).length&&(e.extra={...c,...e.extra});const l=En(r);l&&Object.keys(l).length&&(e.tags={...l,...e.tags});const f=En(o);f&&Object.keys(f).length&&(e.user={...f,...e.user});const d=En(s);d&&Object.keys(d).length&&(e.contexts={...d,...e.contexts}),a&&(e.level=a),i&&e.type!=="transaction"&&(e.transaction=i)}function hC(e,t){const n=[...e.breadcrumbs||[],...t];e.breadcrumbs=n.length?n:void 0}function pC(e,t){e.sdkProcessingMetadata={...e.sdkProcessingMetadata,...t}}function mC(e,t){e.contexts={trace:Sx(t),...e.contexts},e.sdkProcessingMetadata={dynamicSamplingContext:ri(t),...e.sdkProcessingMetadata};const n=Pn(t),r=Bt(n).description;r&&!e.transaction&&e.type==="transaction"&&(e.transaction=r)}function gC(e,t){e.fingerprint=e.fingerprint?Array.isArray(e.fingerprint)?e.fingerprint:[e.fingerprint]:[],t&&(e.fingerprint=e.fingerprint.concat(t)),e.fingerprint&&!e.fingerprint.length&&delete e.fingerprint}function vC(e,t,n,r,o,s){const{normalizeDepth:a=3,normalizeMaxBreadth:i=1e3}=e,c={...t,event_id:t.event_id||n.event_id||wr(),timestamp:t.timestamp||Bc()},l=n.integrations||e.integrations.map(k=>k.name);bC(c,e),SC(c,l),o&&o.emit("applyFrameMetadata",t),t.type===void 0&&_C(c,e.stackParser);const f=wC(r,n.captureContext);n.mechanism&&Ia(c,n.mechanism);const d=o?o.getEventProcessors():[],m=ix().getScopeData();if(s){const k=s.getScopeData();Dg(m,k)}if(f){const k=f.getScopeData();Dg(m,k)}const v=[...n.attachments||[],...m.attachments];v.length&&(n.attachments=v),dC(c,m);const _=[...d,...m.eventProcessors];return Lh(_,c,n).then(k=>(k&&yC(k),typeof a=="number"&&a>0?kC(k,a,i):k))}function bC(e,t){const{environment:n,release:r,dist:o,maxValueLength:s=250}=t;e.environment=e.environment||n||Gp,!e.release&&r&&(e.release=r),!e.dist&&o&&(e.dist=o),e.message&&(e.message=ya(e.message,s));const a=e.exception&&e.exception.values&&e.exception.values[0];a&&a.value&&(a.value=ya(a.value,s));const i=e.request;i&&i.url&&(i.url=ya(i.url,s))}function _C(e,t){const n=uC(t);try{e.exception.values.forEach(r=>{r.stacktrace.frames.forEach(o=>{n&&o.filename&&(o.debug_id=n[o.filename])})})}catch{}}function yC(e){const t={};try{e.exception.values.forEach(r=>{r.stacktrace.frames.forEach(o=>{o.debug_id&&(o.abs_path?t[o.abs_path]=o.debug_id:o.filename&&(t[o.filename]=o.debug_id),delete o.debug_id)})})}catch{}if(Object.keys(t).length===0)return;e.debug_meta=e.debug_meta||{},e.debug_meta.images=e.debug_meta.images||[];const n=e.debug_meta.images;Object.entries(t).forEach(([r,o])=>{n.push({type:"sourcemap",code_file:r,debug_id:o})})}function SC(e,t){t.length>0&&(e.sdk=e.sdk||{},e.sdk.integrations=[...e.sdk.integrations||[],...t])}function kC(e,t,n){if(!e)return null;const r={...e,...e.breadcrumbs&&{breadcrumbs:e.breadcrumbs.map(o=>({...o,...o.data&&{data:uo(o.data,t,n)}}))},...e.user&&{user:uo(e.user,t,n)},...e.contexts&&{contexts:uo(e.contexts,t,n)},...e.extra&&{extra:uo(e.extra,t,n)}};return e.contexts&&e.contexts.trace&&r.contexts&&(r.contexts.trace=e.contexts.trace,e.contexts.trace.data&&(r.contexts.trace.data=uo(e.contexts.trace.data,t,n))),e.spans&&(r.spans=e.spans.map(o=>({...o,...o.data&&{data:uo(o.data,t,n)}}))),e.contexts&&e.contexts.flags&&r.contexts&&(r.contexts.flags=uo(e.contexts.flags,3,n)),r}function wC(e,t){if(!t)return e;const n=e?e.clone():new Ns;return n.update(t),n}function xC(e,t){return Kt().captureException(e,void 0)}function v2(e,t){return Kt().captureEvent(e,t)}function CC(){const e=Nt();return!!e&&e.getOptions().enabled!==!1&&!!e.getTransport()}function Ng(e){const t=Nt(),n=ls(),r=Kt(),{release:o,environment:s=Gp}=t&&t.getOptions()||{},{userAgent:a}=Ot.navigator||{},i=Z5({release:o,environment:s,user:r.getUser()||n.getUser(),...a&&{userAgent:a},...e}),c=n.getSession();return c&&c.status==="ok"&&Aa(c,{status:"exited"}),b2(),n.setSession(i),r.setSession(i),i}function b2(){const e=ls(),t=Kt(),n=t.getSession()||e.getSession();n&&Q5(n),_2(),e.setSession(),t.setSession()}function _2(){const e=ls(),t=Kt(),n=Nt(),r=t.getSession()||e.getSession();r&&n&&n.captureSession(r)}function Lg(e=!1){if(e){b2();return}_2()}const TC="7";function MC(e){const t=e.protocol?`${e.protocol}:`:"",n=e.port?`:${e.port}`:"";return`${t}//${e.host}${n}${e.path?`/${e.path}`:""}/api/`}function EC(e){return`${MC(e)}${e.projectId}/envelope/`}function IC(e,t){const n={sentry_version:TC};return e.publicKey&&(n.sentry_key=e.publicKey),t&&(n.sentry_client=`${t.name}/${t.version}`),new URLSearchParams(n).toString()}function AC(e,t,n){return t||`${EC(e)}?${IC(e,n)}`}const zg=[];function RC(e){const t={};return e.forEach(n=>{const{name:r}=n,o=t[r];o&&!o.isDefaultInstance&&n.isDefaultInstance||(t[r]=n)}),Object.values(t)}function OC(e){const t=e.defaultIntegrations||[],n=e.integrations;t.forEach(a=>{a.isDefaultInstance=!0});let r;if(Array.isArray(n))r=[...t,...n];else if(typeof n=="function"){const a=n(t);r=Array.isArray(a)?a:[a]}else r=t;const o=RC(r),s=o.findIndex(a=>a.name==="Debug");if(s>-1){const[a]=o.splice(s,1);o.push(a)}return o}function PC(e,t){const n={};return t.forEach(r=>{r&&y2(e,r,n)}),n}function Fg(e,t){for(const n of t)n&&n.afterAllSetup&&n.afterAllSetup(e)}function y2(e,t,n){if(n[t.name]){pt&&Xe.log(`Integration skipped because it was already installed: ${t.name}`);return}if(n[t.name]=t,zg.indexOf(t.name)===-1&&typeof t.setupOnce=="function"&&(t.setupOnce(),zg.push(t.name)),t.setup&&typeof t.setup=="function"&&t.setup(e),typeof t.preprocessEvent=="function"){const r=t.preprocessEvent.bind(t);e.on("preprocessEvent",(o,s)=>r(o,s,e))}if(typeof t.processEvent=="function"){const r=t.processEvent.bind(t),o=Object.assign((s,a)=>r(s,a,e),{id:t.name});e.addEventProcessor(o)}pt&&Xe.log(`Integration installed: ${t.name}`)}function BC(e,t,n){const r=[{type:"client_report"},{timestamp:Bc(),discarded_events:e}];return oi(t?{dsn:t}:{},[r])}class Ar extends Error{constructor(t,n="warn"){super(t),this.message=t,this.logLevel=n}}const Wg="Not capturing exception because it's already been captured.";class DC{constructor(t){if(this._options=t,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],t.dsn?this._dsn=Dx(t.dsn):pt&&Xe.warn("No DSN provided, client will not send events."),this._dsn){const o=AC(this._dsn,t.tunnel,t._metadata?t._metadata.sdk:void 0);this._transport=t.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...t.transportOptions,url:o})}const r=["enableTracing","tracesSampleRate","tracesSampler"].find(o=>o in t&&t[o]==null);r&&Ys(()=>{console.warn(`[Sentry] Deprecation warning: \`${r}\` is set to undefined, which leads to tracing being enabled. In v9, a value of \`undefined\` will result in tracing being disabled.`)})}captureException(t,n,r){const o=wr();if(bg(t))return pt&&Xe.log(Wg),o;const s={event_id:o,...n};return this._process(this.eventFromException(t,s).then(a=>this._captureEvent(a,s,r))),s.event_id}captureMessage(t,n,r,o){const s={event_id:wr(),...r},a=Fp(t)?t:String(t),i=Wp(t)?this.eventFromMessage(a,n,s):this.eventFromException(t,s);return this._process(i.then(c=>this._captureEvent(c,s,o))),s.event_id}captureEvent(t,n,r){const o=wr();if(n&&n.originalException&&bg(n.originalException))return pt&&Xe.log(Wg),o;const s={event_id:o,...n},i=(t.sdkProcessingMetadata||{}).capturedSpanScope;return this._process(this._captureEvent(t,s,i||r)),s.event_id}captureSession(t){typeof t.release!="string"?pt&&Xe.warn("Discarded session because of missing or non-string release"):(this.sendSession(t),Aa(t,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(t){const n=this._transport;return n?(this.emit("flush"),this._isClientDoneProcessing(t).then(r=>n.flush(t).then(o=>r&&o))):Ds(!0)}close(t){return this.flush(t).then(n=>(this.getOptions().enabled=!1,this.emit("close"),n))}getEventProcessors(){return this._eventProcessors}addEventProcessor(t){this._eventProcessors.push(t)}init(){(this._isEnabled()||this._options.integrations.some(({name:t})=>t.startsWith("Spotlight")))&&this._setupIntegrations()}getIntegrationByName(t){return this._integrations[t]}addIntegration(t){const n=this._integrations[t.name];y2(this,t,this._integrations),n||Fg(this,[t])}sendEvent(t,n={}){this.emit("beforeSendEvent",t,n);let r=qx(t,this._dsn,this._options._metadata,this._options.tunnel);for(const s of n.attachments||[])r=$x(r,Ux(s));const o=this.sendEnvelope(r);o&&o.then(s=>this.emit("afterSendEvent",t,s),null)}sendSession(t){const n=Yx(t,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(n)}recordDroppedEvent(t,n,r){if(this._options.sendClientReports){const o=typeof r=="number"?r:1,s=`${t}:${n}`;pt&&Xe.log(`Recording outcome: "${s}"${o>1?` (${o} times)`:""}`),this._outcomes[s]=(this._outcomes[s]||0)+o}}on(t,n){const r=this._hooks[t]=this._hooks[t]||[];return r.push(n),()=>{const o=r.indexOf(n);o>-1&&r.splice(o,1)}}emit(t,...n){const r=this._hooks[t];r&&r.forEach(o=>o(...n))}sendEnvelope(t){return this.emit("beforeEnvelope",t),this._isEnabled()&&this._transport?this._transport.send(t).then(null,n=>(pt&&Xe.error("Error while sending envelope:",n),n)):(pt&&Xe.error("Transport disabled"),Ds({}))}_setupIntegrations(){const{integrations:t}=this._options;this._integrations=PC(this,t),Fg(this,t)}_updateSessionFromEvent(t,n){let r=n.level==="fatal",o=!1;const s=n.exception&&n.exception.values;if(s){o=!0;for(const c of s){const l=c.mechanism;if(l&&l.handled===!1){r=!0;break}}}const a=t.status==="ok";(a&&t.errors===0||a&&r)&&(Aa(t,{...r&&{status:"crashed"},errors:t.errors||Number(o||r)}),this.captureSession(t))}_isClientDoneProcessing(t){return new Sr(n=>{let r=0;const o=1,s=setInterval(()=>{this._numProcessing==0?(clearInterval(s),n(!0)):(r+=o,t&&r>=t&&(clearInterval(s),n(!1)))},o)})}_isEnabled(){return this.getOptions().enabled!==!1&&this._transport!==void 0}_prepareEvent(t,n,r=Kt(),o=ls()){const s=this.getOptions(),a=Object.keys(this._integrations);return!n.integrations&&a.length>0&&(n.integrations=a),this.emit("preprocessEvent",t,n),t.type||o.setLastEventId(t.event_id||n.event_id),vC(s,t,n,r,this,o).then(i=>{if(i===null)return i;i.contexts={trace:cx(r),...i.contexts};const c=c2(this,r);return i.sdkProcessingMetadata={dynamicSamplingContext:c,...i.sdkProcessingMetadata},i})}_captureEvent(t,n={},r){return this._processEvent(t,n,r).then(o=>o.event_id,o=>{pt&&(o instanceof Ar&&o.logLevel==="log"?Xe.log(o.message):Xe.warn(o))})}_processEvent(t,n,r){const o=this.getOptions(),{sampleRate:s}=o,a=k2(t),i=S2(t),c=t.type||"error",l=`before send for type \`${c}\``,f=typeof s>"u"?void 0:l2(s);if(i&&typeof f=="number"&&Math.random()>f)return this.recordDroppedEvent("sample_rate","error",t),Kl(new Ar(`Discarding event because it's not included in the random sample (sampling rate = ${s})`,"log"));const d=c==="replay_event"?"replay":c,v=(t.sdkProcessingMetadata||{}).capturedSpanIsolationScope;return this._prepareEvent(t,n,r,v).then(_=>{if(_===null)throw this.recordDroppedEvent("event_processor",d,t),new Ar("An event processor returned `null`, will not send event.","log");if(n.data&&n.data.__sentry__===!0)return _;const k=LC(this,o,_,n);return NC(k,l)}).then(_=>{if(_===null){if(this.recordDroppedEvent("before_send",d,t),a){const b=1+(t.spans||[]).length;this.recordDroppedEvent("before_send","span",b)}throw new Ar(`${l} returned \`null\`, will not send event.`,"log")}const y=r&&r.getSession();if(!a&&y&&this._updateSessionFromEvent(y,_),a){const g=_.sdkProcessingMetadata&&_.sdkProcessingMetadata.spanCountBeforeProcessing||0,b=_.spans?_.spans.length:0,h=g-b;h>0&&this.recordDroppedEvent("before_send","span",h)}const k=_.transaction_info;if(a&&k&&_.transaction!==t.transaction){const g="custom";_.transaction_info={...k,source:g}}return this.sendEvent(_,n),_}).then(null,_=>{throw _ instanceof Ar?_:(this.captureException(_,{data:{__sentry__:!0},originalException:_}),new Ar(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${_}`))})}_process(t){this._numProcessing++,t.then(n=>(this._numProcessing--,n),n=>(this._numProcessing--,n))}_clearOutcomes(){const t=this._outcomes;return this._outcomes={},Object.entries(t).map(([n,r])=>{const[o,s]=n.split(":");return{reason:o,category:s,quantity:r}})}_flushOutcomes(){pt&&Xe.log("Flushing outcomes...");const t=this._clearOutcomes();if(t.length===0){pt&&Xe.log("No outcomes to send");return}if(!this._dsn){pt&&Xe.log("No dsn provided, will not send outcomes");return}pt&&Xe.log("Sending outcomes:",t);const n=BC(t,this._options.tunnel&&Dc(this._dsn));this.sendEnvelope(n)}}function NC(e,t){const n=`${t} must return \`null\` or a valid event.`;if(vd(e))return e.then(r=>{if(!Ea(r)&&r!==null)throw new Ar(n);return r},r=>{throw new Ar(`${t} rejected with ${r}`)});if(!Ea(e)&&e!==null)throw new Ar(n);return e}function LC(e,t,n,r){const{beforeSend:o,beforeSendTransaction:s,beforeSendSpan:a}=t;if(S2(n)&&o)return o(n,r);if(k2(n)){if(n.spans&&a){const i=[];for(const c of n.spans){const l=a(c);l?i.push(l):(r2(),e.recordDroppedEvent("before_send","span"))}n.spans=i}if(s){if(n.spans){const i=n.spans.length;n.sdkProcessingMetadata={...n.sdkProcessingMetadata,spanCountBeforeProcessing:i}}return s(n,r)}}return n}function S2(e){return e.type===void 0}function k2(e){return e.type==="transaction"}function zC(e,t){t.debug===!0&&(pt?Xe.enable():Ys(()=>{console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.")})),Kt().update(t.initialScope);const r=new e(t);return FC(r),r.init(),r}function FC(e){Kt().setClient(e)}function WC(e){const t=[];function n(){return e===void 0||t.length<e}function r(a){return t.splice(t.indexOf(a),1)[0]||Promise.resolve(void 0)}function o(a){if(!n())return Kl(new Ar("Not adding Promise because buffer limit was reached."));const i=a();return t.indexOf(i)===-1&&t.push(i),i.then(()=>r(i)).then(null,()=>r(i).then(null,()=>{})),i}function s(a){return new Sr((i,c)=>{let l=t.length;if(!l)return i(!0);const f=setTimeout(()=>{a&&a>0&&i(!1)},a);t.forEach(d=>{Ds(d).then(()=>{--l||(clearTimeout(f),i(!0))},c)})})}return{$:t,add:o,drain:s}}const $C=60*1e3;function VC(e,t=Date.now()){const n=parseInt(`${e}`,10);if(!isNaN(n))return n*1e3;const r=Date.parse(`${e}`);return isNaN(r)?$C:r-t}function jC(e,t){return e[t]||e.all||0}function HC(e,t,n=Date.now()){return jC(e,t)>n}function UC(e,{statusCode:t,headers:n},r=Date.now()){const o={...e},s=n&&n["x-sentry-rate-limits"],a=n&&n["retry-after"];if(s)for(const i of s.trim().split(",")){const[c,l,,,f]=i.split(":",5),d=parseInt(c,10),m=(isNaN(d)?60:d)*1e3;if(!l)o.all=r+m;else for(const v of l.split(";"))v==="metric_bucket"?(!f||f.split(";").includes("custom"))&&(o[v]=r+m):o[v]=r+m}else a?o.all=r+VC(a,r):t===429&&(o.all=r+60*1e3);return o}const GC=64;function XC(e,t,n=WC(e.bufferSize||GC)){let r={};const o=a=>n.drain(a);function s(a){const i=[];if(Mg(a,(d,m)=>{const v=Eg(m);if(HC(r,v)){const _=$g(d,m);e.recordDroppedEvent("ratelimit_backoff",v,_)}else i.push(d)}),i.length===0)return Ds({});const c=oi(a[0],i),l=d=>{Mg(c,(m,v)=>{const _=$g(m,v);e.recordDroppedEvent(d,Eg(v),_)})},f=()=>t({body:Vx(c)}).then(d=>(d.statusCode!==void 0&&(d.statusCode<200||d.statusCode>=300)&&pt&&Xe.warn(`Sentry responded with status code ${d.statusCode} to sent event.`),r=UC(r,d),d),d=>{throw l("network_error"),d});return n.add(f).then(d=>d,d=>{if(d instanceof Ar)return pt&&Xe.error("Skipped sending event because buffer is full."),l("queue_overflow"),Ds({});throw d})}return{send:s,flush:o}}function $g(e,t){if(!(t!=="event"&&t!=="transaction"))return Array.isArray(e)?e[1]:void 0}function KC(e,t,n=[t],r="npm"){const o=e._metadata||{};o.sdk||(o.sdk={name:`sentry.javascript.${t}`,packages:n.map(s=>({name:`${r}:@sentry/${s}`,version:ws})),version:ws}),e._metadata=o}function w2(e={}){const t=Nt();if(!CC()||!t)return{};const n=qs(),r=ti(n);if(r.getTraceData)return r.getTraceData(e);const o=Kt(),s=e.span||Dn(),a=s?kx(s):YC(o),i=s?ri(s):c2(t,o),c=mx(i);return Z_.test(a)?{"sentry-trace":a,baggage:c}:(Xe.warn("Invalid sentry-trace data. Cannot generate trace data"),{})}function YC(e){const{traceId:t,sampled:n,spanId:r}=e.getPropagationContext();return Q_(t,r,n)}const qC=100;function zs(e,t){const n=Nt(),r=ls();if(!n)return;const{beforeBreadcrumb:o=null,maxBreadcrumbs:s=qC}=n.getOptions();if(s<=0)return;const i={timestamp:Bc(),...e},c=o?Ys(()=>o(i,t)):i;c!==null&&(n.emit&&n.emit("beforeAddBreadcrumb",c,t),r.addBreadcrumb(c,s))}let Vg;const ZC="FunctionToString",jg=new WeakMap,QC=()=>({name:ZC,setupOnce(){Vg=Function.prototype.toString;try{Function.prototype.toString=function(...e){const t=$p(this),n=jg.has(Nt())&&t!==void 0?t:this;return Vg.apply(n,e)}}catch{}},setup(e){jg.set(e,!0)}}),JC=QC,eT=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,"undefined is not an object (evaluating 'a.L')",`can't redefine non-configurable property "solana"`,"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler",/^Non-Error promise rejection captured with value: Object Not Found Matching Id:\d+, MethodName:simulateEvent, ParamCount:\d+$/],tT="InboundFilters",nT=(e={})=>({name:tT,processEvent(t,n,r){const o=r.getOptions(),s=oT(e,o);return sT(t,s)?null:t}}),rT=nT;function oT(e={},t={}){return{allowUrls:[...e.allowUrls||[],...t.allowUrls||[]],denyUrls:[...e.denyUrls||[],...t.denyUrls||[]],ignoreErrors:[...e.ignoreErrors||[],...t.ignoreErrors||[],...e.disableErrorDefaults?[]:eT],ignoreTransactions:[...e.ignoreTransactions||[],...t.ignoreTransactions||[]],ignoreInternal:e.ignoreInternal!==void 0?e.ignoreInternal:!0}}function sT(e,t){return t.ignoreInternal&&dT(e)?(pt&&Xe.warn(`Event dropped due to being internal Sentry Error.
Event: ${$o(e)}`),!0):aT(e,t.ignoreErrors)?(pt&&Xe.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${$o(e)}`),!0):hT(e)?(pt&&Xe.warn(`Event dropped due to not having an error message, error type or stacktrace.
Event: ${$o(e)}`),!0):iT(e,t.ignoreTransactions)?(pt&&Xe.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.
Event: ${$o(e)}`),!0):cT(e,t.denyUrls)?(pt&&Xe.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${$o(e)}.
Url: ${ql(e)}`),!0):lT(e,t.allowUrls)?!1:(pt&&Xe.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${$o(e)}.
Url: ${ql(e)}`),!0)}function aT(e,t){return e.type||!t||!t.length?!1:uT(e).some(n=>xs(n,t))}function iT(e,t){if(e.type!=="transaction"||!t||!t.length)return!1;const n=e.transaction;return n?xs(n,t):!1}function cT(e,t){if(!t||!t.length)return!1;const n=ql(e);return n?xs(n,t):!1}function lT(e,t){if(!t||!t.length)return!0;const n=ql(e);return n?xs(n,t):!0}function uT(e){const t=[];e.message&&t.push(e.message);let n;try{n=e.exception.values[e.exception.values.length-1]}catch{}return n&&n.value&&(t.push(n.value),n.type&&t.push(`${n.type}: ${n.value}`)),t}function dT(e){try{return e.exception.values[0].type==="SentryError"}catch{}return!1}function fT(e=[]){for(let t=e.length-1;t>=0;t--){const n=e[t];if(n&&n.filename!=="<anonymous>"&&n.filename!=="[native code]")return n.filename||null}return null}function ql(e){try{let t;try{t=e.exception.values[0].stacktrace.frames}catch{}return t?fT(t):null}catch{return pt&&Xe.error(`Cannot extract url for event ${$o(e)}`),null}}function hT(e){return e.type||!e.exception||!e.exception.values||e.exception.values.length===0?!1:!e.message&&!e.exception.values.some(t=>t.stacktrace||t.type&&t.type!=="Error"||t.value)}function pT(e,t,n=250,r,o,s,a){if(!s.exception||!s.exception.values||!a||!ko(a.originalException,Error))return;const i=s.exception.values.length>0?s.exception.values[s.exception.values.length-1]:void 0;i&&(s.exception.values=mT(zh(e,t,o,a.originalException,r,s.exception.values,i,0),n))}function zh(e,t,n,r,o,s,a,i){if(s.length>=n+1)return s;let c=[...s];if(ko(r[o],Error)){Hg(a,i);const l=e(t,r[o]),f=c.length;Ug(l,o,f,i),c=zh(e,t,n,r[o],o,[l,...c],l,f)}return Array.isArray(r.errors)&&r.errors.forEach((l,f)=>{if(ko(l,Error)){Hg(a,i);const d=e(t,l),m=c.length;Ug(d,`errors[${f}]`,m,i),c=zh(e,t,n,l,o,[d,...c],d,m)}}),c}function Hg(e,t){e.mechanism=e.mechanism||{type:"generic",handled:!0},e.mechanism={...e.mechanism,...e.type==="AggregateError"&&{is_exception_group:!0},exception_id:t}}function Ug(e,t,n,r){e.mechanism=e.mechanism||{type:"generic",handled:!0},e.mechanism={...e.mechanism,type:"chained",source:t,exception_id:n,parent_id:r}}function mT(e,t){return e.map(n=>(n.value&&(n.value=ya(n.value,t)),n))}function Ms(e){if(!e)return{};const t=e.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};const n=t[6]||"",r=t[8]||"";return{host:t[4],path:t[5],protocol:t[2],search:n,hash:r,relative:t[5]+n+r}}function gT(e){const t="console";is(t,e),cs(t,vT)}function vT(){"console"in Ot&&Mh.forEach(function(e){e in Ot.console&&ur(Ot.console,e,function(t){return Xl[e]=t,function(...n){kr("console",{args:n,level:e});const o=Xl[e];o&&o.apply(Ot.console,n)}})})}function bT(e){return e==="warn"?"warning":["fatal","error","warning","log","info","debug"].includes(e)?e:"log"}const _T="Dedupe",yT=()=>{let e;return{name:_T,processEvent(t){if(t.type)return t;try{if(kT(t,e))return pt&&Xe.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{}return e=t}}},ST=yT;function kT(e,t){return t?!!(wT(e,t)||xT(e,t)):!1}function wT(e,t){const n=e.message,r=t.message;return!(!n&&!r||n&&!r||!n&&r||n!==r||!C2(e,t)||!x2(e,t))}function xT(e,t){const n=Gg(t),r=Gg(e);return!(!n||!r||n.type!==r.type||n.value!==r.value||!C2(e,t)||!x2(e,t))}function x2(e,t){let n=fg(e),r=fg(t);if(!n&&!r)return!0;if(n&&!r||!n&&r||(n=n,r=r,r.length!==n.length))return!1;for(let o=0;o<r.length;o++){const s=r[o],a=n[o];if(s.filename!==a.filename||s.lineno!==a.lineno||s.colno!==a.colno||s.function!==a.function)return!1}return!0}function C2(e,t){let n=e.fingerprint,r=t.fingerprint;if(!n&&!r)return!0;if(n&&!r||!n&&r)return!1;n=n,r=r;try{return n.join("")===r.join("")}catch{return!1}}function Gg(e){return e.exception&&e.exception.values&&e.exception.values[0]}function CT(e,t,n,r,o="auto.http.browser"){if(!e.fetchData)return;const s=Zo()&&t(e.fetchData.url);if(e.endTimestamp&&s){const m=e.fetchData.__span;if(!m)return;const v=r[m];v&&(ET(v,e),delete r[m]);return}const{method:a,url:i}=e.fetchData,c=MT(i),l=c?Ms(c).host:void 0,f=!!Dn(),d=s&&f?Nc({name:`${a} ${i}`,attributes:{url:i,type:"fetch","http.method":a,"http.url":c,"server.address":l,[xn]:o,[Ls]:"http.client"}}):new ni;if(e.fetchData.__span=d.spanContext().spanId,r[d.spanContext().spanId]=d,n(e.fetchData.url)){const m=e.args[0],v=e.args[1]||{},_=TT(m,v,Zo()&&f?d:void 0);_&&(e.args[1]=v,v.headers=_)}return d}function TT(e,t,n){const r=w2({span:n}),o=r["sentry-trace"],s=r.baggage;if(!o)return;const a=t.headers||(IT(e)?e.headers:void 0);if(a)if(AT(a)){const i=new Headers(a);if(i.set("sentry-trace",o),s){const c=i.get("baggage");if(c){const l=bl(c);i.set("baggage",l?`${l},${s}`:s)}else i.set("baggage",s)}return i}else if(Array.isArray(a)){const i=[...a.filter(c=>!(Array.isArray(c)&&c[0]==="sentry-trace")).map(c=>{if(Array.isArray(c)&&c[0]==="baggage"&&typeof c[1]=="string"){const[l,f,...d]=c;return[l,bl(f),...d]}else return c}),["sentry-trace",o]];return s&&i.push(["baggage",s]),i}else{const i="baggage"in a?a.baggage:void 0;let c=[];return Array.isArray(i)?c=i.map(l=>typeof l=="string"?bl(l):l).filter(l=>l===""):i&&c.push(bl(i)),s&&c.push(s),{...a,"sentry-trace":o,baggage:c.length>0?c.join(","):void 0}}else return{...r}}function MT(e){try{return new URL(e).href}catch{return}}function ET(e,t){if(t.response){Y_(e,t.response.status);const n=t.response&&t.response.headers&&t.response.headers.get("content-length");if(n){const r=parseInt(n);r>0&&e.setAttribute("http.response_content_length",r)}}else t.error&&e.setStatus({code:Sn,message:"internal_error"});e.end()}function bl(e){return e.split(",").filter(t=>!t.split("=")[0].startsWith(Up)).join(",")}function IT(e){return typeof Request<"u"&&ko(e,Request)}function AT(e){return typeof Headers<"u"&&ko(e,Headers)}function T2(e){if(e!==void 0)return e>=400&&e<500?"warning":e>=500?"error":void 0}const Fh=Ot;function M2(){if(!("fetch"in Fh))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch{return!1}}function Wh(e){return e&&/^function\s+\w+\(\)\s+\{\s+\[native code\]\s+\}$/.test(e.toString())}function RT(){if(typeof EdgeRuntime=="string")return!0;if(!M2())return!1;if(Wh(Fh.fetch))return!0;let e=!1;const t=Fh.document;if(t&&typeof t.createElement=="function")try{const n=t.createElement("iframe");n.hidden=!0,t.head.appendChild(n),n.contentWindow&&n.contentWindow.fetch&&(e=Wh(n.contentWindow.fetch)),t.head.removeChild(n)}catch(n){as&&Xe.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",n)}return e}function E2(e,t){const n="fetch";is(n,e),cs(n,()=>I2(void 0,t))}function OT(e){const t="fetch-body-resolved";is(t,e),cs(t,()=>I2(BT))}function I2(e,t=!1){t&&!RT()||ur(Ot,"fetch",function(n){return function(...r){const o=new Error,{method:s,url:a}=DT(r),i={args:r,fetchData:{method:s,url:a},startTimestamp:Wn()*1e3,virtualError:o};return e||kr("fetch",{...i}),n.apply(Ot,r).then(async c=>(e?e(c):kr("fetch",{...i,endTimestamp:Wn()*1e3,response:c}),c),c=>{throw kr("fetch",{...i,endTimestamp:Wn()*1e3,error:c}),zp(c)&&c.stack===void 0&&(c.stack=o.stack,xr(c,"framesToPop",1)),c})}})}async function PT(e,t){if(e&&e.body){const n=e.body,r=n.getReader(),o=setTimeout(()=>{n.cancel().then(null,()=>{})},90*1e3);let s=!0;for(;s;){let a;try{a=setTimeout(()=>{n.cancel().then(null,()=>{})},5e3);const{done:i}=await r.read();clearTimeout(a),i&&(t(),s=!1)}catch{s=!1}finally{clearTimeout(a)}}clearTimeout(o),r.releaseLock(),n.cancel().then(null,()=>{})}}function BT(e){let t;try{t=e.clone()}catch{return}PT(t,()=>{kr("fetch-body-resolved",{endTimestamp:Wn()*1e3,response:e})})}function $h(e,t){return!!e&&typeof e=="object"&&!!e[t]}function Xg(e){return typeof e=="string"?e:e?$h(e,"url")?e.url:e.toString?e.toString():"":""}function DT(e){if(e.length===0)return{method:"GET",url:""};if(e.length===2){const[n,r]=e;return{url:Xg(n),method:$h(r,"method")?String(r.method).toUpperCase():"GET"}}const t=e[0];return{url:Xg(t),method:$h(t,"method")?String(t.method).toUpperCase():"GET"}}function NT(){return"npm"}const _l=Ot;function LT(){const e=_l.chrome,t=e&&e.app&&e.app.runtime,n="history"in _l&&!!_l.history.pushState&&!!_l.history.replaceState;return!t&&n}const ft=Ot;let Vh=0;function A2(){return Vh>0}function zT(){Vh++,setTimeout(()=>{Vh--})}function Oa(e,t={}){function n(o){return typeof o=="function"}if(!n(e))return e;try{const o=e.__sentry_wrapped__;if(o)return typeof o=="function"?o:e;if($p(e))return e}catch{return e}const r=function(...o){try{const s=o.map(a=>Oa(a,t));return e.apply(this,s)}catch(s){throw zT(),jp(a=>{a.addEventProcessor(i=>(t.mechanism&&(Ih(i,void 0),Ia(i,t.mechanism)),i.extra={...i.extra,arguments:o},i)),xC(s)}),s}};try{for(const o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}catch{}j_(r,e),xr(e,"__sentry_wrapped__",r);try{Object.getOwnPropertyDescriptor(r,"name").configurable&&Object.defineProperty(r,"name",{get(){return e.name}})}catch{}return r}const eo=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function Kp(e,t){const n=Yp(e,t),r={type:jT(t),value:HT(t)};return n.length&&(r.stacktrace={frames:n}),r.type===void 0&&r.value===""&&(r.value="Unrecoverable error caught"),r}function FT(e,t,n,r){const o=Nt(),s=o&&o.getOptions().normalizeDepth,a=YT(t),i={__serialized__:d2(t,s)};if(a)return{exception:{values:[Kp(e,a)]},extra:i};const c={exception:{values:[{type:gd(t)?t.constructor.name:r?"UnhandledRejection":"Error",value:XT(t,{isUnhandledRejection:r})}]},extra:i};if(n){const l=Yp(e,n);l.length&&(c.exception.values[0].stacktrace={frames:l})}return c}function Af(e,t){return{exception:{values:[Kp(e,t)]}}}function Yp(e,t){const n=t.stacktrace||t.stack||"",r=$T(t),o=VT(t);try{return e(n,r,o)}catch{}return[]}const WT=/Minified React error #\d+;/i;function $T(e){return e&&WT.test(e.message)?1:0}function VT(e){return typeof e.framesToPop=="number"?e.framesToPop:0}function R2(e){return typeof WebAssembly<"u"&&typeof WebAssembly.Exception<"u"?e instanceof WebAssembly.Exception:!1}function jT(e){const t=e&&e.name;return!t&&R2(e)?e.message&&Array.isArray(e.message)&&e.message.length==2?e.message[0]:"WebAssembly.Exception":t}function HT(e){const t=e&&e.message;return t?t.error&&typeof t.error.message=="string"?t.error.message:R2(e)&&Array.isArray(e.message)&&e.message.length==2?e.message[1]:t:"No error message"}function UT(e,t,n,r){const o=n&&n.syntheticException||void 0,s=qp(e,t,o,r);return Ia(s),s.level="error",n&&n.event_id&&(s.event_id=n.event_id),Ds(s)}function GT(e,t,n="info",r,o){const s=r&&r.syntheticException||void 0,a=jh(e,t,s,o);return a.level=n,r&&r.event_id&&(a.event_id=r.event_id),Ds(a)}function qp(e,t,n,r,o){let s;if(W_(t)&&t.error)return Af(e,t.error);if(pg(t)||z5(t)){const a=t;if("stack"in t)s=Af(e,t);else{const i=a.name||(pg(a)?"DOMError":"DOMException"),c=a.message?`${i}: ${a.message}`:i;s=jh(e,c,n,r),Ih(s,c)}return"code"in a&&(s.tags={...s.tags,"DOMException.code":`${a.code}`}),s}return zp(t)?Af(e,t):Ea(t)||gd(t)?(s=FT(e,t,n,o),Ia(s,{synthetic:!0}),s):(s=jh(e,t,n,r),Ih(s,`${t}`),Ia(s,{synthetic:!0}),s)}function jh(e,t,n,r){const o={};if(r&&n){const s=Yp(e,n);s.length&&(o.exception={values:[{value:t,stacktrace:{frames:s}}]}),Ia(o,{synthetic:!0})}if(Fp(t)){const{__sentry_template_string__:s,__sentry_template_values__:a}=t;return o.logentry={message:s,params:a},o}return o.message=t,o}function XT(e,{isUnhandledRejection:t}){const n=X5(e),r=t?"promise rejection":"exception";return W_(e)?`Event \`ErrorEvent\` captured as ${r} with message \`${e.message}\``:gd(e)?`Event \`${KT(e)}\` (type=${e.type}) captured as ${r}`:`Object captured as ${r} with keys: ${n}`}function KT(e){try{const t=Object.getPrototypeOf(e);return t?t.constructor.name:void 0}catch{}}function YT(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const n=e[t];if(n instanceof Error)return n}}function qT(e,{metadata:t,tunnel:n,dsn:r}){const o={event_id:e.event_id,sent_at:new Date().toISOString(),...t&&t.sdk&&{sdk:{name:t.sdk.name,version:t.sdk.version}},...!!n&&!!r&&{dsn:Dc(r)}},s=ZT(e);return oi(o,[s])}function ZT(e){return[{type:"user_report"},e]}class QT extends DC{constructor(t){const n={parentSpanIsAlwaysRootSpan:!0,...t},r=ft.SENTRY_SDK_SOURCE||NT();KC(n,"browser",["browser"],r),super(n),n.sendClientReports&&ft.document&&ft.document.addEventListener("visibilitychange",()=>{ft.document.visibilityState==="hidden"&&this._flushOutcomes()})}eventFromException(t,n){return UT(this._options.stackParser,t,n,this._options.attachStacktrace)}eventFromMessage(t,n="info",r){return GT(this._options.stackParser,t,n,r,this._options.attachStacktrace)}captureUserFeedback(t){if(!this._isEnabled()){eo&&Xe.warn("SDK not enabled, will not capture user feedback.");return}const n=qT(t,{metadata:this.getSdkMetadata(),dsn:this.getDsn(),tunnel:this.getOptions().tunnel});this.sendEnvelope(n)}_prepareEvent(t,n,r){return t.platform=t.platform||"javascript",super._prepareEvent(t,n,r)}}const Zp=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,JT=(e,t)=>e>t[1]?"poor":e>t[0]?"needs-improvement":"good",si=(e,t,n,r)=>{let o,s;return a=>{t.value>=0&&(a||r)&&(s=t.value-(o||0),(s||o===void 0)&&(o=t.value,t.delta=s,t.rating=JT(t.value,n),e(t)))}},ot=Ot,eM=()=>`v4-${Date.now()}-${Math.floor(Math.random()*(9e12-1))+1e12}`,Lc=(e=!0)=>{const t=ot.performance&&ot.performance.getEntriesByType&&ot.performance.getEntriesByType("navigation")[0];if(!e||t&&t.responseStart>0&&t.responseStart<performance.now())return t},zc=()=>{const e=Lc();return e&&e.activationStart||0},ai=(e,t)=>{const n=Lc();let r="navigate";return n&&(ot.document&&ot.document.prerendering||zc()>0?r="prerender":ot.document&&ot.document.wasDiscarded?r="restore":n.type&&(r=n.type.replace(/_/g,"-"))),{name:e,value:typeof t>"u"?-1:t,rating:"good",delta:0,entries:[],id:eM(),navigationType:r}},Qs=(e,t,n)=>{try{if(PerformanceObserver.supportedEntryTypes.includes(e)){const r=new PerformanceObserver(o=>{Promise.resolve().then(()=>{t(o.getEntries())})});return r.observe(Object.assign({type:e,buffered:!0},n||{})),r}}catch{}},ii=e=>{const t=n=>{(n.type==="pagehide"||ot.document&&ot.document.visibilityState==="hidden")&&e(n)};ot.document&&(addEventListener("visibilitychange",t,!0),addEventListener("pagehide",t,!0))},Sd=e=>{let t=!1;return()=>{t||(e(),t=!0)}};let Hi=-1;const tM=()=>ot.document.visibilityState==="hidden"&&!ot.document.prerendering?0:1/0,Zl=e=>{ot.document.visibilityState==="hidden"&&Hi>-1&&(Hi=e.type==="visibilitychange"?e.timeStamp:0,rM())},nM=()=>{addEventListener("visibilitychange",Zl,!0),addEventListener("prerenderingchange",Zl,!0)},rM=()=>{removeEventListener("visibilitychange",Zl,!0),removeEventListener("prerenderingchange",Zl,!0)},kd=()=>(ot.document&&Hi<0&&(Hi=tM(),nM()),{get firstHiddenTime(){return Hi}}),Fc=e=>{ot.document&&ot.document.prerendering?addEventListener("prerenderingchange",()=>e(),!0):e()},oM=[1800,3e3],sM=(e,t={})=>{Fc(()=>{const n=kd(),r=ai("FCP");let o;const a=Qs("paint",i=>{i.forEach(c=>{c.name==="first-contentful-paint"&&(a.disconnect(),c.startTime<n.firstHiddenTime&&(r.value=Math.max(c.startTime-zc(),0),r.entries.push(c),o(!0)))})});a&&(o=si(e,r,oM,t.reportAllChanges))})},aM=[.1,.25],iM=(e,t={})=>{sM(Sd(()=>{const n=ai("CLS",0);let r,o=0,s=[];const a=c=>{c.forEach(l=>{if(!l.hadRecentInput){const f=s[0],d=s[s.length-1];o&&f&&d&&l.startTime-d.startTime<1e3&&l.startTime-f.startTime<5e3?(o+=l.value,s.push(l)):(o=l.value,s=[l])}}),o>n.value&&(n.value=o,n.entries=s,r())},i=Qs("layout-shift",a);i&&(r=si(e,n,aM,t.reportAllChanges),ii(()=>{a(i.takeRecords()),r(!0)}),setTimeout(r,0))}))},cM=[100,300],lM=(e,t={})=>{Fc(()=>{const n=kd(),r=ai("FID");let o;const s=c=>{c.startTime<n.firstHiddenTime&&(r.value=c.processingStart-c.startTime,r.entries.push(c),o(!0))},a=c=>{c.forEach(s)},i=Qs("first-input",a);o=si(e,r,cM,t.reportAllChanges),i&&ii(Sd(()=>{a(i.takeRecords()),i.disconnect()}))})};let O2=0,Rf=1/0,yl=0;const uM=e=>{e.forEach(t=>{t.interactionId&&(Rf=Math.min(Rf,t.interactionId),yl=Math.max(yl,t.interactionId),O2=yl?(yl-Rf)/7+1:0)})};let Hh;const dM=()=>Hh?O2:performance.interactionCount||0,fM=()=>{"interactionCount"in performance||Hh||(Hh=Qs("event",uM,{type:"event",buffered:!0,durationThreshold:0}))},fo=[],Of=new Map,hM=40;let pM=0;const mM=()=>dM()-pM,gM=()=>{const e=Math.min(fo.length-1,Math.floor(mM()/50));return fo[e]},Pf=10,vM=[],bM=e=>{if(vM.forEach(r=>r(e)),!(e.interactionId||e.entryType==="first-input"))return;const t=fo[fo.length-1],n=Of.get(e.interactionId);if(n||fo.length<Pf||t&&e.duration>t.latency){if(n)e.duration>n.latency?(n.entries=[e],n.latency=e.duration):e.duration===n.latency&&e.startTime===(n.entries[0]&&n.entries[0].startTime)&&n.entries.push(e);else{const r={id:e.interactionId,latency:e.duration,entries:[e]};Of.set(r.id,r),fo.push(r)}fo.sort((r,o)=>o.latency-r.latency),fo.length>Pf&&fo.splice(Pf).forEach(r=>Of.delete(r.id))}},P2=e=>{const t=ot.requestIdleCallback||ot.setTimeout;let n=-1;return e=Sd(e),ot.document&&ot.document.visibilityState==="hidden"?e():(n=t(e),ii(e)),n},_M=[200,500],yM=(e,t={})=>{"PerformanceEventTiming"in ot&&"interactionId"in PerformanceEventTiming.prototype&&Fc(()=>{fM();const n=ai("INP");let r;const o=a=>{P2(()=>{a.forEach(bM);const i=gM();i&&i.latency!==n.value&&(n.value=i.latency,n.entries=i.entries,r())})},s=Qs("event",o,{durationThreshold:t.durationThreshold!=null?t.durationThreshold:hM});r=si(e,n,_M,t.reportAllChanges),s&&(s.observe({type:"first-input",buffered:!0}),ii(()=>{o(s.takeRecords()),r(!0)}))})},SM=[2500,4e3],Kg={},kM=(e,t={})=>{Fc(()=>{const n=kd(),r=ai("LCP");let o;const s=i=>{t.reportAllChanges||(i=i.slice(-1)),i.forEach(c=>{c.startTime<n.firstHiddenTime&&(r.value=Math.max(c.startTime-zc(),0),r.entries=[c],o())})},a=Qs("largest-contentful-paint",s);if(a){o=si(e,r,SM,t.reportAllChanges);const i=Sd(()=>{Kg[r.id]||(s(a.takeRecords()),a.disconnect(),Kg[r.id]=!0,o(!0))});["keydown","click"].forEach(c=>{ot.document&&addEventListener(c,()=>P2(i),{once:!0,capture:!0})}),ii(i)}})},wM=[800,1800],Uh=e=>{ot.document&&ot.document.prerendering?Fc(()=>Uh(e)):ot.document&&ot.document.readyState!=="complete"?addEventListener("load",()=>Uh(e),!0):setTimeout(e,0)},xM=(e,t={})=>{const n=ai("TTFB"),r=si(e,n,wM,t.reportAllChanges);Uh(()=>{const o=Lc();o&&(n.value=Math.max(o.responseStart-zc(),0),n.entries=[o],r(!0))})},Ui={},Ql={};let B2,D2,N2,L2,z2;function F2(e,t=!1){return Wc("cls",e,IM,B2,t)}function CM(e,t=!1){return Wc("lcp",e,RM,N2,t)}function TM(e){return Wc("fid",e,AM,D2)}function MM(e){return Wc("ttfb",e,OM,L2)}function EM(e){return Wc("inp",e,PM,z2)}function Ji(e,t){return W2(e,t),Ql[e]||(BM(e),Ql[e]=!0),$2(e,t)}function ci(e,t){const n=Ui[e];if(!(!n||!n.length))for(const r of n)try{r(t)}catch(o){Zp&&Xe.error(`Error while triggering instrumentation handler.
Type: ${e}
Name: ${So(r)}
Error:`,o)}}function IM(){return iM(e=>{ci("cls",{metric:e}),B2=e},{reportAllChanges:!0})}function AM(){return lM(e=>{ci("fid",{metric:e}),D2=e})}function RM(){return kM(e=>{ci("lcp",{metric:e}),N2=e},{reportAllChanges:!0})}function OM(){return xM(e=>{ci("ttfb",{metric:e}),L2=e})}function PM(){return yM(e=>{ci("inp",{metric:e}),z2=e})}function Wc(e,t,n,r,o=!1){W2(e,t);let s;return Ql[e]||(s=n(),Ql[e]=!0),r&&t({metric:r}),$2(e,t,o?s:void 0)}function BM(e){const t={};e==="event"&&(t.durationThreshold=0),Qs(e,n=>{ci(e,{entries:n})},t)}function W2(e,t){Ui[e]=Ui[e]||[],Ui[e].push(t)}function $2(e,t,n){return()=>{n&&n();const r=Ui[e];if(!r)return;const o=r.indexOf(t);o!==-1&&r.splice(o,1)}}function DM(e){return"duration"in e}function Bf(e){return typeof e=="number"&&isFinite(e)}function wo(e,t,n,{...r}){const o=Bt(e).start_timestamp;return o&&o>t&&typeof e.updateStartTime=="function"&&e.updateStartTime(t),p2(e,()=>{const s=Nc({startTime:t,...r});return s&&s.end(n),s})}function V2(e){const t=Nt();if(!t)return;const{name:n,transaction:r,attributes:o,startTime:s}=e,{release:a,environment:i}=t.getOptions(),c=t.getIntegrationByName("Replay"),l=c&&c.getReplayId(),f=Kt(),d=f.getUser(),m=d!==void 0?d.email||d.id||d.ip_address:void 0;let v;try{v=f.getScopeData().contexts.profile.profile_id}catch{}const _={release:a,environment:i,user:m||void 0,profile_id:v||void 0,replay_id:l||void 0,transaction:r,"user_agent.original":ot.navigator&&ot.navigator.userAgent,...o};return Nc({name:n,attributes:_,startTime:s,experimental:{standalone:!0}})}function Qp(){return ot&&ot.addEventListener&&ot.performance}function dn(e){return e/1e3}function j2(e){let t="unknown",n="unknown",r="";for(const o of e){if(o==="/"){[t,n]=e.split("/");break}if(!isNaN(Number(o))){t=r==="h"?"http":r,n=e.split(r)[1];break}r+=o}return r===e&&(t=r),{name:t,version:n}}function NM(){let e=0,t,n;if(!zM())return;let r=!1;function o(){r||(r=!0,n&&LM(e,t,n),s())}const s=F2(({metric:a})=>{const i=a.entries[a.entries.length-1];i&&(e=a.value,t=i)},!0);ii(()=>{o()}),setTimeout(()=>{const a=Nt();if(!a)return;const i=a.on("startNavigationSpan",()=>{o(),i&&i()}),c=Dn(),l=c&&Pn(c),f=l&&Bt(l);f&&f.op==="pageload"&&(n=l.spanContext().spanId)},0)}function LM(e,t,n){Zp&&Xe.log(`Sending CLS span (${e})`);const r=dn((Zn||0)+(t&&t.startTime||0)),o=Kt().getScopeData().transactionName,s=t?Bs(t.sources[0]&&t.sources[0].node):"Layout shift",a=En({[xn]:"auto.http.browser.cls",[Ls]:"ui.webvital.cls",[Hp]:t&&t.duration||0,"sentry.pageload.span_id":n}),i=V2({name:s,transaction:o,attributes:a,startTime:r});i&&(i.addEvent("cls",{[_d]:"",[yd]:e}),i.end(r))}function zM(){try{return PerformanceObserver.supportedEntryTypes.includes("layout-shift")}catch{return!1}}const FM=2147483647;let Yg=0,Tn={},Kn,Gi;function WM({recordClsStandaloneSpans:e}){const t=Qp();if(t&&Zn){t.mark&&ot.performance.mark("sentry-tracing-init");const n=GM(),r=UM(),o=XM(),s=e?NM():HM();return()=>{n(),r(),o(),s&&s()}}return()=>{}}function $M(){Ji("longtask",({entries:e})=>{const t=Dn();if(!t)return;const{op:n,start_timestamp:r}=Bt(t);for(const o of e){const s=dn(Zn+o.startTime),a=dn(o.duration);n==="navigation"&&r&&s<r||wo(t,s,s+a,{name:"Main UI thread blocked",op:"ui.long-task",attributes:{[xn]:"auto.ui.browser.metrics"}})}})}function VM(){new PerformanceObserver(t=>{const n=Dn();if(n)for(const r of t.getEntries()){if(!r.scripts[0])continue;const o=dn(Zn+r.startTime),{start_timestamp:s,op:a}=Bt(n);if(a==="navigation"&&s&&o<s)continue;const i=dn(r.duration),c={[xn]:"auto.ui.browser.metrics"},l=r.scripts[0],{invoker:f,invokerType:d,sourceURL:m,sourceFunctionName:v,sourceCharPosition:_}=l;c["browser.script.invoker"]=f,c["browser.script.invoker_type"]=d,m&&(c["code.filepath"]=m),v&&(c["code.function"]=v),_!==-1&&(c["browser.script.source_char_position"]=_),wo(n,o,o+i,{name:"Main UI thread blocked",op:"ui.long-animation-frame",attributes:c})}}).observe({type:"long-animation-frame",buffered:!0})}function jM(){Ji("event",({entries:e})=>{const t=Dn();if(t){for(const n of e)if(n.name==="click"){const r=dn(Zn+n.startTime),o=dn(n.duration),s={name:Bs(n.target),op:`ui.interaction.${n.name}`,startTime:r,attributes:{[xn]:"auto.ui.browser.metrics"}},a=V_(n.target);a&&(s.attributes["ui.component_name"]=a),wo(t,r,r+o,s)}}})}function HM(){return F2(({metric:e})=>{const t=e.entries[e.entries.length-1];t&&(Tn.cls={value:e.value,unit:""},Gi=t)},!0)}function UM(){return CM(({metric:e})=>{const t=e.entries[e.entries.length-1];t&&(Tn.lcp={value:e.value,unit:"millisecond"},Kn=t)},!0)}function GM(){return TM(({metric:e})=>{const t=e.entries[e.entries.length-1];if(!t)return;const n=dn(Zn),r=dn(t.startTime);Tn.fid={value:e.value,unit:"millisecond"},Tn["mark.fid"]={value:n+r,unit:"second"}})}function XM(){return MM(({metric:e})=>{e.entries[e.entries.length-1]&&(Tn.ttfb={value:e.value,unit:"millisecond"})})}function KM(e,t){const n=Qp();if(!n||!n.getEntries||!Zn)return;const r=dn(Zn),o=n.getEntries(),{op:s,start_timestamp:a}=Bt(e);if(o.slice(Yg).forEach(i=>{const c=dn(i.startTime),l=dn(Math.max(0,i.duration));if(!(s==="navigation"&&a&&r+c<a))switch(i.entryType){case"navigation":{qM(e,i,r);break}case"mark":case"paint":case"measure":{YM(e,i,c,l,r);const f=kd(),d=i.startTime<f.firstHiddenTime;i.name==="first-paint"&&d&&(Tn.fp={value:i.startTime,unit:"millisecond"}),i.name==="first-contentful-paint"&&d&&(Tn.fcp={value:i.startTime,unit:"millisecond"});break}case"resource":{JM(e,i,i.name,c,l,r);break}}}),Yg=Math.max(o.length-1,0),eE(e),s==="pageload"){nE(Tn);const i=Tn["mark.fid"];i&&Tn.fid&&(wo(e,i.value,i.value+dn(Tn.fid.value),{name:"first input delay",op:"ui.action",attributes:{[xn]:"auto.ui.browser.metrics"}}),delete Tn["mark.fid"]),(!("fcp"in Tn)||!t.recordClsOnPageloadSpan)&&delete Tn.cls,Object.entries(Tn).forEach(([c,l])=>{Qx(c,l.value,l.unit)}),e.setAttribute("performance.timeOrigin",r),e.setAttribute("performance.activationStart",zc()),tE(e)}Kn=void 0,Gi=void 0,Tn={}}function YM(e,t,n,r,o){const s=Lc(!1),a=dn(s?s.requestStart:0),i=o+Math.max(n,a),c=o+n,l=c+r,f={[xn]:"auto.resource.browser.metrics"};return i!==c&&(f["sentry.browser.measure_happened_before_request"]=!0,f["sentry.browser.measure_start_time"]=i),wo(e,i,l,{name:t.name,op:t.entryType,attributes:f}),i}function qM(e,t,n){["unloadEvent","redirect","domContentLoadedEvent","loadEvent","connect"].forEach(r=>{Sl(e,t,r,n)}),Sl(e,t,"secureConnection",n,"TLS/SSL"),Sl(e,t,"fetch",n,"cache"),Sl(e,t,"domainLookup",n,"DNS"),QM(e,t,n)}function Sl(e,t,n,r,o=n){const s=ZM(n),a=t[s],i=t[`${n}Start`];!i||!a||wo(e,r+dn(i),r+dn(a),{op:`browser.${o}`,name:t.name,attributes:{[xn]:"auto.ui.browser.metrics"}})}function ZM(e){return e==="secureConnection"?"connectEnd":e==="fetch"?"domainLookupStart":`${e}End`}function QM(e,t,n){const r=n+dn(t.requestStart),o=n+dn(t.responseEnd),s=n+dn(t.responseStart);t.responseEnd&&(wo(e,r,o,{op:"browser.request",name:t.name,attributes:{[xn]:"auto.ui.browser.metrics"}}),wo(e,s,o,{op:"browser.response",name:t.name,attributes:{[xn]:"auto.ui.browser.metrics"}}))}function JM(e,t,n,r,o,s){if(t.initiatorType==="xmlhttprequest"||t.initiatorType==="fetch")return;const a=Ms(n),i={[xn]:"auto.resource.browser.metrics"};Df(i,t,"transferSize","http.response_transfer_size"),Df(i,t,"encodedBodySize","http.response_content_length"),Df(i,t,"decodedBodySize","http.decoded_response_content_length");const c=t.deliveryType;c!=null&&(i["http.response_delivery_type"]=c);const l=t.renderBlockingStatus;l&&(i["resource.render_blocking_status"]=l),a.protocol&&(i["url.scheme"]=a.protocol.split(":").pop()),a.host&&(i["server.address"]=a.host),i["url.same_origin"]=n.includes(ot.location.origin);const{name:f,version:d}=j2(t.nextHopProtocol);i["network.protocol.name"]=f,i["network.protocol.version"]=d;const m=s+r,v=m+o;wo(e,m,v,{name:n.replace(ot.location.origin,""),op:t.initiatorType?`resource.${t.initiatorType}`:"resource.other",attributes:i})}function eE(e){const t=ot.navigator;if(!t)return;const n=t.connection;n&&(n.effectiveType&&e.setAttribute("effectiveConnectionType",n.effectiveType),n.type&&e.setAttribute("connectionType",n.type),Bf(n.rtt)&&(Tn["connection.rtt"]={value:n.rtt,unit:"millisecond"})),Bf(t.deviceMemory)&&e.setAttribute("deviceMemory",`${t.deviceMemory} GB`),Bf(t.hardwareConcurrency)&&e.setAttribute("hardwareConcurrency",String(t.hardwareConcurrency))}function tE(e){Kn&&(Kn.element&&e.setAttribute("lcp.element",Bs(Kn.element)),Kn.id&&e.setAttribute("lcp.id",Kn.id),Kn.url&&e.setAttribute("lcp.url",Kn.url.trim().slice(0,200)),Kn.loadTime!=null&&e.setAttribute("lcp.loadTime",Kn.loadTime),Kn.renderTime!=null&&e.setAttribute("lcp.renderTime",Kn.renderTime),e.setAttribute("lcp.size",Kn.size)),Gi&&Gi.sources&&Gi.sources.forEach((t,n)=>e.setAttribute(`cls.source.${n+1}`,Bs(t.node)))}function Df(e,t,n,r){const o=t[n];o!=null&&o<FM&&(e[r]=o)}function nE(e){const t=Lc(!1);if(!t)return;const{responseStart:n,requestStart:r}=t;r<=n&&(e["ttfb.requestTime"]={value:n-r,unit:"millisecond"})}const rE=1e3;let qg,Gh,Xh;function oE(e){const t="dom";is(t,e),cs(t,sE)}function sE(){if(!ot.document)return;const e=kr.bind(null,"dom"),t=Zg(e,!0);ot.document.addEventListener("click",t,!1),ot.document.addEventListener("keypress",t,!1),["EventTarget","Node"].forEach(n=>{const o=ot[n],s=o&&o.prototype;!s||!s.hasOwnProperty||!s.hasOwnProperty("addEventListener")||(ur(s,"addEventListener",function(a){return function(i,c,l){if(i==="click"||i=="keypress")try{const f=this.__sentry_instrumentation_handlers__=this.__sentry_instrumentation_handlers__||{},d=f[i]=f[i]||{refCount:0};if(!d.handler){const m=Zg(e);d.handler=m,a.call(this,i,m,l)}d.refCount++}catch{}return a.call(this,i,c,l)}}),ur(s,"removeEventListener",function(a){return function(i,c,l){if(i==="click"||i=="keypress")try{const f=this.__sentry_instrumentation_handlers__||{},d=f[i];d&&(d.refCount--,d.refCount<=0&&(a.call(this,i,d.handler,l),d.handler=void 0,delete f[i]),Object.keys(f).length===0&&delete this.__sentry_instrumentation_handlers__)}catch{}return a.call(this,i,c,l)}}))})}function aE(e){if(e.type!==Gh)return!1;try{if(!e.target||e.target._sentryId!==Xh)return!1}catch{}return!0}function iE(e,t){return e!=="keypress"?!1:!t||!t.tagName?!0:!(t.tagName==="INPUT"||t.tagName==="TEXTAREA"||t.isContentEditable)}function Zg(e,t=!1){return n=>{if(!n||n._sentryCaptured)return;const r=cE(n);if(iE(n.type,r))return;xr(n,"_sentryCaptured",!0),r&&!r._sentryId&&xr(r,"_sentryId",wr());const o=n.type==="keypress"?"input":n.type;aE(n)||(e({event:n,name:o,global:t}),Gh=n.type,Xh=r?r._sentryId:void 0),clearTimeout(qg),qg=ot.setTimeout(()=>{Xh=void 0,Gh=void 0},rE)}}function cE(e){try{return e.target}catch{return null}}let kl;function Jp(e){const t="history";is(t,e),cs(t,lE)}function lE(){if(!LT())return;const e=ot.onpopstate;ot.onpopstate=function(...n){const r=ot.location.href,o=kl;if(kl=r,kr("history",{from:o,to:r}),e)try{return e.apply(this,n)}catch{}};function t(n){return function(...r){const o=r.length>2?r[2]:void 0;if(o){const s=kl,a=String(o);kl=a,kr("history",{from:s,to:a})}return n.apply(this,r)}}ur(ot.history,"pushState",t),ur(ot.history,"replaceState",t)}const $l={};function uE(e){const t=$l[e];if(t)return t;let n=ot[e];if(Wh(n))return $l[e]=n.bind(ot);const r=ot.document;if(r&&typeof r.createElement=="function")try{const o=r.createElement("iframe");o.hidden=!0,r.head.appendChild(o);const s=o.contentWindow;s&&s[e]&&(n=s[e]),r.head.removeChild(o)}catch(o){Zp&&Xe.warn(`Could not create sandbox iframe for ${e} check, bailing to window.${e}: `,o)}return n&&($l[e]=n.bind(ot))}function Qg(e){$l[e]=void 0}const pa="__sentry_xhr_v3__";function H2(e){const t="xhr";is(t,e),cs(t,dE)}function dE(){if(!ot.XMLHttpRequest)return;const e=XMLHttpRequest.prototype;e.open=new Proxy(e.open,{apply(t,n,r){const o=new Error,s=Wn()*1e3,a=go(r[0])?r[0].toUpperCase():void 0,i=fE(r[1]);if(!a||!i)return t.apply(n,r);n[pa]={method:a,url:i,request_headers:{}},a==="POST"&&i.match(/sentry_key/)&&(n.__sentry_own_request__=!0);const c=()=>{const l=n[pa];if(l&&n.readyState===4){try{l.status_code=n.status}catch{}const f={endTimestamp:Wn()*1e3,startTimestamp:s,xhr:n,virtualError:o};kr("xhr",f)}};return"onreadystatechange"in n&&typeof n.onreadystatechange=="function"?n.onreadystatechange=new Proxy(n.onreadystatechange,{apply(l,f,d){return c(),l.apply(f,d)}}):n.addEventListener("readystatechange",c),n.setRequestHeader=new Proxy(n.setRequestHeader,{apply(l,f,d){const[m,v]=d,_=f[pa];return _&&go(m)&&go(v)&&(_.request_headers[m.toLowerCase()]=v),l.apply(f,d)}}),t.apply(n,r)}}),e.send=new Proxy(e.send,{apply(t,n,r){const o=n[pa];if(!o)return t.apply(n,r);r[0]!==void 0&&(o.body=r[0]);const s={startTimestamp:Wn()*1e3,xhr:n};return kr("xhr",s),t.apply(n,r)}})}function fE(e){if(go(e))return e;try{return e.toString()}catch{}}const Nf=[],Vl=new Map;function hE(){if(Qp()&&Zn){const t=pE();return()=>{t()}}return()=>{}}const Jg={click:"click",pointerdown:"click",pointerup:"click",mousedown:"click",mouseup:"click",touchstart:"click",touchend:"click",mouseover:"hover",mouseout:"hover",mouseenter:"hover",mouseleave:"hover",pointerover:"hover",pointerout:"hover",pointerenter:"hover",pointerleave:"hover",dragstart:"drag",dragend:"drag",drag:"drag",dragenter:"drag",dragleave:"drag",dragover:"drag",drop:"drag",keydown:"press",keyup:"press",keypress:"press",input:"press"};function pE(){return EM(({metric:e})=>{if(e.value==null)return;const t=e.entries.find(_=>_.duration===e.value&&Jg[_.name]);if(!t)return;const{interactionId:n}=t,r=Jg[t.name],o=dn(Zn+t.startTime),s=dn(e.value),a=Dn(),i=a?Pn(a):void 0,l=(n!=null?Vl.get(n):void 0)||i,f=l?Bt(l).description:Kt().getScopeData().transactionName,d=Bs(t.target),m=En({[xn]:"auto.http.browser.inp",[Ls]:`ui.interaction.${r}`,[Hp]:t.duration}),v=V2({name:d,transaction:f,attributes:m,startTime:o});v&&(v.addEvent("inp",{[_d]:"millisecond",[yd]:e.value}),v.end(o+s))})}function mE(e){const t=({entries:n})=>{const r=Dn(),o=r&&Pn(r);n.forEach(s=>{if(!DM(s)||!o)return;const a=s.interactionId;if(a!=null&&!Vl.has(a)){if(Nf.length>10){const i=Nf.shift();Vl.delete(i)}Nf.push(a),Vl.set(a,o)}})};Ji("event",t),Ji("first-input",t)}function gE(e,t=uE("fetch")){let n=0,r=0;function o(s){const a=s.body.length;n+=a,r++;const i={body:s.body,method:"POST",referrerPolicy:"origin",headers:e.headers,keepalive:n<=6e4&&r<15,...e.fetchOptions};if(!t)return Qg("fetch"),Kl("No fetch implementation available");try{return t(e.url,i).then(c=>(n-=a,r--,{statusCode:c.status,headers:{"x-sentry-rate-limits":c.headers.get("X-Sentry-Rate-Limits"),"retry-after":c.headers.get("Retry-After")}}))}catch(c){return Qg("fetch"),n-=a,r--,Kl(c)}}return XC(e,o)}const vE=30,bE=50;function Kh(e,t,n,r){const o={filename:e,function:t==="<anonymous>"?Ps:t,in_app:!0};return n!==void 0&&(o.lineno=n),r!==void 0&&(o.colno=r),o}const _E=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,yE=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,SE=/\((\S*)(?::(\d+))(?::(\d+))\)/,kE=e=>{const t=_E.exec(e);if(t){const[,r,o,s]=t;return Kh(r,Ps,+o,+s)}const n=yE.exec(e);if(n){if(n[2]&&n[2].indexOf("eval")===0){const a=SE.exec(n[2]);a&&(n[2]=a[1],n[3]=a[2],n[4]=a[3])}const[o,s]=U2(n[1]||Ps,n[2]);return Kh(s,o,n[3]?+n[3]:void 0,n[4]?+n[4]:void 0)}},wE=[vE,kE],xE=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,CE=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,TE=e=>{const t=xE.exec(e);if(t){if(t[3]&&t[3].indexOf(" > eval")>-1){const s=CE.exec(t[3]);s&&(t[1]=t[1]||"eval",t[3]=s[1],t[4]=s[2],t[5]="")}let r=t[3],o=t[1]||Ps;return[o,r]=U2(o,r),Kh(r,o,t[4]?+t[4]:void 0,t[5]?+t[5]:void 0)}},ME=[bE,TE],EE=[wE,ME],IE=N_(...EE),U2=(e,t)=>{const n=e.indexOf("safari-extension")!==-1,r=e.indexOf("safari-web-extension")!==-1;return n||r?[e.indexOf("@")!==-1?e.split("@")[0]:Ps,n?`safari-extension:${t}`:`safari-web-extension:${t}`]:[e,t]},wl=1024,AE="Breadcrumbs",RE=(e={})=>{const t={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...e};return{name:AE,setup(n){t.console&&gT(DE(n)),t.dom&&oE(BE(n,t.dom)),t.xhr&&H2(NE(n)),t.fetch&&E2(LE(n)),t.history&&Jp(zE(n)),t.sentry&&n.on("beforeSendEvent",PE(n))}}},OE=RE;function PE(e){return function(n){Nt()===e&&zs({category:`sentry.${n.type==="transaction"?"transaction":"event"}`,event_id:n.event_id,level:n.level,message:$o(n)},{event:n})}}function BE(e,t){return function(r){if(Nt()!==e)return;let o,s,a=typeof t=="object"?t.serializeAttribute:void 0,i=typeof t=="object"&&typeof t.maxStringLength=="number"?t.maxStringLength:void 0;i&&i>wl&&(eo&&Xe.warn(`\`dom.maxStringLength\` cannot exceed ${wl}, but a value of ${i} was configured. Sentry will use ${wl} instead.`),i=wl),typeof a=="string"&&(a=[a]);try{const l=r.event,f=FE(l)?l.target:l;o=Bs(f,{keyAttrs:a,maxStringLength:i}),s=V_(f)}catch{o="<unknown>"}if(o.length===0)return;const c={category:`ui.${r.name}`,message:o};s&&(c.data={"ui.component_name":s}),zs(c,{event:r.event,name:r.name,global:r.global})}}function DE(e){return function(n){if(Nt()!==e)return;const r={category:"console",data:{arguments:n.args,logger:"console"},level:bT(n.level),message:mg(n.args," ")};if(n.level==="assert")if(n.args[0]===!1)r.message=`Assertion failed: ${mg(n.args.slice(1)," ")||"console.assert"}`,r.data.arguments=n.args.slice(1);else return;zs(r,{input:n.args,level:n.level})}}function NE(e){return function(n){if(Nt()!==e)return;const{startTimestamp:r,endTimestamp:o}=n,s=n.xhr[pa];if(!r||!o||!s)return;const{method:a,url:i,status_code:c,body:l}=s,f={method:a,url:i,status_code:c},d={xhr:n.xhr,input:l,startTimestamp:r,endTimestamp:o},m=T2(c);zs({category:"xhr",data:f,type:"http",level:m},d)}}function LE(e){return function(n){if(Nt()!==e)return;const{startTimestamp:r,endTimestamp:o}=n;if(o&&!(n.fetchData.url.match(/sentry_key/)&&n.fetchData.method==="POST"))if(n.error){const s=n.fetchData,a={data:n.error,input:n.args,startTimestamp:r,endTimestamp:o};zs({category:"fetch",data:s,level:"error",type:"http"},a)}else{const s=n.response,a={...n.fetchData,status_code:s&&s.status},i={input:n.args,response:s,startTimestamp:r,endTimestamp:o},c=T2(a.status_code);zs({category:"fetch",data:a,type:"http",level:c},i)}}}function zE(e){return function(n){if(Nt()!==e)return;let r=n.from,o=n.to;const s=Ms(ft.location.href);let a=r?Ms(r):void 0;const i=Ms(o);(!a||!a.path)&&(a=s),s.protocol===i.protocol&&s.host===i.host&&(o=i.relative),s.protocol===a.protocol&&s.host===a.host&&(r=a.relative),zs({category:"navigation",data:{from:r,to:o}})}}function FE(e){return!!e&&!!e.target}const WE=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],$E="BrowserApiErrors",VE=(e={})=>{const t={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...e};return{name:$E,setupOnce(){t.setTimeout&&ur(ft,"setTimeout",e0),t.setInterval&&ur(ft,"setInterval",e0),t.requestAnimationFrame&&ur(ft,"requestAnimationFrame",HE),t.XMLHttpRequest&&"XMLHttpRequest"in ft&&ur(XMLHttpRequest.prototype,"send",UE);const n=t.eventTarget;n&&(Array.isArray(n)?n:WE).forEach(GE)}}},jE=VE;function e0(e){return function(...t){const n=t[0];return t[0]=Oa(n,{mechanism:{data:{function:So(e)},handled:!1,type:"instrument"}}),e.apply(this,t)}}function HE(e){return function(t){return e.apply(this,[Oa(t,{mechanism:{data:{function:"requestAnimationFrame",handler:So(e)},handled:!1,type:"instrument"}})])}}function UE(e){return function(...t){const n=this;return["onload","onerror","onprogress","onreadystatechange"].forEach(o=>{o in n&&typeof n[o]=="function"&&ur(n,o,function(s){const a={mechanism:{data:{function:o,handler:So(s)},handled:!1,type:"instrument"}},i=$p(s);return i&&(a.mechanism.data.handler=So(i)),Oa(s,a)})}),e.apply(this,t)}}function GE(e){const n=ft[e],r=n&&n.prototype;!r||!r.hasOwnProperty||!r.hasOwnProperty("addEventListener")||(ur(r,"addEventListener",function(o){return function(s,a,i){try{XE(a)&&(a.handleEvent=Oa(a.handleEvent,{mechanism:{data:{function:"handleEvent",handler:So(a),target:e},handled:!1,type:"instrument"}}))}catch{}return o.apply(this,[s,Oa(a,{mechanism:{data:{function:"addEventListener",handler:So(a),target:e},handled:!1,type:"instrument"}}),i])}}),ur(r,"removeEventListener",function(o){return function(s,a,i){try{const c=a.__sentry_wrapped__;c&&o.call(this,s,c,i)}catch{}return o.call(this,s,a,i)}}))}function XE(e){return typeof e.handleEvent=="function"}const KE=()=>({name:"BrowserSession",setupOnce(){if(typeof ft.document>"u"){eo&&Xe.warn("Using the `browserSessionIntegration` in non-browser environments is not supported.");return}Ng({ignoreDuration:!0}),Lg(),Jp(({from:e,to:t})=>{e!==void 0&&e!==t&&(Ng({ignoreDuration:!0}),Lg())})}}),YE="GlobalHandlers",qE=(e={})=>{const t={onerror:!0,onunhandledrejection:!0,...e};return{name:YE,setupOnce(){Error.stackTraceLimit=50},setup(n){t.onerror&&(QE(n),t0("onerror")),t.onunhandledrejection&&(JE(n),t0("onunhandledrejection"))}}},ZE=qE;function QE(e){L_(t=>{const{stackParser:n,attachStacktrace:r}=G2();if(Nt()!==e||A2())return;const{msg:o,url:s,line:a,column:i,error:c}=t,l=n6(qp(n,c||o,void 0,r,!1),s,a,i);l.level="error",v2(l,{originalException:c,mechanism:{handled:!1,type:"onerror"}})})}function JE(e){z_(t=>{const{stackParser:n,attachStacktrace:r}=G2();if(Nt()!==e||A2())return;const o=e6(t),s=Wp(o)?t6(o):qp(n,o,void 0,r,!0);s.level="error",v2(s,{originalException:o,mechanism:{handled:!1,type:"onunhandledrejection"}})})}function e6(e){if(Wp(e))return e;try{if("reason"in e)return e.reason;if("detail"in e&&"reason"in e.detail)return e.detail.reason}catch{}return e}function t6(e){return{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(e)}`}]}}}function n6(e,t,n,r){const o=e.exception=e.exception||{},s=o.values=o.values||[],a=s[0]=s[0]||{},i=a.stacktrace=a.stacktrace||{},c=i.frames=i.frames||[],l=r,f=n,d=go(t)&&t.length>0?t:H5();return c.length===0&&c.push({colno:l,filename:d,function:Ps,in_app:!0,lineno:f}),e}function t0(e){eo&&Xe.log(`Global Handler attached: ${e}`)}function G2(){const e=Nt();return e&&e.getOptions()||{stackParser:()=>[],attachStacktrace:!1}}const r6=()=>({name:"HttpContext",preprocessEvent(e){if(!ft.navigator&&!ft.location&&!ft.document)return;const t=e.request&&e.request.url||ft.location&&ft.location.href,{referrer:n}=ft.document||{},{userAgent:r}=ft.navigator||{},o={...e.request&&e.request.headers,...n&&{Referer:n},...r&&{"User-Agent":r}},s={...e.request,...t&&{url:t},headers:o};e.request=s}}),o6="cause",s6=5,a6="LinkedErrors",i6=(e={})=>{const t=e.limit||s6,n=e.key||o6;return{name:a6,preprocessEvent(r,o,s){const a=s.getOptions();pT(Kp,a.stackParser,a.maxValueLength,n,t,r,o)}}},c6=i6;function l6(e){const t=[rT(),JC(),jE(),OE(),ZE(),c6(),ST(),r6()];return e.autoSessionTracking!==!1&&t.push(KE()),t}function u6(e={}){const t={defaultIntegrations:l6(e),release:typeof __SENTRY_RELEASE__=="string"?__SENTRY_RELEASE__:ft.SENTRY_RELEASE&&ft.SENTRY_RELEASE.id?ft.SENTRY_RELEASE.id:void 0,autoSessionTracking:!0,sendClientReports:!0};return e.defaultIntegrations==null&&delete e.defaultIntegrations,{...t,...e}}function d6(){const e=typeof ft.window<"u"&&ft;if(!e)return!1;const t=e.chrome?"chrome":"browser",n=e[t],r=n&&n.runtime&&n.runtime.id,o=ft.location&&ft.location.href||"",s=["chrome-extension:","moz-extension:","ms-browser-extension:","safari-web-extension:"],a=!!r&&ft===ft.top&&s.some(c=>o.startsWith(`${c}//`)),i=typeof e.nw<"u";return!!r&&!a&&!i}function f6(e={}){const t=u6(e);if(!t.skipBrowserExtensionCheck&&d6()){Ys(()=>{console.error("[Sentry] You cannot run Sentry this way in a browser extension, check: https://docs.sentry.io/platforms/javascript/best-practices/browser-extensions/")});return}eo&&(M2()||Xe.warn("No Fetch API detected. The Sentry SDK requires a Fetch API compatible environment to send events. Please add a Fetch API polyfill."));const n={...t,stackParser:B5(t.stackParser||IE),integrations:OC(t),transport:t.transport||gE};return zC(QT,n)}const n0=new WeakMap,Lf=new Map,jl={traceFetch:!0,traceXHR:!0,enableHTTPTimings:!0,trackFetchStreamPerformance:!1};function h6(e,t){const{traceFetch:n,traceXHR:r,trackFetchStreamPerformance:o,shouldCreateSpanForRequest:s,enableHTTPTimings:a,tracePropagationTargets:i}={traceFetch:jl.traceFetch,traceXHR:jl.traceXHR,trackFetchStreamPerformance:jl.trackFetchStreamPerformance,...t},c=typeof s=="function"?s:d=>!0,l=d=>g6(d,i),f={};n&&(e.addEventProcessor(d=>(d.type==="transaction"&&d.spans&&d.spans.forEach(m=>{if(m.op==="http.client"){const v=Lf.get(m.span_id);v&&(m.timestamp=v/1e3,Lf.delete(m.span_id))}}),d)),o&&OT(d=>{if(d.response){const m=n0.get(d.response);m&&d.endTimestamp&&Lf.set(m,d.endTimestamp)}}),E2(d=>{const m=CT(d,c,l,f);if(d.response&&d.fetchData.__span&&n0.set(d.response,d.fetchData.__span),m){const v=X2(d.fetchData.url),_=v?Ms(v).host:void 0;m.setAttributes({"http.url":v,"server.address":_})}a&&m&&r0(m)})),r&&H2(d=>{const m=v6(d,c,l,f);a&&m&&r0(m)})}function p6(e){return e.entryType==="resource"&&"initiatorType"in e&&typeof e.nextHopProtocol=="string"&&(e.initiatorType==="fetch"||e.initiatorType==="xmlhttprequest")}function r0(e){const{url:t}=Bt(e).data||{};if(!t||typeof t!="string")return;const n=Ji("resource",({entries:r})=>{r.forEach(o=>{p6(o)&&o.name.endsWith(t)&&(m6(o).forEach(a=>e.setAttribute(...a)),setTimeout(n))})})}function Ur(e=0){return((Zn||performance.timeOrigin)+e)/1e3}function m6(e){const{name:t,version:n}=j2(e.nextHopProtocol),r=[];return r.push(["network.protocol.version",n],["network.protocol.name",t]),Zn?[...r,["http.request.redirect_start",Ur(e.redirectStart)],["http.request.fetch_start",Ur(e.fetchStart)],["http.request.domain_lookup_start",Ur(e.domainLookupStart)],["http.request.domain_lookup_end",Ur(e.domainLookupEnd)],["http.request.connect_start",Ur(e.connectStart)],["http.request.secure_connection_start",Ur(e.secureConnectionStart)],["http.request.connection_end",Ur(e.connectEnd)],["http.request.request_start",Ur(e.requestStart)],["http.request.response_start",Ur(e.responseStart)],["http.request.response_end",Ur(e.responseEnd)]]:r}function g6(e,t){const n=ft.location&&ft.location.href;if(n){let r,o;try{r=new URL(e,n),o=new URL(n).origin}catch{return!1}const s=r.origin===o;return t?xs(r.toString(),t)||s&&xs(r.pathname,t):s}else{const r=!!e.match(/^\/(?!\/)/);return t?xs(e,t):r}}function v6(e,t,n,r){const o=e.xhr,s=o&&o[pa];if(!o||o.__sentry_own_request__||!s)return;const a=Zo()&&t(s.url);if(e.endTimestamp&&a){const d=o.__sentry_xhr_span_id__;if(!d)return;const m=r[d];m&&s.status_code!==void 0&&(Y_(m,s.status_code),m.end(),delete r[d]);return}const i=X2(s.url),c=i?Ms(i).host:void 0,l=!!Dn(),f=a&&l?Nc({name:`${s.method} ${s.url}`,attributes:{type:"xhr","http.method":s.method,"http.url":i,url:s.url,"server.address":c,[xn]:"auto.http.browser",[Ls]:"http.client"}}):new ni;return o.__sentry_xhr_span_id__=f.spanContext().spanId,r[o.__sentry_xhr_span_id__]=f,n(s.url)&&b6(o,Zo()&&l?f:void 0),f}function b6(e,t){const{"sentry-trace":n,baggage:r}=w2({span:t});n&&_6(e,n,r)}function _6(e,t,n){try{e.setRequestHeader("sentry-trace",t),n&&e.setRequestHeader("baggage",n)}catch{}}function X2(e){try{return new URL(e,ft.location.origin).href}catch{return}}function y6(){ft&&ft.document?ft.document.addEventListener("visibilitychange",()=>{const e=Dn();if(!e)return;const t=Pn(e);if(ft.document.hidden&&t){const n="cancelled",{op:r,status:o}=Bt(t);eo&&Xe.log(`[Tracing] Transaction: ${n} -> since tab moved to the background, op: ${r}`),o||t.setStatus({code:Sn,message:n}),t.setAttribute("sentry.cancellation_reason","document.hidden"),t.end()}}):eo&&Xe.warn("[Tracing] Could not set up background tab detection due to lack of global document")}const S6="BrowserTracing",k6={...Wl,instrumentNavigation:!0,instrumentPageLoad:!0,markBackgroundSpan:!0,enableLongTask:!0,enableLongAnimationFrame:!0,enableInp:!0,_experiments:{},...jl},w6=(e={})=>{Tx();const{enableInp:t,enableLongTask:n,enableLongAnimationFrame:r,_experiments:{enableInteractions:o,enableStandaloneClsSpans:s},beforeStartSpan:a,idleTimeout:i,finalTimeout:c,childSpanTimeout:l,markBackgroundSpan:f,traceFetch:d,traceXHR:m,trackFetchStreamPerformance:v,shouldCreateSpanForRequest:_,enableHTTPTimings:y,instrumentPageLoad:k,instrumentNavigation:g}={...k6,...e},b=WM({recordClsStandaloneSpans:s||!1});t&&hE(),r&&Ot.PerformanceObserver&&PerformanceObserver.supportedEntryTypes&&PerformanceObserver.supportedEntryTypes.includes("long-animation-frame")?VM():n&&$M(),o&&jM();const h={name:void 0,source:void 0};function S(x,w){const I=w.op==="pageload",M=a?a(w):w,H=M.attributes||{};w.name!==M.name&&(H[po]="custom",M.attributes=H),h.name=M.name,h.source=H[po];const j=g2(M,{idleTimeout:i,finalTimeout:c,childSpanTimeout:l,disableAutoFinish:I,beforeSpanEnd:A=>{b(),KM(A,{recordClsOnPageloadSpan:!s})}});function W(){["interactive","complete"].includes(ft.document.readyState)&&x.emit("idleSpanEnableAutoFinish",j)}return I&&ft.document&&(ft.document.addEventListener("readystatechange",()=>{W()}),W()),j}return{name:S6,afterAllSetup(x){let w,I=ft.location&&ft.location.href;function M(){w&&!Bt(w).timestamp&&(eo&&Xe.log(`[Tracing] Finishing current active span with op: ${Bt(w).op}`),w.end())}x.on("startNavigationSpan",H=>{Nt()===x&&(M(),w=S(x,{op:"navigation",...H}))}),x.on("startPageLoadSpan",(H,j={})=>{if(Nt()!==x)return;M();const W=j.sentryTrace||o0("sentry-trace"),A=j.baggage||o0("baggage"),L=_x(W,A);Kt().setPropagationContext(L),w=S(x,{op:"pageload",...H})}),x.on("spanEnd",H=>{const j=Bt(H).op;if(H!==Pn(H)||j!=="navigation"&&j!=="pageload")return;const W=Kt(),A=W.getPropagationContext();W.setPropagationContext({...A,sampled:A.sampled!==void 0?A.sampled:Zs(H),dsc:A.dsc||ri(H)})}),ft.location&&(k&&x6(x,{name:ft.location.pathname,startTime:Zn?Zn/1e3:void 0,attributes:{[po]:"url",[xn]:"auto.pageload.browser"}}),g&&Jp(({to:H,from:j})=>{if(j===void 0&&I&&I.indexOf(H)!==-1){I=void 0;return}j!==H&&(I=void 0,C6(x,{name:ft.location.pathname,attributes:{[po]:"url",[xn]:"auto.navigation.browser"}}))})),f&&y6(),o&&T6(i,c,l,h),t&&mE(),h6(x,{traceFetch:d,traceXHR:m,trackFetchStreamPerformance:v,tracePropagationTargets:x.getOptions().tracePropagationTargets,shouldCreateSpanForRequest:_,enableHTTPTimings:y})}}};function x6(e,t,n){e.emit("startPageLoadSpan",t,n),Kt().setTransactionName(t.name);const r=Dn();return(r&&Bt(r).op)==="pageload"?r:void 0}function C6(e,t){ls().setPropagationContext({traceId:Yo()}),Kt().setPropagationContext({traceId:Yo()}),e.emit("startNavigationSpan",t),Kt().setTransactionName(t.name);const n=Dn();return(n&&Bt(n).op)==="navigation"?n:void 0}function o0(e){const t=U5(`meta[name=${e}]`);return t?t.getAttribute("content"):void 0}function T6(e,t,n,r){let o;const s=()=>{const a="ui.action.click",i=Dn(),c=i&&Pn(i);if(c){const l=Bt(c).op;if(["navigation","pageload"].includes(l)){eo&&Xe.warn(`[Tracing] Did not create ${a} span because a pageload or navigation span is in progress.`);return}}if(o&&(o.setAttribute(Oh,"interactionInterrupted"),o.end(),o=void 0),!r.name){eo&&Xe.warn(`[Tracing] Did not create ${a} transaction because _latestRouteName is missing.`);return}o=g2({name:r.name,op:a,attributes:{[po]:r.source||"url"}},{idleTimeout:e,finalTimeout:t,childSpanTimeout:n})};ft.document&&addEventListener("click",s,{once:!1,capture:!0})}const Et=J.button`
  display: flex;
  align-items: center;
  background: transparent;
  border: none;
  border-radius: 0.2rem;
  color: var(--color-text);
  padding: 0.5rem 1rem;
  cursor: pointer;
  height: 2rem;
  outline: none;
  font-size: 0.8rem;

  &:hover {
    background: var(--color-highlight);
  }
  &:active {
    background: ${({theme:e})=>gt(e.secondaryBackgroundColor).lighten(.1).hex()};
  }
`,xo=J(Et)`
  background: var(--color-theme);
  color: var(--color-on-surface);

  &:hover {
    background: ${({theme:e})=>gt(e.themeColor).darken(.1).hex()};
  }
  &:active {
    background: ${({theme:e})=>gt(e.themeColor).darken(.2).hex()};
  }
`,M6=ss`
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
`,E6=ss`
  from {
    opacity: 0;
    transform: translate(-50%, -48%) scale(0.96);
  }
  to {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
`,I6=J(_4)`
  background-color: rgba(0, 0, 0, 0.3);
  position: fixed;
  inset: 0;
  animation: ${M6} 150ms cubic-bezier(0.16, 1, 0.3, 1);
`,A6=p.forwardRef(({...e},t)=>{const n=p.useRef(null);return G(S4,{children:[u(k4,{}),u(y4,{onOpenAutoFocus:Jt(e.onOpenAutoFocus,()=>{n.current=document.activeElement}),onCloseAutoFocus:Jt(e.onCloseAutoFocus,()=>{var r;(r=n.current)==null||r.focus()}),ref:t,...e})]})}),R6=J(A6)`
  background-color: var(--color-background);
  border-radius: 0.5rem;
  box-shadow: 0 0.5rem 3rem var(--color-shadow);
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  margin-bottom: 1rem;
  max-width: 30rem;
  max-height: 85vh;
  padding: 1rem;
  animation: ${E6} 150ms cubic-bezier(0.16, 1, 0.3, 1);
  display: flex;
  flex-direction: column;
  pointer-events: auto;
  overflow: hidden;

  &:focus {
    outline: none;
  }
`,hn=({children:e,style:t,...n})=>u(x4,{...n,children:G(w4,{children:[u(I6,{}),u(R6,{style:t,children:e})]})}),bn=J.div`
  font-size: 1.25rem;
  color: var(--color-text);
  margin-bottom: 1.5rem;
`,qt=J.div`
  overflow-x: hidden;
  overflow-y: auto;
  margin-bottom: 1rem;
`,gn=J.div`
  display: flex;
  justify-content: flex-end;

  & > *:not(:last-child) {
    margin-right: 1rem;
  }
`,O6=e=>{const{setDialog:t}=p.useContext(C4),n=r=>{e.callback(r),t(null)};return G(hn,{open:!0,onOpenChange:()=>n(null),style:{minWidth:"20rem"},children:[u(bn,{children:e.title}),e.message&&u(qt,{children:e.message}),u(gn,{children:e.actions.map(r=>u(Et,{onClick:()=>n(r.key),children:r.title},r.key))})]})};function P6(){const e=navigator.platform.toLowerCase();let t=null;return e.indexOf("win")>=0?t="Windows":e.indexOf("mac")>=0&&(t="macOS"),t}function $n(){return navigator.userAgent.toLowerCase().indexOf(" electron/")>-1}const Pa={};function Jl(e){return"init"in e}function Yh(e){return!!e.write}function qh(e){return"v"in e||"e"in e}function Ba(e){if("e"in e)throw e.e;if((Pa?"production":void 0)!=="production"&&!("v"in e))throw new Error("[Bug] atom state is not initialized");return e.v}const eu=new WeakMap;function K2(e){var t;return tu(e)&&!!((t=eu.get(e))!=null&&t[0])}function B6(e){const t=eu.get(e);t!=null&&t[0]&&(t[0]=!1,t[1].forEach(n=>n()))}function Zh(e,t){let n=eu.get(e);if(!n){n=[!0,new Set],eu.set(e,n);const r=()=>{n[0]=!1};e.then(r,r)}n[1].add(t)}function tu(e){return typeof(e==null?void 0:e.then)=="function"}function Y2(e,t,n){if(!n.p.has(e)){n.p.add(e);const r=()=>n.p.delete(e);t.then(r,r)}}function q2(e,t,n){var r;const o=new Set;for(const s of((r=n.get(e))==null?void 0:r.t)||[])n.has(s)&&o.add(s);for(const s of t.p)o.add(s);return o}const D6=()=>{const e=new Set,t=()=>e.forEach(n=>n());return t.add=n=>(e.add(n),()=>e.delete(n)),t},xl=()=>{const e={},t=new WeakMap,n=r=>{var o,s;(o=t.get(e))==null||o.forEach(a=>a(r)),(s=t.get(r))==null||s.forEach(a=>a())};return n.add=(r,o)=>{const s=r||e,a=(t.has(s)?t:t.set(s,new Set)).get(s);return a.add(o),()=>{a==null||a.delete(o),a.size||t.delete(s)}},n};function N6(e){return e.r||(e.r=xl()),e.c||(e.c=xl()),e.m||(e.m=xl()),e.u||(e.u=xl()),e.f||(e.f=D6()),e}const L6=(e,t,...n)=>t.read(...n),z6=(e,t,...n)=>t.write(...n),F6=(e,t)=>{var n;return(n=t.unstable_onInit)==null?void 0:n.call(t,e)},W6=(e,t,n)=>{var r;return(r=t.onMount)==null?void 0:r.call(t,n)},$6=(e,t)=>{const n=In(e),r=n[0],o=n[9];if((Pa?"production":void 0)!=="production"&&!t)throw new Error("Atom is undefined or null");let s=r.get(t);return s||(s={d:new Map,p:new Set,n:0},r.set(t,s),o==null||o(e,t)),s},V6=e=>{const t=In(e),n=t[1],r=t[3],o=t[4],s=t[5],a=t[6],i=t[13],c=[],l=f=>{try{f()}catch(d){c.push(d)}};do{a.f&&l(a.f);const f=new Set,d=f.add.bind(f);r.forEach(m=>{var v;return(v=n.get(m))==null?void 0:v.l.forEach(d)}),r.clear(),s.forEach(d),s.clear(),o.forEach(d),o.clear(),f.forEach(l),r.size&&i(e)}while(r.size||s.size||o.size);if(c.length)throw new AggregateError(c)},j6=e=>{const t=In(e),n=t[1],r=t[2],o=t[3],s=t[11],a=t[14],i=t[17],c=[],l=new WeakSet,f=new WeakSet,d=Array.from(o);for(;d.length;){const m=d[d.length-1],v=s(e,m);if(f.has(m)){d.pop();continue}if(l.has(m)){if(r.get(m)===v.n)c.push([m,v]);else if((Pa?"production":void 0)!=="production"&&r.has(m))throw new Error("[Bug] invalidated atom exists");f.add(m),d.pop();continue}l.add(m);for(const _ of q2(m,v,n))l.has(_)||d.push(_)}for(let m=c.length-1;m>=0;--m){const[v,_]=c[m];let y=!1;for(const k of _.d.keys())if(k!==v&&o.has(k)){y=!0;break}y&&(a(e,v),i(e,v)),r.delete(v)}},H6=(e,t)=>{var n,r;const o=In(e),s=o[1],a=o[2],i=o[3],c=o[6],l=o[7],f=o[11],d=o[12],m=o[13],v=o[14],_=o[16],y=o[17],k=f(e,t);if(qh(k)&&(s.has(t)&&a.get(t)!==k.n||Array.from(k.d).every(([M,H])=>v(e,M).n===H)))return k;k.d.clear();let g=!0;function b(){s.has(t)&&(y(e,t),m(e),d(e))}function h(M){var H;if(M===t){const W=f(e,M);if(!qh(W))if(Jl(M))nu(e,M,M.init);else throw new Error("no atom init");return Ba(W)}const j=v(e,M);try{return Ba(j)}finally{k.d.set(M,j.n),K2(k.v)&&Y2(t,k.v,j),(H=s.get(M))==null||H.t.add(t),g||b()}}let S,x;const w={get signal(){return S||(S=new AbortController),S.signal},get setSelf(){return(Pa?"production":void 0)!=="production"&&!Yh(t)&&console.warn("setSelf function cannot be used with read-only atom"),!x&&Yh(t)&&(x=(...M)=>{if((Pa?"production":void 0)!=="production"&&g&&console.warn("setSelf function cannot be called in sync"),!g)try{return _(e,t,...M)}finally{m(e),d(e)}}),x}},I=k.n;try{const M=l(e,t,h,w);return nu(e,t,M),tu(M)&&(Zh(M,()=>S==null?void 0:S.abort()),M.then(b,b)),(n=c.r)==null||n.call(c,t),k}catch(M){return delete k.v,k.e=M,++k.n,k}finally{g=!1,I!==k.n&&a.get(t)===I&&(a.set(t,k.n),i.add(t),(r=c.c)==null||r.call(c,t))}},U6=(e,t)=>{const n=In(e),r=n[1],o=n[2],s=n[11],a=[t];for(;a.length;){const i=a.pop(),c=s(e,i);for(const l of q2(i,c,r)){const f=s(e,l);o.set(l,f.n),a.push(l)}}},Z2=(e,t,...n)=>{const r=In(e),o=r[3],s=r[6],a=r[8],i=r[11],c=r[12],l=r[13],f=r[14],d=r[15],m=r[17];let v=!0;const _=k=>Ba(f(e,k)),y=(k,...g)=>{var b;const h=i(e,k);try{if(k===t){if(!Jl(k))throw new Error("atom not writable");const S=h.n,x=g[0];nu(e,k,x),m(e,k),S!==h.n&&(o.add(k),(b=s.c)==null||b.call(s,k),d(e,k));return}else return Z2(e,k,...g)}finally{v||(l(e),c(e))}};try{return a(e,t,_,y,...n)}finally{v=!1}},G6=(e,t)=>{var n;const r=In(e),o=r[1],s=r[3],a=r[6],i=r[11],c=r[15],l=r[18],f=r[19],d=i(e,t),m=o.get(t);if(m&&!K2(d.v)){for(const[v,_]of d.d)if(!m.d.has(v)){const y=i(e,v);l(e,v).t.add(t),m.d.add(v),_!==y.n&&(s.add(v),(n=a.c)==null||n.call(a,v),c(e,v))}for(const v of m.d||[])if(!d.d.has(v)){m.d.delete(v);const _=f(e,v);_==null||_.t.delete(t)}}},Q2=(e,t)=>{var n;const r=In(e),o=r[1],s=r[4],a=r[6],i=r[10],c=r[11],l=r[12],f=r[13],d=r[14],m=r[16],v=c(e,t);let _=o.get(t);if(!_){d(e,t);for(const y of v.d.keys())Q2(e,y).t.add(t);if(_={l:new Set,d:new Set(v.d.keys()),t:new Set},o.set(t,_),(n=a.m)==null||n.call(a,t),Yh(t)){const y=()=>{let k=!0;const g=(...b)=>{try{return m(e,t,...b)}finally{k||(f(e),l(e))}};try{const b=i(e,t,g);b&&(_.u=()=>{k=!0;try{b()}finally{k=!1}})}finally{k=!1}};s.add(y)}}return _},X6=(e,t)=>{var n;const r=In(e),o=r[1],s=r[5],a=r[6],i=r[11],c=r[19],l=i(e,t);let f=o.get(t);if(f&&!f.l.size&&!Array.from(f.t).some(d=>{var m;return(m=o.get(d))==null?void 0:m.d.has(t)})){f.u&&s.add(f.u),f=void 0,o.delete(t),(n=a.u)==null||n.call(a,t);for(const d of l.d.keys()){const m=c(e,d);m==null||m.t.delete(t)}return}return f},nu=(e,t,n)=>{const r=In(e)[11],o=r(e,t),s="v"in o,a=o.v;if(tu(n))for(const i of o.d.keys())Y2(t,n,r(e,i));o.v=n,delete o.e,(!s||!Object.is(a,o.v))&&(++o.n,tu(a)&&B6(a))},K6=(e,t)=>{const n=In(e)[14];return Ba(n(e,t))},Y6=(e,t,...n)=>{const r=In(e),o=r[12],s=r[13],a=r[16];try{return a(e,t,...n)}finally{s(e),o(e)}},q6=(e,t,n)=>{const r=In(e),o=r[12],s=r[18],a=r[19],c=s(e,t).l;return c.add(n),o(e),()=>{c.delete(n),a(e,t),o(e)}},J2=new WeakMap,In=e=>{const t=J2.get(e);if((Pa?"production":void 0)!=="production"&&!t)throw new Error("Store must be created by buildStore to read its building blocks");return t};function ey(e){const t=In(e),n=t[24];return n?n(t):t}function ty(...e){const t={get(r){const o=In(t)[21];return o(t,r)},set(r,...o){const s=In(t)[22];return s(t,r,...o)},sub(r,o){const s=In(t)[23];return s(t,r,o)}},n=[new WeakMap,new WeakMap,new WeakMap,new Set,new Set,new Set,{},L6,z6,F6,W6,$6,V6,j6,H6,U6,Z2,G6,Q2,X6,nu,K6,Y6,q6,void 0].map((r,o)=>e[o]||r);return J2.set(t,Object.freeze(n)),t}const ny={};let Z6=0;function me(e,t){const n=`atom${++Z6}`,r={toString(){return(ny?"production":void 0)!=="production"&&this.debugLabel?n+":"+this.debugLabel:n}};return typeof e=="function"?r.read=e:(r.init=e,r.read=Q6,r.write=J6),t&&(r.write=t),r}function Q6(e){return e(this)}function J6(e,t,n){return t(this,typeof n=="function"?n(e(this)):n)}function ry(){return ty()}let Ri;function e8(){return Ri||(Ri=ry(),(ny?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=Ri),globalThis.__JOTAI_DEFAULT_STORE__!==Ri&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),Ri}const t8={},Qh=p.createContext(void 0);function mr(e){const t=p.useContext(Qh);return(e==null?void 0:e.store)||t||e8()}function n8({children:e,store:t}){const n=p.useRef(null);return t?p.createElement(Qh.Provider,{value:t},e):(n.current===null&&(n.current=ry()),p.createElement(Qh.Provider,{value:n.current},e))}const Jh=e=>typeof(e==null?void 0:e.then)=="function",ep=e=>{e.status||(e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t}))},r8=it.use||(e=>{if(e.status==="pending")throw e;if(e.status==="fulfilled")return e.value;throw e.status==="rejected"?e.reason:(ep(e),e)}),zf=new WeakMap,s0=(e,t)=>{let n=zf.get(e);return n||(n=new Promise((r,o)=>{let s=e;const a=l=>f=>{s===l&&r(f)},i=l=>f=>{s===l&&o(f)},c=()=>{try{const l=t();Jh(l)?(zf.set(l,n),s=l,l.then(a(l),i(l)),Zh(l,c)):r(l)}catch(l){o(l)}};e.then(a(e),i(e)),Zh(e,c)}),zf.set(e,n)),n};function Oe(e,t){const{delay:n,unstable_promiseStatus:r=!it.use}=t||{},o=mr(t),[[s,a,i],c]=p.useReducer(f=>{const d=o.get(e);return Object.is(f[0],d)&&f[1]===o&&f[2]===e?f:[d,o,e]},void 0,()=>[o.get(e),o,e]);let l=s;if((a!==o||i!==e)&&(c(),l=o.get(e)),p.useEffect(()=>{const f=o.sub(e,()=>{if(r)try{const d=o.get(e);Jh(d)&&ep(s0(d,()=>o.get(e)))}catch{}if(typeof n=="number"){setTimeout(c,n);return}c()});return c(),f},[o,e,n,r]),p.useDebugValue(l),Jh(l)){const f=s0(l,()=>o.get(e));return r&&ep(f),r8(f)}return l}function xe(e,t){const n=mr(t);return p.useCallback((...o)=>{if((t8?"production":void 0)!=="production"&&!("write"in e))throw new Error("not writable atom");return n.set(e,...o)},[n,e])}function em(e,t){return[Oe(e,t),xe(e,t)]}class o8{constructor(t,n){this.tickTransform=t,this.trackTransform=n}getY(t){return this.trackTransform.getY(t)}getTrackIndex(t){return this.trackTransform.getTrackIndex(t)}getArrangePoint(t){return{tick:this.tickTransform.getTick(t.x),trackIndex:this.trackTransform.getTrackIndex(t.y)}}}class oy{constructor(t,n){this.pixelsPerKey=t,this.maxNoteNumber=n}getY(t){return(this.maxNoteNumber-t)*this.pixelsPerKey}getNoteNumber(t){return Math.ceil(this.getNoteNumberFractional(t))}getNoteNumberFractional(t){return this.maxNoteNumber-t/this.pixelsPerKey}getDeltaNoteNumber(t){return-t/this.pixelsPerKey}get numberOfKeys(){return this.maxNoteNumber+1}getMaxY(){return this.numberOfKeys*this.pixelsPerKey}}class sy{constructor(t,n){this.tickTransform=t,this.keyTransform=n}getX(t){return this.tickTransform.getX(t)}getY(t){return this.keyTransform.getY(t)}getTick(t){return this.tickTransform.getTick(t)}getNoteNumber(t){return this.keyTransform.getNoteNumber(t)}getNoteNumberFractional(t){return this.keyTransform.getNoteNumberFractional(t)}getDeltaNoteNumber(t){return this.keyTransform.getDeltaNoteNumber(t)}get numberOfKeys(){return this.keyTransform.numberOfKeys}get pixelsPerKey(){return this.keyTransform.pixelsPerKey}getMaxY(){return this.keyTransform.getMaxY()}getRect(t){return{x:this.getX(t.tick),y:this.getY(t.noteNumber),width:this.getX(t.duration),height:this.keyTransform.pixelsPerKey}}getDrumRect(t){return{x:this.getX(t.tick)-this.keyTransform.pixelsPerKey/2,y:this.getY(t.noteNumber),width:this.keyTransform.pixelsPerKey,height:this.keyTransform.pixelsPerKey}}getNotePoint(t){return{tick:this.getTick(t.x),noteNumber:this.getNoteNumber(t.y)}}getNotePointFractional(t){return{tick:this.getTick(t.x),noteNumber:this.getNoteNumberFractional(t.y)}}}const tm={},s8=Symbol((tm?"production":void 0)!=="production"?"RESET":""),ay=e=>typeof(e==null?void 0:e.then)=="function";function a8(e=()=>{try{return window.localStorage}catch(n){(tm?"production":void 0)!=="production"&&typeof window<"u"&&console.warn(n);return}},t){var n;let r,o;const s={getItem:(c,l)=>{var f,d;const m=_=>{if(_=_||"",r!==_){try{o=JSON.parse(_,t==null?void 0:t.reviver)}catch{return l}r=_}return o},v=(d=(f=e())==null?void 0:f.getItem(c))!=null?d:null;return ay(v)?v.then(m):m(v)},setItem:(c,l)=>{var f;return(f=e())==null?void 0:f.setItem(c,JSON.stringify(l,void 0))},removeItem:c=>{var l;return(l=e())==null?void 0:l.removeItem(c)}},a=c=>(l,f,d)=>c(l,m=>{let v;try{v=JSON.parse(m||"")}catch{v=d}f(v)});let i;try{i=(n=e())==null?void 0:n.subscribe}catch{}return!i&&typeof window<"u"&&typeof window.addEventListener=="function"&&window.Storage&&(i=(c,l)=>{if(!(e()instanceof window.Storage))return()=>{};const f=d=>{d.storageArea===e()&&d.key===c&&l(d.newValue)};return window.addEventListener("storage",f),()=>{window.removeEventListener("storage",f)}}),i&&(s.subscribe=a(i)),s}const i8=a8();function nm(e,t,n=i8,r){const o=me(t);return(tm?"production":void 0)!=="production"&&(o.debugPrivate=!0),o.onMount=a=>{a(n.getItem(e,t));let i;return n.subscribe&&(i=n.subscribe(e,a,t)),i},me(a=>a(o),(a,i,c)=>{const l=typeof c=="function"?c(a(o)):c;return l===s8?(i(o,t),n.removeItem(e)):ay(l)?l.then(f=>(i(o,f),n.setItem(e,f))):(i(o,l),n.setItem(e,l))})}function Qo(e,t){const n=p.useMemo(()=>me(null,(r,o,...s)=>e(r,o,...s)),[e]);return xe(n,t)}const a0=new WeakMap;function c8(e,t){const n=mr(t),r=l8(n);for(const[o,...s]of e)(!r.has(o)||t!=null&&t.dangerouslyForceHydrate)&&(r.add(o),n.set(o,...s))}const l8=e=>{let t=a0.get(e);return t||(t=new WeakSet,a0.set(e,t)),t},ru=new WeakMap;function i0(e,t){const n=new Set(e),r=new Set(t);return e===t||n.size===r.size&&Array.from(n).every(r.has.bind(r))}function Cl(e){return"write"in e}const c0={};function $c({atoms:e=[],atomFamilies:t=[],parentStore:n,name:r}){const o=new Set(e),s=new Set(t),a=ru.get(n),i=(a==null?void 0:a.baseStore)??n,c=new WeakMap,l=new WeakMap,f=new WeakMap,d={getAtom:_,baseStore:i,cleanup(){for(const S of v)S()},prepareWriteAtom(S,x,w,I){if(x.read===Ff&&Cl(x)&&Cl(S)&&x.write!==l0&&d!==w){const{write:M}=x;return S.write=h(x.write.bind(x),w,I),()=>{S.write=M}}}},m=u8(d);ru.set(m,d);for(const S of o)c.set(S,[g(S,d),d]);const v=new Set;for(const S of s){for(const w of S.getParams()){const I=S(w);c.has(I)||c.set(I,[g(I,d),d])}const x=S.unstable_listen(w=>{w.type==="CREATE"&&!c.has(w.atom)?c.set(w.atom,[g(w.atom,d),d]):o.has(w.atom)||c.delete(w.atom)});v.add(x)}return m;function _(S,x){var w,I;if(c.has(S))return c.get(S);if(x===d)return l.has(S)||l.set(S,[g(S,x),x]),l.get(S);const M=x??c0;if(a){if(!((w=f.get(M))!=null&&w.has(S))){const[H,j]=a.getAtom(S,x);y(k(H,S,j),S,x,j)}return f.get(M).get(S)}return(I=f.get(M))!=null&&I.has(S)||y(k(S,S),S),f.get(M).get(S)}function y(S,x,w,I){const M=w??c0;f.has(M)||f.set(M,new WeakMap),f.get(M).set(x,[S,I].filter(Boolean))}function k(S,x,w){return x.read!==Ff?g(x,w):S}function g(S,x){const w=Object.getOwnPropertyDescriptors(S);Object.keys(w).filter(H=>["read","write","debugLabel"].includes(H)).forEach(H=>w[H].configurable=!0);const I=Object.getPrototypeOf(S),M=Object.create(I,w);return M.originalAtom=S,M.read!==Ff&&(M.read=b(S.read.bind(S),x)),Cl(M)&&Cl(S)&&M.write!==l0&&(M.write=h(S.write.bind(S),x)),M}function b(S,x){return function(w,I){return S(function(M){const[H]=_(M,x);return w(H)},I)}}function h(S,x,w=x){return function(I,M,...H){return S(function(j){const[W]=_(j,x);return I(W)},function(j,...W){const[A]=_(j,x),L=d.prepareWriteAtom(A,j,x,w);try{return M(A,...W)}finally{L==null||L()}},...H)}}}const{read:Ff,write:l0}=me(null);function u8(e){const t=[...ey(e.baseStore)],n=t[21],r=t[22],o=t[23],s={};t[9]=(g,b)=>{var h;return(h=b.unstable_onInit)==null?void 0:h.call(b,a)},t[21]=m(n),t[22]=f,t[23]=m(o),t[24]=([...g])=>{const b=[v(g[0],i),v(g[1],c),v(g[2]),_(g[3]),g[4],g[5],k(g[6]),m(g[7]),m(g[8]),g[9],m(g[10]),m(g[11],h=>l(b[0],h)),g[12],g[13],m(g[14]),m(g[15]),m(g[16]),m(g[17]),m(g[18]),m(g[19]),m(g[20]),m(g[21]),m(g[22]),m(g[23]),void 0];return b};const a=ty(...t);return a;function i(g){const b=new WeakMap;return function(h){let S=b.get(h);if(S)return S;const x=g(h);if(x)return S={...x,d:v(x.d,function(w){return I=>w(e.getAtom(I)[0])}),p:_(x.p),get n(){return x.n},set n(w){x.n=w},get v(){return x.v},set v(w){x.v=w},get e(){return x.e},set e(w){x.e=w}},b.set(h,S),S}}function c(g){const b=new WeakMap;return function(h){let S=b.get(h);if(S)return S;const x=g(h);if(x)return S={...x,d:_(x.d),t:_(x.t),get u(){return x.u},set u(w){x.u=w}},b.set(h,S),x}}function l(g,b){return function(h,S){return g.get(S)||(g.set(S,b(h,S)),g.get(S))}}function f(g,b,...h){const[S,x]=e.getAtom(b),w=e.prepareWriteAtom(S,b,x,e);try{return r(g,S,...h)}finally{w==null||w()}}function d(g,b){return function(h,...S){const[x]=e.getAtom(h);return(b?b(g):g)(x,...S)}}function m(g,b){return function(h,S,...x){const[w]=e.getAtom(S);return(b?b(g):g)(h,w,...x)}}function v(g,b){const h={get:d(g.get.bind(g),b),set:d(g.set.bind(g))};return"has"in g&&(h.has=d(g.has.bind(g))),"delete"in g&&(h.delete=d(g.delete.bind(g))),h}function _(g){return{get size(){return g.size},add:d(g.add.bind(g)),has:d(g.has.bind(g)),clear:g.clear.bind(g),forEach:b=>g.forEach(d(b)),*[Symbol.iterator](){for(const b of g)yield e.getAtom(b)[0]}}}function y(g){if(!g)return;const b=d(g);return b.add=function(h,S){if(h===void 0)return g.add(void 0,S);const[x]=e.getAtom(h);return g.add(x,S)},b}function k(g){return Object.assign({get r(){return s.r??(s.r=y(g.r))},set r(b){g.r=b},get c(){return s.c??(s.c=y(g.c))},set c(b){g.c=b},get m(){return s.m??(s.m=y(g.m))},set m(b){g.m=b},get u(){return s.u??(s.u=y(g.u))},set u(b){g.u=b},get f(){return g.f},set f(b){g.f=b}},g)}}function rm(e){var t;const{atoms:n=[],atomFamilies:r=[],children:o,scope:s,name:a}=e,i=mr(),c=Array.from(n,v=>Array.isArray(v)?v[0]:v);function l(){return[s??$c({atoms:c,atomFamilies:r,parentStore:i,name:a}),function(v){return i!==v.parentStore||!i0(c,v.atoms)||!i0(r,v.atomFamilies)||s!==v.providedScope}]}const[[f,d],m]=p.useState(l);return d({atoms:c,atomFamilies:r,parentStore:i,providedScope:s})&&((t=ru.get(f))==null||t.cleanup(),m(l)),c8(Array.from(n).filter(Array.isArray),{store:f}),p.useEffect(()=>{var v;return(v=ru.get(f))==null?void 0:v.cleanup},[f]),p.createElement(n8,{store:f},o)}var to;(e=>{const t={tick:0,measure:0,denominator:4,numerator:4},n=(c,l,f)=>{const d=f*4/c.denominator,m=d*c.numerator;let v=l-c.tick;const _=Math.floor(v/m);v-=_*m;const y=Math.floor(v/d);return v-=y*d,{measure:c.measure+_,beat:y,tick:v}};function r(c,l){if(c.length===0)return[t];{let f=0;return c.map((d,m)=>{let v=0;if(m>0){const _=c[m-1],y=l*4/_.denominator,k=Math.floor((d.tick-_.tick)/y/_.numerator);v=f+k,f=v}return{tick:d.tick,measure:v,numerator:d.numerator,denominator:d.denominator}})}}e.fromTimeSignatures=r,e.getMBTString=(c,l,f,d=d8)=>d(o(c,l,f)),e.getMeasuresInRange=(c,l)=>{let f=0;const d=[];for(const m of c){const v=c[f+1];if(f++,d.length===0){if(v!==void 0&&v.tick<=l[0])continue;m.tick>l[0]?(console.warn("There is no initial time signature. Use 4/4 by default"),d.push(t)):d.push(m)}if(d.length!==0)if(m.tick<=l[1])d.push(m);else break}return d};const o=(c,l,f)=>n(u0(c,l)??t,l,f);function s(c,l,f){const d=u0(c,l)??t,m=f*4/d.denominator*d.numerator,v=Math.floor((l-d.tick)/m),_=d.tick+m*v,y=f*4/d.denominator;return{tick:_,duration:m,ticksPerBeat:y,eventTick:d.tick,numerator:d.numerator}}e.getMeasureStart=s;function a(c,l,f){const d=s(c,l,f);return l>d.tick+d.ticksPerBeat?d.tick:s(c,d.tick-1,f).tick}e.getPreviousMeasureTick=a;function i(c,l,f){const d=s(c,l,f);return d.tick+d.duration}e.getNextMeasureTick=i})(to||(to={}));const Wf=(e,t)=>{const n=e.toFixed(0);return("0".repeat(t)+n).slice(-Math.max(t,n.length))};function d8(e){return`${Wf(e.measure+1,4)}:${Wf(e.beat+1,2)}:${Wf(e.tick,3)}`}function u0(e,t){let n=null;for(const r of e){if(r.tick>t)break;n=r}return n}var ou;(e=>{e.createInRange=(t,n,r)=>{const o=[],s=to.getMeasuresInRange(t,r);return s.forEach((a,i)=>{const c=s[i+1],l=n*4/a.denominator,f=c?c.tick:r[1],d=Math.max(0,Math.floor((r[0]-a.tick)/l)),m=(f-a.tick)/l;for(let v=d;v<m;v++){const _=a.tick+l*v;o.push({measure:a.measure+Math.floor(v/a.numerator),beat:v%a.numerator,tick:_})}}),o}})(ou||(ou={}));var Mt;(function(e){e.assertEqual=o=>o;function t(o){}e.assertIs=t;function n(o){throw new Error}e.assertNever=n,e.arrayToEnum=o=>{const s={};for(const a of o)s[a]=a;return s},e.getValidEnumValues=o=>{const s=e.objectKeys(o).filter(i=>typeof o[o[i]]!="number"),a={};for(const i of s)a[i]=o[i];return e.objectValues(a)},e.objectValues=o=>e.objectKeys(o).map(function(s){return o[s]}),e.objectKeys=typeof Object.keys=="function"?o=>Object.keys(o):o=>{const s=[];for(const a in o)Object.prototype.hasOwnProperty.call(o,a)&&s.push(a);return s},e.find=(o,s)=>{for(const a of o)if(s(a))return a},e.isInteger=typeof Number.isInteger=="function"?o=>Number.isInteger(o):o=>typeof o=="number"&&isFinite(o)&&Math.floor(o)===o;function r(o,s=" | "){return o.map(a=>typeof a=="string"?`'${a}'`:a).join(s)}e.joinValues=r,e.jsonStringifyReplacer=(o,s)=>typeof s=="bigint"?s.toString():s})(Mt||(Mt={}));var tp;(function(e){e.mergeShapes=(t,n)=>({...t,...n})})(tp||(tp={}));const qe=Mt.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ho=e=>{switch(typeof e){case"undefined":return qe.undefined;case"string":return qe.string;case"number":return isNaN(e)?qe.nan:qe.number;case"boolean":return qe.boolean;case"function":return qe.function;case"bigint":return qe.bigint;case"symbol":return qe.symbol;case"object":return Array.isArray(e)?qe.array:e===null?qe.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?qe.promise:typeof Map<"u"&&e instanceof Map?qe.map:typeof Set<"u"&&e instanceof Set?qe.set:typeof Date<"u"&&e instanceof Date?qe.date:qe.object;default:return qe.unknown}},Ce=Mt.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),f8=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class fr extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}format(t){const n=t||function(s){return s.message},r={_errors:[]},o=s=>{for(const a of s.issues)if(a.code==="invalid_union")a.unionErrors.map(o);else if(a.code==="invalid_return_type")o(a.returnTypeError);else if(a.code==="invalid_arguments")o(a.argumentsError);else if(a.path.length===0)r._errors.push(n(a));else{let i=r,c=0;for(;c<a.path.length;){const l=a.path[c];c===a.path.length-1?(i[l]=i[l]||{_errors:[]},i[l]._errors.push(n(a))):i[l]=i[l]||{_errors:[]},i=i[l],c++}}};return o(this),r}static assert(t){if(!(t instanceof fr))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Mt.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){const n={},r=[];for(const o of this.issues)o.path.length>0?(n[o.path[0]]=n[o.path[0]]||[],n[o.path[0]].push(t(o))):r.push(t(o));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}}fr.create=e=>new fr(e);const Da=(e,t)=>{let n;switch(e.code){case Ce.invalid_type:e.received===qe.undefined?n="Required":n=`Expected ${e.expected}, received ${e.received}`;break;case Ce.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,Mt.jsonStringifyReplacer)}`;break;case Ce.unrecognized_keys:n=`Unrecognized key(s) in object: ${Mt.joinValues(e.keys,", ")}`;break;case Ce.invalid_union:n="Invalid input";break;case Ce.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${Mt.joinValues(e.options)}`;break;case Ce.invalid_enum_value:n=`Invalid enum value. Expected ${Mt.joinValues(e.options)}, received '${e.received}'`;break;case Ce.invalid_arguments:n="Invalid function arguments";break;case Ce.invalid_return_type:n="Invalid function return type";break;case Ce.invalid_date:n="Invalid date";break;case Ce.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:Mt.assertNever(e.validation):e.validation!=="regex"?n=`Invalid ${e.validation}`:n="Invalid";break;case Ce.too_small:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:n="Invalid input";break;case Ce.too_big:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?n=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:n="Invalid input";break;case Ce.custom:n="Invalid input";break;case Ce.invalid_intersection_types:n="Intersection results could not be merged";break;case Ce.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case Ce.not_finite:n="Number must be finite";break;default:n=t.defaultError,Mt.assertNever(e)}return{message:n}};let iy=Da;function h8(e){iy=e}function su(){return iy}const au=e=>{const{data:t,path:n,errorMaps:r,issueData:o}=e,s=[...n,...o.path||[]],a={...o,path:s};if(o.message!==void 0)return{...o,path:s,message:o.message};let i="";const c=r.filter(l=>!!l).slice().reverse();for(const l of c)i=l(a,{data:t,defaultError:i}).message;return{...o,path:s,message:i}},p8=[];function Ve(e,t){const n=su(),r=au({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===Da?void 0:Da].filter(o=>!!o)});e.common.issues.push(r)}class Bn{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,n){const r=[];for(const o of n){if(o.status==="aborted")return at;o.status==="dirty"&&t.dirty(),r.push(o.value)}return{status:t.value,value:r}}static async mergeObjectAsync(t,n){const r=[];for(const o of n){const s=await o.key,a=await o.value;r.push({key:s,value:a})}return Bn.mergeObjectSync(t,r)}static mergeObjectSync(t,n){const r={};for(const o of n){const{key:s,value:a}=o;if(s.status==="aborted"||a.status==="aborted")return at;s.status==="dirty"&&t.dirty(),a.status==="dirty"&&t.dirty(),s.value!=="__proto__"&&(typeof a.value<"u"||o.alwaysSet)&&(r[s.value]=a.value)}return{status:t.value,value:r}}}const at=Object.freeze({status:"aborted"}),ma=e=>({status:"dirty",value:e}),Vn=e=>({status:"valid",value:e}),np=e=>e.status==="aborted",rp=e=>e.status==="dirty",Fs=e=>e.status==="valid",ec=e=>typeof Promise<"u"&&e instanceof Promise;function iu(e,t,n,r){if(typeof t=="function"?e!==t||!0:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t.get(e)}function cy(e,t,n,r,o){if(typeof t=="function"?e!==t||!0:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,n),n}var nt;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(nt||(nt={}));var $i,Vi;class no{constructor(t,n,r,o){this._cachedPath=[],this.parent=t,this.data=n,this._path=r,this._key=o}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const d0=(e,t)=>{if(Fs(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new fr(e.common.issues);return this._error=n,this._error}}};function mt(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:o}=e;if(t&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:o}:{errorMap:(a,i)=>{var c,l;const{message:f}=e;return a.code==="invalid_enum_value"?{message:f??i.defaultError}:typeof i.data>"u"?{message:(c=f??r)!==null&&c!==void 0?c:i.defaultError}:a.code!=="invalid_type"?{message:i.defaultError}:{message:(l=f??n)!==null&&l!==void 0?l:i.defaultError}},description:o}}class vt{get description(){return this._def.description}_getType(t){return ho(t.data)}_getOrReturnCtx(t,n){return n||{common:t.parent.common,data:t.data,parsedType:ho(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Bn,ctx:{common:t.parent.common,data:t.data,parsedType:ho(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const n=this._parse(t);if(ec(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(t){const n=this._parse(t);return Promise.resolve(n)}parse(t,n){const r=this.safeParse(t,n);if(r.success)return r.data;throw r.error}safeParse(t,n){var r;const o={common:{issues:[],async:(r=n==null?void 0:n.async)!==null&&r!==void 0?r:!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:ho(t)},s=this._parseSync({data:t,path:o.path,parent:o});return d0(o,s)}"~validate"(t){var n,r;const o={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:ho(t)};if(!this["~standard"].async)try{const s=this._parseSync({data:t,path:[],parent:o});return Fs(s)?{value:s.value}:{issues:o.common.issues}}catch(s){!((r=(n=s==null?void 0:s.message)===null||n===void 0?void 0:n.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),o.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:o}).then(s=>Fs(s)?{value:s.value}:{issues:o.common.issues})}async parseAsync(t,n){const r=await this.safeParseAsync(t,n);if(r.success)return r.data;throw r.error}async safeParseAsync(t,n){const r={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:ho(t)},o=this._parse({data:t,path:r.path,parent:r}),s=await(ec(o)?o:Promise.resolve(o));return d0(r,s)}refine(t,n){const r=o=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(o):n;return this._refinement((o,s)=>{const a=t(o),i=()=>s.addIssue({code:Ce.custom,...r(o)});return typeof Promise<"u"&&a instanceof Promise?a.then(c=>c?!0:(i(),!1)):a?!0:(i(),!1)})}refinement(t,n){return this._refinement((r,o)=>t(r)?!0:(o.addIssue(typeof n=="function"?n(r,o):n),!1))}_refinement(t){return new Lr({schema:this,typeName:st.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return Jr.create(this,this._def)}nullable(){return ns.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Dr.create(this)}promise(){return La.create(this,this._def)}or(t){return oc.create([this,t],this._def)}and(t){return sc.create(this,t,this._def)}transform(t){return new Lr({...mt(this._def),schema:this,typeName:st.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const n=typeof t=="function"?t:()=>t;return new uc({...mt(this._def),innerType:this,defaultValue:n,typeName:st.ZodDefault})}brand(){return new om({typeName:st.ZodBranded,type:this,...mt(this._def)})}catch(t){const n=typeof t=="function"?t:()=>t;return new dc({...mt(this._def),innerType:this,catchValue:n,typeName:st.ZodCatch})}describe(t){const n=this.constructor;return new n({...this._def,description:t})}pipe(t){return Vc.create(this,t)}readonly(){return fc.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const m8=/^c[^\s-]{8,}$/i,g8=/^[0-9a-z]+$/,v8=/^[0-9A-HJKMNP-TV-Z]{26}$/i,b8=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,_8=/^[a-z0-9_-]{21}$/i,y8=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,S8=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,k8=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,w8="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let $f;const x8=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,C8=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,T8=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,M8=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,E8=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,I8=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ly="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",A8=new RegExp(`^${ly}$`);function uy(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const n=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${n}`}function R8(e){return new RegExp(`^${uy(e)}$`)}function dy(e){let t=`${ly}T${uy(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function O8(e,t){return!!((t==="v4"||!t)&&x8.test(e)||(t==="v6"||!t)&&T8.test(e))}function P8(e,t){if(!y8.test(e))return!1;try{const[n]=e.split("."),r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),o=JSON.parse(atob(r));return!(typeof o!="object"||o===null||!o.typ||!o.alg||t&&o.alg!==t)}catch{return!1}}function B8(e,t){return!!((t==="v4"||!t)&&C8.test(e)||(t==="v6"||!t)&&M8.test(e))}class Pr extends vt{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==qe.string){const s=this._getOrReturnCtx(t);return Ve(s,{code:Ce.invalid_type,expected:qe.string,received:s.parsedType}),at}const r=new Bn;let o;for(const s of this._def.checks)if(s.kind==="min")t.data.length<s.value&&(o=this._getOrReturnCtx(t,o),Ve(o,{code:Ce.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="max")t.data.length>s.value&&(o=this._getOrReturnCtx(t,o),Ve(o,{code:Ce.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="length"){const a=t.data.length>s.value,i=t.data.length<s.value;(a||i)&&(o=this._getOrReturnCtx(t,o),a?Ve(o,{code:Ce.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):i&&Ve(o,{code:Ce.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),r.dirty())}else if(s.kind==="email")k8.test(t.data)||(o=this._getOrReturnCtx(t,o),Ve(o,{validation:"email",code:Ce.invalid_string,message:s.message}),r.dirty());else if(s.kind==="emoji")$f||($f=new RegExp(w8,"u")),$f.test(t.data)||(o=this._getOrReturnCtx(t,o),Ve(o,{validation:"emoji",code:Ce.invalid_string,message:s.message}),r.dirty());else if(s.kind==="uuid")b8.test(t.data)||(o=this._getOrReturnCtx(t,o),Ve(o,{validation:"uuid",code:Ce.invalid_string,message:s.message}),r.dirty());else if(s.kind==="nanoid")_8.test(t.data)||(o=this._getOrReturnCtx(t,o),Ve(o,{validation:"nanoid",code:Ce.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid")m8.test(t.data)||(o=this._getOrReturnCtx(t,o),Ve(o,{validation:"cuid",code:Ce.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid2")g8.test(t.data)||(o=this._getOrReturnCtx(t,o),Ve(o,{validation:"cuid2",code:Ce.invalid_string,message:s.message}),r.dirty());else if(s.kind==="ulid")v8.test(t.data)||(o=this._getOrReturnCtx(t,o),Ve(o,{validation:"ulid",code:Ce.invalid_string,message:s.message}),r.dirty());else if(s.kind==="url")try{new URL(t.data)}catch{o=this._getOrReturnCtx(t,o),Ve(o,{validation:"url",code:Ce.invalid_string,message:s.message}),r.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(t.data)||(o=this._getOrReturnCtx(t,o),Ve(o,{validation:"regex",code:Ce.invalid_string,message:s.message}),r.dirty())):s.kind==="trim"?t.data=t.data.trim():s.kind==="includes"?t.data.includes(s.value,s.position)||(o=this._getOrReturnCtx(t,o),Ve(o,{code:Ce.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),r.dirty()):s.kind==="toLowerCase"?t.data=t.data.toLowerCase():s.kind==="toUpperCase"?t.data=t.data.toUpperCase():s.kind==="startsWith"?t.data.startsWith(s.value)||(o=this._getOrReturnCtx(t,o),Ve(o,{code:Ce.invalid_string,validation:{startsWith:s.value},message:s.message}),r.dirty()):s.kind==="endsWith"?t.data.endsWith(s.value)||(o=this._getOrReturnCtx(t,o),Ve(o,{code:Ce.invalid_string,validation:{endsWith:s.value},message:s.message}),r.dirty()):s.kind==="datetime"?dy(s).test(t.data)||(o=this._getOrReturnCtx(t,o),Ve(o,{code:Ce.invalid_string,validation:"datetime",message:s.message}),r.dirty()):s.kind==="date"?A8.test(t.data)||(o=this._getOrReturnCtx(t,o),Ve(o,{code:Ce.invalid_string,validation:"date",message:s.message}),r.dirty()):s.kind==="time"?R8(s).test(t.data)||(o=this._getOrReturnCtx(t,o),Ve(o,{code:Ce.invalid_string,validation:"time",message:s.message}),r.dirty()):s.kind==="duration"?S8.test(t.data)||(o=this._getOrReturnCtx(t,o),Ve(o,{validation:"duration",code:Ce.invalid_string,message:s.message}),r.dirty()):s.kind==="ip"?O8(t.data,s.version)||(o=this._getOrReturnCtx(t,o),Ve(o,{validation:"ip",code:Ce.invalid_string,message:s.message}),r.dirty()):s.kind==="jwt"?P8(t.data,s.alg)||(o=this._getOrReturnCtx(t,o),Ve(o,{validation:"jwt",code:Ce.invalid_string,message:s.message}),r.dirty()):s.kind==="cidr"?B8(t.data,s.version)||(o=this._getOrReturnCtx(t,o),Ve(o,{validation:"cidr",code:Ce.invalid_string,message:s.message}),r.dirty()):s.kind==="base64"?E8.test(t.data)||(o=this._getOrReturnCtx(t,o),Ve(o,{validation:"base64",code:Ce.invalid_string,message:s.message}),r.dirty()):s.kind==="base64url"?I8.test(t.data)||(o=this._getOrReturnCtx(t,o),Ve(o,{validation:"base64url",code:Ce.invalid_string,message:s.message}),r.dirty()):Mt.assertNever(s);return{status:r.value,value:t.data}}_regex(t,n,r){return this.refinement(o=>t.test(o),{validation:n,code:Ce.invalid_string,...nt.errToObj(r)})}_addCheck(t){return new Pr({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...nt.errToObj(t)})}url(t){return this._addCheck({kind:"url",...nt.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...nt.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...nt.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...nt.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...nt.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...nt.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...nt.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...nt.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...nt.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...nt.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...nt.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...nt.errToObj(t)})}datetime(t){var n,r;return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(n=t==null?void 0:t.offset)!==null&&n!==void 0?n:!1,local:(r=t==null?void 0:t.local)!==null&&r!==void 0?r:!1,...nt.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...nt.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...nt.errToObj(t)})}regex(t,n){return this._addCheck({kind:"regex",regex:t,...nt.errToObj(n)})}includes(t,n){return this._addCheck({kind:"includes",value:t,position:n==null?void 0:n.position,...nt.errToObj(n==null?void 0:n.message)})}startsWith(t,n){return this._addCheck({kind:"startsWith",value:t,...nt.errToObj(n)})}endsWith(t,n){return this._addCheck({kind:"endsWith",value:t,...nt.errToObj(n)})}min(t,n){return this._addCheck({kind:"min",value:t,...nt.errToObj(n)})}max(t,n){return this._addCheck({kind:"max",value:t,...nt.errToObj(n)})}length(t,n){return this._addCheck({kind:"length",value:t,...nt.errToObj(n)})}nonempty(t){return this.min(1,nt.errToObj(t))}trim(){return new Pr({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Pr({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Pr({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxLength(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}Pr.create=e=>{var t;return new Pr({checks:[],typeName:st.ZodString,coerce:(t=e==null?void 0:e.coerce)!==null&&t!==void 0?t:!1,...mt(e)})};function D8(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,o=n>r?n:r,s=parseInt(e.toFixed(o).replace(".","")),a=parseInt(t.toFixed(o).replace(".",""));return s%a/Math.pow(10,o)}class Jo extends vt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==qe.number){const s=this._getOrReturnCtx(t);return Ve(s,{code:Ce.invalid_type,expected:qe.number,received:s.parsedType}),at}let r;const o=new Bn;for(const s of this._def.checks)s.kind==="int"?Mt.isInteger(t.data)||(r=this._getOrReturnCtx(t,r),Ve(r,{code:Ce.invalid_type,expected:"integer",received:"float",message:s.message}),o.dirty()):s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(r=this._getOrReturnCtx(t,r),Ve(r,{code:Ce.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),o.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(r=this._getOrReturnCtx(t,r),Ve(r,{code:Ce.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),o.dirty()):s.kind==="multipleOf"?D8(t.data,s.value)!==0&&(r=this._getOrReturnCtx(t,r),Ve(r,{code:Ce.not_multiple_of,multipleOf:s.value,message:s.message}),o.dirty()):s.kind==="finite"?Number.isFinite(t.data)||(r=this._getOrReturnCtx(t,r),Ve(r,{code:Ce.not_finite,message:s.message}),o.dirty()):Mt.assertNever(s);return{status:o.value,value:t.data}}gte(t,n){return this.setLimit("min",t,!0,nt.toString(n))}gt(t,n){return this.setLimit("min",t,!1,nt.toString(n))}lte(t,n){return this.setLimit("max",t,!0,nt.toString(n))}lt(t,n){return this.setLimit("max",t,!1,nt.toString(n))}setLimit(t,n,r,o){return new Jo({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:nt.toString(o)}]})}_addCheck(t){return new Jo({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:nt.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:nt.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:nt.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:nt.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:nt.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:nt.toString(n)})}finite(t){return this._addCheck({kind:"finite",message:nt.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:nt.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:nt.toString(t)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&Mt.isInteger(t.value))}get isFinite(){let t=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(t===null||r.value<t)&&(t=r.value)}return Number.isFinite(n)&&Number.isFinite(t)}}Jo.create=e=>new Jo({checks:[],typeName:st.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...mt(e)});class es extends vt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==qe.bigint)return this._getInvalidInput(t);let r;const o=new Bn;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(r=this._getOrReturnCtx(t,r),Ve(r,{code:Ce.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),o.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(r=this._getOrReturnCtx(t,r),Ve(r,{code:Ce.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),o.dirty()):s.kind==="multipleOf"?t.data%s.value!==BigInt(0)&&(r=this._getOrReturnCtx(t,r),Ve(r,{code:Ce.not_multiple_of,multipleOf:s.value,message:s.message}),o.dirty()):Mt.assertNever(s);return{status:o.value,value:t.data}}_getInvalidInput(t){const n=this._getOrReturnCtx(t);return Ve(n,{code:Ce.invalid_type,expected:qe.bigint,received:n.parsedType}),at}gte(t,n){return this.setLimit("min",t,!0,nt.toString(n))}gt(t,n){return this.setLimit("min",t,!1,nt.toString(n))}lte(t,n){return this.setLimit("max",t,!0,nt.toString(n))}lt(t,n){return this.setLimit("max",t,!1,nt.toString(n))}setLimit(t,n,r,o){return new es({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:nt.toString(o)}]})}_addCheck(t){return new es({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:nt.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:nt.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:nt.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:nt.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:nt.toString(n)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}es.create=e=>{var t;return new es({checks:[],typeName:st.ZodBigInt,coerce:(t=e==null?void 0:e.coerce)!==null&&t!==void 0?t:!1,...mt(e)})};class tc extends vt{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==qe.boolean){const r=this._getOrReturnCtx(t);return Ve(r,{code:Ce.invalid_type,expected:qe.boolean,received:r.parsedType}),at}return Vn(t.data)}}tc.create=e=>new tc({typeName:st.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...mt(e)});class Ws extends vt{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==qe.date){const s=this._getOrReturnCtx(t);return Ve(s,{code:Ce.invalid_type,expected:qe.date,received:s.parsedType}),at}if(isNaN(t.data.getTime())){const s=this._getOrReturnCtx(t);return Ve(s,{code:Ce.invalid_date}),at}const r=new Bn;let o;for(const s of this._def.checks)s.kind==="min"?t.data.getTime()<s.value&&(o=this._getOrReturnCtx(t,o),Ve(o,{code:Ce.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),r.dirty()):s.kind==="max"?t.data.getTime()>s.value&&(o=this._getOrReturnCtx(t,o),Ve(o,{code:Ce.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),r.dirty()):Mt.assertNever(s);return{status:r.value,value:new Date(t.data.getTime())}}_addCheck(t){return new Ws({...this._def,checks:[...this._def.checks,t]})}min(t,n){return this._addCheck({kind:"min",value:t.getTime(),message:nt.toString(n)})}max(t,n){return this._addCheck({kind:"max",value:t.getTime(),message:nt.toString(n)})}get minDate(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t!=null?new Date(t):null}}Ws.create=e=>new Ws({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:st.ZodDate,...mt(e)});class cu extends vt{_parse(t){if(this._getType(t)!==qe.symbol){const r=this._getOrReturnCtx(t);return Ve(r,{code:Ce.invalid_type,expected:qe.symbol,received:r.parsedType}),at}return Vn(t.data)}}cu.create=e=>new cu({typeName:st.ZodSymbol,...mt(e)});class nc extends vt{_parse(t){if(this._getType(t)!==qe.undefined){const r=this._getOrReturnCtx(t);return Ve(r,{code:Ce.invalid_type,expected:qe.undefined,received:r.parsedType}),at}return Vn(t.data)}}nc.create=e=>new nc({typeName:st.ZodUndefined,...mt(e)});class rc extends vt{_parse(t){if(this._getType(t)!==qe.null){const r=this._getOrReturnCtx(t);return Ve(r,{code:Ce.invalid_type,expected:qe.null,received:r.parsedType}),at}return Vn(t.data)}}rc.create=e=>new rc({typeName:st.ZodNull,...mt(e)});class Na extends vt{constructor(){super(...arguments),this._any=!0}_parse(t){return Vn(t.data)}}Na.create=e=>new Na({typeName:st.ZodAny,...mt(e)});class Es extends vt{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Vn(t.data)}}Es.create=e=>new Es({typeName:st.ZodUnknown,...mt(e)});class Co extends vt{_parse(t){const n=this._getOrReturnCtx(t);return Ve(n,{code:Ce.invalid_type,expected:qe.never,received:n.parsedType}),at}}Co.create=e=>new Co({typeName:st.ZodNever,...mt(e)});class lu extends vt{_parse(t){if(this._getType(t)!==qe.undefined){const r=this._getOrReturnCtx(t);return Ve(r,{code:Ce.invalid_type,expected:qe.void,received:r.parsedType}),at}return Vn(t.data)}}lu.create=e=>new lu({typeName:st.ZodVoid,...mt(e)});class Dr extends vt{_parse(t){const{ctx:n,status:r}=this._processInputParams(t),o=this._def;if(n.parsedType!==qe.array)return Ve(n,{code:Ce.invalid_type,expected:qe.array,received:n.parsedType}),at;if(o.exactLength!==null){const a=n.data.length>o.exactLength.value,i=n.data.length<o.exactLength.value;(a||i)&&(Ve(n,{code:a?Ce.too_big:Ce.too_small,minimum:i?o.exactLength.value:void 0,maximum:a?o.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:o.exactLength.message}),r.dirty())}if(o.minLength!==null&&n.data.length<o.minLength.value&&(Ve(n,{code:Ce.too_small,minimum:o.minLength.value,type:"array",inclusive:!0,exact:!1,message:o.minLength.message}),r.dirty()),o.maxLength!==null&&n.data.length>o.maxLength.value&&(Ve(n,{code:Ce.too_big,maximum:o.maxLength.value,type:"array",inclusive:!0,exact:!1,message:o.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((a,i)=>o.type._parseAsync(new no(n,a,n.path,i)))).then(a=>Bn.mergeArray(r,a));const s=[...n.data].map((a,i)=>o.type._parseSync(new no(n,a,n.path,i)));return Bn.mergeArray(r,s)}get element(){return this._def.type}min(t,n){return new Dr({...this._def,minLength:{value:t,message:nt.toString(n)}})}max(t,n){return new Dr({...this._def,maxLength:{value:t,message:nt.toString(n)}})}length(t,n){return new Dr({...this._def,exactLength:{value:t,message:nt.toString(n)}})}nonempty(t){return this.min(1,t)}}Dr.create=(e,t)=>new Dr({type:e,minLength:null,maxLength:null,exactLength:null,typeName:st.ZodArray,...mt(t)});function da(e){if(e instanceof Qt){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=Jr.create(da(r))}return new Qt({...e._def,shape:()=>t})}else return e instanceof Dr?new Dr({...e._def,type:da(e.element)}):e instanceof Jr?Jr.create(da(e.unwrap())):e instanceof ns?ns.create(da(e.unwrap())):e instanceof ro?ro.create(e.items.map(t=>da(t))):e}class Qt extends vt{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),n=Mt.objectKeys(t);return this._cached={shape:t,keys:n}}_parse(t){if(this._getType(t)!==qe.object){const l=this._getOrReturnCtx(t);return Ve(l,{code:Ce.invalid_type,expected:qe.object,received:l.parsedType}),at}const{status:r,ctx:o}=this._processInputParams(t),{shape:s,keys:a}=this._getCached(),i=[];if(!(this._def.catchall instanceof Co&&this._def.unknownKeys==="strip"))for(const l in o.data)a.includes(l)||i.push(l);const c=[];for(const l of a){const f=s[l],d=o.data[l];c.push({key:{status:"valid",value:l},value:f._parse(new no(o,d,o.path,l)),alwaysSet:l in o.data})}if(this._def.catchall instanceof Co){const l=this._def.unknownKeys;if(l==="passthrough")for(const f of i)c.push({key:{status:"valid",value:f},value:{status:"valid",value:o.data[f]}});else if(l==="strict")i.length>0&&(Ve(o,{code:Ce.unrecognized_keys,keys:i}),r.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const f of i){const d=o.data[f];c.push({key:{status:"valid",value:f},value:l._parse(new no(o,d,o.path,f)),alwaysSet:f in o.data})}}return o.common.async?Promise.resolve().then(async()=>{const l=[];for(const f of c){const d=await f.key,m=await f.value;l.push({key:d,value:m,alwaysSet:f.alwaysSet})}return l}).then(l=>Bn.mergeObjectSync(r,l)):Bn.mergeObjectSync(r,c)}get shape(){return this._def.shape()}strict(t){return nt.errToObj,new Qt({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(n,r)=>{var o,s,a,i;const c=(a=(s=(o=this._def).errorMap)===null||s===void 0?void 0:s.call(o,n,r).message)!==null&&a!==void 0?a:r.defaultError;return n.code==="unrecognized_keys"?{message:(i=nt.errToObj(t).message)!==null&&i!==void 0?i:c}:{message:c}}}:{}})}strip(){return new Qt({...this._def,unknownKeys:"strip"})}passthrough(){return new Qt({...this._def,unknownKeys:"passthrough"})}extend(t){return new Qt({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new Qt({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:st.ZodObject})}setKey(t,n){return this.augment({[t]:n})}catchall(t){return new Qt({...this._def,catchall:t})}pick(t){const n={};return Mt.objectKeys(t).forEach(r=>{t[r]&&this.shape[r]&&(n[r]=this.shape[r])}),new Qt({...this._def,shape:()=>n})}omit(t){const n={};return Mt.objectKeys(this.shape).forEach(r=>{t[r]||(n[r]=this.shape[r])}),new Qt({...this._def,shape:()=>n})}deepPartial(){return da(this)}partial(t){const n={};return Mt.objectKeys(this.shape).forEach(r=>{const o=this.shape[r];t&&!t[r]?n[r]=o:n[r]=o.optional()}),new Qt({...this._def,shape:()=>n})}required(t){const n={};return Mt.objectKeys(this.shape).forEach(r=>{if(t&&!t[r])n[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof Jr;)s=s._def.innerType;n[r]=s}}),new Qt({...this._def,shape:()=>n})}keyof(){return fy(Mt.objectKeys(this.shape))}}Qt.create=(e,t)=>new Qt({shape:()=>e,unknownKeys:"strip",catchall:Co.create(),typeName:st.ZodObject,...mt(t)});Qt.strictCreate=(e,t)=>new Qt({shape:()=>e,unknownKeys:"strict",catchall:Co.create(),typeName:st.ZodObject,...mt(t)});Qt.lazycreate=(e,t)=>new Qt({shape:e,unknownKeys:"strip",catchall:Co.create(),typeName:st.ZodObject,...mt(t)});class oc extends vt{_parse(t){const{ctx:n}=this._processInputParams(t),r=this._def.options;function o(s){for(const i of s)if(i.result.status==="valid")return i.result;for(const i of s)if(i.result.status==="dirty")return n.common.issues.push(...i.ctx.common.issues),i.result;const a=s.map(i=>new fr(i.ctx.common.issues));return Ve(n,{code:Ce.invalid_union,unionErrors:a}),at}if(n.common.async)return Promise.all(r.map(async s=>{const a={...n,common:{...n.common,issues:[]},parent:null};return{result:await s._parseAsync({data:n.data,path:n.path,parent:a}),ctx:a}})).then(o);{let s;const a=[];for(const c of r){const l={...n,common:{...n.common,issues:[]},parent:null},f=c._parseSync({data:n.data,path:n.path,parent:l});if(f.status==="valid")return f;f.status==="dirty"&&!s&&(s={result:f,ctx:l}),l.common.issues.length&&a.push(l.common.issues)}if(s)return n.common.issues.push(...s.ctx.common.issues),s.result;const i=a.map(c=>new fr(c));return Ve(n,{code:Ce.invalid_union,unionErrors:i}),at}}get options(){return this._def.options}}oc.create=(e,t)=>new oc({options:e,typeName:st.ZodUnion,...mt(t)});const co=e=>e instanceof ic?co(e.schema):e instanceof Lr?co(e.innerType()):e instanceof cc?[e.value]:e instanceof ts?e.options:e instanceof lc?Mt.objectValues(e.enum):e instanceof uc?co(e._def.innerType):e instanceof nc?[void 0]:e instanceof rc?[null]:e instanceof Jr?[void 0,...co(e.unwrap())]:e instanceof ns?[null,...co(e.unwrap())]:e instanceof om||e instanceof fc?co(e.unwrap()):e instanceof dc?co(e._def.innerType):[];class wd extends vt{_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==qe.object)return Ve(n,{code:Ce.invalid_type,expected:qe.object,received:n.parsedType}),at;const r=this.discriminator,o=n.data[r],s=this.optionsMap.get(o);return s?n.common.async?s._parseAsync({data:n.data,path:n.path,parent:n}):s._parseSync({data:n.data,path:n.path,parent:n}):(Ve(n,{code:Ce.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),at)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,n,r){const o=new Map;for(const s of n){const a=co(s.shape[t]);if(!a.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(const i of a){if(o.has(i))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(i)}`);o.set(i,s)}}return new wd({typeName:st.ZodDiscriminatedUnion,discriminator:t,options:n,optionsMap:o,...mt(r)})}}function op(e,t){const n=ho(e),r=ho(t);if(e===t)return{valid:!0,data:e};if(n===qe.object&&r===qe.object){const o=Mt.objectKeys(t),s=Mt.objectKeys(e).filter(i=>o.indexOf(i)!==-1),a={...e,...t};for(const i of s){const c=op(e[i],t[i]);if(!c.valid)return{valid:!1};a[i]=c.data}return{valid:!0,data:a}}else if(n===qe.array&&r===qe.array){if(e.length!==t.length)return{valid:!1};const o=[];for(let s=0;s<e.length;s++){const a=e[s],i=t[s],c=op(a,i);if(!c.valid)return{valid:!1};o.push(c.data)}return{valid:!0,data:o}}else return n===qe.date&&r===qe.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class sc extends vt{_parse(t){const{status:n,ctx:r}=this._processInputParams(t),o=(s,a)=>{if(np(s)||np(a))return at;const i=op(s.value,a.value);return i.valid?((rp(s)||rp(a))&&n.dirty(),{status:n.value,value:i.data}):(Ve(r,{code:Ce.invalid_intersection_types}),at)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([s,a])=>o(s,a)):o(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}sc.create=(e,t,n)=>new sc({left:e,right:t,typeName:st.ZodIntersection,...mt(n)});class ro extends vt{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==qe.array)return Ve(r,{code:Ce.invalid_type,expected:qe.array,received:r.parsedType}),at;if(r.data.length<this._def.items.length)return Ve(r,{code:Ce.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),at;!this._def.rest&&r.data.length>this._def.items.length&&(Ve(r,{code:Ce.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const s=[...r.data].map((a,i)=>{const c=this._def.items[i]||this._def.rest;return c?c._parse(new no(r,a,r.path,i)):null}).filter(a=>!!a);return r.common.async?Promise.all(s).then(a=>Bn.mergeArray(n,a)):Bn.mergeArray(n,s)}get items(){return this._def.items}rest(t){return new ro({...this._def,rest:t})}}ro.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ro({items:e,typeName:st.ZodTuple,rest:null,...mt(t)})};class ac extends vt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==qe.object)return Ve(r,{code:Ce.invalid_type,expected:qe.object,received:r.parsedType}),at;const o=[],s=this._def.keyType,a=this._def.valueType;for(const i in r.data)o.push({key:s._parse(new no(r,i,r.path,i)),value:a._parse(new no(r,r.data[i],r.path,i)),alwaysSet:i in r.data});return r.common.async?Bn.mergeObjectAsync(n,o):Bn.mergeObjectSync(n,o)}get element(){return this._def.valueType}static create(t,n,r){return n instanceof vt?new ac({keyType:t,valueType:n,typeName:st.ZodRecord,...mt(r)}):new ac({keyType:Pr.create(),valueType:t,typeName:st.ZodRecord,...mt(n)})}}class uu extends vt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==qe.map)return Ve(r,{code:Ce.invalid_type,expected:qe.map,received:r.parsedType}),at;const o=this._def.keyType,s=this._def.valueType,a=[...r.data.entries()].map(([i,c],l)=>({key:o._parse(new no(r,i,r.path,[l,"key"])),value:s._parse(new no(r,c,r.path,[l,"value"]))}));if(r.common.async){const i=new Map;return Promise.resolve().then(async()=>{for(const c of a){const l=await c.key,f=await c.value;if(l.status==="aborted"||f.status==="aborted")return at;(l.status==="dirty"||f.status==="dirty")&&n.dirty(),i.set(l.value,f.value)}return{status:n.value,value:i}})}else{const i=new Map;for(const c of a){const l=c.key,f=c.value;if(l.status==="aborted"||f.status==="aborted")return at;(l.status==="dirty"||f.status==="dirty")&&n.dirty(),i.set(l.value,f.value)}return{status:n.value,value:i}}}}uu.create=(e,t,n)=>new uu({valueType:t,keyType:e,typeName:st.ZodMap,...mt(n)});class $s extends vt{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==qe.set)return Ve(r,{code:Ce.invalid_type,expected:qe.set,received:r.parsedType}),at;const o=this._def;o.minSize!==null&&r.data.size<o.minSize.value&&(Ve(r,{code:Ce.too_small,minimum:o.minSize.value,type:"set",inclusive:!0,exact:!1,message:o.minSize.message}),n.dirty()),o.maxSize!==null&&r.data.size>o.maxSize.value&&(Ve(r,{code:Ce.too_big,maximum:o.maxSize.value,type:"set",inclusive:!0,exact:!1,message:o.maxSize.message}),n.dirty());const s=this._def.valueType;function a(c){const l=new Set;for(const f of c){if(f.status==="aborted")return at;f.status==="dirty"&&n.dirty(),l.add(f.value)}return{status:n.value,value:l}}const i=[...r.data.values()].map((c,l)=>s._parse(new no(r,c,r.path,l)));return r.common.async?Promise.all(i).then(c=>a(c)):a(i)}min(t,n){return new $s({...this._def,minSize:{value:t,message:nt.toString(n)}})}max(t,n){return new $s({...this._def,maxSize:{value:t,message:nt.toString(n)}})}size(t,n){return this.min(t,n).max(t,n)}nonempty(t){return this.min(1,t)}}$s.create=(e,t)=>new $s({valueType:e,minSize:null,maxSize:null,typeName:st.ZodSet,...mt(t)});class Sa extends vt{constructor(){super(...arguments),this.validate=this.implement}_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==qe.function)return Ve(n,{code:Ce.invalid_type,expected:qe.function,received:n.parsedType}),at;function r(i,c){return au({data:i,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,su(),Da].filter(l=>!!l),issueData:{code:Ce.invalid_arguments,argumentsError:c}})}function o(i,c){return au({data:i,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,su(),Da].filter(l=>!!l),issueData:{code:Ce.invalid_return_type,returnTypeError:c}})}const s={errorMap:n.common.contextualErrorMap},a=n.data;if(this._def.returns instanceof La){const i=this;return Vn(async function(...c){const l=new fr([]),f=await i._def.args.parseAsync(c,s).catch(v=>{throw l.addIssue(r(c,v)),l}),d=await Reflect.apply(a,this,f);return await i._def.returns._def.type.parseAsync(d,s).catch(v=>{throw l.addIssue(o(d,v)),l})})}else{const i=this;return Vn(function(...c){const l=i._def.args.safeParse(c,s);if(!l.success)throw new fr([r(c,l.error)]);const f=Reflect.apply(a,this,l.data),d=i._def.returns.safeParse(f,s);if(!d.success)throw new fr([o(f,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new Sa({...this._def,args:ro.create(t).rest(Es.create())})}returns(t){return new Sa({...this._def,returns:t})}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(t,n,r){return new Sa({args:t||ro.create([]).rest(Es.create()),returns:n||Es.create(),typeName:st.ZodFunction,...mt(r)})}}class ic extends vt{get schema(){return this._def.getter()}_parse(t){const{ctx:n}=this._processInputParams(t);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}ic.create=(e,t)=>new ic({getter:e,typeName:st.ZodLazy,...mt(t)});class cc extends vt{_parse(t){if(t.data!==this._def.value){const n=this._getOrReturnCtx(t);return Ve(n,{received:n.data,code:Ce.invalid_literal,expected:this._def.value}),at}return{status:"valid",value:t.data}}get value(){return this._def.value}}cc.create=(e,t)=>new cc({value:e,typeName:st.ZodLiteral,...mt(t)});function fy(e,t){return new ts({values:e,typeName:st.ZodEnum,...mt(t)})}class ts extends vt{constructor(){super(...arguments),$i.set(this,void 0)}_parse(t){if(typeof t.data!="string"){const n=this._getOrReturnCtx(t),r=this._def.values;return Ve(n,{expected:Mt.joinValues(r),received:n.parsedType,code:Ce.invalid_type}),at}if(iu(this,$i)||cy(this,$i,new Set(this._def.values)),!iu(this,$i).has(t.data)){const n=this._getOrReturnCtx(t),r=this._def.values;return Ve(n,{received:n.data,code:Ce.invalid_enum_value,options:r}),at}return Vn(t.data)}get options(){return this._def.values}get enum(){const t={};for(const n of this._def.values)t[n]=n;return t}get Values(){const t={};for(const n of this._def.values)t[n]=n;return t}get Enum(){const t={};for(const n of this._def.values)t[n]=n;return t}extract(t,n=this._def){return ts.create(t,{...this._def,...n})}exclude(t,n=this._def){return ts.create(this.options.filter(r=>!t.includes(r)),{...this._def,...n})}}$i=new WeakMap;ts.create=fy;class lc extends vt{constructor(){super(...arguments),Vi.set(this,void 0)}_parse(t){const n=Mt.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(t);if(r.parsedType!==qe.string&&r.parsedType!==qe.number){const o=Mt.objectValues(n);return Ve(r,{expected:Mt.joinValues(o),received:r.parsedType,code:Ce.invalid_type}),at}if(iu(this,Vi)||cy(this,Vi,new Set(Mt.getValidEnumValues(this._def.values))),!iu(this,Vi).has(t.data)){const o=Mt.objectValues(n);return Ve(r,{received:r.data,code:Ce.invalid_enum_value,options:o}),at}return Vn(t.data)}get enum(){return this._def.values}}Vi=new WeakMap;lc.create=(e,t)=>new lc({values:e,typeName:st.ZodNativeEnum,...mt(t)});class La extends vt{unwrap(){return this._def.type}_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==qe.promise&&n.common.async===!1)return Ve(n,{code:Ce.invalid_type,expected:qe.promise,received:n.parsedType}),at;const r=n.parsedType===qe.promise?n.data:Promise.resolve(n.data);return Vn(r.then(o=>this._def.type.parseAsync(o,{path:n.path,errorMap:n.common.contextualErrorMap})))}}La.create=(e,t)=>new La({type:e,typeName:st.ZodPromise,...mt(t)});class Lr extends vt{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===st.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:n,ctx:r}=this._processInputParams(t),o=this._def.effect||null,s={addIssue:a=>{Ve(r,a),a.fatal?n.abort():n.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),o.type==="preprocess"){const a=o.transform(r.data,s);if(r.common.async)return Promise.resolve(a).then(async i=>{if(n.value==="aborted")return at;const c=await this._def.schema._parseAsync({data:i,path:r.path,parent:r});return c.status==="aborted"?at:c.status==="dirty"||n.value==="dirty"?ma(c.value):c});{if(n.value==="aborted")return at;const i=this._def.schema._parseSync({data:a,path:r.path,parent:r});return i.status==="aborted"?at:i.status==="dirty"||n.value==="dirty"?ma(i.value):i}}if(o.type==="refinement"){const a=i=>{const c=o.refinement(i,s);if(r.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return i};if(r.common.async===!1){const i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?at:(i.status==="dirty"&&n.dirty(),a(i.value),{status:n.value,value:i.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(i=>i.status==="aborted"?at:(i.status==="dirty"&&n.dirty(),a(i.value).then(()=>({status:n.value,value:i.value}))))}if(o.type==="transform")if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Fs(a))return a;const i=o.transform(a.value,s);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:i}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>Fs(a)?Promise.resolve(o.transform(a.value,s)).then(i=>({status:n.value,value:i})):a);Mt.assertNever(o)}}Lr.create=(e,t,n)=>new Lr({schema:e,typeName:st.ZodEffects,effect:t,...mt(n)});Lr.createWithPreprocess=(e,t,n)=>new Lr({schema:t,effect:{type:"preprocess",transform:e},typeName:st.ZodEffects,...mt(n)});class Jr extends vt{_parse(t){return this._getType(t)===qe.undefined?Vn(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Jr.create=(e,t)=>new Jr({innerType:e,typeName:st.ZodOptional,...mt(t)});class ns extends vt{_parse(t){return this._getType(t)===qe.null?Vn(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}ns.create=(e,t)=>new ns({innerType:e,typeName:st.ZodNullable,...mt(t)});class uc extends vt{_parse(t){const{ctx:n}=this._processInputParams(t);let r=n.data;return n.parsedType===qe.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}uc.create=(e,t)=>new uc({innerType:e,typeName:st.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...mt(t)});class dc extends vt{_parse(t){const{ctx:n}=this._processInputParams(t),r={...n,common:{...n.common,issues:[]}},o=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return ec(o)?o.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new fr(r.common.issues)},input:r.data})})):{status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new fr(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}dc.create=(e,t)=>new dc({innerType:e,typeName:st.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...mt(t)});class du extends vt{_parse(t){if(this._getType(t)!==qe.nan){const r=this._getOrReturnCtx(t);return Ve(r,{code:Ce.invalid_type,expected:qe.nan,received:r.parsedType}),at}return{status:"valid",value:t.data}}}du.create=e=>new du({typeName:st.ZodNaN,...mt(e)});const N8=Symbol("zod_brand");class om extends vt{_parse(t){const{ctx:n}=this._processInputParams(t),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}}class Vc extends vt{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?at:s.status==="dirty"?(n.dirty(),ma(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{const o=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?at:o.status==="dirty"?(n.dirty(),{status:"dirty",value:o.value}):this._def.out._parseSync({data:o.value,path:r.path,parent:r})}}static create(t,n){return new Vc({in:t,out:n,typeName:st.ZodPipeline})}}class fc extends vt{_parse(t){const n=this._def.innerType._parse(t),r=o=>(Fs(o)&&(o.value=Object.freeze(o.value)),o);return ec(n)?n.then(o=>r(o)):r(n)}unwrap(){return this._def.innerType}}fc.create=(e,t)=>new fc({innerType:e,typeName:st.ZodReadonly,...mt(t)});function f0(e,t){const n=typeof e=="function"?e(t):typeof e=="string"?{message:e}:e;return typeof n=="string"?{message:n}:n}function hy(e,t={},n){return e?Na.create().superRefine((r,o)=>{var s,a;const i=e(r);if(i instanceof Promise)return i.then(c=>{var l,f;if(!c){const d=f0(t,r),m=(f=(l=d.fatal)!==null&&l!==void 0?l:n)!==null&&f!==void 0?f:!0;o.addIssue({code:"custom",...d,fatal:m})}});if(!i){const c=f0(t,r),l=(a=(s=c.fatal)!==null&&s!==void 0?s:n)!==null&&a!==void 0?a:!0;o.addIssue({code:"custom",...c,fatal:l})}}):Na.create()}const L8={object:Qt.lazycreate};var st;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(st||(st={}));const z8=(e,t={message:`Input not instance of ${e.name}`})=>hy(n=>n instanceof e,t),py=Pr.create,my=Jo.create,F8=du.create,W8=es.create,gy=tc.create,$8=Ws.create,V8=cu.create,j8=nc.create,H8=rc.create,U8=Na.create,G8=Es.create,X8=Co.create,K8=lu.create,Y8=Dr.create,q8=Qt.create,Z8=Qt.strictCreate,Q8=oc.create,J8=wd.create,e9=sc.create,t9=ro.create,n9=ac.create,r9=uu.create,o9=$s.create,s9=Sa.create,a9=ic.create,i9=cc.create,c9=ts.create,l9=lc.create,u9=La.create,h0=Lr.create,d9=Jr.create,f9=ns.create,h9=Lr.createWithPreprocess,p9=Vc.create,m9=()=>py().optional(),g9=()=>my().optional(),v9=()=>gy().optional(),b9={string:e=>Pr.create({...e,coerce:!0}),number:e=>Jo.create({...e,coerce:!0}),boolean:e=>tc.create({...e,coerce:!0}),bigint:e=>es.create({...e,coerce:!0}),date:e=>Ws.create({...e,coerce:!0})},_9=at;var un=Object.freeze({__proto__:null,defaultErrorMap:Da,setErrorMap:h8,getErrorMap:su,makeIssue:au,EMPTY_PATH:p8,addIssueToContext:Ve,ParseStatus:Bn,INVALID:at,DIRTY:ma,OK:Vn,isAborted:np,isDirty:rp,isValid:Fs,isAsync:ec,get util(){return Mt},get objectUtil(){return tp},ZodParsedType:qe,getParsedType:ho,ZodType:vt,datetimeRegex:dy,ZodString:Pr,ZodNumber:Jo,ZodBigInt:es,ZodBoolean:tc,ZodDate:Ws,ZodSymbol:cu,ZodUndefined:nc,ZodNull:rc,ZodAny:Na,ZodUnknown:Es,ZodNever:Co,ZodVoid:lu,ZodArray:Dr,ZodObject:Qt,ZodUnion:oc,ZodDiscriminatedUnion:wd,ZodIntersection:sc,ZodTuple:ro,ZodRecord:ac,ZodMap:uu,ZodSet:$s,ZodFunction:Sa,ZodLazy:ic,ZodLiteral:cc,ZodEnum:ts,ZodNativeEnum:lc,ZodPromise:La,ZodEffects:Lr,ZodTransformer:Lr,ZodOptional:Jr,ZodNullable:ns,ZodDefault:uc,ZodCatch:dc,ZodNaN:du,BRAND:N8,ZodBranded:om,ZodPipeline:Vc,ZodReadonly:fc,custom:hy,Schema:vt,ZodSchema:vt,late:L8,get ZodFirstPartyTypeKind(){return st},coerce:b9,any:U8,array:Y8,bigint:W8,boolean:gy,date:$8,discriminatedUnion:J8,effect:h0,enum:c9,function:s9,instanceof:z8,intersection:e9,lazy:a9,literal:i9,map:r9,nan:F8,nativeEnum:l9,never:X8,null:H8,nullable:f9,number:my,object:q8,oboolean:v9,onumber:g9,optional:d9,ostring:m9,pipeline:p9,preprocess:h9,promise:u9,record:n9,set:o9,strictObject:Z8,string:py,symbol:V8,transformer:h0,tuple:t9,undefined:j8,union:Q8,unknown:G8,void:K8,NEVER:_9,ZodIssueCode:Ce,quotelessJson:f8,ZodError:fr});const vy=un.object({type:un.literal("piano_notes"),notes:un.array(un.any())}),y9=un.object({type:un.literal("arrange_notes"),notes:un.record(un.union([un.number(),un.string()]).describe("trackIndex"),un.array(un.any().describe("TrackEvent"))),selectedTrackIndex:un.number()}),by=un.object({type:un.literal("control_events"),events:un.array(un.any().describe("TrackEvent"))}),S9=un.object({type:un.literal("tempo_events"),events:un.array(un.any().describe("TrackEventOf<SetTempoEvent>"))});var Ft;(e=>{function t(i,c){return[i,i+c]}e.fromLength=t;function n(i,c){return[i,c]}e.create=n;function r(i){return[i,i]}e.point=r;function o(i,c){const[l,f]=i;return l<=c&&c<f}e.contains=o;function s(i,c){const[l,f]=i,[d,m]=c;return l<m&&d<f}e.intersects=s;function a(i,c){const[l,f]=i;return Math.min(Math.max(l,c),f)}e.clamp=a})(Ft||(Ft={}));var za;(e=>{function t(o,s,a,i){const c=(0,e.fromPoint)(o,a),l=(0,e.fromPoint)(s,a);return(0,e.clamp)((0,e.union)(c,l),i)}e.fromPoints=t,e.fromPoint=(o,{quantizeFloor:s,quantizeCeil:a})=>{const i=s(o.tick),c=a(o.tick);return{fromTick:i,toTick:c,fromTrackIndex:Math.floor(o.trackIndex),toTrackIndex:Math.floor(o.trackIndex)+1}},e.union=(o,s)=>({fromTick:Math.min(o.fromTick,s.fromTick),toTick:Math.max(o.toTick,s.toTick),fromTrackIndex:Math.min(o.fromTrackIndex,s.fromTrackIndex),toTrackIndex:Math.max(o.toTrackIndex,s.toTrackIndex)}),e.clamp=(o,s)=>({fromTick:Math.max(0,o.fromTick),toTick:Math.max(0,o.toTick),fromTrackIndex:Math.min(s,Math.max(0,o.fromTrackIndex)),toTrackIndex:Math.min(s,Math.max(0,o.toTrackIndex))}),e.moved=(o,s)=>({fromTick:o.fromTick+s.tick,toTick:o.toTick+s.tick,fromTrackIndex:o.fromTrackIndex+s.trackIndex,toTrackIndex:o.toTrackIndex+s.trackIndex});function n(o){return{tick:o.fromTick,trackIndex:o.fromTrackIndex}}e.start=n;function r(o){return{tick:o.toTick,trackIndex:o.toTrackIndex}}e.end=r})(za||(za={}));function _y(e){return{deltaTime:e,type:"meta",subtype:"endOfTrack"}}function sm(e,t){return{deltaTime:e,type:"meta",subtype:"trackName",text:t}}function fu(e,t){return{deltaTime:e,type:"meta",subtype:"setTempo",microsecondsPerBeat:t}}function yy(e,t=4,n=4,r=24,o=8){return{deltaTime:e,type:"meta",subtype:"timeSignature",numerator:t,denominator:n,metronome:r,thirtyseconds:o}}function am(e,t,n,r){return{deltaTime:e,type:"channel",subtype:"noteOn",channel:t,noteNumber:n,velocity:r}}function Sy(e,t,n,r=0){return{deltaTime:e,type:"channel",subtype:"noteOff",channel:t,noteNumber:n,velocity:r}}function ky(e,t,n){return{deltaTime:e,type:"channel",subtype:"pitchBend",channel:t,value:n}}function xd(e,t,n){return{deltaTime:e,type:"channel",subtype:"programChange",channel:t,value:n}}function Qr(e,t,n,r){return{deltaTime:e,type:"channel",subtype:"controller",channel:t,controllerType:n,value:r}}function k9(e,t,n){return Qr(e,t,1,n)}function wy(e,t,n){return Qr(e,t,7,n)}function xy(e,t,n){return Qr(e,t,10,n)}function w9(e,t,n){return Qr(e,t,11,n)}function x9(e,t){return Qr(e,t,121,0)}function im(e,t,n,r,o,s){const a=[Qr(e,t,101,n),Qr(0,t,100,r)],i=[];return o!==void 0&&i.push(Qr(0,t,6,o)),s!==void 0&&i.push(Qr(0,t,38,s)),[...a,...i]}function C9(e,t,n=2){return im(e,t,0,0,n)}function T9(e,t,n=0){const r=n+8192,o=Math.floor(r/128),s=r-o*128;return im(e,t,0,1,o,s)}function M9(e,t,n=0){return im(e,t,0,2,n+64)}function Cy(e){const t=[];function n(o){const s=t.findIndex(i=>i.noteNumber===o.noteNumber);if(s<0)return null;const a=t[s];return t.splice(s,1),a}const r=[];return e.forEach(o=>{if("subtype"in o)switch(o.subtype){case"noteOn":t.push(o);break;case"noteOff":{const s=n(o);if(s!=null){const a={...s,subtype:"note",id:-1,tick:s.tick,duration:o.tick-s.tick};r.push(a)}break}default:r.push(o);break}else r.push(o)}),r}function Ty(e){if("subtype"in e&&e.subtype==="note"){const t=e.channel??-1,n=am(0,t,e.noteNumber,e.velocity),r=Sy(0,t,e.noteNumber);return[{...n,tick:e.tick},{...r,tick:e.tick+e.duration}]}else return[e]}const My=(e,t,n)=>e.filter(r=>r.isRecording!==!0).flatMap(r=>Ty(r)).map(r=>({...r,channel:t,trackId:n})),E9=e=>e.flatMap(t=>My(t.events,t.channel,t.id));var I9={j:function(t){try{return JSON.stringify(t)}catch(n){return"[UnexpectedJSONParseError]: ".concat(n.message)}},l:function(t){return t.toString()}};function Wt(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!e){var o=[],s=0,a=t.replace(/%([a-zA-Z%])/g,function(i,c){if(i==="%%")return i;var l=I9[c];if(typeof l=="function"){var f=n[s++];return o.push(f),l(f)}return i});throw console&&o.length>0&&console.log.apply(console,o),new Error("[serializr] "+(a||"Illegal State"))}}function Ey(e){if(e)throw new Error(e)}function A9(e){var t=!1;return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];if(!t)return t=!0,e.apply(void 0,n);Wt(!1,"callback was invoked twice")}}function Iy(e,t,n){if(e.length===0)return void n(null,[]);var r=e.filter(function(a){return!0}).length,o=[],s=!1;e.forEach(function(a,i){t(a,function(c,l){c?s||(s=!0,n(c)):(o[i]=l,--r===0&&n(null,o))},i)})}function hu(e){return e===null?!0:typeof e!="object"&&typeof e!="function"}function Fa(e){return e&&e.factory&&e.props}function Ay(e){return e&&e.serializer&&e.deserializer}function R9(e){return typeof e=="object"&&typeof e.jsonname=="string"}function p0(e,t){for(var n=e;n;){if(n===t)return!0;n=n.extends}return!1}function m0(e){return e&&typeof e.keys=="function"&&typeof e.clear=="function"&&typeof e.forEach=="function"&&typeof e.set=="function"}function jc(e,t){return e}function Is(e){if(e){if(Fa(e))return e;if(Fa(e.serializeInfo))return e.serializeInfo;if(e.constructor&&e.constructor.serializeInfo)return e.constructor.serializeInfo}}function O9(e,t){return Wt(Fa(t),"expected modelSchema, got ".concat(t)),e.serializeInfo=t,t}function Cd(e,t,n){Wt(e!==Object,"one cannot simply put define a model schema for Object"),Wt(typeof e=="function","expected constructor function");var r={targetClass:e,factory:function(){return new e},props:t};if(e.prototype.constructor!==Object){var o=Is(e.prototype.constructor);o&&o.targetClass!==e&&(r.extends=o)}return O9(e,r),r}function Or(e){var t={serializer:function(n){return Wt(hu(n),"this value is not primitive: ".concat(n)),n},deserializer:function(n,r){return hu(n)?void r(null,n):void r("[serializr] this value is not primitive: ".concat(n))}};return t=jc(t),t}var Wa=typeof Symbol<"u"?Symbol("SKIP"):{SKIP:!0},Td=Or();function pu(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Wt(e.length===1||e.length===2,"serialize expects one or 2 arguments");var n,r;return e.length===1?(n=void 0,r=e[0]):(n=e[0],r=e[1]),Array.isArray(r)?r.map(function(o){return n?pu(n,o):pu(o)}):(n?typeof n!="object"&&(n=Is(n)):n=Is(r),n||Wt(n,"Failed to find default schema for ".concat(r)),Ry(n,r))}function Ry(e,t){var n;Wt(e&&typeof e=="object"&&e.props,"Expected schema"),Wt(t&&typeof t=="object","Expected object");var r;return e.extends?r=Ry(e.extends,t):r={},Object.keys(e.props).forEach(function(o){var s=e.props[o];if(s){if(o==="*"){P9(e,s,t,r);return}s===!0&&(s=Td);var a=s.serializer(t[o],o,t);a!==Wa&&(r[s.jsonname||o]=a)}}),!((n=e.discriminator)===null||n===void 0)&&n.storeDiscriminator&&e.discriminator.storeDiscriminator(r),r}function P9(e,t,n,r){for(var o=0,s=Object.keys(n);o<s.length;o++){var a=s[o];if(!(a in e.props)&&(t===!0||t&&(!t.pattern||t.pattern.test(a)))){var i=n[a];if(t===!0)hu(i)&&(r[a]=i);else{var c=t.serializer(i,a,n);if(c===Wa)return;r[a]=c}}}}var B9=function(){function e(t,n,r,o,s){this.parentContext=t,this.modelSchema=n,this.json=r,this.onReadyCb=o,this.isRoot=!t,this.pendingCallbacks=0,this.pendingRefsCount=0,this.target=void 0,this.hasError=!1,t?(this.rootContext=t.rootContext,this.args=t.args):(this.rootContext=this,this.args=s,this.pendingRefs={},this.resolvedRefs={})}return e.prototype.createCallback=function(t){var n=this;return this.pendingCallbacks++,A9(function(r,o){r?n.hasError||(n.hasError=!0,n.onReadyCb(r),e.rootContextCache.delete(n)):n.hasError||(t(o),--n.pendingCallbacks===n.pendingRefsCount&&(n.pendingRefsCount>0?(n.onReadyCb(new Error('Unresolvable references in json: "'.concat(Object.keys(n.pendingRefs).filter(function(s){return n.pendingRefs[s].length>0}).join('", "'),'"'))),e.rootContextCache.delete(n)):(n.onReadyCb(null,n.target),e.rootContextCache.delete(n))))})},e.prototype.await=function(t,n,r){if(Wt(this.isRoot,"await can only be called on the root context"),n in this.resolvedRefs){var o=this.resolvedRefs[n].filter(function(s){return p0(s.modelSchema,t)})[0];if(o)return void r(null,o.value)}this.pendingRefsCount++,this.pendingRefs[n]||(this.pendingRefs[n]=[]),this.pendingRefs[n].push({modelSchema:t,uuid:n,callback:r})},e.prototype.resolve=function(t,n,r){if(Wt(this.isRoot,"resolve can only called on the root context"),this.resolvedRefs[n]||(this.resolvedRefs[n]=[]),this.resolvedRefs[n].push({modelSchema:t,value:r}),n in this.pendingRefs)for(var o=this.pendingRefs[n].length-1;o>=0;o--){var s=this.pendingRefs[n][o];p0(t,s.modelSchema)&&(this.pendingRefs[n].splice(o,1),this.pendingRefsCount--,s.callback(null,r))}},e.prototype.setTarget=function(t){this.isRoot&&this.target&&e.rootContextCache.delete(this.target),this.target=t,e.rootContextCache.set(this.target,this)},e.prototype.cancelAwaits=function(){var t=this;Wt(this.isRoot,"cancelAwaits can only be called on the root context"),Object.keys(this.pendingRefs).forEach(function(n){t.pendingRefs[n].forEach(function(r){t.pendingRefsCount--,r.callback(new Error("Reference resolution canceled for "+n))})}),this.pendingRefs={},this.pendingRefsCount=0},e.getTargetContext=function(t){return e.rootContextCache.get(t)},e.rootContextCache=new WeakMap,e}();function D9(e,t){for(var n in e.props){var r=e.props[n];if(typeof r=="object"&&r.jsonname===t)return!0}return!1}function N9(e,t,n,r,o){var s=function(i){if(!(i in t.props)&&!D9(t,i)){var c=o[i];n===!0?(Wt(hu(c),"encountered non primitive value while deserializing '*' properties in property '".concat(i,"': ").concat(c)),r[i]=c):n&&(!n.pattern||n.pattern.test(i))&&n.deserializer(c,e.rootContext.createCallback(function(l){return l!==Wa&&(r[i]=l)}),e)}};for(var a in o)s(a)}function Oy(e,t){var n;if(!((n=t.subSchemas)===null||n===void 0)&&n.length)for(var r=0,o=t.subSchemas;r<o.length;r++){var s=o[r];if(s.discriminator){if(s.discriminator.isActualType(e))return s;var a=Oy(e,s);if(a!==s)return a}}return t}function L9(e,t,n,r){n===void 0&&(n=Ey),Wt(arguments.length>=2,"deserialize expects at least 2 arguments");var o=Is(e);if(Wt(Fa(o),"first argument should be model schema"),Array.isArray(t)){var s=[];return Iy(t,function(a,i){var c=sp(void 0,o,a,i,r);s.push(c)},n),s}else return sp(void 0,o,t,n,r)}function sp(e,t,n,r,o){if(n==null||typeof n!="object")return void r(null,null);var s=Oy(n,t),a=new B9(e,s,n,r,o),i=s.factory(a);Wt(!!i,"No object returned from factory"),a.setTarget(i);var c=a.createCallback(Ey);return Dy(a,s,n,i),c(),i}var Py=function(e,t,n,r,o,s){s&&typeof s.beforeDeserialize=="function"?s.beforeDeserialize(e,t,n,r,o,s):e(null,t)},By=function(e,t,n,r,o,s,a,i){i&&typeof i.afterDeserialize=="function"?i.afterDeserialize(e,t,n,r,o,s,a,i):e(t,n)};function Dy(e,t,n,r){var o;t.extends&&Dy(e,t.extends,n,r);function s(d,m,v){var _=e.rootContext.createCallback(function(y){return y!==Wa&&(r[v]=y)});d.deserializer(m,function(y,k){return By(_,y,k,m,n,v,e,d)},e,r[v])}for(var a=function(d){var m=t.props[d];if(!m)return{value:void 0};if(d==="*")return N9(e,t,m,r,n),{value:void 0};m===!0&&(m=Td);var v=(o=m.jsonname)!==null&&o!==void 0?o:d;Wt(typeof v!="symbol","You must alias symbol properties. prop = %l",d);var _=n[v],y=m,k=function(g,b){!g&&b!==void 0&&s(y,b,d)};Py(k,_,n,v,e,m)},i=0,c=Object.keys(t.props);i<c.length;i++){var l=c[i],f=a(l);if(typeof f=="object")return f.value}}function Ny(e,t){Wt(typeof e=="object"||typeof e=="function","No modelschema provided. If you are importing it from another file be aware of circular dependencies.");var n={serializer:function(r){var o=Is(r)||Is(e);return Wt(Fa(o),"expected modelSchema, got ".concat(o)),r==null?r:pu(o,r)},deserializer:function(r,o,s){return e=Is(e),Wt(Fa(e),"expected modelSchema, got ".concat(e)),r==null?void o(null,r):void sp(s,e,r,o,void 0)}};return jc(n)}function z9(e,t,n){Wt(typeof e=="function","first argument should be function"),Wt(typeof t=="function","second argument should be a function or promise");var r={serializer:e,deserializer:function(o,s,a,i){var c=t(o,a,i,s);t.length!==4&&s(null,c)}};return r=jc(r),r}function cm(e,t){e=e||Td,Wt(Ay(e),"expected prop schema as first argument"),Wt(!R9(e),"provided prop is aliased, please put aliases first");var n={serializer:function(r){return r===void 0?Wa:r===null?null:(Wt(r&&"length"in r&&"map"in r,"expected array (like) object"),r.map(e.serializer))},deserializer:function(r,o,s){if(r===null)return void o(null,r);if(!Array.isArray(r))return void o("[serializr] expected JSON array");function a(i,c,l){function f(m,v){m?c(m):e.deserializer(v,d,s)}function d(m,v){typeof e.afterDeserialize=="function"?By(c,m,v,i,r,l,s,e):c(m,v)}Py(f,i,r,l,s,e)}Iy(r,a,function(i,c){if(i)return void o(i);o(void 0,c.filter(function(l){return Wa!==l}))})}};return n=jc(n),n}function F9(e,t,n){e=e||Td,Wt(Ay(e),"expected prop schema as first argument"),Wt(!0,"expected key property name as second argument");var r={serializer:function(o){Wt(o&&typeof o=="object","expected object or Map");var s=[];if(m0(o))o.forEach(function(i,c){return s.push(e.serializer(i,c,o))});else for(var a in o)s.push(e.serializer(o[a],a,o));return s},deserializer:function(o,s,a,i){cm(e).deserializer(o,function(c,l){if(c)return void s(c);var f=m0(i),d;f?(i.clear(),d=i):d={};for(var m=0,v=o.length;m<v;m++)f?d.set(l[m][t],l[m]):d[l[m][t].toString()]=l[m];s(null,d)},a,void 0)}};return r=jc(r),r}const en=e=>"subtype"in e&&e.subtype==="note",W9=e=>"subtype"in e&&e.subtype==="trackName",Ly=e=>"subtype"in e&&e.subtype==="programChange",lm=e=>"subtype"in e&&e.subtype==="pitchBend",li=e=>"subtype"in e&&e.subtype==="setTempo",um=e=>"subtype"in e&&e.subtype==="timeSignature",zy=e=>"subtype"in e&&e.subtype==="controller",ui=e=>t=>zy(t)&&t.controllerType===e,$9=ui(7),V9=ui(10),j9=e=>"subtype"in e&&e.subtype==="sequencerSpecific";function Fy(e){return e!==null}function lr(e){return e!==void 0}const H9=(e,t,n)=>{const r=[];for(let o=e;o<=t;o+=n)r.push(o);return r},Br=e=>Qe.maxBy(e,t=>t.tick),mo=e=>t=>t.tick<=e,U9=(e,t)=>{var n;return(n=Br(e.filter($9).filter(mo(t))))==null?void 0:n.value},G9=(e,t)=>{var n;return(n=Br(e.filter(V9).filter(mo(t))))==null?void 0:n.value},Wy=e=>Br(e.filter(W9)),$y=(e,t)=>Br(e.filter(li).filter(mo(t))),X9=(e,t)=>Br(e.filter(um).filter(mo(t))),Vy=e=>Br(e.filter(Ly)),K9=(e,t)=>{const n=$y(e,t);if(n!==void 0)return 6e7/n.microsecondsPerBeat},Y9=(e,t)=>{const n=e.filter(zy).filter(mo(t)),r=T4(n.map(i=>i.controllerType)).map(i=>Br(n.filter(ui(i)))).filter(lr),o=Br(e.filter(li).filter(mo(t))),s=Br(e.filter(Ly).filter(mo(t))),a=Br(e.filter(lm).filter(mo(t)));return[...r,o,s,a].filter(lr)},jy="Sign".split("").map(e=>e.charCodeAt(0)),Hy=e=>"subtype"in e&&e.subtype==="signal",q9=e=>Hy(e)&&e.signalEventType==="trackColor",Z9=e=>{if(e.data.length<=5||!Qe.isEqual(e.data.slice(0,4),jy))return e;switch(e.data[4]){case 1:return e.data.length!==9?e:{...e,subtype:"signal",signalEventType:"trackColor",alpha:e.data[5],blue:e.data[6],green:e.data[7],red:e.data[8]};default:return e}},Q9=e=>{switch(e.signalEventType){case"trackColor":return{id:e.id,tick:e.tick,type:"meta",subtype:"sequencerSpecific",data:[...jy,1,e.alpha,e.blue,e.green,e.red]}}},g0=z9(e=>e,e=>e);class Uy{constructor(t,n,r=!1,o=()=>Math.random()*1e6){ee(this,"lookupMap");this.array=t,this.keyExtractor=n,this.descending=r,this.generateId=o,this.lookupMap=new Map(t.map(s=>[s.id,s])),this.sort(),Vr(this,{array:Dt.shallow})}getArray(){return this.array}get(t){return this.lookupMap.get(t)}findInsertionIndex(t){const n=this.keyExtractor(t);let r=0,o=this.array.length-1;for(;r<=o;){const s=Math.floor((r+o)/2),a=this.keyExtractor(this.array[s]);let i;if(n<a?i=-1:n>a?i=1:i=0,this.descending&&(i=-i),i<0)o=s-1;else if(i>0)r=s+1;else if("id"in t&&"id"in this.array[s]){const c=t.id-this.array[s].id;if(c<0)o=s-1;else if(c>0)r=s+1;else return s}else return s}return r}add(t){const n=this.findInsertionIndex(t);return this.array.splice(n,0,t),this.lookupMap.set(t.id,t),this.array}create(t){const n={...t,id:this.generateId()};return this.add(n),n}remove(t){const n=this.lookupMap.get(t);if(n===void 0)return this.array;const r=this.array.indexOf(n);return r!==void 0&&(this.array.splice(r,1),this.lookupMap.delete(t)),this.array}update(t,n){const r=this.lookupMap.get(t);if(r===void 0)return this.array;const o=this.array.indexOf(r);if(o!==void 0){const s=this.array[o];this.array.splice(o,1);const a={...s,...n},i=this.findInsertionIndex(a);this.array.splice(i,0,a),this.lookupMap.set(a.id,a)}return this.array}sort(){this.array.sort((t,n)=>{const r=this.keyExtractor(t),o=this.keyExtractor(n);let s;return r<o?s=-1:r>o?s=1:s=t.id-n.id,this.descending?-s:s})}}Cd(Uy,{array:cm(g0),descending:Or(),lookupMap:F9(g0,"id")});class dm extends Uy{constructor(n=[],r=!1){super(n,o=>o.tick,r,()=>this.lastEventId++);ee(this,"lastEventId",0)}}Cd(dm,{lastEventId:Or()});const Gy=60*1e6;function fm(e){return Gy/e}function $a(e){return Gy/e}var Yn;(e=>{e.updateEvent=(n,r)=>o=>{const s=o.get(n);if(s===void 0)return console.warn(`unknown id: ${n}`),null;const a={...s,...r};return Qe.isEqual(a,s)?null:(o.update(n,a),a)},e.addEvent=n=>r=>{if(!("tick"in n)||isNaN(n.tick))throw new Error("invalid event is added");if("subtype"in n&&n.subtype==="endOfTrack")throw new Error("endOfTrack event is added");return r.create({...Qe.omit(n,["deltaTime","channel"])})},e.getRedundantEvents=n=>r=>r.filter(o=>o.type===n.type&&o.tick===n.tick&&("subtype"in o&&"subtype"in n?o.subtype===n.subtype:!0)&&("controllerType"in o&&"controllerType"in n?o.controllerType===n.controllerType:!0)),e.createOrUpdate=n=>r=>{const o=(0,e.getRedundantEvents)(n)(r.getArray());return o.length>0?(Mn(()=>{o.forEach(s=>{(0,e.updateEvent)(s.id,{...n,id:s.id})(r)})}),o[0]):(0,e.addEvent)(n)(r)},e.getMaxTick=n=>{let r=0;for(const o of n){const s=en(o)?o.tick+o.duration:o.tick;r=Math.max(r,s)}return r};const t=(n,r,o)=>s=>{const a=Br(s.getArray().filter(ui(n)).filter(mo(r)));a!==void 0?(0,e.updateEvent)(a.id,{value:o})(s):(0,e.addEvent)({type:"channel",subtype:"controller",controllerType:n,tick:0,value:o})(s)};e.setVolume=(n,r)=>o=>t(7,r,n)(o),e.setPan=(n,r)=>o=>t(10,r,n)(o),e.setProgramNumber=n=>r=>{const o=Vy(r.getArray());o!==void 0?(0,e.updateEvent)(o.id,{value:n})(r):(0,e.addEvent)({...xd(0,0,n),tick:0})(r)},e.setTempo=(n,r)=>o=>{const s=$y(o.getArray(),r),a=Math.floor($a(n));s!==void 0?(0,e.updateEvent)(s.id,{microsecondsPerBeat:a})(o):(0,e.addEvent)({...fu(0,a),tick:0})(o)},e.setName=n=>r=>{const o=Wy(r.getArray());o!==void 0?(0,e.updateEvent)(o.id,{text:n})(r):(0,e.addEvent)({...sm(0,n),tick:0})(r)},e.getColorEvent=n=>n.filter(q9)[0],e.setColor=n=>r=>{const o=(0,e.getColorEvent)(r.getArray());if(n===null){o!==void 0&&r.remove(o.id);return}o!==void 0?(0,e.updateEvent)(o.id,n)(r):(0,e.addEvent)({tick:0,type:"channel",subtype:"signal",signalEventType:"trackColor",...n})(r)}})(Yn||(Yn={}));const Vs=-1;let di=class Xy{constructor(){ee(this,"id",Vs);ee(this,"_events",new dm);ee(this,"endOfTrack",0);ee(this,"channel");ee(this,"getEventById",t=>this._events.get(t));ee(this,"getPan",t=>G9(this.events,t));ee(this,"getVolume",t=>U9(this.events,t));ee(this,"getTempo",t=>K9(this.events,t));ee(this,"getTimeSignatureEvent",t=>X9(this.events,t));ee(this,"setTempo",(t,n)=>{Yn.setTempo(t,n)(this._events)});Vr(this,{updateEvent:Rn,updateEvents:Rn,removeEvent:Rn,removeEvents:Rn,addEvent:Rn,addEvents:Rn,name:yr,programNumber:yr,isConductorTrack:yr,isRhythmTrack:yr,color:yr,events:yr,id:Dt,channel:Dt,endOfTrack:Dt})}get events(){return this._events.getArray()}updateEvent(t,n){const r=Yn.updateEvent(t,n)(this._events);return r!==null&&this.extendEndOfTrack(r),r}updateEvents(t){Mn(()=>{t.forEach(n=>{n.id!==void 0&&this.updateEvent(n.id,n)})})}removeEvent(t){this.removeEvents([t])}removeEvents(t){t.forEach(n=>{this._events.remove(n)})}addEvent(t){const n=Yn.addEvent(t)(this._events);return this.extendEndOfTrack(n),n}addEvents(t){return Mn(()=>{const r=this.isConductorTrack;return t.filter(o=>r?o.type!=="channel":!0).map(o=>this.addEvent(o))})}transaction(t){return Mn(()=>t(this))}createOrUpdate(t){return Yn.createOrUpdate(t)(this._events)}updateEndOfTrack(){this.endOfTrack=Yn.getMaxTick(this.events)}extendEndOfTrack(t){en(t)&&(this.endOfTrack=Math.max(this.endOfTrack,t.tick+t.duration))}get name(){var t;return(t=Wy(this.events))==null?void 0:t.text}get programNumber(){var t;return(t=Vy(this.events))==null?void 0:t.value}get color(){return Yn.getColorEvent(this.events)}setColor(t){Yn.setColor(t)(this._events)}setVolume(t,n){Yn.setVolume(t,n)(this._events)}setPan(t,n){Yn.setPan(t,n)(this._events)}setProgramNumber(t){Yn.setProgramNumber(t)(this._events)}setName(t){Yn.setName(t)(this._events)}get isConductorTrack(){return this.channel===void 0}get isRhythmTrack(){return this.channel===9}clone(){const t=new Xy;return t.channel=this.channel,t.addEvents(this.events.map(n=>({...n}))),t}};Cd(di,{id:Or(),_events:Ny(dm),channel:Or(),endOfTrack:Or()});const Ky=e=>`rgba(${e.red}, ${e.green}, ${e.blue}, ${e.alpha/255})`,J9=e=>[e.red/255,e.green/255,e.blue/255,e.alpha/255];function hm(e){let t=0;return e.map(n=>{const{deltaTime:r,...o}=n;return t+=r,{...o,tick:t}})}const Yy=e=>{const{channel:t,...n}=e;return n},qy=e=>!(e.type==="meta"&&e.subtype==="endOfTrack"),Zy=e=>j9(e)?Z9(e):e;function pm(e){return Cy(hm(e.filter(qy)).map(Zy)).map(Yy)}function e7(e){return Cy(e.filter(qy).map(Zy)).map(Yy)}function t7(e=""){const t=new di,n=pm([sm(0,e),yy(0),fu(0,6e7/120),_y(0)]);return t.addEvents(n),t}const n7=e=>[x9(0,e),sm(0,""),xy(0,e,64),wy(0,e,100),w9(0,e,127),...M9(0,e),...T9(0,e),...C9(0,e,12),ky(0,e,8192),k9(0,e,0),xd(0,e,0)];function mm(e){if(!Number.isInteger(e))throw new Error("channel is not integer");const t=new di;t.channel=e;const n=pm([...n7(e),_y(1)]);return t.addEvents(n),t}const r7=480*30,o7=480;class fi{constructor(){ee(this,"tracks",[]);ee(this,"filepath","");ee(this,"timebase",o7);ee(this,"name","");ee(this,"fileHandle",null);ee(this,"cloudSongId",null);ee(this,"cloudSongDataId",null);ee(this,"isSaved",!0);ee(this,"lastTrackId",0);Vr(this,{addTrack:Rn,removeTrack:Rn,insertTrack:Rn,conductorTrack:yr,measures:yr,timeSignatures:yr,endOfSong:yr,allEvents:yr({keepAlive:!0}),tracks:Dt.ref,filepath:Dt,timebase:Dt,name:Dt,isSaved:Dt}),ud(()=>[this.tracks.map(t=>({channel:t.channel,events:ks(t.events)})),this.name],()=>this.isSaved=!1)}generateTrackId(){return this.lastTrackId++}insertTrack(t,n){t.channel===void 0&&this.tracks.length>0&&(t.channel=t.channel||this.tracks.length-1),t.id=this.generateTrackId();const r=[...this.tracks];r.splice(n,0,t),this.tracks=r}addTrack(t){this.insertTrack(t,this.tracks.length)}removeTrack(t){this.tracks=this.tracks.filter(n=>n.id!==t)}moveTrack(t,n){const r=[...this.tracks],[o]=r.splice(t,1);r.splice(n,0,o),this.tracks=r}get conductorTrack(){return this.tracks.find(t=>t.isConductorTrack)}getTrack(t){return this.tracks.find(n=>n.id===t)}get measures(){const{timeSignatures:t,timebase:n}=this;return to.fromTimeSignatures(t,n)}get timeSignatures(){const{conductorTrack:t}=this;return t===void 0?[]:t.events.filter(um).slice().sort((n,r)=>n.tick-r.tick)}get endOfSong(){return(Math.max(...this.tracks.map(n=>n.endOfTrack))??0)+r7}updateEndOfSong(){this.tracks.forEach(t=>t.updateEndOfTrack())}get allEvents(){return E9(this.tracks)}serialize(){return pu(this)}static deserialize(t){return L9(fi,t)}}Cd(fi,{tracks:cm(Ny(di)),name:Or(),filepath:Or(),timebase:Or(),lastTrackId:Or(),isSaved:Or()});function gm(){const e=new fi;return e.addTrack(t7()),e.addTrack(mm(0)),e.isSaved=!0,e}var mu;(e=>{function t(r,o){return{tick:r.tick-o.tick,trackIndex:r.trackIndex-o.trackIndex}}e.sub=t;function n(r,o){return{tick:Math.max(0,r.tick),trackIndex:Math.max(0,Math.min(o,r.trackIndex))}}e.clamp=n})(mu||(mu={}));const v0=127;var hc;(e=>{e.clamp=t=>Math.min(v0,Math.max(0,t)),e.isValid=t=>t>=0&&t<=v0})(hc||(hc={}));const js=e=>t=>Ft.contains(e,t.tick);class vm{constructor(t){ee(this,"batchUpdateNotesVelocity",(t,n,r)=>{const o=this.songStore.song.getTrack(t);if(!o)return;const s=n.map(a=>o.getEventById(a)).filter(lr).filter(en);o.updateEvents(s.map(a=>({id:a.id,velocity:Qe.clamp(Math.floor(s7(r,a.velocity)),1,127)})))});ee(this,"transposeNotes",(t,n,r)=>{const o=this.songStore.song.getTrack(t);o&&o.updateEvents(n.map(s=>{const a=o.getEventById(s);return a==null||!en(a)?null:{id:s,noteNumber:hc.clamp(a.noteNumber+r)}}).filter(Fy))});ee(this,"duplicateEvents",(t,n)=>{var i,c;const r=this.songStore.song.getTrack(t);if(!r)return[];const o=n.map(l=>r.getEventById(l)).filter(lr),s=(((i=Qe.maxBy(o,l=>l.tick))==null?void 0:i.tick)??0)-(((c=Qe.minBy(o,l=>l.tick))==null?void 0:c.tick)??0),a=o.map(l=>({...l,tick:l.tick+s}));return Mn(()=>a.map(l=>r.createOrUpdate(l))).filter(lr).map(l=>l.id)});ee(this,"duplicateNotes",(t,n,r)=>{const o=this.songStore.song.getTrack(t);if(!o)return{addedNoteIds:[],deltaTick:0};const s=n.map(c=>o.getEventById(c)).filter(lr).filter(en);if(r===0){const c=Qe.min(s.map(f=>f.tick))??0;r=(Qe.max(s.map(f=>f.tick+f.duration))??0)-c}const a=s.map(c=>({...c,tick:c.tick+r}));return{addedNoteIds:o.addEvents(a).map(c=>c.id),deltaTick:r}});ee(this,"updateVelocitiesInRange",(t,n,r,o,s,a)=>{const i=this.songStore.song.getTrack(t);if(!i)return;const c=Math.min(r,s),l=Math.max(r,s),f=Math.min(o,a),d=Math.max(o,a),m=y=>Math.floor(Math.min(d,Math.max(f,(y-r)/(s-r)*(a-o)+o))),_=(n.length>0?n.map(y=>i.getEventById(y)):i.events.filter(en)).filter(js(Ft.create(c,l)));Mn(()=>{i.updateEvents(_.map(y=>({id:y.id,velocity:m(y.tick)})))})});ee(this,"removeRedundantEvents",(t,n)=>{const r=this.songStore.song.getTrack(t);if(!r)return;const o=Yn.getRedundantEvents(n)(r.events).filter(s=>s.id!==n.id).map(s=>s.id);r.removeEvents(o)});ee(this,"removeRedundantEventsForEventIds",(t,n)=>{const r=this.songStore.song.getTrack(t);if(!r)return;const o=r.events.filter(s=>n.includes(s.id));Mn(()=>o.forEach(s=>this.removeRedundantEvents(t,s)))});ee(this,"quantizeNotes",(t,n,r)=>{const o=this.songStore.song.getTrack(t);if(!o)return;const s=n.map(a=>o.getEventById(a)).filter(lr).filter(en).map(a=>({...a,tick:r(a.tick)}));o.updateEvents(s)});ee(this,"updateEventsInRange",(t,n,r,o,s,a,i,c,l)=>{const f=this.songStore.song.getTrack(t);if(!f)return;const d=Math.min(c,l),m=Math.max(c,l),v=o(Math.max(0,d)),_=o(Math.max(0,m)),y=Math.min(a,i),k=Math.max(a,i),g=l===c?()=>i:h=>Math.floor(Math.min(k,Math.max(y,(h-c)/(l-c)*(i-a)+a))),b=f.events.filter(n).filter(h=>h.tick!==c&&h.tick>=Math.min(d,v)&&h.tick<=Math.max(m,_));Mn(()=>{f.removeEvents(b.map(S=>S.id));const h=H9(v,_,s).map(S=>({...r(g(S)),tick:S}));f.addEvents(h)})});this.songStore=t}}const s7=(e,t)=>{switch(e.type){case"set":return e.value;case"add":return t+e.value;case"multiply":return t*e.value}};class a7{constructor(t){ee(this,"trackCommands");ee(this,"moveEventsBetweenTracks",(t,n)=>{const{tracks:r}=this.songStore.song;return Mn(()=>{const o=[];for(const[s,a]of Object.entries(t)){const i=parseInt(s,10),c=r[i],l=a.map(f=>c.getEventById(f)).filter(lr);n.trackIndex===0?c.updateEvents(l.map(f=>({id:f.id,tick:f.tick+n.tick}))):o.push({sourceTrackIndex:i,destinationTrackIndex:i+n.trackIndex,events:l.map(f=>({...f,tick:f.tick+n.tick}))})}if(n.trackIndex!==0){const s={};for(const a of o){r[a.sourceTrackIndex].removeEvents(a.events.map(c=>c.id));const i=r[a.destinationTrackIndex].addEvents(a.events);s[a.destinationTrackIndex]=i.map(c=>c.id)}return s}return t})});ee(this,"batchUpdateNotesVelocity",(t,n)=>{const{tracks:r}=this.songStore.song,o=this.getEventsInSelection(t);Mn(()=>{for(const[s,a]of Object.entries(o)){const i=parseInt(s,10),c=r[i];this.trackCommands.batchUpdateNotesVelocity(c.id,a,n)}})});ee(this,"duplicateSelection",t=>{const{tracks:n}=this.songStore.song,r=t.toTick-t.fromTick,o=this.getEventsInSelection(t);return Mn(()=>{for(const[s,a]of Object.entries(o)){const i=parseInt(s,10),c=n[i],l=a.map(f=>c.getEventById(f)).filter(lr);c.addEvents(l.map(f=>({...f,tick:f.tick+r})))}}),{fromTick:t.fromTick+r,fromTrackIndex:t.fromTrackIndex,toTick:t.toTick+r,toTrackIndex:t.toTrackIndex}});ee(this,"deleteSelection",t=>{const n=this.getEventsInSelection(t),{tracks:r}=this.songStore.song;Mn(()=>{for(const o in n)r[o].removeEvents(n[o])})});ee(this,"transposeSelection",(t,n)=>{const r=this.getEventsInSelection(t),{tracks:o}=this.songStore.song;Mn(()=>{for(const s in r){const a=parseInt(s),i=r[a],c=o[a];c!==void 0&&this.trackCommands.transposeNotes(c.id,i,n)}})});ee(this,"getClipboardDataForSelection",t=>{const n=this.getEventsInSelection(t),{tracks:r}=this.songStore.song;return{type:"arrange_notes",notes:Qe.mapValues(n,(s,a)=>{const i=r[parseInt(a,10)];return s.map(c=>i.getEventById(c)).filter(lr).map(c=>({...c,tick:c.tick-t.fromTick}))}),selectedTrackIndex:t.fromTrackIndex}});ee(this,"pasteClipboardDataAt",(t,n,r)=>{const{tracks:o}=this.songStore.song;Mn(()=>{for(const s in t.notes){const a=t.notes[s].map(f=>({...f,tick:f.tick+n})),c=r<0?0:-t.selectedTrackIndex+r,l=parseInt(s)+c;l<o.length&&o[l].addEvents(a)}})});ee(this,"getEventsInSelection",t=>{const{tracks:n}=this.songStore.song,r={};for(let o=t.fromTrackIndex;o<t.toTrackIndex;o++){const a=n[o].events.filter(js(Ft.create(t.fromTick,t.toTick)));r[o]=a.map(i=>i.id)}return r});ee(this,"hasSelectionNotes",t=>{const n=this.getEventsInSelection(t);return Object.values(n).some(r=>r.length>0)});this.songStore=t,this.trackCommands=new vm(t)}}class i7{constructor(t){ee(this,"trackCommands");ee(this,"duplicateEvents",t=>{const n=this.songStore.song.conductorTrack;return n?this.trackCommands.duplicateEvents(n.id,t):[]});ee(this,"moveTempoEvents",(t,n,r,o)=>{const s=this.songStore.song.conductorTrack;if(!s)return;const a=t.map(i=>s.getEventById(i)).filter(lr);s.updateEvents(a.map(i=>({id:i.id,tick:Math.max(0,Math.floor(i.tick+n)),microsecondsPerBeat:Math.floor($a(Qe.clamp(fm(i.microsecondsPerBeat)+r,0,o)))})))});ee(this,"removeRedundantEventsForEventIds",t=>{const n=this.songStore.song.conductorTrack;if(n)return this.trackCommands.removeRedundantEventsForEventIds(n.id,t)});ee(this,"copyTempoEvents",t=>{const n=this.songStore.song.conductorTrack;if(!n)return null;const r=t.map(a=>n.getEventById(a)).filter(lr).filter(li),o=Qe.min(r.map(a=>a.tick));return o===void 0?null:{type:"tempo_events",events:r.map(a=>({...a,tick:a.tick-o}))}});ee(this,"pasteTempoEventsAt",(t,n)=>{const r=this.songStore.song.conductorTrack;if(!r)return[];const o=t.events.map(s=>({...s,tick:s.tick+n}));Mn(()=>{o.forEach(s=>r.createOrUpdate(s))})});this.songStore=t,this.trackCommands=new vm(t)}}class c7{constructor(t){ee(this,"getClipboardDataForSelection",(t,n)=>{const r=this.songStore.song.getTrack(t);if(!r)return null;const o=n.map(i=>r.getEventById(i)).filter(lr),s=Qe.min(o.map(i=>i.tick));return s===void 0?null:{type:"control_events",events:o.map(i=>({...i,tick:i.tick-s}))}});ee(this,"pasteClipboardDataAtPosition",(t,n,r)=>{const o=this.songStore.song.getTrack(t);if(!o)return;const s=n.events.map(a=>({...a,tick:a.tick+r}));Mn(()=>s.forEach(a=>o.createOrUpdate(a)))});this.songStore=t}}class l7{constructor(t){ee(this,"arrange");ee(this,"track");ee(this,"conductorTrack");ee(this,"control");this.songStore=t,this.arrange=new a7(this.songStore),this.track=new vm(this.songStore),this.conductorTrack=new i7(this.songStore),this.control=new c7(this.songStore)}}var u7=M4,d7=function(){try{var e=u7(Object,"defineProperty");return e({},"",{}),e}catch{}}(),f7=d7,b0=f7;function h7(e,t,n){t=="__proto__"&&b0?b0(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}var p7=h7;function m7(e,t,n,r){for(var o=-1,s=e==null?0:e.length;++o<s;){var a=e[o];t(r,a,n(a),e)}return r}var g7=m7;function v7(e){return function(t,n,r){for(var o=-1,s=Object(t),a=r(t),i=a.length;i--;){var c=a[e?i:++o];if(n(s[c],c,s)===!1)break}return t}}var b7=v7,_7=b7,y7=_7(),S7=y7,k7=S7,w7=E4;function x7(e,t){return e&&k7(e,t,w7)}var C7=x7,T7=I4;function M7(e,t){return function(n,r){if(n==null)return n;if(!T7(n))return e(n,r);for(var o=n.length,s=t?o:-1,a=Object(n);(t?s--:++s<o)&&r(a[s],s,a)!==!1;);return n}}var E7=M7,I7=C7,A7=E7,R7=A7(I7),O7=R7,P7=O7;function B7(e,t,n,r){return P7(e,function(o,s,a){t(r,o,n(o),a)}),r}var D7=B7,N7=g7,L7=D7,z7=A4,F7=y_;function W7(e,t){return function(n,r){var o=F7(n)?N7:L7,s=t?t():{};return o(n,e,z7(r),s)}}var $7=W7,V7=p7,j7=$7,H7=Object.prototype,U7=H7.hasOwnProperty,G7=j7(function(e,t,n){U7.call(e,n)?e[n].push(t):V7(e,n,[t])}),X7=G7;const K7=yt(X7);var zo={noteOff:8,noteOn:9,noteAftertouch:10,controller:11,programChange:12,channelAftertouch:13,pitchBend:14},Cn={sequenceNumber:0,text:1,copyrightNotice:2,trackName:3,instrumentName:4,lyrics:5,marker:6,cuePoint:7,midiChannelPrefix:32,portPrefix:33,endOfTrack:47,setTempo:81,smpteOffset:84,timeSignature:88,keySignature:89,sequencerSpecific:127};function Y7(e,t,n){t===void 0&&(t=0);var r=e.readVarInt();return q7(e,r,t,n)}function q7(e,t,n,r){t===void 0&&(t=0),n===void 0&&(n=0);var o=e.readInt8();if((o&240)===240)if(o===255){var s="meta",a=e.readInt8(),i=e.readVarInt();switch(a){case Cn.sequenceNumber:if(i!==2)throw new Error("Expected length for sequenceNumber event is 2, got "+i);return{deltaTime:t,type:s,subtype:"sequenceNumber",number:e.readInt16()};case Cn.text:return{deltaTime:t,type:s,subtype:"text",text:e.readStr(i)};case Cn.copyrightNotice:return{deltaTime:t,type:s,subtype:"copyrightNotice",text:e.readStr(i)};case Cn.trackName:return{deltaTime:t,type:s,subtype:"trackName",text:e.readStr(i)};case Cn.instrumentName:return{deltaTime:t,type:s,subtype:"instrumentName",text:e.readStr(i)};case Cn.lyrics:return{deltaTime:t,type:s,subtype:"lyrics",text:e.readStr(i)};case Cn.marker:return{deltaTime:t,type:s,subtype:"marker",text:e.readStr(i)};case Cn.cuePoint:return{deltaTime:t,type:s,subtype:"cuePoint",text:e.readStr(i)};case Cn.midiChannelPrefix:if(i!==1)throw new Error("Expected length for midiChannelPrefix event is 1, got "+i);return{deltaTime:t,type:s,subtype:"midiChannelPrefix",value:e.readInt8()};case Cn.portPrefix:if(i!==1)throw new Error("Expected length for midiChannelPrefix event is 1, got "+i);return{deltaTime:t,type:s,subtype:"portPrefix",port:e.readInt8()};case Cn.endOfTrack:if(i!==0)throw new Error("Expected length for endOfTrack event is 0, got "+i);return{deltaTime:t,type:s,subtype:"endOfTrack"};case Cn.setTempo:if(i!==3)throw new Error("Expected length for setTempo event is 3, got "+i);return{deltaTime:t,type:s,subtype:"setTempo",microsecondsPerBeat:(e.readInt8()<<16)+(e.readInt8()<<8)+e.readInt8()};case Cn.smpteOffset:{if(i!==5)throw new Error("Expected length for smpteOffset event is 5, got "+i);var c=e.readInt8(),l={0:24,32:25,64:29,96:30};return{deltaTime:t,type:s,subtype:"smpteOffset",frameRate:l[c&96],hour:c&31,min:e.readInt8(),sec:e.readInt8(),frame:e.readInt8(),subframe:e.readInt8()}}case Cn.timeSignature:if(i!==4)throw new Error("Expected length for timeSignature event is 4, got "+i);return{deltaTime:t,type:s,subtype:"timeSignature",numerator:e.readInt8(),denominator:Math.pow(2,e.readInt8()),metronome:e.readInt8(),thirtyseconds:e.readInt8()};case Cn.keySignature:if(i!==2)throw new Error("Expected length for keySignature event is 2, got "+i);return{deltaTime:t,type:s,subtype:"keySignature",key:e.readInt8(!0),scale:e.readInt8()};case Cn.sequencerSpecific:return{deltaTime:t,type:s,subtype:"sequencerSpecific",data:e.read(i)};default:return{deltaTime:t,type:s,subtype:"unknown",data:e.read(i)}}}else if(o===240){var i=e.readVarInt();return{deltaTime:t,type:"sysEx",data:e.read(i)}}else if(o===247){var i=e.readVarInt();return{deltaTime:t,type:"dividedSysEx",data:e.read(i)}}else switch(o){case 241:return{deltaTime:t,type:"system",subtype:"timeCodeQuarterFrame",data:e.readInt8()};case 242:var f=e.readInt8(),d=e.readInt8();return{deltaTime:t,type:"system",subtype:"songPositionPointer",value:d<<7|f};case 243:return{deltaTime:t,type:"system",subtype:"songSelect",songNumber:e.readInt8()};case 246:return{deltaTime:t,type:"system",subtype:"tuneRequest"};case 248:return{deltaTime:t,type:"system",subtype:"timingClock"};case 250:return{deltaTime:t,type:"system",subtype:"start"};case 251:return{deltaTime:t,type:"system",subtype:"continue"};case 252:return{deltaTime:t,type:"system",subtype:"stop"};case 254:return{deltaTime:t,type:"system",subtype:"activeSensing"};default:throw new Error("Unsupported system event: 0x".concat(o.toString(16)))}else{var m=void 0;o&128?(m=e.readInt8(),r==null||r(o)):(m=o,o=n);var v=o>>4,_=o&15,s="channel";switch(v){case zo.noteOff:return{deltaTime:t,type:s,channel:_,subtype:"noteOff",noteNumber:m,velocity:e.readInt8()};case zo.noteOn:{var y=e.readInt8();return{deltaTime:t,type:s,channel:_,subtype:y===0?"noteOff":"noteOn",noteNumber:m,velocity:y}}case zo.noteAftertouch:return{deltaTime:t,type:s,channel:_,subtype:"noteAftertouch",noteNumber:m,amount:e.readInt8()};case zo.controller:return{deltaTime:t,type:s,channel:_,subtype:"controller",controllerType:m,value:e.readInt8()};case zo.programChange:return{deltaTime:t,type:s,channel:_,subtype:"programChange",value:m};case zo.channelAftertouch:return{deltaTime:t,type:s,channel:_,subtype:"channelAftertouch",amount:m};case zo.pitchBend:return{deltaTime:t,type:s,channel:_,subtype:"pitchBend",value:m+(e.readInt8()<<7)};default:return{deltaTime:t,type:s,channel:_,subtype:"unknown",data:e.readInt8()}}}}var Vf=function(){function e(t){if(this.position=0,t instanceof DataView)this.buf=t;else if(t instanceof ArrayBuffer)this.buf=new DataView(t);else if(t instanceof Array)this.buf=new DataView(new Uint8Array(t).buffer);else if(t instanceof Uint8Array)this.buf=new DataView(t.buffer);else throw new Error("not supported type: "+typeof t)}return e.prototype.readByte=function(){return this.buf.getUint8(this.position++)},e.prototype.readStr=function(t){return this.read(t).map(function(n){return String.fromCharCode(n)}).join("")},e.prototype.read=function(t){for(var n=[],r=0;r<t;r++)n.push(this.readByte());return n},e.prototype.readInt32=function(){var t=this.buf.getInt32(this.position,!1);return this.position+=4,t},e.prototype.readInt16=function(){var t=this.buf.getInt16(this.position,!1);return this.position+=2,t},e.prototype.readInt8=function(t){return t===void 0&&(t=!1),t?this.buf.getInt8(this.position++):this.readByte()},e.prototype.eof=function(){return this.position>=this.buf.byteLength},e.prototype.readVarInt=function(){for(var t=0;;){var n=this.readInt8();if(n&128)t+=n&127,t<<=7;else return t+n}},e}();function Z7(e){function t(g){var b=g.readStr(4),h=g.readInt32();return{id:b,length:h,data:g.read(h)}}var n=new Vf(e),r=t(n);if(r.id!=="MThd"||r.length!==6)throw new Error("Bad .mid file - header not found");var o=new Vf(r.data),s=o.readInt16(),a=o.readInt16(),i=o.readInt16(),c;if(i&32768)throw new Error("Expressing time division in SMTPE frames is not supported yet");c=i;var l={formatType:s,trackCount:a,ticksPerBeat:c},f;function d(g){return Y7(g,f,function(b){return f=b})}for(var m=[],v=0;v<l.trackCount;v++){m[v]=[];var _=t(n);if(_.id!=="MTrk")throw new Error("Unexpected chunk - expected MTrk, got "+_.id);for(var y=new Vf(_.data);!y.eof();){var k=d(y);m[v].push(k)}}return{header:l,tracks:m}}function Qy(e){for(var t=[],n=0;n<e.length;n++)t.push(e.charCodeAt(n));return t}function Q7(e){for(var t=e,n=[t&127];t>>=7,t!==0;)n.unshift(128+(t&127));return n}function J7(e,t){t===void 0&&(t=!0);var n=[];function r(l){if(Array.isArray(l))l.forEach(r);else{if(!Number.isInteger(l))throw new Error('"'.concat(l,'" is not integer'));n.push(l)}}t&&r(Q7(e.deltaTime));function o(l){r(l.length),l.forEach(function(f){return r(f)})}function s(l){r(l.length),r(Qy(l))}switch(e.type){case"meta":{var a=Cn[e.subtype];if(a===void 0)return[];switch(r(255),r(a),e.subtype){case"sequenceNumber":r(e.number);break;case"text":s(e.text);break;case"copyrightNotice":s(e.text);break;case"trackName":s(e.text);break;case"instrumentName":s(e.text);break;case"lyrics":s(e.text);break;case"marker":s(e.text);break;case"cuePoint":s(e.text);break;case"midiChannelPrefix":o([e.value]);break;case"portPrefix":o([e.port]);break;case"endOfTrack":r(0);break;case"setTempo":{var i=e.microsecondsPerBeat;o([i>>16&255,i>>8&255,i&255]);break}case"smpteOffset":{var c={24:0,25:32,29:64,30:96};o([c[e.frameRate]+(31&e.hour),e.min,e.sec,e.frame,e.subframe]);break}case"timeSignature":{o([e.numerator,Math.log2(e.denominator),e.metronome,e.thirtyseconds]);break}case"keySignature":{o([e.key,e.scale]);break}case"sequencerSpecific":o(e.data);break;case"unknown":o(e.data);break}break}case"sysEx":r(240),o(e.data);break;case"dividedSysEx":r(247),o(e.data);break;case"channel":{var a=zo[e.subtype];if(a===void 0)return[];switch(r((a<<4)+e.channel),e.subtype){case"noteOff":{r(e.noteNumber),r(e.velocity);break}case"noteOn":{r(e.noteNumber),r(e.velocity);break}case"noteAftertouch":{r(e.noteNumber),r(e.amount);break}case"controller":{r(e.controllerType),r(e.value);break}case"programChange":r(e.value);break;case"channelAftertouch":r(e.amount);break;case"pitchBend":{r(e.value&127),r(e.value>>7&127);break}case"unknown":r(e.data);break}break}}return n}var eI=function(){function e(){this.data=[],this.position=0}return Object.defineProperty(e.prototype,"length",{get:function(){return this.data.length},enumerable:!1,configurable:!0}),e.prototype.writeByte=function(t){this.data.push(t),this.position++},e.prototype.writeStr=function(t){this.writeBytes(Qy(t))},e.prototype.writeInt32=function(t){this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(t&255)},e.prototype.writeInt16=function(t){this.writeByte(t>>8&255),this.writeByte(t&255)},e.prototype.writeBytes=function(t){var n=this;t.forEach(function(r){return n.writeByte(r)})},e.prototype.writeChunk=function(t,n){this.writeStr(t);var r=new e;n(r),this.writeInt32(r.length),this.writeBytes(r.data)},e.prototype.toBytes=function(){return new Uint8Array(this.data)},e}();function tI(e,t){t===void 0&&(t=480);var n=new eI;n.writeChunk("MThd",function(i){i.writeInt16(1),i.writeInt16(e.length),i.writeInt16(t)});for(var r=function(i){n.writeChunk("MTrk",function(c){for(var l=0,f=i;l<f.length;l++){var d=f[l];c.writeBytes(J7(d))}})},o=0,s=e;o<s.length;o++){var a=s[o];r(a)}return n.toBytes()}var _0=R4,nI=O4,rI=y_,y0=_0?_0.isConcatSpreadable:void 0;function oI(e){return rI(e)||nI(e)||!!(y0&&e&&e[y0])}var sI=oI,aI=P4,iI=sI;function Jy(e,t,n,r,o){var s=-1,a=e.length;for(n||(n=iI),o||(o=[]);++s<a;){var i=e[s];t>0&&n(i)?t>1?Jy(i,t-1,n,r,o):aI(o,i):r||(o[o.length]=i)}return o}var cI=Jy,lI=cI;function uI(e){var t=e==null?0:e.length;return t?lI(e,1):[]}var dI=uI;const fI=yt(dI);function eS(e){let t=0;return e.sort((n,r)=>n.tick-r.tick).map(n=>{const r={...n,deltaTime:Math.round(n.tick)-Math.round(t)};return delete r.tick,t=n.tick,r})}const hI=e=>Hy(e)?Q9(e):e;function pI(e){const t=fI(e.map(hI).map(Ty));return eS(t)}const mI=e=>{const t=new di,n=tS(e);return n!==void 0&&(t.channel=n),t.addEvents(pm(e)),t},gI=e=>{const t=hm(e),n=K7(t,o=>"channel"in o?o.channel+1:0),r=[];for(const o of Object.keys(n)){const s=n[o],a=parseInt(o);for(;r.length<=a;){const l=new di;l.channel=a>0?a-1:void 0,r.push(l)}const i=r[a],c=e7(s);i.addEvents(c)}return r},tS=e=>{const t=e.find(n=>n.type==="channel");if(t!==void 0&&"channel"in t)return t.channel},vI=e=>tS(e)===void 0,bI=e=>"subtype"in e&&(e.subtype==="timeSignature"||e.subtype==="setTempo"),_I=e=>{const[t,n]=Qe.partition(e,vI);t.length===0&&t.push([]);const[r,...o]=[...t,...n].map(hm),s=o.map(a=>a.map(i=>bI(i)?(r.push(i),null):i).filter(Fy));return[r,...s].map(eS)},yI=e=>{switch(e.header.formatType){case 0:return gI(e.tracks[0]);case 1:return _I(e.tracks).map(mI);default:throw new Error(`Unsupported midi format ${e.header.formatType}`)}};function Md(e){const t=new fi,n=Z7(e);if(yI(n).forEach(r=>t.addTrack(r)),n.header.formatType===1&&t.tracks.length>0){const r=t.tracks[0].name;r!==void 0&&(t.name=r)}return t.timebase=n.header.ticksPerBeat,t}const SI=e=>t=>t.type==="channel"?{...t,channel:e}:t;function kI(e){return e.tracks.map(n=>{const r={deltaTime:0,type:"meta",subtype:"endOfTrack"},o=[...pI(n.events),r];return n.channel!==void 0?o.map(SI(n.channel)):o})}function rs(e){const t=kI(e);return tI(t,e.timebase)}var ap;(e=>{e.createInRange=(t,n,r,o,s)=>ou.createInRange(t,r,Ft.fromLength(n.getTick(o),n.getTick(s))).map(a=>({...a,x:Math.round(n.getX(a.tick))}))})(ap||(ap={}));var nS={exports:{}},rS={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hc=p;function wI(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var xI=typeof Object.is=="function"?Object.is:wI,CI=Hc.useSyncExternalStore,TI=Hc.useRef,MI=Hc.useEffect,EI=Hc.useMemo,II=Hc.useDebugValue;rS.useSyncExternalStoreWithSelector=function(e,t,n,r,o){var s=TI(null);if(s.current===null){var a={hasValue:!1,value:null};s.current=a}else a=s.current;s=EI(function(){function c(v){if(!l){if(l=!0,f=v,v=r(v),o!==void 0&&a.hasValue){var _=a.value;if(o(_,v))return d=_}return d=v}if(_=d,xI(f,v))return _;var y=r(v);return o!==void 0&&o(_,y)?(f=v,_):(f=v,d=y)}var l=!1,f,d,m=n===void 0?null:n;return[function(){return c(t())},m===null?void 0:function(){return c(m())}]},[t,n,r,o]);var i=CI(e,s[0],s[1]);return MI(function(){a.hasValue=!0,a.value=i},[i]),II(i),i};nS.exports=rS;var AI=nS.exports;function On(e,t,n=Object.is){return AI.useSyncExternalStoreWithSelector(p.useCallback(r=>ud(e,r,{fireImmediately:!0,equals:n}),t),e,void 0,p.useCallback(r=>r,[]),n)}function bt(e,t,n){return On(()=>e==null?void 0:e[t],[e],n)}function ga(e,t){return p.useCallback(n=>e[t]=n,[e])}const oS=p.createContext(null),Ht=()=>p.useContext(oS),_t=()=>{const{songStore:e}=Ht(),t=bt(e,"song");return{get name(){return bt(t,"name")},get timebase(){return bt(t,"timebase")},get measures(){return bt(t,"measures")},get timeSignatures(){return bt(t,"timeSignatures")},get tracks(){return bt(t,"tracks")},get isSaved(){return bt(t,"isSaved")},get filepath(){return bt(t,"filepath")},get fileHandle(){return bt(t,"fileHandle")},get cloudSongId(){return bt(t,"cloudSongId")},get endOfSong(){return bt(t,"endOfSong")},setName:ga(t,"name"),getSong:p.useCallback(()=>e.song,[e]),setSong:ga(e,"song"),setSaved:ga(t,"isSaved"),setFilepath:ga(t,"filepath"),addTrack:p.useCallback(n=>{t.addTrack(n)},[t]),insertTrack:p.useCallback((n,r)=>{t.insertTrack(n,r)},[t]),moveTrack:p.useCallback((n,r)=>{t.moveTrack(n,r)},[t]),removeTrack:p.useCallback(n=>{t.removeTrack(n)},[t]),getTrack:p.useCallback(n=>t.getTrack(n),[t]),getChannelForTrack:p.useCallback(n=>{var r;return(r=t.getTrack(n))==null?void 0:r.channel},[t]),updateEndOfSong:p.useCallback(()=>{t.updateEndOfSong()},[t])}};class RI{constructor(t){this.pixelsPerTick=t}getX(t){return t*this.pixelsPerTick}getTick(t){return t/this.pixelsPerTick}get id(){return this.pixelsPerTick}}function Lt(){const{player:e}=Ht();return{get position(){return bt(e,"position")},get isPlaying(){return bt(e,"isPlaying")},get loop(){return bt(e,"loop")},setPosition:ga(e,"position"),playOrPause:e.playOrPause,play:e.play,stop:e.stop,reset:e.reset,sendEvent:e.sendEvent,toggleEnableLoop:e.toggleEnableLoop,setLoopBegin:e.setLoopBegin,setLoopEnd:e.setLoopEnd,setCurrentTempo:ga(e,"currentTempo"),allSoundsOffChannel:e.allSoundsOffChannel,allSoundsOffExclude:e.allSoundsOffExclude}}const bm=e=>$c({atoms:new Set([Hs,Uc,Va,gu,Ed,Id,ym]),parentStore:e});function _m({scope:e,minScaleX:t,maxScaleX:n,children:r}){const{endOfSong:o}=_t(),{isPlaying:s,position:a}=Lt(),i=xe(OI,{store:e}),c=xe(ym,{store:e}),l=xe(Ed,{store:e}),f=xe(Id,{store:e});return p.useEffect(()=>l(t),[l,t]),p.useEffect(()=>f(n),[f,n]),p.useEffect(()=>{c(o)},[c,o]),p.useEffect(()=>{s&&i(a)},[i,s,a]),u(rm,{scope:e,children:r})}function kt(e=mr()){return{get autoScroll(){return Oe(gu,{store:e})},get cursorX(){const{player:t}=Ht(),n=Oe(oo,{store:e});return On(()=>n.getX(t.position),[n,t])},get scrollLeft(){return Oe(ja,{store:e})},get scrollLeftTicks(){return Oe(Hs,{store:e})},get scaleX(){return Oe(Uc,{store:e})},get transform(){return Oe(oo,{store:e})},get canvasWidth(){return Oe(Va,{store:e})},get contentWidth(){return Oe(sS,{store:e})},getTick:xe(DI,{store:e}),setCanvasWidth:xe(Va,{store:e}),setScrollLeftInPixels:xe(aS,{store:e}),setScrollLeftInTicks:xe(iS,{store:e}),setScaleX:xe(PI,{store:e}),scaleAroundPointX:xe(BI,{store:e}),setAutoScroll:xe(gu,{store:e})}}const Hs=me(0),Uc=me(1),Va=me(0),gu=me(!0),ym=me(0),Ed=me(.15),Id=me(15),oo=me(e=>new RI(Vt.pixelsPerTick*e(Uc))),ja=me(e=>Math.round(e(oo).getX(e(Hs)))),sS=me(e=>{const t=e(oo),n=e(Va),r=e(ja),o=e(ym),s=t.getTick(r),a=t.getTick(n),i=s+a;return t.getX(Math.max(o,i))}),aS=me(null,(e,t,n)=>{const r=typeof n=="function"?n(e(ja)):n,o=e(oo),s=e(Va),i=e(sS)-s,c=Qe.clamp(r,0,i);t(Hs,o.getTick(c))}),iS=me(null,(e,t,n)=>{const r=e(oo);t(aS,r.getX(n))}),OI=me(null,(e,t,n)=>{const r=e(oo),o=e(Hs),s=e(Va),a=e(gu),i=r.getX(n-o),c=i<0||i>s*.7;a&&c&&t(Hs,n)}),PI=me(null,(e,t,n)=>{const r=e(Ed),o=e(Id);t(Uc,Qe.clamp(n,r,o))}),BI=me(null,(e,t,n,r)=>{const o=e(Ed),s=e(Id),a=e(oo),i=e(ja),c=a.getTick(i+r);t(Uc,_=>Qe.clamp(_*(1+n),o,s));const l=e(oo),f=e(ja),m=l.getTick(f+r)-c,v=e(Hs);t(iS,v-m)}),DI=me(null,(e,t,n)=>{const r=e(oo),o=e(ja);return r.getTick(n+o)}),Sm=e=>$c({atoms:[wm],parentStore:e});function km({scope:e,children:t}){const{scrollLeft:n,transform:r,canvasWidth:o}=kt(),{measures:s,timebase:a}=_t(),i=xe(wm,{store:e});return p.useEffect(()=>{const c=ap.createInRange(s,r,a,n,o);i(c)},[n,r,o,s,a,i]),u(rm,{scope:e,children:t})}function hi(e=mr()){return Oe(wm,{store:e})}const wm=me([]);function xm({scope:e,quantize:t,children:n}){const r=xe(ka,{store:e});return p.useEffect(()=>{r(t)},[r,t]),u(rm,{scope:e,children:n})}const Cm=e=>$c({atoms:new Set([ka,fa]),parentStore:e});function Tl(e,t){const{songStore:n}=Ht(),r=Oe(ka,{store:e});return p.useCallback(o=>{const s=to.getMeasureStart(n.song.measures,o,n.song.timebase),a=r===1?s.numerator??4:4,i=n.song.timebase*a/r,c=(s==null?void 0:s.tick)??0;return t((o-c)/i)*i+c},[n,r,t])}function Nn(e=mr()){return{get quantize(){return Oe(ka,{store:e})},get quantizeUnit(){const{songStore:t}=Ht(),n=Oe(ka,{store:e});return p.useMemo(()=>t.song.timebase*4/n,[t,n])},get isQuantizeEnabled(){return Oe(fa,{store:e})},get quantizeRound(){const t=Oe(fa,{store:e}),n=Tl(e,Math.round);return t?n:Math.round},get quantizeFloor(){const t=Oe(fa,{store:e}),n=Tl(e,Math.floor);return t?n:Math.floor},get quantizeCeil(){const t=Oe(fa,{store:e}),n=Tl(e,Math.ceil);return t?n:Math.ceil},get forceQuantizeRound(){return Tl(e,Math.round)},setQuantize:xe(ka,{store:e}),setIsQuantizeEnabled:xe(fa,{store:e})}}const ka=me(4),fa=me(!0);var Tm=p,NI=Tm.useState,LI=Tm.useCallback,zI=Tm.useLayoutEffect;function S0(e){return e?{width:e.offsetWidth,height:e.offsetHeight}:{width:0,height:0}}function FI(e){var t=NI(S0(e?e.current:{})),n=t[0],r=t[1],o=LI(function(){e.current&&r(S0(e.current))},[e]);return zI(function(){if(e.current)if(o(),typeof ResizeObserver=="function"){var s=new ResizeObserver(function(){o()});return s.observe(e.current),function(){s.disconnect(e.current),s=null}}else return window.addEventListener("resize",o),function(){window.removeEventListener("resize",o)}},[e.current]),n}var WI=FI;const zr=yt(WI);function $I(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var vu=$I(p),VI=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},jI=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},k0=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=jI(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return vu.createElement("svg",VI({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),vu.createElement("path",{d:"M7,15L12,10L17,15H7Z"}))},HI=vu.memo?vu.memo(k0):k0,UI=HI;const GI=yt(UI);var on;(e=>{function t(r,o){return{x:r.x-o.x,y:r.y-o.y}}e.sub=t;function n(r,o){return{x:r.x+o.x,y:r.y+o.y}}e.add=n,e.zero={x:0,y:0}})(on||(on={}));const Qn=e=>({x:e.clientX,y:e.clientY}),jr=({onMouseMove:e,onMouseUp:t,onClick:n})=>{let r=!1;const o=a=>{r=!0,e==null||e(a)},s=a=>{t==null||t(a),r||n==null||n(a),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",s)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",s)},us=(e,{onMouseMove:t,onMouseUp:n,onClick:r})=>{let o=!1;const s=Qn(e),a=c=>{o=!0;const l=Qn(c),f=on.sub(l,s);t==null||t(c,f)},i=c=>{n==null||n(c),o||r==null||r(c),document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",i)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",i)},cr=17,XI=15,KI=cr,YI=300,qI=50,ZI=.5,Ml=20;function w0(e){return Math.max(0,Math.min(1,e))}const QI=J.div`
  box-sizing: border-box;
`,JI=J.div`
  height: 100%;
  width: 100%;
  position: absolute;
  display: flex;

  &.vertical {
    width: ${cr}px;
    height: 100%;
    position: absolute;
    top: 0;
    right: 0;
    flex-direction: column;

    .button-backward .triangle {
      transform: rotate(0deg) scale(1.1);
    }

    .button-forward .triangle {
      transform: rotate(180deg) scale(1.1);
    }
  }

  &.horizontal {
    width: 100%;
    height: ${cr}px;
    position: absolute;
    bottom: 0;
    left: 0;
    flex-direction: row;

    & > div {
      height: 100%;
    }

    .button-backward .triangle {
      transform: rotate(-90deg) scale(1.1);
    }

    .button-forward .triangle {
      transform: rotate(90deg) scale(1.1);
    }
  }

  .triangle {
    flex-grow: 1;
    pointer-events: none;
    width: 15px;
    height: 15px;
  }

  .button-backward,
  .button-forward {
    text-align: center;
    align-content: center;
    display: flex;
  }
`,eA=({isVertical:e,barLength:t,scrollOffset:n=50,contentLength:r=1e3,onScroll:o,children:s},a)=>{const i=XI,c=r-t,l=t-i*2,f=w0(t/r),d=Math.max(KI,l*f),m=c<=0;let v,_;m?(v=0,_=l):(v=Math.floor((l-d)*w0(n/c)),_=Math.floor(l-d-v));const y=e?"vertical":"horizontal",k=e?"height":"width",g=x=>o==null?void 0:o(Math.min(c,Math.max(0,x))),b=x=>w=>{if(w.stopPropagation(),m)return;const I=w.target,M=tA(w);let H=0,j=n;g(j+=x);const W=()=>document.elementFromPoint(M.x,M.y)===I,A=B=>{H=window.setInterval(()=>{clearInterval(H),W()&&(g(j+=B),H=window.setInterval(()=>{g(j+=B*ZI),W()||L()},qI))},YI)},L=()=>{clearInterval(H),H=0};A(x),jr({onMouseMove:B=>{I!==B.target&&L()},onMouseUp:()=>{L()}})},h=x=>{if(x.stopPropagation(),m)return;if(x.target.classList.contains("thumb")){const I=n;us(x.nativeEvent,{onMouseMove:(M,H)=>{const j=e?"y":"x",W=c/(l-d),A=I+H[j]*W;g(A)}})}},S=u(GI,{className:"triangle"});return G(JI,{ref:a,className:`ScrollBar ${y}`,children:[u("div",{className:"button-backward",style:{[k]:i},onMouseDown:b(-Ml),children:S}),u("div",{className:"page-backward",style:{[k]:v},onMouseDown:b(-4*Ml)}),!m&&u(QI,{className:"thumb",style:{[k]:d},onMouseDown:h}),u("div",{className:"page-forward",style:{[k]:_},onMouseDown:b(4*Ml)}),u("div",{className:"button-forward",style:{[k]:i},onMouseDown:b(Ml),children:S}),s]})},Ad=it.forwardRef(eA);function tA(e){return{x:e.pageX,y:e.pageY}}const nA=e=>{const t=p.useRef(null),n=zr(t);return u(Ad,{ref:t,isVertical:!0,...e,barLength:n.height})},rA=e=>{const t=p.useRef(null),n=zr(t);return u(Ad,{ref:t,isVertical:!1,...e,barLength:n.width})},cS=(e,t)=>e.scrollOffset===t.scrollOffset&&e.contentLength===t.contentLength&&e.onScroll===t.onScroll;it.memo(nA,cS);const oA=it.memo(rA,cS);class sA{constructor(t){this.pixelsPerTrack=t}getY(t){return t*this.pixelsPerTrack}getTrackIndex(t){return t/this.pixelsPerTrack}}const aA=64,iA=.5,cA=4,lA=e=>$c({atoms:new Set([bu,Im,Rd,pc,Em,Mm]),parentStore:e}),lS=p.createContext(null);function uA({scope:e,children:t}){const{songStore:n}=Ht(),r=On(()=>n.song.tracks.length,[n]),o=xe(Mm,{store:e});return p.useEffect(()=>{o(r)},[r,o]),u(lS.Provider,{value:e,children:t})}function As(e=p.useContext(lS)){return{get canvasHeight(){return Oe(bu,{store:e})},get contentHeight(){return Oe(Im,{store:e})},get scaleY(){return Oe(Rd,{store:e})},get scrollTop(){return Oe(pc,{store:e})},get trackHeight(){return Oe(Em,{store:e})},get transform(){return Oe(uS,{store:e})},setCanvasHeight:xe(bu,{store:e}),setScaleY:xe(dA,{store:e}),setScrollTop:xe(dS,{store:e})}}const bu=me(0),Rd=me(1),pc=me(0),Mm=me(0),Em=me(e=>aA*e(Rd)),uS=me(e=>new sA(e(Em))),Im=me(e=>{const t=e(uS),n=e(Mm);return t.getY(n)}),dS=me(null,(e,t,n)=>{const r=typeof n=="function"?n(e(pc)):n,o=e(Im)+Vt.rulerHeight+cr-e(bu);t(pc,Qe.clamp(r,0,o))}),dA=me(null,(e,t,n)=>{t(Rd,Qe.clamp(n,iA,cA)),t(dS,e(pc))}),Am=p.createContext(null);function fA({children:e}){const t=mr(),n=p.useMemo(()=>{const r=bm(t),o=lA(r),s=Cm(o),a=Sm(s);return{quantizerScope:s,tickScrollScope:r,trackScrollScope:o,beatsScope:a}},[t]);return u(Am.Provider,{value:n,children:e})}function hA({children:e}){const{tickScrollScope:t,trackScrollScope:n,quantizerScope:r,beatsScope:o}=p.useContext(Am);return u(_m,{scope:t,minScaleX:.15,maxScaleX:15,children:u(uA,{scope:n,children:u(xm,{scope:r,quantize:1,children:u(km,{scope:o,children:e})})})})}function sn(){const{tickScrollScope:e,trackScrollScope:t}=p.useContext(Am);return{get transform(){const{transform:n}=kt(e),{trackHeight:r}=As(t),o=1,s=p.useMemo(()=>new oy((r-o)/Ma,Ma),[r]);return p.useMemo(()=>new sy(n,s),[n,s])},get selectedTrackIndex(){return Oe(jf)},get selectedTrackId(){const{songStore:n}=Ht(),r=Oe(jf);return On(()=>{var o;return(o=n.song.tracks[r])==null?void 0:o.id},[n,r])},get selection(){return Oe(mc)},get trackTransform(){const{transform:n}=kt(e),{transform:r}=As(t);return p.useMemo(()=>new o8(n,r),[n,r])},get openTransposeDialog(){return Oe(x0)},get openVelocityDialog(){return Oe(C0)},get scrollBy(){const{setScrollLeftInPixels:n}=kt(e),{setScrollTop:r}=As(t);return p.useCallback((o,s)=>{n(a=>a-o),r(a=>a-s)},[n,r])},setSelectedTrackIndex:xe(jf),setSelection:xe(mc),resetSelection:xe(pA),setOpenTransposeDialog:xe(x0),setOpenVelocityDialog:xe(C0),serializeState:xe(mA),restoreState:xe(gA)}}const mc=me(null),jf=me(0),x0=me(!1),C0=me(!1),pA=me(null,(e,t)=>{t(mc,null)}),mA=me(null,e=>({selection:Qe.cloneDeep(e(mc))})),gA=me(null,(e,t,{selection:n})=>{t(mc,n)}),vA=(e,t)=>new bA(e,t);class bA{constructor(t,n){ee(this,"firestore");ee(this,"functions");this.firestore=t,this.functions=n}async get(t){var s;const n=n4(this.firestore,"midis"),o=(s=(await r4(o4(n,t).withConverter(_A))).data())==null?void 0:s.data;if(o===void 0)throw new Error("Midi data does not exist");return o.toUint8Array()}async storeMidiFile(t){return(await s4(this.functions,"storeMidiFile")({midiFileUrl:t})).data.docId}}const _A={fromFirestore(e,t){return e.data(t)},toFirestore(e){return e}},Js=D4(dd,Ja),pi=N4(dd,Ja),T0=vA(dd,p4),Rm=B4(dd,Ja);class yA{constructor(t){ee(this,"authUser",null);ee(this,"user",null);this.userRepository=t,Vr(this,{authUser:Dt,user:Dt});let n=null;try{t.observeAuthUser(async r=>{this.authUser=r,$n()&&window.electronAPI.authStateChanged(r!==null),n==null||n(),r!==null&&(n=t.observeCurrentUser(o=>{this.user=o}),await this.createProfileIfNeeded(r))})}catch(r){console.warn(r)}}async createProfileIfNeeded(t){if(await this.userRepository.getCurrentUser()===null){const r={name:t.displayName??"",bio:""};await this.userRepository.create(r)}}get isLoggedIn(){return this.authUser!==null}}const fS=p.createContext(null);function SA({children:e}){const t=p.useMemo(()=>new yA(Rm),[]);return u(fS.Provider,{value:t,children:e})}function Gc(){const e=p.useContext(fS);return{get authUser(){return bt(e,"authUser")},get user(){return bt(e,"user")},get isLoggedIn(){return bt(e,"isLoggedIn")},signOut:p.useCallback(async()=>{await Ja.signOut()},[])}}function M0(){return typeof process<"u"&&!1}function hS(e){const t=me(()=>[]),n=me(function(o){const[s,a,i]=o(t);i.has(n)&&(s.forEach(o),++a.n)});return n.effect=e,n.unstable_onInit=r=>{const o=new Set;let s=0,a=!1,i=!1,c=!1,l;function f(){if(s)return;o.clear();let H=!0;const j=A=>{var B;if(c)return r.get(A);if(A===n){const P=y(r,A);if(!qh(P))if(Jl(A))w(r,A,A.init);else throw new Error("no atom init");return Ba(P)}const L=b(r,A);try{return Ba(L)}finally{M.d.set(A,L.n),(B=m.get(A))==null||B.t.add(n),H?o.add(A):m.has(A)&&(x(r,n),g(r),k(r))}};j.peek=r.get;const W=(A,...L)=>{var P;const B=y(r,A);try{if(++s,A===n){if(!Jl(A))throw new Error("atom not writable");const V=B.n,U=L[0];w(r,A,U),x(r,A),V!==B.n&&(v.add(A),(P=_.c)==null||P.call(_,A),h(r,A));return}else return S(r,A,...L)}finally{H||(g(r),k(r)),--s}};W.recurse=(A,...L)=>{if(c){if(M0())throw new Error("set.recurse is not allowed in cleanup");return}try{return a=!0,x(r,n),W(A,...L)}finally{g(r),a=!1,i&&(i=!1,f())}};try{l==null||l();const A=n.effect(j,W);if(typeof A!="function")return;l=()=>{if(!s)try{return H=!0,c=!0,A()}finally{H=!1,c=!1,l=void 0}}}finally{H=!1,o.forEach(A=>{M.d.set(A,y(r,A).n)}),x(r,n),g(r)}}const d=ey(r),m=d[1],v=d[3],_=N6(d[6]),y=d[11],k=d[12],g=d[13],b=d[14],h=d[15],S=d[16],x=d[17],w=d[20],I=kA(r,_),M=y(r,n);M.v=void 0,Object.assign(r.get(t),[o,M,m]),_.m.add(n,function(){I.add(f),l&&I.delete(l)}),_.u.add(n,function(){I.delete(f),l&&I.add(l)}),_.c.add(n,function(){a?i=!0:I.add(f)})},M0()&&(Object.defineProperty(t,"debugLabel",{get:()=>n.debugLabel?`${n.debugLabel}:ref`:void 0,configurable:!0,enumerable:!0}),t.debugPrivate=!0),n}const E0=new WeakMap;function kA(e,t){let n=E0.get(e);return n||(n=new Set,E0.set(e,n),t.f.add(function(){for(const o of n)n.delete(o),o()})),n}const pS=e=>t=>{const n=new Set(t);return n.delete(e),n},mS=e=>t=>{const n=new Set(t);return n.add(e),n};class gS{constructor(t){ee(this,"startTick",0);ee(this,"endTick",0);ee(this,"listeners",new Set);ee(this,"unregisterReaction",null);ee(this,"registerReaction",()=>{var t;(t=this.unregisterReaction)==null||t.call(this),this.unregisterReaction=ba(this,"windowedEvents",this.notifyListeners)});ee(this,"setRange",(t,n)=>{this.startTick===t&&this.endTick===n||(this.startTick=t,this.endTick=n)});ee(this,"getEvents",()=>this.windowedEvents);ee(this,"subscribe",t=>(this.listeners.add(t),this.listeners.size===1&&this.registerReaction(),()=>{var n;this.listeners.delete(t),this.listeners.size===0&&((n=this.unregisterReaction)==null||n.call(this),this.unregisterReaction=null)}));ee(this,"notifyListeners",()=>{this.listeners.forEach(t=>t())});this.loadEvents=t,Vr(this,{startTick:Dt,endTick:Dt,windowedEvents:yr({keepAlive:!1})})}dispose(){var t;(t=this.unregisterReaction)==null||t.call(this),this.unregisterReaction=null,this.listeners.clear()}[Symbol.dispose](){this.dispose()}get windowedEvents(){const t=Ft.create(this.startTick,this.endTick);return this.loadEvents().filter(n=>"duration"in n&&typeof n.duration=="number"?Ft.intersects(t,Ft.fromLength(n.tick,n.tick+n.duration)):Ft.contains(t,n.tick))}}function vS(e){const t=p.useRef(null),n=p.useMemo(()=>{var o;(o=t.current)==null||o.dispose();const r=e();return t.current=r,r},[e]);return p.useEffect(()=>()=>{t.current&&(t.current.dispose(),t.current=null)},[]),n}const bS=p.createContext(null);function Om(e){const{canvasWidth:t,scrollLeft:n,transform:r}=kt(),o=r.getTick(n),s=r.getTick(n+t);p.useEffect(()=>{e.setRange(o,s)},[e,o,s])}function _S(e){const{songStore:t}=Ht(),n=p.useCallback(()=>new gS(()=>{var r;return ks((r=t.song.getTrack(e))==null?void 0:r.events)??[]}),[t,e]);return vS(n)}function wA({trackId:e,children:t}){const n=_S(e);return Om(n),u(bS.Provider,{value:n,children:t})}function Od(e=p.useContext(bS)){return p.useSyncExternalStore(e.subscribe,e.getEvents)}const xA=.5,CA=4;function vo(){return{get contentHeight(){return Oe(TA)},get scrollTop(){return Oe(vc)},get scrollTopKeys(){return Oe(gc)},get scaleY(){return Oe(_u)},get canvasHeight(){return Oe(ip)},get transform(){return Oe(Ha)},setScrollTopInPixels:xe(vc),setScrollTopInKeys:xe(gc),setCanvasHeight:xe(ip),setScaleY:xe(_u),scaleAroundPointY:xe(MA)}}const ip=me(0),_u=me(1),gc=me(70),Ha=me(e=>new oy(Vt.keyHeight*e(_u),127)),vc=me(e=>Math.round(e(Ha).getY(e(gc))),(e,t,n)=>{const r=typeof n=="function"?n(e(vc)):n,o=e(Ha),s=e(ip),a=o.getMaxY()-s,i=Qe.clamp(r,0,a);t(gc,o.getNoteNumberFractional(i))}),TA=me(e=>e(Ha).getMaxY()),MA=me(null,(e,t,n,r)=>{const o=e(Ha),s=e(vc),a=o.getNoteNumberFractional(s+r);t(_u,d=>Qe.clamp(d*(1+n),xA,CA));const i=e(Ha),c=e(vc),f=i.getNoteNumberFractional(c+r)-a;t(gc,d=>d-f)}),Xc=p.createContext(null);function EA({children:e}){const t=mr(),n=p.useMemo(()=>{const r=bm(t),o=Cm(r),s=Sm(o);return{quantizerScope:o,tickScrollScope:r,beatsScope:s}},[t]);return u(Xc.Provider,{value:n,children:u(IA,{children:e})})}function IA({children:e}){const{songStore:t,midiInput:n,midiMonitor:r,midiRecorder:o}=Ht(),s=mr(),{addPreviewingNoteNumbers:a,removePreviewingNoteNumbers:i,selectedTrack:c,selectedTrackId:l,setSelectedTrackId:f}=Me();return em(WA,{store:s}),p.useEffect(()=>{var d;f(((d=t.song.tracks.find(m=>!m.isConductorTrack))==null?void 0:d.id)??Vs)},[f,t]),p.useEffect(()=>n.on("midiMessage",d=>{const m=new Bp(d.data),v=Dp(m);v.type==="channel"&&(v.subtype==="noteOn"?a(v.noteNumber):v.subtype==="noteOff"&&i(v.noteNumber))}),[n,a,i]),p.useEffect(()=>{r.channel=(c==null?void 0:c.channel)??0},[r,c]),p.useEffect(()=>{o.trackId=l??Vs},[o,l]),e}function AA({children:e}){const{quantizerScope:t,tickScrollScope:n,beatsScope:r}=p.useContext(Xc),{selectedTrackId:o}=Me();return u(_m,{scope:n,minScaleX:.15,maxScaleX:15,children:u(wA,{trackId:o,children:u(xm,{scope:t,quantize:8,children:u(km,{scope:r,children:e})})})})}function Me(){const{songStore:e}=Ht(),{tickScrollScope:t}=p.useContext(Xc),n=mr();return{get notGhostTrackIds(){return Oe(Hf,{store:n})},get mouseMode(){return Oe(yu,{store:n})},get keySignature(){return Oe(R0,{store:n})},get selection(){return Oe(Us,{store:n})},get selectedTrack(){const r=Oe(Kr,{store:n});return On(()=>e.song.getTrack(r),[e,r])},get selectedTrackId(){return Oe(Kr,{store:n})},get selectedTrackIndex(){const r=Oe(Kr,{store:n});return On(()=>e.song.tracks.findIndex(o=>o.id===r),[e,r])},get selectedNoteIds(){return Oe(Gs,{store:n})},get transform(){const{transform:r}=kt(t),{transform:o}=vo();return p.useMemo(()=>new sy(r,o),[r,o])},get ghostTrackIds(){const r=Oe(Hf,{store:n}),o=Oe(Kr,{store:n}),s=On(()=>e.song.tracks.map(a=>a.id),[e.song.tracks],Qe.isEqual);return p.useMemo(()=>s.filter(a=>!r.has(a)&&a!==o),[s,r,o])},get previewingNoteNumbers(){return Oe(Pm,{store:n})},get openTransposeDialog(){return Oe(O0,{store:n})},get openVelocityDialog(){return Oe(P0,{store:n})},get newNoteVelocity(){return Oe(A0,{store:n})},get lastNoteDuration(){return Oe(I0,{store:n})},get activePane(){return Oe(B0,{store:n})},resetSelection:xe(OA,{store:n}),get scrollBy(){const{setScrollLeftInPixels:r}=kt(t),{setScrollTopInPixels:o}=vo();return p.useCallback((s,a)=>{r(i=>i-s),o(i=>i-a)},[r,o])},setNotGhostTrackIds:xe(Hf,{store:n}),setOpenTransposeDialog:xe(O0,{store:n}),setOpenVelocityDialog:xe(P0,{store:n}),setKeySignature:xe(R0,{store:n}),setMouseMode:xe(yu,{store:n}),addPreviewingNoteNumbers:xe(PA,{store:n}),removePreviewingNoteNumbers:xe(BA,{store:n}),setSelection:xe(Us,{store:n}),setSelectedTrackId:xe(Kr,{store:n}),setSelectedTrackIndex:Qo(p.useCallback((r,o,s)=>{var a;return o(Kr,(a=e.song.tracks[s])==null?void 0:a.id)},[e.song.tracks]),{store:n}),setSelectedNoteIds:xe(Gs,{store:n}),get getLocal(){const{scrollLeft:r}=kt(),{scrollTop:o}=vo();return p.useCallback(s=>({x:s.offsetX+r,y:s.offsetY+o}),[r,o])},getSelection:xe(DA,{store:n}),getSelectedTrack:Qo(p.useCallback(r=>{const o=r(Kr);return e.song.getTrack(o)},[e]),{store:n}),getSelectedNoteIds:xe(NA,{store:n}),setLastNoteDuration:xe(I0,{store:n}),toggleTool:xe(LA,{store:n}),setNewNoteVelocity:xe(A0,{store:n}),setActivePane:xe(B0,{store:n}),serializeState:xe(zA,{store:n}),restoreState:xe(FA,{store:n})}}function Pd(){const{tickScrollScope:e}=p.useContext(Xc);return kt(e)}function RA(){const{quantizerScope:e}=p.useContext(Xc);return Nn(e)}const yu=me("pencil"),Kr=me(Vs),Us=me(null),Gs=me([]),I0=me(null),Hf=me(new Set),A0=me(100),R0=me(null),O0=me(!1),P0=me(!1),Pm=me(new Set),B0=me(null),OA=me(null,(e,t)=>{t(Us,null),t(Gs,[])}),PA=me(null,(e,t,n)=>t(Pm,mS(n))),BA=me(null,(e,t,n)=>t(Pm,pS(n))),DA=me(null,e=>e(Us)),NA=me(null,e=>e(Gs)),LA=me(null,(e,t)=>t(yu,n=>n==="pencil"?"selection":"pencil")),zA=me(null,e=>({selection:Qe.cloneDeep(e(Us)),selectedNoteIds:Qe.cloneDeep(e(Gs)),selectedTrackId:e(Kr)})),FA=me(null,(e,t,{selection:n,selectedNoteIds:r,selectedTrackId:o})=>{t(Us,n),t(Gs,r),t(Kr,o)}),WA=hS((e,t)=>{e(Kr),e(yu),t(Us,null),t(Gs,[])});class $A{constructor(t,n,r=320){this.tickTransform=t,this.height=n,this.maxBPM=r}getX(t){return this.tickTransform.getX(t)}getY(t){return(1-t/this.maxBPM)*this.height}getMaxY(){return this.height}getTick(t){return this.tickTransform.getTick(t)}getBPM(t){return(1-t/this.height)*this.maxBPM}getDeltaBPM(t){return-t/this.height*this.maxBPM}fromPosition(t){return{tick:this.getTick(t.x),bpm:this.getBPM(t.y)}}}const Bm=p.createContext(null);function VA({children:e}){const t=mr(),n=p.useMemo(()=>{const r=bm(t),o=Cm(r),s=Sm(o);return{tickScrollScope:r,quantizerScope:o,beatsScope:s}},[t]);return u(Bm.Provider,{value:n,children:e})}function jA({children:e}){const{tickScrollScope:t,quantizerScope:n,beatsScope:r}=p.useContext(Bm);return u(_m,{scope:t,minScaleX:.15,maxScaleX:15,children:u(xm,{scope:n,quantize:4,children:u(km,{scope:r,children:e})})})}function Jn(){const{tickScrollScope:e}=p.useContext(Bm);return{get selection(){return Oe(cp)},get transform(){const{transform:t}=kt(),n=Oe(D0);return p.useMemo(()=>new $A(t,n),[t,n])},get selectedEventIds(){return Oe(lp)},get mouseMode(){return Oe(N0)},get getLocal(){const{scrollLeft:t}=kt(e);return p.useCallback(n=>({x:n.offsetX+t,y:n.offsetY}),[t])},setSelection:xe(cp),setSelectedEventIds:xe(lp),setMouseMode:xe(N0),setCanvasHeight:xe(D0),resetSelection:xe(HA)}}const D0=me(0),N0=me("pencil"),cp=me(null),lp=me([]),HA=me(null,(e,t)=>{t(cp,null),t(lp,[])}),UA=(e,t,n)=>{e=e.sort((s,a)=>s.tick-a.tick);let r={tick:0,bpm:120,timestamp:0};const o=[];for(const s of e){const a=L4(s.tick-r.tick,r.bpm,t)+r.timestamp,i=a/1e3*n;switch(s.type){case"channel":o.push({type:"midi",midi:s,delayTime:i});case"meta":switch(s.subtype){case"setTempo":r={tick:s.tick,bpm:60*1e6/s.microsecondsPerBeat,timestamp:a};break}}}return o},GA=async(e,t,n,r,o)=>{const s=z4(new Uint8Array(e)),a=UA(t,n,r),i=s.map(l=>l.event),c=await F4(i,a,{sampleRate:r,bufferSize:o.bufferSize,cancel:o.cancel,waitForEventLoop:o.waitForEventLoop,onProgress:o.onProgress});return W4(c)},yS=99999;class XA{constructor(t){this.songStore=t}get timebase(){return this.songStore.song.timebase}get endOfSong(){return this.songStore.song.endOfSong}getEvents(t,n){const{song:r}=this.songStore,o=Ft.create(t,n),s=ou.createInRange(r.measures,r.timebase,o).filter(js(o)).flatMap(a=>KA(a));return r.allEvents.filter(js(o)).concat(s)}getCurrentStateEvents(t){return this.songStore.song.tracks.flatMap(n=>{const r=Y9(n.events,t);return My(r,n.channel,n.id)})}}function KA(e){const t=e.beat===0?100:70,n=e.beat===0?76:77;return[{...am(0,9,n,t),tick:e.tick,trackId:yS}]}function YA(e){return btoa(String.fromCharCode(...e))}function qA(e){const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}const Oi="signal_autosave",Uf="signal_autosave_flag",ZA=1e4;class QA{constructor(t){ee(this,"intervalId",null);ee(this,"shouldOfferRestore",!1);ee(this,"startAutoSave",()=>{this.intervalId&&clearInterval(this.intervalId),this.intervalId=setInterval(()=>{try{const t=this.songStore.song;t&&!t.isSaved&&this.save(t)}catch(t){console.warn("Auto save failed:",t)}},ZA)});ee(this,"stopAutoSave",()=>{this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)});ee(this,"hasAutoSavedSong",()=>localStorage.getItem(Oi)!==null);ee(this,"restore",()=>{try{const t=localStorage.getItem(Oi);if(!t)return null;const n=JSON.parse(t),r=qA(n.midiData);return Md(r)}catch(t){return console.warn("Failed to restore auto saved song:",t),null}});ee(this,"getLastSaveTime",()=>{try{const t=localStorage.getItem(Oi);if(!t)return null;const n=JSON.parse(t);return new Date(n.timestamp)}catch{return null}});ee(this,"clearAutoSave",()=>{localStorage.removeItem(Oi)});ee(this,"getShouldOfferRestore",()=>localStorage.getItem(Uf)==="true");ee(this,"setShouldOfferRestore",t=>{this.shouldOfferRestore=t,t?localStorage.setItem(Uf,"true"):localStorage.removeItem(Uf)});ee(this,"onUserExplicitAction",()=>{this.setShouldOfferRestore(!1),this.clearAutoSave()});ee(this,"onSongChanged",()=>{this.shouldOfferRestore||this.setShouldOfferRestore(!0)});this.songStore=t,this.shouldOfferRestore=this.getShouldOfferRestore()}save(t){try{const n=rs(t),o={midiData:YA(n),timestamp:Date.now()};localStorage.setItem(Oi,JSON.stringify(o)),console.debug("Auto saved song")}catch(n){console.warn("Failed to auto save song:",n)}}}var wn;(e=>{e.empty={mutes:{},solos:{}};const t=(a,i)=>c=>s(c)?c:{...c,mutes:{...c.mutes,[a]:i}},n=a=>i=>i.mutes[a]||!1,r=(a,i)=>c=>({...c,solos:{...c.solos,[a]:i}}),o=a=>i=>i.solos[a]||!1;function s(a){return Object.values(a.solos).some(i=>i)}e.isSoloMode=s,e.isSolo=a=>i=>s(i)&&i.solos[a],e.isMuted=a=>i=>!(0,e.shouldPlayTrack)(a)(i),e.mute=a=>t(a,!0),e.unmute=a=>t(a,!1),e.solo=a=>r(a,!0),e.unsolo=a=>r(a,!1),e.shouldPlayTrack=a=>i=>s(i)?o(a)(i):!n(a)(i)})(wn||(wn={}));class JA{constructor(t){ee(this,"outputs",[]);ee(this,"isMetronomeEnabled",!1);ee(this,"trackMute",wn.empty);this.metronomeOutput=t,Vr(this,{isMetronomeEnabled:Dt})}activate(){this.outputs.filter(t=>t.isEnabled).forEach(t=>t.synth.activate())}getOutputs(t){return t===yS?this.isMetronomeEnabled?[this.metronomeOutput]:[]:t!==void 0&&!wn.shouldPlayTrack(t)(this.trackMute)?[]:this.outputs.filter(n=>n.isEnabled).map(n=>n.synth)}sendEvent(t,n,r,o){this.getOutputs(o).forEach(s=>s.sendEvent(t,n,r,o))}}class eR{constructor(){ee(this,"devices",[]);ee(this,"listeners",[]);ee(this,"removeAllDevices",()=>{this.devices.forEach(this.removeDevice)});ee(this,"removeDevice",t=>{t.removeEventListener("midimessage",this.onMidiMessage),this.devices=this.devices.filter(n=>n.id!==t.id)});ee(this,"addDevice",t=>{t.addEventListener("midimessage",this.onMidiMessage),this.devices.push(t)});ee(this,"onMidiMessage",t=>{this.listeners.forEach(n=>n(t))})}on(t,n){return this.listeners.push(n),()=>{this.off(t,n)}}off(t,n){this.listeners=this.listeners.filter(r=>r!==n)}}class tR{constructor(t){ee(this,"channel",0);this.player=t}onMessage(t){const n=new Bp(t.data),r=Dp(n);r.type==="channel"&&(r.channel=this.channel,this.player.sendEvent(r))}}class nR{constructor(t,n){ee(this,"recordedNotes",[]);ee(this,"trackId",Vs);ee(this,"isRecording",!1);this.songStore=t,this.player=n,Vr(this,{isRecording:Dt}),ba(n,"position",r=>{if(!this.isRecording)return;const o=this.songStore.song.getTrack(this.trackId);if(o===void 0)return;const s=r.object.get();this.recordedNotes.forEach(a=>{o.updateEvent(a.id,{duration:Math.max(0,s-a.tick)})})}),ba(this,"isRecording",r=>{this.recordedNotes=[],r.newValue||this.songStore.song.tracks.forEach(o=>{const s=o.events.filter(a=>a.isRecording===!0).map(a=>({...a,isRecording:!1}));o.updateEvents(s)})})}onMessage(t){if(!this.isRecording)return;const n=this.songStore.song.getTrack(this.trackId);if(n===void 0)return;const r=new Bp(t.data),o=Dp(r);if(o.type!=="channel")return;const s=this.player.position;switch(o.subtype){case"noteOn":{const a=n.addEvent({type:"channel",subtype:"note",noteNumber:o.noteNumber,tick:s,velocity:o.velocity,duration:0,isRecording:!0});this.recordedNotes.push(a);break}case"noteOff":{this.recordedNotes.filter(a=>a.noteNumber===o.noteNumber).forEach(a=>{n.updateEvent(a.id,{duration:Math.max(0,s-a.tick)})}),this.recordedNotes=this.recordedNotes.filter(a=>a.noteNumber!==o.noteNumber);break}default:{n.addEvent({...o,tick:s,isRecording:!0});break}}}}var Dm=new Map,ra={},rR={},oR=function(e){return new Date().getTime()+e},sR=function(e){var t=new Date().getTime(),n=new Date(e).getTime();return n<=t},aR=function(e){return!!e&&Array.isArray(e)===!1&&typeof e=="object"},iR=function(e,t){},cR=function(e,t){},lR=function(e,t){},uR=function(e,t){},Do=function(e,t,n){},dR=function(e){return Array.isArray(e)?e.every(function(t){return Array.isArray(t)}):!1},fR=function(e){return Array.isArray(e)},hR=function(e,t){return Object.keys(e).forEach(function(n){return t(e[n])&&delete e[n]}),e},Gf=function(e,t,n,r){function o(s){return s instanceof n?s:new n(function(a){a(s)})}return new(n||(n=Promise))(function(s,a){function i(f){try{l(r.next(f))}catch(d){a(d)}}function c(f){try{l(r.throw(f))}catch(d){a(d)}}function l(f){f.done?s(f.value):o(f.value).then(i,c)}l((r=r.apply(e,t||[])).next())})},Xf=function(e,t){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,o,s,a;return a={next:i(0),throw:i(1),return:i(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function i(l){return function(f){return c([l,f])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(n=0)),n;)try{if(r=1,o&&(s=l[0]&2?o.return:l[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,l[1])).done)return s;switch(o=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,o=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=t.call(e,n)}catch(f){l=[6,f],o=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},pR=function(){function e(t){this.options=t}return e.prototype.setItem=function(t,n){var r;return Gf(this,void 0,void 0,function(){var o,s,a,i,c,l;return Xf(this,function(f){switch(f.label){case 0:return o=this.options,s=o.stringify,a=s===void 0?!0:s,o.debugMode,i=hR({expireInTimestamp:this.options.expireIn?oR(this.options.expireIn):void 0,version:this.options.version},function(d){return d===void 0}),c=Object.keys(i).length?Object.assign({},n,{__mps__:i}):n,l=a?JSON.stringify(c):c,[4,(r=this.options.storage)===null||r===void 0?void 0:r.setItem(t,l)];case 1:return f.sent(),[2]}})})},e.prototype.getItem=function(t){var n,r,o;return Gf(this,void 0,void 0,function(){var s,a,i,c,l,f,d,m;return Xf(this,function(v){switch(v.label){case 0:return s=this.options,a=s.removeOnExpiration,i=a===void 0?!0:a,s.debugMode,c=s.version,[4,(n=this.options.storage)===null||n===void 0?void 0:n.getItem(t)];case 1:l=v.sent();try{f=JSON.parse(l)||{}}catch{f=l||{}}return d=sR((r=f.__mps__)===null||r===void 0?void 0:r.expireInTimestamp),m=c&&((o=f.__mps__)===null||o===void 0?void 0:o.version)!==c,d&&i||m?[4,this.removeItem(t)]:[3,3];case 2:v.sent(),v.label=3;case 3:return f=d||m?{}:f,[2,f]}})})},e.prototype.removeItem=function(t){var n;return Gf(this,void 0,void 0,function(){return Xf(this,function(r){switch(r.label){case 0:return this.options.debugMode,[4,(n=this.options.storage)===null||n===void 0?void 0:n.removeItem(t)];case 1:return r.sent(),[2]}})})},e}(),mR=function(e){var t=["key","serialize","deserialize"];return aR(e)?t.every(function(n){return!!(e.hasOwnProperty(n)&&typeof n<"u")}):!1},gR=function(e){return e.reduce(function(t,n){return typeof n=="string"?(t.push({key:n,serialize:function(r){return r},deserialize:function(r){return r}}),t):(mR(n)&&t.push(n),t)},[])},Pi=function(e,t,n,r){function o(s){return s instanceof n?s:new n(function(a){a(s)})}return new(n||(n=Promise))(function(s,a){function i(f){try{l(r.next(f))}catch(d){a(d)}}function c(f){try{l(r.throw(f))}catch(d){a(d)}}function l(f){f.done?s(f.value):o(f.value).then(i,c)}l((r=r.apply(e,t||[])).next())})},Bi=function(e,t){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,o,s,a;return a={next:i(0),throw:i(1),return:i(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function i(l){return function(f){return c([l,f])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(n=0)),n;)try{if(r=1,o&&(s=l[0]&2?o.return:l[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,l[1])).done)return s;switch(o=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,o=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=t.call(e,n)}catch(f){l=[6,f],o=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},vR=function(){function e(t,n,r){r===void 0&&(r={});var o,s,a,i,c,l,f,d;this.cancelWatch=null,this.properties=[],this.reactionOptions={},this.storageAdapter=null,this.target=null,this.version=void 0,this.debugMode=!1,this.isHydrated=!1,this.isPersisting=!1,this.storageName="",this.target=t,this.storageName=n.name,this.version=(o=n.version)!==null&&o!==void 0?o:ra.version,this.properties=gR(n.properties),this.reactionOptions=Object.assign({fireImmediately:!0},rR,r),this.debugMode=(a=(s=n.debugMode)!==null&&s!==void 0?s:ra.debugMode)!==null&&a!==void 0?a:!1,this.storageAdapter=new pR({version:this.version,expireIn:(i=n.expireIn)!==null&&i!==void 0?i:ra.expireIn,removeOnExpiration:(l=(c=n.removeOnExpiration)!==null&&c!==void 0?c:ra.removeOnExpiration)!==null&&l!==void 0?l:!0,stringify:(d=(f=n.stringify)!==null&&f!==void 0?f:ra.stringify)!==null&&d!==void 0?d:!0,storage:n.storage?n.storage:ra.storage,debugMode:this.debugMode}),Vr(this,{clearPersistedStore:Rn,hydrateStore:Rn,isHydrated:Dt,isPersisting:Dt,pausePersisting:Rn,startPersisting:Rn,stopPersisting:Rn},{autoBind:!0,deep:!1}),iR(this.storageAdapter.options.storage,this.storageName),Do(this.debugMode,"".concat(this.storageName," - (makePersistable)"),{properties:this.properties,storageAdapter:this.storageAdapter,reactionOptions:this.reactionOptions})}return e.prototype.init=function(){return Pi(this,void 0,void 0,function(){return Bi(this,function(t){switch(t.label){case 0:return[4,this.hydrateStore()];case 1:return t.sent(),this.startPersisting(),[2,this]}})})},e.prototype.hydrateStore=function(){return Pi(this,void 0,void 0,function(){var t,n,r,o=this;return Bi(this,function(s){switch(s.label){case 0:return t=!!this.cancelWatch,this.isPersisting&&this.pausePersisting(),Tf(function(){o.isHydrated=!1,Do(o.debugMode,"".concat(o.storageName," - (hydrateStore) isHydrated:"),o.isHydrated)}),this.storageAdapter&&this.target?[4,this.storageAdapter.getItem(this.storageName)]:[3,2];case 1:n=s.sent(),r=this.target,n&&Tf(function(){o.properties.forEach(function(a){var i=[a.key in r,typeof n[a.key]<"u"].every(Boolean);if(i){var c=n[a.key];r[a.key]instanceof ag&&dR(c)?r[a.key]=a.deserialize(new Map(c)):r[a.key]instanceof ig&&fR(c)?r[a.key]=a.deserialize(new Set(c)):r[a.key]=a.deserialize(c)}})}),s.label=2;case 2:return Tf(function(){o.isHydrated=!0,Do(o.debugMode,"".concat(o.storageName," - isHydrated:"),o.isHydrated)}),t&&this.startPersisting(),[2]}})})},e.prototype.startPersisting=function(){var t=this;if(!(!this.storageAdapter||!this.target||this.cancelWatch)){var n=this.target;this.cancelWatch=ud(function(){var r={};return t.properties.forEach(function(o){var s=a4(n,o.key),a=i4(n[o.key]);if(lR(s,String(o.key)),uR(a,String(o.key)),!s&&!a){var i=o.serialize(n[o.key]);if(i instanceof ag){var c=[];i.forEach(function(l,f){c.push([f,ks(l)])}),i=c}else i instanceof ig&&(i=Array.from(i).map(ks));r[o.key]=ks(i)}}),r},function(r){return Pi(t,void 0,void 0,function(){return Bi(this,function(o){switch(o.label){case 0:return this.storageAdapter?[4,this.storageAdapter.setItem(this.storageName,r)]:[3,2];case 1:o.sent(),o.label=2;case 2:return[2]}})})},this.reactionOptions),this.isPersisting=!0,Do(this.debugMode,"".concat(this.storageName," - (startPersisting) isPersisting:"),this.isPersisting)}},e.prototype.pausePersisting=function(){this.isPersisting=!1,Do(this.debugMode,"".concat(this.storageName," - pausePersisting (isPersisting):"),this.isPersisting),this.cancelWatch&&(this.cancelWatch(),this.cancelWatch=null)},e.prototype.stopPersisting=function(){this.pausePersisting(),Do(this.debugMode,"".concat(this.storageName," - (stopPersisting)")),Dm.delete(this.target),this.cancelWatch=null,this.properties=[],this.reactionOptions={},this.storageAdapter=null,this.target=null},e.prototype.clearPersistedStore=function(){return Pi(this,void 0,void 0,function(){return Bi(this,function(t){switch(t.label){case 0:return this.storageAdapter?(Do(this.debugMode,"".concat(this.storageName," - (clearPersistedStore)")),[4,this.storageAdapter.removeItem(this.storageName)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},e.prototype.getPersistedStore=function(){return Pi(this,void 0,void 0,function(){return Bi(this,function(t){return this.storageAdapter?(Do(this.debugMode,"".concat(this.storageName," - (getPersistedStore)")),[2,this.storageAdapter.getItem(this.storageName)]):[2,null]})})},e}(),bR=function(e,t,n,r){function o(s){return s instanceof n?s:new n(function(a){a(s)})}return new(n||(n=Promise))(function(s,a){function i(f){try{l(r.next(f))}catch(d){a(d)}}function c(f){try{l(r.throw(f))}catch(d){a(d)}}function l(f){f.done?s(f.value):o(f.value).then(i,c)}l((r=r.apply(e,[])).next())})},_R=function(e,t){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,o,s,a;return a={next:i(0),throw:i(1),return:i(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function i(l){return function(f){return c([l,f])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(n=0)),n;)try{if(r=1,o&&(s=l[0]&2?o.return:l[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,l[1])).done)return s;switch(o=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,o=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=t.call(e,n)}catch(f){l=[6,f],o=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},yR=function(e,t){Dm.set(e,t)},SS=function(e,t,n){return bR(void 0,void 0,void 0,function(){var r,o;return _R(this,function(s){return r=new vR(e,t,n),o=Array.from(Dm.values()).map(function(a){return a.storageName}).includes(r.storageName),cR(o,r.storageName),yR(e,r),[2,r.init()]})})};class SR{constructor(){ee(this,"inputs",[]);ee(this,"outputs",[]);ee(this,"requestError",null);ee(this,"isLoading",!1);ee(this,"enabledOutputs",{});ee(this,"enabledInputs",{});ee(this,"isFactorySoundEnabled",!0);ee(this,"requestMIDIAccess",async()=>{if(this.isLoading=!0,this.inputs=[],this.outputs=[],navigator.requestMIDIAccess===void 0){this.isLoading=!1,this.requestError=new Error("Web MIDI API is not supported by your browser");return}try{const t=await navigator.requestMIDIAccess({sysex:!0});this.updatePorts(t),t.onstatechange=()=>{this.updatePorts(t)}}catch(t){this.requestError=t}finally{this.isLoading=!1}});ee(this,"setInputEnable",(t,n)=>{this.enabledInputs={...this.enabledInputs,[t]:n}});ee(this,"setOutputEnable",(t,n)=>{this.enabledOutputs={...this.enabledOutputs,[t]:n}});Vr(this,{inputs:Dt,outputs:Dt,requestError:Dt,isLoading:Dt,enabledOutputs:Dt,enabledInputs:Dt,isFactorySoundEnabled:Dt,setInputEnable:Rn,setOutputEnable:Rn}),SS(this,{name:"MIDIDeviceStore",properties:["isFactorySoundEnabled","enabledOutputs","enabledInputs"],storage:window.localStorage}),this.requestMIDIAccess()}updatePorts(t){this.inputs=Array.from(t.inputs.values()),this.outputs=Array.from(t.outputs.values())}}class kR{constructor(t){ee(this,"midiOutput");this.midiOutput=t}activate(){this.midiOutput.open()}sendEvent(t,n,r){const o=$4({...t}),s=n*1e3+r;if(this.midiOutput.state==="connected")try{this.midiOutput.send(o,s)}catch(a){console.warn(a)}}}const wR=e=>{ba(e.midiDeviceStore,"enabledOutputs",L0(e)),cg(xR(e)),cg(L0(e)),ba(e.midiRecorder,"isRecording",CR(e)),ba(e.player,"isPlaying",TR(e)),ud(()=>e.songStore.song.isSaved,t=>{t||e.autoSaveService.onSongChanged()})},L0=({midiDeviceStore:e,player:t,synth:n,synthGroup:r})=>()=>{const{outputs:o,enabledOutputs:s,isFactorySoundEnabled:a}=e;t.allSoundsOff();const i=o.map(c=>({synth:new kR(c),isEnabled:s[c.id]}));r.outputs=[{synth:n,isEnabled:a},...i]},xR=({midiDeviceStore:e,midiInput:t})=>()=>{const{inputs:n,enabledInputs:r}=e,o=n.filter(s=>r[s.id]);t.removeAllDevices(),o.forEach(t.addDevice)},CR=({player:e,midiRecorder:t})=>()=>e.disableSeek=t.isRecording,TR=({player:e,midiRecorder:t})=>()=>{e.isPlaying||(t.isRecording=!1)};class MR{constructor(){ee(this,"song",gm());Vr(this,{song:Dt.ref})}serialize(){return this.song.serialize()}}function Nm(e){return e.split("/").pop()}const No="files",oa="catalog",z0=0;class ER{constructor(t,n){ee(this,"db",null);this.dbName=t,this.version=n}async init(){this.db=await this.openDatabase()}openDatabase(){return new Promise((t,n)=>{const r=indexedDB.open(this.dbName,this.version);r.onsuccess=()=>t(r.result),r.onupgradeneeded=()=>{const o=r.result;o.objectStoreNames.contains(No)||o.createObjectStore(No,{autoIncrement:!0}),o.objectStoreNames.contains(oa)||o.createObjectStore(oa)},r.onerror=()=>n(r.error)})}async getCatalog(){if(!this.db)throw new Error("Database not initialized");const r=this.db.transaction(oa,"readonly").objectStore(oa).get(z0);return await El(r)??{files:{}}}async setCatalog(t){if(!this.db)throw new Error("Database not initialized");const o=this.db.transaction(oa,"readwrite").objectStore(oa).put(t,z0);await El(o)}async updateCatalog(t){const n=await this.getCatalog(),r=t(n);await this.setCatalog(r)}async save(t,n){return(await this.saveMany([{data:t,metadata:n}]))[0].id}async saveMany(t){if(!this.db)throw new Error("Database not initialized");const r=this.db.transaction(No,"readwrite").objectStore(No),o=[];for await(const s of t){const a=r.add(s.data),i=await El(a);o.push({id:i,metadata:s.metadata})}return await this.updateCatalog(s=>{for(const{id:a,metadata:i}of o)s.files[a]=i;return s}),o}async load(t){if(!this.db)throw new Error("Database not initialized");const o=this.db.transaction(No,"readonly").objectStore(No).get(t);return await El(o)??null}async delete(t){await this.deleteMany([t])}async deleteMany(t){if(!this.db)throw new Error("Database not initialized");const r=this.db.transaction(No,"readwrite").objectStore(No);for(const o of t)r.delete(o);await this.updateCatalog(o=>{for(const s of t)delete o.files[s];return o})}async list(){return(await this.getCatalog()).files}}function El(e){return new Promise((t,n)=>{e.onsuccess=()=>t(e.result),e.onerror=()=>n(e.error)})}const Kf=$n()?[{id:-999,type:"file",path:"./assets/soundfonts/A320U.sf2",name:"A320U.sf2 (Signal Factory Sound)"}]:[{id:-999,type:"remote",name:"A320U.sf2 (Signal Factory Sound)",url:"./A320U.sf2"}];class IR{constructor(t){ee(this,"storage");ee(this,"files",[]);ee(this,"selectedSoundFontId",null);ee(this,"scanPaths",[]);ee(this,"isLoading",!1);ee(this,"load",async t=>{const n=await this.getSoundFont(t);if(n===null)throw new Error("SoundFont not found");this.isLoading=!0,await this.synth.loadSoundFont(await AR(n)),this.selectedSoundFontId=t,this.isLoading=!1});ee(this,"addSoundFont",async(t,n)=>{await this.storage.save(t,n),await this.updateFileList()});ee(this,"removeSoundFont",async t=>{await this.storage.delete(t),await this.updateFileList()});ee(this,"scanSoundFonts",async()=>{if(!$n())return;await this.clearScannedSoundFonts();const t=[];for(const n of this.scanPaths){const o=(await window.electronAPI.searchSoundFonts(n)).map(s=>({data:{type:"file",path:s},metadata:{name:Nm(s),scanPath:n}}));t.push(...o)}await this.storage.saveMany(t),await this.updateFileList()});ee(this,"removeScanPath",async t=>{await this.clearScannedSoundFonts(),this.scanPaths=this.scanPaths.filter(n=>n!==t),this.scanSoundFonts()});ee(this,"addScanPath",async t=>{this.scanPaths.includes(t)||(this.scanPaths=[...this.scanPaths,t],await this.scanSoundFonts())});this.synth=t,Vr(this,{files:Dt.shallow,selectedSoundFontId:Dt,scanPaths:Dt.shallow,isLoading:Dt}),this.storage=new ER("soundfonts",1)}async init(){await SS(this,{name:"SoundFontStore",properties:["selectedSoundFontId","scanPaths"],storage:window.localStorage}),await this.storage.init(),await this.updateFileList(),await this.load(this.selectedSoundFontId??Kf[0].id)}async updateFileList(){const t=await this.storage.list(),n=Object.keys(t).map(r=>({...t[Number(r)],id:Number(r)}));this.files=[...Kf,...n]}async getSoundFont(t){const n=Kf.find(r=>r.id===t);return n!==void 0?n:await this.storage.load(t)}async clearScannedSoundFonts(){const t=await this.storage.list(),n=Object.entries(t).filter(([,r])=>r.scanPath!==void 0&&this.scanPaths.includes(r.scanPath)).map(([r])=>Number(r));await this.storage.deleteMany(n)}}async function AR(e){switch(e.type){case"local":return Ll.load(e.data);case"remote":return await Ll.loadFromURL(e.url);case"file":{const t=await window.electronAPI.readFile(e.path);return await Ll.load(t)}}}class RR{constructor(){ee(this,"songStore",new MR);ee(this,"midiDeviceStore",new SR);ee(this,"player");ee(this,"synth");ee(this,"metronomeSynth");ee(this,"synthGroup");ee(this,"midiInput",new eR);ee(this,"midiRecorder");ee(this,"midiMonitor");ee(this,"soundFontStore");ee(this,"autoSaveService");ee(this,"commands",new l7(this.songStore));const t=new(window.AudioContext||window.webkitAudioContext);this.synth=new lg(t),this.metronomeSynth=new lg(t),this.synthGroup=new JA(this.metronomeSynth),this.synthGroup.outputs.push({synth:this.synth,isEnabled:!0});const n=new XA(this.songStore);this.player=new V4(this.synthGroup,n),this.soundFontStore=new IR(this.synth),this.midiRecorder=new nR(this.songStore,this.player),this.midiMonitor=new tR(this.player),this.midiInput.on("midiMessage",r=>{this.midiMonitor.onMessage(r),this.midiRecorder.onMessage(r)}),this.autoSaveService=new QA(this.songStore),wR(this)}async init(){await this.synth.setup(),await this.soundFontStore.init(),this.setupMetronomeSynth(),this.autoSaveService.startAutoSave()}async setupMetronomeSynth(){const t=await OR();await this.metronomeSynth.loadSoundFont(await Ll.load(t))}}async function OR(){return $n()?await window.electronAPI.readFile("./assets/soundfonts/A320U_drums.sf2"):await(await fetch("./A320U_drums.sf2")).arrayBuffer()}const To=e=>e,Lm=e=>({_tag:"Left",value:e}),Bd=e=>({_tag:"Right",value:e}),PR=(e,t,n)=>n._tag==="Left"?e(n.value):t(n.value),kS={dimap:(e,t,n)=>r=>t(n(e(r))),first:e=>([t,n])=>[e(t),n],right:e=>t=>t._tag==="Left"?t:Bd(e(t.value)),wander:e=>t=>t.map(e)},BR={empty:()=>{},foldMap:(e,t)=>{for(let n=0;n<t.length;n++){const r=e(t[n]);if(r!=null)return r}}},DR={empty:()=>[],foldMap:(e,t)=>{let n=[];return t.forEach(r=>{n=n.concat(e(r))}),n}},zm=e=>({dimap:(t,n,r)=>o=>r(t(o)),first:t=>([n,r])=>t(n),right:t=>n=>n._tag==="Left"?e.empty():t(n.value),wander:t=>n=>e.foldMap(t,n)}),Yf={Equivalence:{Equivalence:"Equivalence",Iso:"Iso",Lens:"Lens",Prism:"Prism",Traversal:"Traversal",Getter:"Getter",AffineFold:"AffineFold",Fold:"Fold",Setter:"Setter"},Iso:{Equivalence:"Iso",Iso:"Iso",Lens:"Lens",Prism:"Prism",Traversal:"Traversal",Getter:"Getter",AffineFold:"AffineFold",Fold:"Fold",Setter:"Setter"},Lens:{Equivalence:"Lens",Iso:"Lens",Lens:"Lens",Prism:"Prism",Traversal:"Traversal",Getter:"Getter",AffineFold:"AffineFold",Fold:"Fold",Setter:"Setter"},Prism:{Equivalence:"Prism",Iso:"Prism",Lens:"Prism",Prism:"Prism",Traversal:"Traversal",Getter:"AffineFold",AffineFold:"AffineFold",Fold:"Fold",Setter:"Setter"},Traversal:{Equivalence:"Traversal",Iso:"Traversal",Lens:"Traversal",Prism:"Traversal",Traversal:"Traversal",Getter:"Fold",AffineFold:"Fold",Fold:"Fold",Setter:"Setter"},Getter:{Equivalence:"Getter",Iso:"Getter",Lens:"Getter",Prism:"AffineFold",Traversal:"Fold",Getter:"Getter",AffineFold:"AffineFold",Fold:"Fold",Setter:void 0},AffineFold:{Equivalence:"AffineFold",Iso:"AffineFold",Lens:"AffineFold",Prism:"AffineFold",Traversal:"Fold",Getter:"AffineFold",AffineFold:"AffineFold",Fold:"Fold",Setter:void 0},Fold:{Equivalence:"Fold",Iso:"Fold",Lens:"Fold",Prism:"Fold",Traversal:"Fold",Getter:"Fold",AffineFold:"Fold",Fold:"Fold",Setter:void 0},Setter:{Equivalence:void 0,Iso:void 0,Lens:void 0,Prism:void 0,Traversal:void 0,Getter:void 0,AffineFold:void 0,Fold:void 0,Setter:void 0}},mi=(e,t)=>{const n=t;return n._tag=e,n},wS=e=>(e._removable=!0,e);function Rt(e,t,n){switch(arguments.length){case 2:{const r=(o,s)=>e(o,t(o,s));return r._tag=Yf[e._tag][t._tag],r._removable=t._removable||!1,r}default:{const r=Yf[e._tag][t._tag],o=(s,a)=>e(s,t(s,n(s,a)));return o._tag=Yf[r][n._tag],o._removable=n._removable||!1,o}}}const NR=mi("Equivalence",(e,t)=>t),Dd=(e,t)=>mi("Iso",(n,r)=>n.dimap(e,t,r)),gr=(e,t)=>mi("Lens",(n,r)=>n.dimap(o=>[e(o),o],t,n.first(r))),Fm=(e,t)=>mi("Prism",(n,r)=>n.dimap(e,o=>PR(To,t,o),n.right(r))),Wm=mi("Traversal",(e,t)=>e.dimap(To,To,e.wander(t))),LR=e=>mi("Getter",(t,n)=>t.dimap(e,To,n)),xS=(e,t,n)=>e(kS,t)(n),zR=(e,t,n)=>e(kS,()=>t)(n),FR=(e,t)=>e(zm({}),To)(t),WR=(e,t)=>e(zm(BR),To)(t),CS=(e,t)=>e(zm(DR),n=>[n])(t),$R=Dd(e=>e.map((t,n)=>[n,t]),e=>{const t=[...e].sort((r,o)=>r[0]-o[0]),n=[];for(let r=0;r<t.length;++r)(r===t.length-1||t[r][0]!==t[r+1][0])&&n.push(t[r][1]);return n}),F0=e=>gr(t=>t[e],([t,n])=>Object.assign(Object.assign({},n),{[e]:t})),VR=e=>gr(t=>{const n={};for(const r of e)n[r]=t[r];return n},([t,n])=>{const r=Object.assign({},n);for(const o of e)delete r[o];return Object.assign(r,t)}),TS=e=>gr(t=>t[e],([t,n])=>{const r=n.slice();return r[e]=t,r}),$m=TS(0),Vm=e=>Fm(t=>e(t)?Bd(t):Lm(t),To),bc=Symbol("__no_match__"),MS=Vm(e=>e!==bc),ES=Symbol("__remove_me__"),qf=e=>wS(Rt(gr(t=>0<=e&&e<t.length?t[e]:bc,([t,n])=>{if(t===bc)return n;if(t===ES)return typeof n=="string"?n.substring(0,e)+n.substring(e+1):[...n.slice(0,e),...n.slice(e+1)];if(typeof n=="string")return e===0?t+n.substring(1):e===n.length?n.substring(0,e-1)+t:n.substring(0,e)+t+n.substring(e+1);{const r=n.slice();return r[e]=t,r}}),MS)),jR=Fm(e=>e===void 0?Lm(void 0):Bd(e),To),HR=e=>Fm(t=>e(t)?Bd(t):Lm(t),To),UR=e=>wS(Rt(gr(t=>{const n=t.findIndex(e);return n===-1?[bc,-1]:[t[n],n]},([[t,n],r])=>{if(t===bc)return r;if(t===ES)return[...r.slice(0,n),...r.slice(n+1)];const o=r.slice();return o[n]=t,o}),$m,MS)),GR=e=>Rt(gr(t=>{const n=t.map((r,o)=>e(r)?o:null).filter(r=>r!=null);return[n.map(r=>t[r]),n]},([[t,n],r])=>{const o=r.length,s=t.length;let a=0,i=0,c=0;const l=[];for(;a<o;)n[i]===a?(++i,c<s&&(l.push(t[c]),++c)):l.push(r[a]),++a;for(;c<s;)l.push(t[c++]);return l}),$m),XR=e=>gr(t=>t===void 0?e:t,([t,n])=>t),KR=e=>Rt(gr(t=>{const n=CS(e,t);return[n,n.length]},([[t,n],r])=>{if(t.length!==n)throw new Error("cannot add/remove elements through partsOf");let o=0;return xS(e,()=>t[o++],r)}),$m),YR=e=>gr(t=>e(t),([t,n])=>t),qR=e=>gr(t=>t,([t,n])=>e(t)),ZR=gr(e=>{},([e,t])=>e===void 0?t:[e,...t]),QR=gr(e=>{},([e,t])=>e===void 0?t:[...t,e]),JR=Rt(Dd(e=>e.split(""),e=>e.join("")),Wm),eO=Rt(Dd(e=>e.split(/\b/),e=>e.join("")),Wm,Vm(e=>!/\s+/.test(e)));class zt{constructor(t){this._ref=t}get _tag(){return this._ref._tag}get _removable(){return this._ref._removable}compose(t){return new zt(Rt(this._ref,t._ref))}iso(t,n){return new zt(Rt(this._ref,Dd(t,n)))}lens(t,n){return new zt(Rt(this._ref,gr(t,([r,o])=>n(o,r))))}indexed(){return new zt(Rt(this._ref,$R))}prop(t){return new zt(Rt(this._ref,F0(t)))}path(...t){return t.length===1&&(t=t[0].split(".")),new zt(t.reduce((n,r)=>Rt(n,F0(r)),this._ref))}pick(t){return new zt(Rt(this._ref,VR(t)))}nth(t){return new zt(Rt(this._ref,TS(t)))}filter(t){return new zt(Rt(this._ref,GR(t)))}valueOr(t){return new zt(Rt(this._ref,XR(t)))}partsOf(t){const n=typeof t=="function"?t(IS):t;return new zt(Rt(this._ref,KR(n._ref)))}reread(t){return new zt(Rt(this._ref,YR(t)))}rewrite(t){return new zt(Rt(this._ref,qR(t)))}optional(){return new zt(Rt(this._ref,jR))}guard_(){return t=>this.guard(t)}guard(t){return new zt(Rt(this._ref,HR(t)))}at(t){return new zt(Rt(this._ref,qf(t)))}head(){return new zt(Rt(this._ref,qf(0)))}index(t){return new zt(Rt(this._ref,qf(t)))}find(t){return new zt(Rt(this._ref,UR(t)))}elems(){return new zt(Rt(this._ref,Wm))}to(t){return new zt(Rt(this._ref,LR(t)))}when(t){return new zt(Rt(this._ref,Vm(t)))}chars(){return new zt(Rt(this._ref,JR))}words(){return new zt(Rt(this._ref,eO))}prependTo(){return new zt(Rt(this._ref,ZR))}appendTo(){return new zt(Rt(this._ref,QR))}}const IS=new zt(NR);function tO(){return IS}function nO(e){return t=>FR(e._ref,t)}function rO(e){return t=>WR(e._ref,t)}function oO(e){return t=>CS(e._ref,t)}function sO(e){return t=>n=>xS(e._ref,t,n)}function aO(e){return t=>n=>zR(e._ref,t,n)}const W0=(e,t,n)=>(t.has(n)?t:t.set(n,e())).get(n),iO=new WeakMap,cO=(e,t,n)=>{const r=W0(()=>new WeakMap,iO,t);return W0(e,r,n)},lO=e=>typeof e=="function";function Nd(e,t){return cO(()=>{const n=t(tO());return me(o=>{const s=o(e);return s instanceof Promise?s.then(a=>$0(n,a)):$0(n,s)},(o,s,a)=>{const i=lO(a)?sO(n)(a):aO(n)(a),c=o(e);return s(e,c instanceof Promise?c.then(i):i(c))})},e,t)}const $0=(e,t)=>e._tag==="Traversal"?oO(e)(t):e._tag==="Prism"?rO(e)(t):nO(e)(t);function gi(){return{get language(){return Oe(V0)},get showNoteLabels(){return Oe(j0)},get themeType(){return Oe(H0)},setLanguage:xe(V0),setShowNoteLabels:xe(j0),setThemeType:xe(H0)}}const AS=nm("SettingStore",{language:null,showNoteLabels:!0}),uO=nm("ThemeStore",{themeType:"dark"}),V0=Nd(AS,e=>e.prop("language")),j0=Nd(AS,e=>e.prop("showNoteLabels")),H0=Nd(uO,e=>e.prop("themeType")),dO=({children:e})=>{const{themeType:t}=gi();return u(c4,{theme:b_[t],children:e})},Kc=({size:e="2rem"})=>{const t=$t();return u(j4,{style:{width:e,height:e},color:t.themeColor})},fO=J.div`
  color: var(--color-text);
  margin-left: 1rem;
  display: flex;
  align-items: center;
  font-size: 0.8rem;
`,hO=({open:e,children:t})=>u(hn,{open:e,style:{minWidth:"20rem"},children:G(qt,{style:{display:"flex",marginBottom:"0"},children:[u(Kc,{}),u(fO,{children:t})]})}),pO=({open:e,message:t})=>u(hO,{open:e,children:t}),Ld=J.input`
  display: block;
  appearance: none;
  border: none;
  background: inherit;
  border: 1px solid var(--color-divider);
  border-radius: 0.25rem;
  height: 3rem;
  padding: 0 1rem;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  color: inherit;
  font-size: 1rem;
  font-family: inherit;
  outline: none;

  &:focus {
    border-color: var(--color-theme);
  }
`,mO=e=>{const[t,n]=p.useState(e.initialText),{setPrompt:r}=p.useContext(H4),o=()=>{r(null)},s=()=>{e.callback(null),o()},a=()=>{e.callback(t??null),o()};return G(hn,{open:!0,onOpenChange:s,style:{width:"20rem"},children:[u(bn,{children:e.title}),u(qt,{children:u(Ld,{type:"text",value:t,onChange:i=>n(i.target.value),autoFocus:!0,onKeyPress:i=>{i.key==="Enter"&&a()},style:{width:"100%"}})}),G(gn,{children:[u(Et,{onClick:a,children:e.okText??"OK"}),u(Et,{onClick:s,children:e.cancelText??"Cancel"})]})]})};function gO(){p.useEffect(()=>{const e=t=>{t.preventDefault()};return document.addEventListener("touchmove",e,{passive:!1}),()=>document.removeEventListener("touchmove",e)},[])}function vO(){p.useEffect(()=>(document.oncontextmenu=e=>e.preventDefault(),()=>{document.oncontextmenu=null}),[])}function bO(){p.useEffect(()=>{const e=t=>{t.ctrlKey&&t.preventDefault()};return document.addEventListener("wheel",e,{passive:!1}),()=>document.removeEventListener("wheel",e)},[])}function an(){const{commands:e}=Ht();return e}var Xs;(e=>{e.getEventFactory=t=>n=>{switch(t.type){case"pitchBend":return ky(0,0,Math.round(n));case"controller":return Qr(0,0,t.controllerType,Math.round(n))}},e.getEventPredicate=t=>{switch(t.type){case"pitchBend":return lm;case"controller":return ui(t.controllerType)}},e.equals=(t,n)=>{switch(t.type){case"pitchBend":return n.type==="pitchBend";case"controller":return n.type==="controller"&&t.controllerType===n.controllerType}}})(Xs||(Xs={}));const Di=e=>{switch(e.type){case"velocity":return"velocity";case"pitchBend":return"pitchBend";case"controller":return`controller-${e.controllerType}`}},ji=(e,t)=>{switch(e.type){case"velocity":case"pitchBend":return e.type===t.type;case"controller":switch(t.type){case"velocity":case"pitchBend":return!1;case"controller":return Xs.equals(e,t)}}},RS=[{type:"velocity"},{type:"pitchBend"},{type:"controller",controllerType:Zr.MSB_MAIN_VOLUME},{type:"controller",controllerType:Zr.MSB_PAN},{type:"controller",controllerType:Zr.MSB_EXPRESSION},{type:"controller",controllerType:Zr.SUSTAIN},{type:"controller",controllerType:Zr.MSB_MODWHEEL}];function Yt(){return{get controlMode(){return Oe(U0)},get controlModes(){return Oe(Su)},get selection(){return Oe(_c)},get selectedEventIds(){return Oe(yc)},resetSelection:xe(yO),setControlMode:xe(U0),setControlModes:xe(Su),setSelection:xe(_c),setSelectedEventIds:xe(yc),serializeState:xe(SO),restoreState:xe(kO)}}const U0=me({type:"velocity"}),_c=me(null),yc=me([]),_O=nm("ControlStore",{controlModes:RS}),Su=Nd(_O,e=>e.prop("controlModes")),yO=me(null,(e,t)=>{t(_c,null),t(yc,[])}),SO=me(null,e=>({controlModes:Qe.cloneDeep(e(Su)),selection:Qe.cloneDeep(e(_c)),selectedEventIds:Qe.cloneDeep(e(yc))})),kO=me(null,(e,t,{controlModes:n,selection:r,selectedEventIds:o})=>{t(Su,n),t(_c,r),t(yc,o)});function ht(){return{get hasUndo(){return Oe(TO)},get hasRedo(){return Oe(MO)},get pushHistory(){return wO()},get undo(){return xO()},get redo(){return CO()},clear:xe(RO)}}function jm(){const{songStore:e}=Ht(),{serializeState:t}=Me(),{serializeState:n}=Yt(),{serializeState:r}=sn();return p.useCallback(()=>({song:e.serialize(),pianoRollStore:t(),controlStore:n(),arrangeViewStore:r()}),[e,t,n,r])}function OS(){const{setSong:e}=_t(),{restoreState:t}=Me(),{restoreState:n}=Yt(),{restoreState:r}=sn();return p.useCallback(o=>{const s=fi.deserialize(o.song);e(s),t(o.pianoRollStore),n(o.controlStore),r(o.arrangeViewStore)},[e,t,n,r])}function wO(){const e=jm();return Qo(p.useCallback((t,n)=>{const r=e();n(EO,r)},[e]))}function xO(){const e=jm(),t=OS();return Qo(p.useCallback((n,r)=>{const o=r(IO,e());o&&t(o)},[t,e]))}function CO(){const e=jm(),t=OS();return Qo(p.useCallback((n,r)=>{const o=r(AO,e());o&&t(o)},[e,t]))}const Ua=me([]),Ga=me([]),TO=me(e=>e(Ua).length>0),MO=me(e=>e(Ga).length>0),EO=me(null,(e,t,n)=>{t(Ua,r=>[...r,n]),t(Ga,[])}),IO=me(null,(e,t,n)=>{const r=[...e(Ua)],o=r.pop();return o&&(t(Ua,r),t(Ga,s=>[...s,n])),o}),AO=me(null,(e,t,n)=>{const r=[...e(Ga)],o=r.pop();return o&&(t(Ga,r),t(Ua,s=>[...s,n])),o}),RO=me(null,(e,t)=>{t(Ua,[]),t(Ga,[])});async function Yc(){try{const e=await navigator.clipboard.readText();return e?JSON.parse(e):null}catch{return null}}async function zd(e){try{const t=JSON.stringify(e);await navigator.clipboard.writeText(t)}catch(t){console.error("Failed to write to clipboard:",t)}}function Fd(e){var n;const t=(n=e.clipboardData)==null?void 0:n.getData("text/plain");return t?JSON.parse(t):null}const qc=()=>{const{selection:e}=sn(),t=an();return p.useCallback(()=>{if(e===null)return;const n=t.arrange.getClipboardDataForSelection(e);zd(n)},[t,e])},Hm=()=>{const{position:e}=Lt(),{pushHistory:t}=ht(),{selectedTrackIndex:n}=sn(),r=an();return p.useCallback(async o=>{const s=o?Fd(o):await Yc(),{data:a,error:i}=y9.safeParse(s);if(!a){console.error("Invalid clipboard data",i);return}t(),r.arrange.pasteClipboardDataAt(a,e,n)},[r,e,t,n])},Wd=()=>{const{pushHistory:e}=ht(),{setSelection:t,selection:n}=sn(),r=an();return p.useCallback(()=>{n!==null&&(e(),r.arrange.deleteSelection(n),t(null))},[r,e,n,t])},OO=()=>{const e=qc(),t=Wd();return p.useCallback(()=>{e(),t()},[e,t])},PS=()=>{const{pushHistory:e}=ht(),{selection:t}=sn(),n=an();return p.useCallback(r=>{t!==null&&(e(),n.arrange.transposeSelection(t,r))},[n,e,t])},BS=()=>{const{pushHistory:e}=ht(),{selection:t,setSelection:n}=sn(),r=an();return p.useCallback(()=>{if(t===null)return;e();const o=r.arrange.duplicateSelection(t);n(o)},[t,e,n,r])},PO=()=>{const{pushHistory:e}=ht(),{selection:t}=sn(),n=an();return p.useCallback(r=>{t!==null&&(e(),n.arrange.batchUpdateNotesVelocity(t,r))},[n,e,t])};function Xa(){const{synthGroup:e}=Ht(),{getTrack:t}=_t(),{allSoundsOffChannel:n,allSoundsOffExclude:r}=Lt(),o=p.useMemo(()=>hS(s=>{e.trackMute=s(ir)}),[e]);return em(o),{get trackMute(){return Oe(ir)},mute:xe(BO),unmute:xe(DO),solo:xe(NO),unsolo:xe(LO),reset:xe(zO),toggleMute:Qo(p.useCallback((s,a,i)=>{var l;const c=(l=t(i))==null?void 0:l.channel;c!==void 0&&(wn.isMuted(i)(s(ir))?a(ir,wn.unmute(i)):(a(ir,wn.mute(i)),n(c)))},[t,n])),toggleSolo:Qo(p.useCallback((s,a,i)=>{var l;const c=(l=t(i))==null?void 0:l.channel;c!==void 0&&(wn.isSolo(i)(s(ir))?(a(ir,wn.unsolo(i)),n(c)):(a(ir,wn.solo(i)),r(c)))},[t,n,r]))}}const ir=me(wn.empty),BO=me(null,(e,t,n)=>t(ir,wn.mute(n))),DO=me(null,(e,t,n)=>t(ir,wn.unmute(n))),NO=me(null,(e,t,n)=>t(ir,wn.solo(n))),LO=me(null,(e,t,n)=>t(ir,wn.unsolo(n))),zO=me(null,(e,t)=>t(ir,wn.empty));function wt(e){const t=_t(),n=On(()=>t.getTrack(e),[t,e]);return{get isRhythmTrack(){return bt(n,"isRhythmTrack")??!1},get isConductorTrack(){return bt(n,"isConductorTrack")??!1},get programNumber(){return bt(n,"programNumber")??0},get name(){return bt(n,"name")??""},get channel(){return bt(n,"channel")},get events(){return bt(n,"events")??[]},getEvents(){return(n==null?void 0:n.events)??[]},get color(){return bt(n,"color")},get isMuted(){const{trackMute:r}=Xa();return wn.isMuted(e)(r)},get isSolo(){const{trackMute:r}=Xa();return wn.isSolo(e)(r)},setColor:p.useCallback(r=>{n==null||n.setColor(r)},[n]),setName:p.useCallback(r=>{n==null||n.setName(r)},[n]),setChannel:p.useCallback(r=>{n&&(n.channel=r)},[n]),setPan:p.useCallback((r,o)=>{n==null||n.setPan(r,o)},[n]),setVolume:p.useCallback((r,o)=>{n==null||n.setVolume(r,o)},[n]),setProgramNumber:p.useCallback(r=>{n==null||n.setProgramNumber(r)},[n]),...DS(n)}}function DS(e){return{addEvent:p.useCallback(t=>{if(e)return e.addEvent(t)},[e]),addEvents:p.useCallback(t=>{if(e)return e.addEvents(t)},[e]),removeEvent:p.useCallback(t=>{e&&e.removeEvent(t)},[e]),removeEvents:p.useCallback(t=>{e&&e.removeEvents(t)},[e]),createOrUpdate:p.useCallback(t=>{if(e)return e.createOrUpdate(t)},[e]),updateEvent:p.useCallback((t,n)=>e?e.updateEvent(t,n):null,[e]),updateEvents:p.useCallback(t=>{e&&e.updateEvents(t)},[e]),getEventById:p.useCallback(t=>e==null?void 0:e.getEventById(t),[e])}}function io(){const{tracks:e,timebase:t}=_t(),n=On(()=>e.find(s=>s.isConductorTrack),[e]),r=On(()=>((n==null?void 0:n.events)??[]).filter(um),[n],Qe.isEqual),o=p.useMemo(()=>to.fromTimeSignatures(r,t),[r,t]);return{get id(){return bt(n,"id")??Vs},get currentTempo(){const{position:s}=Lt();return On(()=>(n==null?void 0:n.getTempo(s))??0,[n,s])},get tempoEvents(){return On(()=>((n==null?void 0:n.events)??[]).filter(li),[n],Qe.isEqual)},timeSignatures:r,measures:o,getEvents:p.useCallback(()=>(n==null?void 0:n.events)??[],[n]),setTempo:p.useCallback((s,a)=>{n==null||n.setTempo(s,a)},[n]),...DS(n)}}const FO=()=>{const{updateEvent:e}=io(),{pushHistory:t}=ht();return p.useCallback((n,r)=>{t(),e(n,{microsecondsPerBeat:r})},[e,t])},WO=()=>{const{selectedTrackId:e,setNewNoteVelocity:t}=Me(),{updateEvents:n}=wt(e),{pushHistory:r}=ht();return p.useCallback((o,s)=>{r(),n(o.map(a=>({id:a,velocity:s}))),t(s)},[r,n,t])},$O=()=>{const{selectedTrackId:e}=Me(),{quantizeRound:t}=Nn(),{createOrUpdate:n}=wt(e),{position:r,sendEvent:o}=Lt(),{pushHistory:s}=ht();return p.useCallback((a,i)=>{var l;s();const c=(l=n({...a,tick:t(i??r)}))==null?void 0:l.id;return i!==void 0&&o(a),c},[s,n,t,r,o])},NS=(e,t,n)=>{const{quantizeFloor:r,quantizeUnit:o}=Nn(),s=an();return p.useCallback((a,i,c,l)=>{s.track.updateEventsInRange(e,t,n,r,o,a,i,c,l)},[s,e,t,n,r,o])},VO=e=>{const{selectedTrackId:t}=Me();return NS(t,Xs.getEventPredicate(e),Xs.getEventFactory(e))},jO=e=>{const{sendEvent:t}=Lt(),{pushHistory:n}=ht(),{channel:r,setProgramNumber:o}=wt(e);return p.useCallback(s=>{n(),o(s),r!==void 0&&t(xd(0,r,s))},[n,o,r,t])},LS=()=>{const{notGhostTrackIds:e,setNotGhostTrackIds:t}=Me(),{pushHistory:n}=ht();return p.useCallback(r=>{n(),e.has(r)?t(pS(r)):t(mS(r))},[n,e,t])},HO=()=>{const{notGhostTrackIds:e,setNotGhostTrackIds:t}=Me(),{tracks:n}=_t(),{pushHistory:r}=ht();return p.useCallback(()=>{r(),e.size>Math.floor(n.length/2)?t(new Set):t(new Set(n.map(o=>o.id)))},[r,e,t,n])},UO=()=>{const{timebase:e}=_t(),{pushHistory:t}=ht(),{measures:n,timeSignatures:r,addEvent:o}=io();return p.useCallback((s,a,i)=>{const c=to.getMeasureStart(n,s,e).tick;r.some(l=>l.tick===c)||(t(),o({...yy(0,a,i),tick:c}))},[e,t,n,r,o])},GO=()=>{const{updateEvent:e}=io(),{pushHistory:t}=ht();return p.useCallback((n,r,o)=>{t(),e(n,{numerator:r,denominator:o})},[t,e])},XO=()=>{const{selectedTrackId:e,selectedNoteIds:t}=Me(),{pushHistory:n}=ht(),r=an();return p.useCallback(o=>{n(),r.track.batchUpdateNotesVelocity(e,t,o)},[e,t,n,r])},zS=()=>{const{setScrollLeftInTicks:e}=Pd(),{stop:t,setPosition:n}=Lt();return p.useCallback(()=>{t(),n(0),e(0)},[t,n,e])},FS=()=>{const{measures:e,timebase:t}=_t(),{scrollLeftTicks:n,setScrollLeftInTicks:r}=Pd(),{position:o,setPosition:s}=Lt();return p.useCallback(()=>{const a=to.getPreviousMeasureTick(e,o,t);s(a),o<n&&r(o)},[e,t,o,n,s,r])},WS=()=>{const{transform:e,scrollLeft:t,canvasWidth:n,setScrollLeftInPixels:r}=Pd(),{measures:o,timebase:s}=_t(),{position:a,setPosition:i}=Lt();return p.useCallback(()=>{const c=to.getNextMeasureTick(o,a,s);i(c);const l=e.getX(a);l-t>n*.7&&r(l-n*.7)},[o,s,a,e,t,n,i,r])},KO=()=>{const{selectedTrackIndex:e,setSelectedTrackIndex:t}=Me(),{tracks:n}=_t();return p.useCallback(()=>{t(Math.min(e+1,n.length-1))},[e,t,n.length])},YO=()=>{const{selectedTrackIndex:e,setSelectedTrackIndex:t}=Me();return p.useCallback(()=>{t(Math.max(e-1,1))},[e,t])},qO=()=>{const{toggleSolo:e}=Xa(),{selectedTrackId:t}=Me();return p.useCallback(()=>e(t),[e,t])},ZO=()=>{const{toggleMute:e}=Xa(),{selectedTrackId:t}=Me();return p.useCallback(()=>e(t),[e,t])},QO=()=>{const{selectedTrackId:e}=Me(),t=LS();return p.useCallback(()=>t(e),[t,e])},JO=()=>{const{synthGroup:e}=Ht(),{sendEvent:t}=Lt();return p.useCallback(({channel:n,noteNumber:r,velocity:o},s=0)=>{e.activate(),t(am(0,n,r,o),s)},[e,t])},eP=()=>{const{sendEvent:e}=Lt();return p.useCallback(({channel:t,noteNumber:n},r=0)=>{e(Sy(0,t,n,0),r)},[e])},$S=()=>{const{midiRecorder:e}=Ht(),{play:t,stop:n}=Lt();return p.useCallback(()=>{e.isRecording?(e.isRecording=!1,n()):(e.isRecording=!0,t())},[e,t,n])};var Sc;(e=>{function t(d,m){return m.x>=d.x&&m.x<=d.x+d.width&&m.y>=d.y&&m.y<=d.y+d.height}e.containsPoint=t;function n(d){return d.x+d.width}e.right=n;function r(d){return d.y+d.height}e.bottom=r;function o(d,m){return n(d)>m.x&&n(m)>d.x&&r(d)>m.y&&r(m)>d.y}e.intersects=o;function s(d,m){return e.containsPoint(d,m)&&e.containsPoint(d,a(m))}e.containsRect=s;function a(d){return{x:n(d),y:r(d)}}e.br=a;function i(d,m){const v=Math.min(d.x,m.x),_=Math.max(d.x,m.x),y=Math.min(d.y,m.y),k=Math.max(d.y,m.y);return{x:v,y,width:_-v,height:k-y}}e.fromPoints=i;function c(d,m){return{x:d.x-m/2,y:d.y-m/2,width:m,height:m}}e.fromPointWithSize=c;function l(d,m,v){return{x:d.x*m,y:d.y*v,width:d.width*m,height:d.height*v}}e.scale=l,e.zero={x:0,y:0,width:0,height:0};function f(d,m){return{x:d.x+m.x,y:d.y+m.y,width:d.width,height:d.height}}e.move=f})(Sc||(Sc={}));var Fn;(e=>{e.getBounds=(o,s)=>{const a=s.getX(o.fromTick),i=s.getX(o.toTick),c=s.getY(o.fromNoteNumber),l=s.getY(o.toNoteNumber);return{x:a,y:c,width:i-a,height:l-c}},e.moved=(o,s,a)=>({fromTick:o.fromTick+s,fromNoteNumber:o.fromNoteNumber+a,toTick:o.toTick+s,toNoteNumber:o.toNoteNumber+a});function t(o,s){const a=Math.min(o.tick,s.tick),i=Math.max(o.tick,s.tick),c=Math.ceil(Math.max(o.noteNumber,s.noteNumber)),l=Math.floor(Math.min(o.noteNumber,s.noteNumber));return{fromTick:Math.max(0,a),fromNoteNumber:Qe.clamp(c,-1,Ma),toTick:Math.max(0,i),toNoteNumber:Qe.clamp(l,-1,Ma)}}e.fromPoints=t;function n(o){return{tick:o.fromTick,noteNumber:o.fromNoteNumber}}e.getFrom=n;function r(o){return{tick:o.toTick,noteNumber:o.toNoteNumber}}e.getTo=r,e.isEmpty=o=>o.fromTick===o.toTick||o.fromNoteNumber===o.toNoteNumber})(Fn||(Fn={}));function Mo(e){return e!==void 0}const tP=(e,t)=>{const n=[];for(let r=0;r<e.length;r++)n.push(e[r]),r<e.length-1&&n.push(t(e[r],e[r+1]));return n},Ni={current:null};function $d(){const e=JO(),t=eP(),{selectedTrackId:n,addPreviewingNoteNumbers:r,removePreviewingNoteNumbers:o}=Me(),{channel:s}=wt(n),a=p.useCallback(()=>{if(s===void 0||Ni.current===null)return;const{noteNumber:c,timeout:l}=Ni.current;l!==void 0&&clearTimeout(l),t({noteNumber:c,channel:s}),o(c),Ni.current=null},[s,t,o]);return{previewNoteOn:p.useCallback((c=64,l)=>{if(s!==void 0)if(a(),e({noteNumber:c,velocity:100,channel:s}),r(c),l!==void 0){const f=setTimeout(()=>{a()},l);Ni.current={noteNumber:c,timeout:f}}else Ni.current={noteNumber:c}},[s,e,r,a]),previewNoteOff:a}}function VS(e,t){const n={x:t.fromTick,width:t.toTick-t.fromTick,y:t.toNoteNumber,height:t.fromNoteNumber-t.toNoteNumber};return e.filter(en).filter(r=>Sc.intersects({x:r.tick,width:r.duration,y:r.noteNumber-1,height:1},n))}const Zc=()=>{const e=an(),{selectedTrackId:t,selection:n,selectedNoteIds:r,setSelection:o}=Me(),{pushHistory:s}=ht();return p.useCallback(a=>{if(s(),n!==null){const i=Fn.moved(n,0,a);o(i)}e.track.transposeNotes(t,r,a)},[s,n,o,e,t,r])},nP=()=>{const{selection:e,selectedNoteIds:t,selectedTrackId:n,setSelectedNoteIds:r}=Me(),{getEventById:o,addEvents:s}=wt(n);return p.useCallback(()=>{if(e===null)return;const a=t.map(i=>o(i)).filter(Mo).map(i=>({...i}));s(a),r(a.map(i=>i.id))},[e,t,o,s,r])},vi=()=>{const{selection:e,selectedNoteIds:t,selectedTrackId:n}=Me(),{getEventById:r}=wt(n);return p.useCallback(async()=>{if(t.length===0)return;const o=t.map(c=>r(c)).filter(Mo).filter(en),s=(e==null?void 0:e.fromTick)??Qe.min(o.map(c=>c.tick)),i={type:"piano_notes",notes:o.map(c=>({...c,tick:c.tick-s}))};await zd(i)},[e,t,r])},bi=()=>{const{selection:e,selectedNoteIds:t,selectedTrackId:n,setSelection:r,setSelectedNoteIds:o}=Me(),{removeEvents:s}=wt(n),{pushHistory:a}=ht();return p.useCallback(()=>{t.length===0&&e===null||(a(),s(t),r(null),o([]))},[t,e,a,s,r,o])},Vd=()=>{const{selectedTrackId:e}=Me(),{addEvents:t}=wt(e),{position:n}=Lt(),{pushHistory:r}=ht();return p.useCallback(async o=>{const s=o?Fd(o):await Yc(),{data:a}=vy.safeParse(s);if(!a)return;r();const i=a.notes.map(c=>({...c,tick:Math.max(0,c.tick+n)}));t(i)},[t,n,r])},rP=()=>{const e=vi(),t=bi();return p.useCallback(()=>{e(),t()},[e,t])},jd=()=>{const{selection:e,selectedNoteIds:t,selectedTrackId:n,setSelection:r,setSelectedNoteIds:o}=Me(),{pushHistory:s}=ht(),a=an();return p.useCallback(()=>{if(e===null&&t.length===0)return;s();const i=e?e.toTick-e.fromTick:0,{addedNoteIds:c,deltaTick:l}=a.track.duplicateNotes(n,t,i);e&&r(Fn.moved(e,l,0)),o(c)},[e,t,s,a,n,r,o])},jS=()=>{const{setSelectedNoteIds:e}=Me(),{setSelectedEventIds:t}=Yt();return p.useCallback(n=>{t([]),e([n])},[t,e])},Zf=e=>e.filter(en).sort((t,n)=>t.tick<n.tick?-1:t.tick>n.tick?1:t.noteNumber<n.noteNumber?-1:t.noteNumber>n.noteNumber?1:0),HS=()=>{const{selectedTrackId:e,selectedNoteIds:t}=Me(),{previewNoteOn:n}=$d(),{getEvents:r}=wt(e),o=jS();return p.useCallback(s=>{if(t.length===0)return;const a=r().filter(en),i=Zf(t.map(m=>a.find(v=>v.id===m)).filter(Mo));if(i.length===0)return;const c=Zf(i)[0],l=Zf(a),f=l.findIndex(m=>m.id===c.id),d=l[f+s];d!==void 0&&(o(d.id),n(d.noteNumber,d.duration))},[t,r,o,n])},Um=()=>{const e=HS();return p.useCallback(()=>e(1),[e])},Gm=()=>{const e=HS();return p.useCallback(()=>e(-1),[e])},Hd=()=>{const{selectedTrackId:e,selectedNoteIds:t}=Me(),{forceQuantizeRound:n}=RA(),{pushHistory:r}=ht(),o=an();return p.useCallback(()=>{t.length!==0&&(r(),o.track.quantizeNotes(e,t,n))},[t,r,o.track,e,n])},Xm=()=>{const{selectedTrackId:e,setSelectedNoteIds:t}=Me(),{getEvents:n}=wt(e),{setSelectedEventIds:r}=Yt();return p.useCallback(()=>{t(n().filter(en).map(o=>o.id)),r([])},[n,t,r])};function Ao(){const{autoSaveService:e}=Ht(),t=Ro();return{onUserExplicitAction:e.onUserExplicitAction,shouldShowAutoSaveDialog:p.useCallback(()=>e.getShouldOfferRestore()&&e.hasAutoSavedSong(),[e]),restoreAutoSave:p.useCallback(()=>{const n=e.restore();n&&(t(n),e.clearAutoSave())},[e,t]),getLastSaveTime:e.getLastSaveTime}}function Ud(){const{tracks:e,getTrack:t,moveTrack:n}=_t(),r=e.filter(o=>!o.isConductorTrack).map(o=>o.id);return{get isOpen(){return Oe(G0)},setOpen:xe(G0),trackIds:r,moveTrack:p.useCallback((o,s)=>{const a=t(o),i=t(s);if(a===void 0||i===void 0)return;const c=e.indexOf(a),l=e.indexOf(i);n(c,l)},[e,t,n])}}const G0=me(!1);function oP(e,t="noname"){const n=document.createElement("a");n.href=e,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),n.remove()}function US(e,t){const n=window.URL.createObjectURL(e);oP(n,t),setTimeout(()=>window.URL.revokeObjectURL(n),1e3)}function sP(e){const t=rs(e),n=new Blob([t],{type:"application/octet-stream"});US(n,e.filepath.length>0?e.filepath:"no name.mid")}async function GS(e,t){const n=await e.createWritable();await n.write(t),await n.close()}const aP=new URL(window.location.href).searchParams.get("disableFileSystem")==="true",Rr=("chooseFileSystemEntries"in window||"showOpenFilePicker"in window)&&!aP,XS=()=>{const e=Ro();return async()=>{let t;try{t=(await window.showOpenFilePicker({types:[{description:"MIDI file",accept:{"audio/midi":[".mid"]}}]}))[0]}catch(o){if(o.name==="AbortError")return;const s="An error occured trying to open the file.";console.error(s,o),alert(s);return}const n=await t.getFile(),r=await Km(n);r.fileHandle=t,e(r)}},Km=async e=>ku(await e.arrayBuffer(),"path"in e?e.path:void 0,e.name),KS=e=>{var t;return((t=Nm(e))==null?void 0:t.replace(/\.[^/.]+$/,""))??""},ku=(e,t,n)=>{const r=Md(new Uint8Array(e)),o=t??n;return r.name.length===0&&o&&(r.name=KS(o)),t&&(r.filepath=t),r.isSaved=!0,r},iP=async e=>{const t=e.fileHandle;if(t===null){await Ym(e);return}const n=rs(e).buffer;try{await GS(t,n),e.isSaved=!0}catch(r){console.error(r),alert("unable to save file")}},Ym=async e=>{let t;try{t=await window.showSaveFilePicker({types:[{description:"MIDI file",accept:{"audio/midi":[".mid"]}}]})}catch(n){if(n.name==="AbortError")return;const r="An error occured trying to open the file.";console.error(r,n),alert(r);return}try{const n=rs(e).buffer;await GS(t,n),e.fileHandle=t,e.name=KS(t.name),e.isSaved=!0}catch(n){const r="Unable to save file.";console.error(r,n),alert(r);return}},cP=async e=>{if(e.files===null||e.files.length===0)return Promise.resolve(null);const t=e.files[0];return await Km(t)},Ro=()=>{const{setSong:e}=_t(),{clear:t}=ht(),{reset:n}=Xa(),{stop:r,reset:o,setPosition:s}=Lt(),{setOpen:a}=Ud(),{setNotGhostTrackIds:i,setSelection:c,setSelectedNoteIds:l,setSelectedTrackId:f}=Me(),{setScrollLeftInPixels:d}=Pd(),{setSelection:m}=sn();return p.useCallback(v=>{var _;e(v),n(),d(0),i(new Set),a(!0),c(null),l([]),f(((_=v.tracks.find(y=>!y.isConductorTrack))==null?void 0:_.id)??Vs),m(null),t(),r(),o(),s(0)},[e,t,n,r,o,s,i,d,a,c,l,f,m])},lP=()=>{const e=Ro(),{onUserExplicitAction:t}=Ao();return p.useCallback(()=>{t(),e(gm())},[t,e])},YS=()=>{const{getSong:e}=_t(),{setSaved:t}=_t(),{onUserExplicitAction:n}=Ao();return p.useCallback(()=>{t(!0),n(),sP(e())},[t,n,e])},qS=()=>{const e=Ro(),{onUserExplicitAction:t}=Ao();return p.useCallback(async n=>{const r=await cP(n);r!==null&&(t(),e(r))},[e,t])},ZS=()=>{const{addTrack:e,tracks:t}=_t(),{pushHistory:n}=ht();return p.useCallback(()=>{n(),e(mm(Math.min(t.length-1,15)))},[n,e,t])},QS=()=>{const{selectedTrackIndex:e,setSelectedTrackIndex:t}=Me(),{tracks:n,removeTrack:r}=_t(),{pushHistory:o}=ht(),{selectedTrackIndex:s,setSelectedTrackIndex:a}=sn();return p.useCallback(i=>{const c=n.length;if(n.filter(f=>!f.isConductorTrack).length<=1)return;o(),r(i);const l=c-2;t(Math.min(e,l)),a(Math.min(s,l))},[n,o,r,e,t,s,a])},JS=()=>{const{setSelectedTrackId:e}=Me();return e},uP=()=>{const{insertTrack:e,tracks:t}=_t(),{pushHistory:n}=ht();return p.useCallback(r=>{n(),e(mm(t.length-1),r)},[n,e,t])},dP=()=>{const{getTrack:e,tracks:t,insertTrack:n}=_t(),{pushHistory:r}=ht();return p.useCallback(o=>{const s=e(o);if(s===void 0)throw new Error("No track found");const a=t.findIndex(c=>c.id===o),i=s.clone();i.channel=void 0,r(),n(i,a+1)},[e,t,n,r])},Gd=()=>{const{isSaved:e,getSong:t}=_t(),n=Io(),r=er(),o=lP(),s=qS(),a=YS(),i=XS(),{onUserExplicitAction:c}=Ao();return{createNewSong:p.useCallback(async()=>{(e||confirm(r["confirm-new"]))&&o()},[e,r,o]),openSong:p.useCallback(async()=>{try{(e||confirm(r["confirm-open"]))&&await i()}catch(l){n.error(l.message)}},[e,r,i,n]),openSongLegacy:p.useCallback(async l=>{try{(e||confirm(r["confirm-new"]))&&await s(l.currentTarget)}catch(f){n.error(f.message)}},[e,r,s,n]),saveSong:p.useCallback(async()=>{await iP(t()),c()},[t,c]),saveAsSong:p.useCallback(async()=>{await Ym(t()),c()},[t,c]),downloadSong:p.useCallback(async()=>{a()},[a])}};function fP(e){const t=hP(e),n=p.forwardRef((r,o)=>{const{children:s,...a}=r,i=p.Children.toArray(s),c=i.find(mP);if(c){const l=c.props.children,f=i.map(d=>d===c?p.Children.count(l)>1?p.Children.only(null):p.isValidElement(l)?l.props.children:null:d);return Fe.jsx(t,{...a,ref:o,children:p.isValidElement(l)?p.cloneElement(l,void 0,f):null})}return Fe.jsx(t,{...a,ref:o,children:s})});return n.displayName=`${e}.Slot`,n}function hP(e){const t=p.forwardRef((n,r)=>{const{children:o,...s}=n;if(p.isValidElement(o)){const a=vP(o),i=gP(s,o.props);return o.type!==p.Fragment&&(i.ref=r?U4(r,a):a),p.cloneElement(o,i)}return p.Children.count(o)>1?p.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var pP=Symbol("radix.slottable");function mP(e){return p.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===pP}function gP(e,t){const n={...t};for(const r in t){const o=e[r],s=t[r];/^on[A-Z]/.test(r)?o&&s?n[r]=(...i)=>{const c=s(...i);return o(...i),c}:o&&(n[r]=o):r==="style"?n[r]={...o,...s}:r==="className"&&(n[r]=[o,s].filter(Boolean).join(" "))}return{...e,...n}}function vP(e){var r,o;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(o=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:o.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var bP=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],_P=bP.reduce((e,t)=>{const n=fP(`Primitive.${t}`),r=p.forwardRef((o,s)=>{const{asChild:a,...i}=o,c=a?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),Fe.jsx(c,{...i,ref:s})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{}),Qf="focusScope.autoFocusOnMount",Jf="focusScope.autoFocusOnUnmount",X0={bubbles:!1,cancelable:!0},yP="FocusScope",qm=p.forwardRef((e,t)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:o,onUnmountAutoFocus:s,...a}=e,[i,c]=p.useState(null),l=Gl(o),f=Gl(s),d=p.useRef(null),m=tr(t,y=>c(y)),v=p.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;p.useEffect(()=>{if(r){let y=function(h){if(v.paused||!i)return;const S=h.target;i.contains(S)?d.current=S:Fo(d.current,{select:!0})},k=function(h){if(v.paused||!i)return;const S=h.relatedTarget;S!==null&&(i.contains(S)||Fo(d.current,{select:!0}))},g=function(h){if(document.activeElement===document.body)for(const x of h)x.removedNodes.length>0&&Fo(i)};document.addEventListener("focusin",y),document.addEventListener("focusout",k);const b=new MutationObserver(g);return i&&b.observe(i,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",y),document.removeEventListener("focusout",k),b.disconnect()}}},[r,i,v.paused]),p.useEffect(()=>{if(i){Y0.add(v);const y=document.activeElement;if(!i.contains(y)){const g=new CustomEvent(Qf,X0);i.addEventListener(Qf,l),i.dispatchEvent(g),g.defaultPrevented||(SP(TP(ek(i)),{select:!0}),document.activeElement===y&&Fo(i))}return()=>{i.removeEventListener(Qf,l),setTimeout(()=>{const g=new CustomEvent(Jf,X0);i.addEventListener(Jf,f),i.dispatchEvent(g),g.defaultPrevented||Fo(y??document.body,{select:!0}),i.removeEventListener(Jf,f),Y0.remove(v)},0)}}},[i,l,f,v]);const _=p.useCallback(y=>{if(!n&&!r||v.paused)return;const k=y.key==="Tab"&&!y.altKey&&!y.ctrlKey&&!y.metaKey,g=document.activeElement;if(k&&g){const b=y.currentTarget,[h,S]=kP(b);h&&S?!y.shiftKey&&g===S?(y.preventDefault(),n&&Fo(h,{select:!0})):y.shiftKey&&g===h&&(y.preventDefault(),n&&Fo(S,{select:!0})):g===b&&y.preventDefault()}},[n,r,v.paused]);return Fe.jsx(_P.div,{tabIndex:-1,...a,ref:m,onKeyDown:_})});qm.displayName=yP;function SP(e,{select:t=!1}={}){const n=document.activeElement;for(const r of e)if(Fo(r,{select:t}),document.activeElement!==n)return}function kP(e){const t=ek(e),n=K0(t,e),r=K0(t.reverse(),e);return[n,r]}function ek(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function K0(e,t){for(const n of e)if(!wP(n,{upTo:t}))return n}function wP(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function xP(e){return e instanceof HTMLInputElement&&"select"in e}function Fo(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&xP(e)&&t&&e.select()}}var Y0=CP();function CP(){let e=[];return{add(t){const n=e[0];t!==n&&(n==null||n.pause()),e=q0(e,t),e.unshift(t)},remove(t){var n;e=q0(e,t),(n=e[0])==null||n.resume()}}}function q0(e,t){const n=[...e],r=n.indexOf(t);return r!==-1&&n.splice(r,1),n}function TP(e){return e.filter(t=>t.tagName!=="A")}const MP=J(G4)`
  min-width: 8rem;
  background: var(--color-background-secondary);
  border-radius: 0.5rem;
  box-shadow: 0 1rem 3rem var(--color-shadow);
  border: 1px solid var(--color-popup-border);
  margin: 0 1rem;
  padding: 0.5rem 0;
  outline: none;
`,tk=J.ul`
  list-style: none;
  padding: 0;
  margin: 0;
  outline: none;
`,Qc=({trigger:e,open:t,onOpenChange:n,children:r})=>G(Z4,{open:t,onOpenChange:n,children:[u(q4,{asChild:!0,children:e}),u(S_,{children:u(MP,{children:u(qm,{asChild:!0,children:u(tk,{children:r})})})})]}),EP=J.li`
  font-size: 0.8rem;
  color: var(--color-text);
  display: flex;
  align-items: center;
  padding: 0.5rem 1rem;
  cursor: pointer;

  &:hover {
    background: var(--color-highlight);
  }

  &[data-disabled="true"] {
    color: var(--color-text-secondary);
    pointer-events: none;

    &:hover {
      background: transparent;
    }
  }
`,We=({children:e,disabled:t=!1,...n})=>u(EP,{...n,"data-disabled":t,children:e}),qn=J.hr`
  border: none;
  border-top: 1px solid var(--color-divider);
`,IP=ss`
	from {
		opacity: 0;
		transform: translateY(2px);
	}
	to {
		opacity: 1;
		transform: translateY(0);
	}
`,AP=ss`
	from {
		opacity: 0;
		transform: translateX(-2px);
	}
	to {
		opacity: 1;
		transform: translateX(0);
	}
`,RP=ss`
	from {
		opacity: 0;
		transform: translateY(-2px);
	}
	to {
		opacity: 1;
		transform: translateY(0);
	}
`,OP=ss`
	from {
		opacity: 0;
		transform: translateX(2px);
	}
	to {
		opacity: 1;
		transform: translateX(0);
	}
`,PP=J(X4)`
  min-width: 8rem;
  border-radius: 6px;
  box-shadow:
    0px 10px 38px -10px rgba(22, 23, 24, 0.35),
    0px 10px 20px -15px rgba(22, 23, 24, 0.2);
  animation-duration: 400ms;
  animation-timing-function: cubic-bezier(0.16, 1, 0.3, 1);
  will-change: transform, opacity;

  &[data-side="top"] {
    animation-name: ${RP};
  }
  &[data-side="bottom"] {
    animation-name: ${IP};
  }
  $[data-side="left"] {
    animation-name: ${AP};
  }
  &[data-side="right"] {
    animation-name: ${OP};
  }

  background: var(--color-background-secondary);
  border-radius: 0.5rem;
  box-shadow: 0 1rem 3rem var(--color-shadow);
  border: 1px solid var(--color-popup-border);
  padding: 0.5rem 0;
`,BP=J(K4)`
  outline: none;
`,DP=({trigger:e,children:t})=>G(Y4,{children:[u(BP,{children:e}),u(S_,{children:u(PP,{sideOffset:-4,alignOffset:-4,children:u(tk,{children:t})})})]}),yn=J.div`
  font-size: 0.9em;
  flex-grow: 1;
  text-align: right;
  color: var(--color-text-secondary);
  margin-left: 2em;
`,up="OpenButtonInputFile",Zm=({onChange:e,children:t,accept:n,id:r})=>G(Ke,{children:[u("input",{accept:n,style:{display:"none"},id:r??up,type:"file",onChange:e}),u("label",{htmlFor:r??up,children:t})]}),NP=({close:e})=>{const{createNewSong:t,openSongLegacy:n,downloadSong:r}=Gd();return G(Ke,{children:[u(We,{onClick:async()=>{e(),await t()},children:u(N,{name:"new-song"})}),u(qn,{}),u(Zm,{onChange:async i=>{e(),await n(i)},accept:".mid,audio/midi",children:u(We,{children:u(N,{name:"open-song"})})}),u(We,{onClick:async()=>{e(),await r()},children:u(N,{name:"save-song"})})]})},LP=e=>e instanceof HTMLAnchorElement||e instanceof HTMLAreaElement||e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLButtonElement||e instanceof HTMLIFrameElement;function _i({actions:e,onCopy:t,onCut:n,onPaste:r}){const o=p.useCallback(c=>{if(c.target!==null&&LP(c.target))return;const l=e.find(f=>{var d;return(((d=f.enabled)==null?void 0:d.call(f))??!0)&&c.code===f.code&&c.altKey===(f.altKey??!1)&&c.shiftKey===(f.shiftKey??!1)&&(c.ctrlKey||c.metaKey)===(f.metaKey??!1)});l!==void 0&&(l.run(c.nativeEvent),c.preventDefault(),c.stopPropagation())},[e]),s=p.useCallback(c=>t==null?void 0:t(c.nativeEvent),[t]),a=p.useCallback(c=>n==null?void 0:n(c.nativeEvent),[n]),i=p.useCallback(c=>r==null?void 0:r(c.nativeEvent),[r]);return{onKeyDown:o,onCopy:s,onCut:a,onPaste:i}}function Ln(){return{get openHelpDialog(){return Oe(Z0)},get openSignInDialog(){return Oe(Q0)},get openCloudFileDialog(){return Oe(J0)},get openSettingDialog(){return Oe(ev)},get openControlSettingDialog(){return Oe(tv)},get initializeError(){return Oe(nv)},get openInitializeErrorDialog(){return Oe(rv)},get openPublishDialog(){return Oe(ov)},get openUserSettingsDialog(){return Oe(sv)},get openDeleteAccountDialog(){return Oe(av)},setOpenHelpDialog:xe(Z0),setOpenSignInDialog:xe(Q0),setOpenCloudFileDialog:xe(J0),setOpenSettingDialog:xe(ev),setOpenControlSettingDialog:xe(tv),setInitializeError:xe(nv),setOpenInitializeErrorDialog:xe(rv),setOpenPublishDialog:xe(ov),setOpenUserSettingsDialog:xe(sv),setOpenDeleteAccountDialog:xe(av)}}const Z0=me(!1),Q0=me(!1),J0=me(!1),ev=me(!1),tv=me(!1),nv=me(null),rv=me(!1),ov=me(!1),sv=me(!1),av=me(!1);function ds(){return{get path(){return Oe(iv)},setPath:xe(iv)}}const iv=me("/track"),zP=()=>{const{setOpenHelpDialog:e}=Ln(),{setPath:t}=ds(),{playOrPause:n}=Lt(),{isSaved:r}=_t(),o=FS(),s=WS(),a=zS(),i=$S(),{undo:c,redo:l}=ht(),{createNewSong:f,openSong:d,saveSong:m,saveAsSong:v,downloadSong:_}=Gd(),y=er(),k=p.useCallback(async()=>{var b;(r||confirm(y["confirm-open"]))&&((b=document.getElementById(up))==null||b.click())},[r,y]),g=p.useMemo(()=>[{code:"Space",run:n},{code:"KeyZ",metaKey:!0,run:c},{code:"KeyZ",metaKey:!0,shiftKey:!0,run:l},{code:"KeyY",metaKey:!0,run:l},{code:"Slash",shiftKey:!0,run:()=>e(!0)},{code:"Enter",run:a},{code:"KeyA",run:o},{code:"KeyD",run:s},{code:"KeyR",run:i},{code:"Digit1",metaKey:!0,run:()=>t("/track")},{code:"Digit2",metaKey:!0,run:()=>t("/arrange")},{code:"Digit3",metaKey:!0,run:()=>t("/tempo")},{code:"KeyS",metaKey:!0,run:Rr?m:_},{code:"KeyS",altKey:!0,run:Rr?m:_},{code:"KeyS",shiftKey:!0,metaKey:!0,run:Rr?v:_},{code:"KeyS",shiftKey:!0,altKey:!0,run:Rr?v:_},{code:"KeyO",metaKey:!0,run:Rr?d:k},{code:"KeyO",altKey:!0,run:Rr?d:k},{code:"KeyN",metaKey:!0,run:f},{code:"KeyN",altKey:!0,run:f}],[n,c,l,v,e,a,o,s,i,t,m,_,d,k,f]);return _i({actions:g})},cv=24,FP=()=>{const{resetSelection:e,scrollBy:t,setOpenTransposeDialog:n}=sn(),r=Wd(),o=qc(),s=Hm(),a=BS(),i=OO(),c=p.useMemo(()=>[{code:"Escape",run:()=>e()},{code:"Delete",run:()=>r()},{code:"Backspace",run:()=>r()},{code:"ArrowUp",metaKey:!0,run:()=>t(0,cv)},{code:"ArrowDown",metaKey:!0,run:()=>t(0,-cv)},{code:"KeyT",run:()=>n(!0)},{code:"KeyD",metaKey:!0,run:()=>a()},{code:"KeyC",metaKey:!0,run:()=>o()},{code:"KeyV",metaKey:!0,run:()=>s()},{code:"KeyX",metaKey:!0,run:()=>i()}],[e,t,n,r,a,o,s,i]);return _i({actions:c,onCut:i,onCopy:o,onPaste:s})};function Qm(e){const t=p.useRef(null);return p.useEffect(()=>{var n;(n=t.current)==null||n.focus()},[t]),t}function WP(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var wu=WP(p),$P=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},VP=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},lv=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=VP(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return wu.createElement("svg",$P({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),wu.createElement("path",{d:"M20,18H22V6H20M11.59,7.41L15.17,11H1V13H15.17L11.59,16.58L13,18L19,12L13,6L11.59,7.41Z"}))},jP=wu.memo?wu.memo(lv):lv,HP=jP;const UP=yt(HP);var GP=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),XP="VisuallyHidden",nk=p.forwardRef((e,t)=>Fe.jsx(pr.span,{...e,ref:t,style:{...GP,...e.style}}));nk.displayName=XP;var KP=nk,[Xd]=fd("Tooltip",[hd]),Kd=hd(),rk="TooltipProvider",YP=700,dp="tooltip.open",[qP,Jm]=Xd(rk),ok=e=>{const{__scopeTooltip:t,delayDuration:n=YP,skipDelayDuration:r=300,disableHoverableContent:o=!1,children:s}=e,a=p.useRef(!0),i=p.useRef(!1),c=p.useRef(0);return p.useEffect(()=>{const l=c.current;return()=>window.clearTimeout(l)},[]),Fe.jsx(qP,{scope:t,isOpenDelayedRef:a,delayDuration:n,onOpen:p.useCallback(()=>{window.clearTimeout(c.current),a.current=!1},[]),onClose:p.useCallback(()=>{window.clearTimeout(c.current),c.current=window.setTimeout(()=>a.current=!0,r)},[r]),isPointerInTransitRef:i,onPointerInTransitChange:p.useCallback(l=>{i.current=l},[]),disableHoverableContent:o,children:s})};ok.displayName=rk;var kc="Tooltip",[ZP,Jc]=Xd(kc),sk=e=>{const{__scopeTooltip:t,children:n,open:r,defaultOpen:o,onOpenChange:s,disableHoverableContent:a,delayDuration:i}=e,c=Jm(kc,e.__scopeTooltip),l=Kd(t),[f,d]=p.useState(null),m=C_(),v=p.useRef(0),_=a??c.disableHoverableContent,y=i??c.delayDuration,k=p.useRef(!1),[g,b]=pd({prop:r,defaultProp:o??!1,onChange:I=>{I?(c.onOpen(),document.dispatchEvent(new CustomEvent(dp))):c.onClose(),s==null||s(I)},caller:kc}),h=p.useMemo(()=>g?k.current?"delayed-open":"instant-open":"closed",[g]),S=p.useCallback(()=>{window.clearTimeout(v.current),v.current=0,k.current=!1,b(!0)},[b]),x=p.useCallback(()=>{window.clearTimeout(v.current),v.current=0,b(!1)},[b]),w=p.useCallback(()=>{window.clearTimeout(v.current),v.current=window.setTimeout(()=>{k.current=!0,b(!0),v.current=0},y)},[y,b]);return p.useEffect(()=>()=>{v.current&&(window.clearTimeout(v.current),v.current=0)},[]),Fe.jsx(T_,{...l,children:Fe.jsx(ZP,{scope:t,contentId:m,open:g,stateAttribute:h,trigger:f,onTriggerChange:d,onTriggerEnter:p.useCallback(()=>{c.isOpenDelayedRef.current?w():S()},[c.isOpenDelayedRef,w,S]),onTriggerLeave:p.useCallback(()=>{_?x():(window.clearTimeout(v.current),v.current=0)},[x,_]),onOpen:S,onClose:x,disableHoverableContent:_,children:n})})};sk.displayName=kc;var fp="TooltipTrigger",ak=p.forwardRef((e,t)=>{const{__scopeTooltip:n,...r}=e,o=Jc(fp,n),s=Jm(fp,n),a=Kd(n),i=p.useRef(null),c=tr(t,i,o.onTriggerChange),l=p.useRef(!1),f=p.useRef(!1),d=p.useCallback(()=>l.current=!1,[]);return p.useEffect(()=>()=>document.removeEventListener("pointerup",d),[d]),Fe.jsx(Np,{asChild:!0,...a,children:Fe.jsx(pr.button,{"aria-describedby":o.open?o.contentId:void 0,"data-state":o.stateAttribute,...r,ref:c,onPointerMove:Jt(e.onPointerMove,m=>{m.pointerType!=="touch"&&!f.current&&!s.isPointerInTransitRef.current&&(o.onTriggerEnter(),f.current=!0)}),onPointerLeave:Jt(e.onPointerLeave,()=>{o.onTriggerLeave(),f.current=!1}),onPointerDown:Jt(e.onPointerDown,()=>{o.open&&o.onClose(),l.current=!0,document.addEventListener("pointerup",d,{once:!0})}),onFocus:Jt(e.onFocus,()=>{l.current||o.onOpen()}),onBlur:Jt(e.onBlur,o.onClose),onClick:Jt(e.onClick,o.onClose)})})});ak.displayName=fp;var e1="TooltipPortal",[QP,JP]=Xd(e1,{forceMount:void 0}),ik=e=>{const{__scopeTooltip:t,forceMount:n,children:r,container:o}=e,s=Jc(e1,t);return Fe.jsx(QP,{scope:t,forceMount:n,children:Fe.jsx(Pc,{present:n||s.open,children:Fe.jsx(x_,{asChild:!0,container:o,children:r})})})};ik.displayName=e1;var Ka="TooltipContent",ck=p.forwardRef((e,t)=>{const n=JP(Ka,e.__scopeTooltip),{forceMount:r=n.forceMount,side:o="top",...s}=e,a=Jc(Ka,e.__scopeTooltip);return Fe.jsx(Pc,{present:r||a.open,children:a.disableHoverableContent?Fe.jsx(lk,{side:o,...s,ref:t}):Fe.jsx(eB,{side:o,...s,ref:t})})}),eB=p.forwardRef((e,t)=>{const n=Jc(Ka,e.__scopeTooltip),r=Jm(Ka,e.__scopeTooltip),o=p.useRef(null),s=tr(t,o),[a,i]=p.useState(null),{trigger:c,onClose:l}=n,f=o.current,{onPointerInTransitChange:d}=r,m=p.useCallback(()=>{i(null),d(!1)},[d]),v=p.useCallback((_,y)=>{const k=_.currentTarget,g={x:_.clientX,y:_.clientY},b=sB(g,k.getBoundingClientRect()),h=aB(g,b),S=iB(y.getBoundingClientRect()),x=lB([...h,...S]);i(x),d(!0)},[d]);return p.useEffect(()=>()=>m(),[m]),p.useEffect(()=>{if(c&&f){const _=k=>v(k,f),y=k=>v(k,c);return c.addEventListener("pointerleave",_),f.addEventListener("pointerleave",y),()=>{c.removeEventListener("pointerleave",_),f.removeEventListener("pointerleave",y)}}},[c,f,v,m]),p.useEffect(()=>{if(a){const _=y=>{const k=y.target,g={x:y.clientX,y:y.clientY},b=(c==null?void 0:c.contains(k))||(f==null?void 0:f.contains(k)),h=!cB(g,a);b?m():h&&(m(),l())};return document.addEventListener("pointermove",_),()=>document.removeEventListener("pointermove",_)}},[c,f,a,l,m]),Fe.jsx(lk,{...e,ref:s})}),[tB,nB]=Xd(kc,{isInside:!1}),rB=Q4("TooltipContent"),lk=p.forwardRef((e,t)=>{const{__scopeTooltip:n,children:r,"aria-label":o,onEscapeKeyDown:s,onPointerDownOutside:a,...i}=e,c=Jc(Ka,n),l=Kd(n),{onClose:f}=c;return p.useEffect(()=>(document.addEventListener(dp,f),()=>document.removeEventListener(dp,f)),[f]),p.useEffect(()=>{if(c.trigger){const d=m=>{const v=m.target;v!=null&&v.contains(c.trigger)&&f()};return window.addEventListener("scroll",d,{capture:!0}),()=>window.removeEventListener("scroll",d,{capture:!0})}},[c.trigger,f]),Fe.jsx(k_,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:s,onPointerDownOutside:a,onFocusOutside:d=>d.preventDefault(),onDismiss:f,children:Fe.jsxs(w_,{"data-state":c.stateAttribute,...l,...i,ref:t,style:{...i.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[Fe.jsx(rB,{children:r}),Fe.jsx(tB,{scope:n,isInside:!0,children:Fe.jsx(KP,{id:c.contentId,role:"tooltip",children:o||r})})]})})});ck.displayName=Ka;var uk="TooltipArrow",oB=p.forwardRef((e,t)=>{const{__scopeTooltip:n,...r}=e,o=Kd(n);return nB(uk,n).isInside?null:Fe.jsx(M_,{...o,...r,ref:t})});oB.displayName=uk;function sB(e,t){const n=Math.abs(t.top-e.y),r=Math.abs(t.bottom-e.y),o=Math.abs(t.right-e.x),s=Math.abs(t.left-e.x);switch(Math.min(n,r,o,s)){case s:return"left";case o:return"right";case n:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function aB(e,t,n=5){const r=[];switch(t){case"top":r.push({x:e.x-n,y:e.y+n},{x:e.x+n,y:e.y+n});break;case"bottom":r.push({x:e.x-n,y:e.y-n},{x:e.x+n,y:e.y-n});break;case"left":r.push({x:e.x+n,y:e.y-n},{x:e.x+n,y:e.y+n});break;case"right":r.push({x:e.x-n,y:e.y-n},{x:e.x-n,y:e.y+n});break}return r}function iB(e){const{top:t,right:n,bottom:r,left:o}=e;return[{x:o,y:t},{x:n,y:t},{x:n,y:r},{x:o,y:r}]}function cB(e,t){const{x:n,y:r}=e;let o=!1;for(let s=0,a=t.length-1;s<t.length;a=s++){const i=t[s],c=t[a],l=i.x,f=i.y,d=c.x,m=c.y;f>r!=m>r&&n<(d-l)*(r-f)/(m-f)+l&&(o=!o)}return o}function lB(e){const t=e.slice();return t.sort((n,r)=>n.x<r.x?-1:n.x>r.x?1:n.y<r.y?-1:n.y>r.y?1:0),uB(t)}function uB(e){if(e.length<=1)return e.slice();const t=[];for(let r=0;r<e.length;r++){const o=e[r];for(;t.length>=2;){const s=t[t.length-1],a=t[t.length-2];if((s.x-a.x)*(o.y-a.y)>=(s.y-a.y)*(o.x-a.x))t.pop();else break}t.push(o)}t.pop();const n=[];for(let r=e.length-1;r>=0;r--){const o=e[r];for(;n.length>=2;){const s=n[n.length-1],a=n[n.length-2];if((s.x-a.x)*(o.y-a.y)>=(s.y-a.y)*(o.x-a.x))n.pop();else break}n.push(o)}return n.pop(),t.length===1&&n.length===1&&t[0].x===n[0].x&&t[0].y===n[0].y?t:t.concat(n)}var dB=ok,fB=sk,hB=ak,pB=ik,mB=ck;const gB=J(mB)`
  background: ${({theme:e})=>gt(e.backgroundColor).darken(.2).hex()};
  color: var(--color-text-secondary);
  padding: 0.5rem;
  border-radius: 0.5rem;
  box-shadow: 0 1rem 3rem var(--color-shadow);
`,dr=({children:e,title:t,side:n="bottom",...r})=>u(dB,{...r,children:G(fB,{children:[u(hB,{asChild:!0,children:e}),u(pB,{children:u(gB,{side:n,sideOffset:5,children:t})})]})}),vB=J.button`
  -webkit-appearance: none;
  min-width: auto;
  padding: 0 0.8rem;
  color: var(--color-text);
  border: none;
  background: var(--color-background-dark);
  text-transform: none;
  height: 2rem;
  overflow: hidden;
  white-space: nowrap;
  display: flex;
  align-items: center;
  border-radius: 999px;
  cursor: pointer;
  outline: none;
  flex-shrink: 0;

  &:hover {
    background: var(--color-highlight);
  }

  &[data-selected="true"] {
    color: var(--color-on-surface);
    background: var(--color-theme);
  }
`,t1=p.forwardRef(({children:e,onMouseDown:t,selected:n=!1,...r},o)=>u(vB,{...r,"data-selected":n,onMouseDown:s=>{s.preventDefault(),t==null||t(s)},tabIndex:-1,ref:o,children:e})),bB=J(UP)`
  width: 1.2rem;
  fill: currentColor;
`,_B=({onClick:e,selected:t})=>{const n=p.useCallback(r=>{r.preventDefault(),e()},[e]);return u(dr,{title:u(N,{name:"auto-scroll"}),children:u(t1,{onMouseDown:n,selected:t,children:u(bB,{})})})},n1=()=>{const{autoScroll:e,setAutoScroll:t}=kt(),n=p.useCallback(()=>t(!e),[e,t]);return u(_B,{onClick:n,selected:e})};function yB(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var xu=yB(p),SB=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},kB=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},uv=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=kB(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return xu.createElement("svg",SB({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),xu.createElement("path",{d:"M19,12C19,15.86 15.86,19 12,19C8.14,19 5,15.86 5,12C5,8.14 8.14,5 12,5C15.86,5 19,8.14 19,12Z"}))},wB=xu.memo?xu.memo(uv):uv,xB=wB;const Yd=yt(xB);function CB(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var Cu=CB(p),TB=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},MB=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},dv=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=MB(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return Cu.createElement("svg",TB({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),Cu.createElement("path",{d:"M12 3V13.55C11.41 13.21 10.73 13 10 13C7.79 13 6 14.79 6 17S7.79 21 10 21 14 19.21 14 17V7H18V3H12Z"}))},EB=Cu.memo?Cu.memo(dv):dv,IB=EB;const AB=yt(IB),dk=J.div`
  min-width: auto;
  overflow: hidden;
  white-space: nowrap;
  display: flex;
  align-items: center;
  cursor: pointer;
  flex-shrink: 0;
`,RB=J.button`
  outline: none;
  -webkit-appearance: none;
  min-width: auto;
  padding: 0 0.5rem;
  color: var(--color-text);
  background: var(--color-background-dark);
  text-transform: none;
  height: 2rem;
  overflow: hidden;
  white-space: nowrap;
  display: flex;
  align-items: center;
  cursor: pointer;
  margin: 0;

  border: none;
  border-radius: 4px;

  &:first-of-type {
    border-radius: 4px 0 0 4px;
  }

  &:last-child {
    border-radius: 0 4px 4px 0;
  }

  &:hover {
    background: var(--color-highlight);
  }

  &[data-selected="true"] {
    color: var(--color-on-surface);
    background: var(--color-theme);
  }
`,Tu=p.forwardRef(({children:e,onMouseDown:t,selected:n=!1,...r},o)=>u(RB,{...r,onMouseDown:s=>{s.preventDefault(),t==null||t(s)},"data-selected":n,tabIndex:-1,ref:o,children:e}));var eh="focusScope.autoFocusOnMount",th="focusScope.autoFocusOnUnmount",fv={bubbles:!1,cancelable:!0},OB="FocusScope",fk=p.forwardRef((e,t)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:o,onUnmountAutoFocus:s,...a}=e,[i,c]=p.useState(null),l=Gl(o),f=Gl(s),d=p.useRef(null),m=tr(t,y=>c(y)),v=p.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;p.useEffect(()=>{if(r){let y=function(h){if(v.paused||!i)return;const S=h.target;i.contains(S)?d.current=S:Wo(d.current,{select:!0})},k=function(h){if(v.paused||!i)return;const S=h.relatedTarget;S!==null&&(i.contains(S)||Wo(d.current,{select:!0}))},g=function(h){if(document.activeElement===document.body)for(const x of h)x.removedNodes.length>0&&Wo(i)};document.addEventListener("focusin",y),document.addEventListener("focusout",k);const b=new MutationObserver(g);return i&&b.observe(i,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",y),document.removeEventListener("focusout",k),b.disconnect()}}},[r,i,v.paused]),p.useEffect(()=>{if(i){pv.add(v);const y=document.activeElement;if(!i.contains(y)){const g=new CustomEvent(eh,fv);i.addEventListener(eh,l),i.dispatchEvent(g),g.defaultPrevented||(PB(zB(hk(i)),{select:!0}),document.activeElement===y&&Wo(i))}return()=>{i.removeEventListener(eh,l),setTimeout(()=>{const g=new CustomEvent(th,fv);i.addEventListener(th,f),i.dispatchEvent(g),g.defaultPrevented||Wo(y??document.body,{select:!0}),i.removeEventListener(th,f),pv.remove(v)},0)}}},[i,l,f,v]);const _=p.useCallback(y=>{if(!n&&!r||v.paused)return;const k=y.key==="Tab"&&!y.altKey&&!y.ctrlKey&&!y.metaKey,g=document.activeElement;if(k&&g){const b=y.currentTarget,[h,S]=BB(b);h&&S?!y.shiftKey&&g===S?(y.preventDefault(),n&&Wo(h,{select:!0})):y.shiftKey&&g===h&&(y.preventDefault(),n&&Wo(S,{select:!0})):g===b&&y.preventDefault()}},[n,r,v.paused]);return Fe.jsx(pr.div,{tabIndex:-1,...a,ref:m,onKeyDown:_})});fk.displayName=OB;function PB(e,{select:t=!1}={}){const n=document.activeElement;for(const r of e)if(Wo(r,{select:t}),document.activeElement!==n)return}function BB(e){const t=hk(e),n=hv(t,e),r=hv(t.reverse(),e);return[n,r]}function hk(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function hv(e,t){for(const n of e)if(!DB(n,{upTo:t}))return n}function DB(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function NB(e){return e instanceof HTMLInputElement&&"select"in e}function Wo(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&NB(e)&&t&&e.select()}}var pv=LB();function LB(){let e=[];return{add(t){const n=e[0];t!==n&&(n==null||n.pause()),e=mv(e,t),e.unshift(t)},remove(t){var n;e=mv(e,t),(n=e[0])==null||n.resume()}}}function mv(e,t){const n=[...e],r=n.indexOf(t);return r!==-1&&n.splice(r,1),n}function zB(e){return e.filter(t=>t.tagName!=="A")}var qd="Popover",[pk]=fd(qd,[hd]),el=hd(),[FB,fs]=pk(qd),mk=e=>{const{__scopePopover:t,children:n,open:r,defaultOpen:o,onOpenChange:s,modal:a=!1}=e,i=el(t),c=p.useRef(null),[l,f]=p.useState(!1),[d,m]=pd({prop:r,defaultProp:o??!1,onChange:s,caller:qd});return Fe.jsx(T_,{...i,children:Fe.jsx(FB,{scope:t,contentId:C_(),triggerRef:c,open:d,onOpenChange:m,onOpenToggle:p.useCallback(()=>m(v=>!v),[m]),hasCustomAnchor:l,onCustomAnchorAdd:p.useCallback(()=>f(!0),[]),onCustomAnchorRemove:p.useCallback(()=>f(!1),[]),modal:a,children:n})})};mk.displayName=qd;var gk="PopoverAnchor",WB=p.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,o=fs(gk,n),s=el(n),{onCustomAnchorAdd:a,onCustomAnchorRemove:i}=o;return p.useEffect(()=>(a(),()=>i()),[a,i]),Fe.jsx(Np,{...s,...r,ref:t})});WB.displayName=gk;var vk="PopoverTrigger",bk=p.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,o=fs(vk,n),s=el(n),a=tr(t,o.triggerRef),i=Fe.jsx(pr.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":wk(o.open),...r,ref:a,onClick:Jt(e.onClick,o.onOpenToggle)});return o.hasCustomAnchor?i:Fe.jsx(Np,{asChild:!0,...s,children:i})});bk.displayName=vk;var r1="PopoverPortal",[$B,VB]=pk(r1,{forceMount:void 0}),_k=e=>{const{__scopePopover:t,forceMount:n,children:r,container:o}=e,s=fs(r1,t);return Fe.jsx($B,{scope:t,forceMount:n,children:Fe.jsx(Pc,{present:n||s.open,children:Fe.jsx(x_,{asChild:!0,container:o,children:r})})})};_k.displayName=r1;var Ya="PopoverContent",yk=p.forwardRef((e,t)=>{const n=VB(Ya,e.__scopePopover),{forceMount:r=n.forceMount,...o}=e,s=fs(Ya,e.__scopePopover);return Fe.jsx(Pc,{present:r||s.open,children:s.modal?Fe.jsx(HB,{...o,ref:t}):Fe.jsx(UB,{...o,ref:t})})});yk.displayName=Ya;var jB=t5("PopoverContent.RemoveScroll"),HB=p.forwardRef((e,t)=>{const n=fs(Ya,e.__scopePopover),r=p.useRef(null),o=tr(t,r),s=p.useRef(!1);return p.useEffect(()=>{const a=r.current;if(a)return J4(a)},[]),Fe.jsx(e5,{as:jB,allowPinchZoom:!0,children:Fe.jsx(Sk,{...e,ref:o,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Jt(e.onCloseAutoFocus,a=>{var i;a.preventDefault(),s.current||(i=n.triggerRef.current)==null||i.focus()}),onPointerDownOutside:Jt(e.onPointerDownOutside,a=>{const i=a.detail.originalEvent,c=i.button===0&&i.ctrlKey===!0,l=i.button===2||c;s.current=l},{checkForDefaultPrevented:!1}),onFocusOutside:Jt(e.onFocusOutside,a=>a.preventDefault(),{checkForDefaultPrevented:!1})})})}),UB=p.forwardRef((e,t)=>{const n=fs(Ya,e.__scopePopover),r=p.useRef(!1),o=p.useRef(!1);return Fe.jsx(Sk,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var a,i;(a=e.onCloseAutoFocus)==null||a.call(e,s),s.defaultPrevented||(r.current||(i=n.triggerRef.current)==null||i.focus(),s.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:s=>{var c,l;(c=e.onInteractOutside)==null||c.call(e,s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const a=s.target;((l=n.triggerRef.current)==null?void 0:l.contains(a))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),Sk=p.forwardRef((e,t)=>{const{__scopePopover:n,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:a,onEscapeKeyDown:i,onPointerDownOutside:c,onFocusOutside:l,onInteractOutside:f,...d}=e,m=fs(Ya,n),v=el(n);return n5(),Fe.jsx(fk,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:s,children:Fe.jsx(k_,{asChild:!0,disableOutsidePointerEvents:a,onInteractOutside:f,onEscapeKeyDown:i,onPointerDownOutside:c,onFocusOutside:l,onDismiss:()=>m.onOpenChange(!1),children:Fe.jsx(w_,{"data-state":wk(m.open),role:"dialog",id:m.contentId,...v,...d,ref:t,style:{...d.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),kk="PopoverClose",GB=p.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,o=fs(kk,n);return Fe.jsx(pr.button,{type:"button",...r,ref:t,onClick:Jt(e.onClick,()=>o.onOpenChange(!1))})});GB.displayName=kk;var XB="PopoverArrow",KB=p.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,o=el(n);return Fe.jsx(M_,{...o,...r,ref:t})});KB.displayName=XB;function wk(e){return e?"open":"closed"}var YB=mk,qB=bk,ZB=_k,QB=yk;function xk(e){const t=p.useRef({value:e,previous:e});return p.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var Zd="Checkbox",[JB]=fd(Zd),[eD,tD]=JB(Zd),Ck=p.forwardRef((e,t)=>{const{__scopeCheckbox:n,name:r,checked:o,defaultChecked:s,required:a,disabled:i,value:c="on",onCheckedChange:l,form:f,...d}=e,[m,v]=p.useState(null),_=tr(t,S=>v(S)),y=p.useRef(!1),k=m?f||!!m.closest("form"):!0,[g,b]=pd({prop:o,defaultProp:s??!1,onChange:l,caller:Zd}),h=p.useRef(g);return p.useEffect(()=>{const S=m==null?void 0:m.form;if(S){const x=()=>b(h.current);return S.addEventListener("reset",x),()=>S.removeEventListener("reset",x)}},[m,b]),Fe.jsxs(eD,{scope:n,state:g,disabled:i,children:[Fe.jsx(pr.button,{type:"button",role:"checkbox","aria-checked":Ko(g)?"mixed":g,"aria-required":a,"data-state":Ik(g),"data-disabled":i?"":void 0,disabled:i,value:c,...d,ref:_,onKeyDown:Jt(e.onKeyDown,S=>{S.key==="Enter"&&S.preventDefault()}),onClick:Jt(e.onClick,S=>{b(x=>Ko(x)?!0:!x),k&&(y.current=S.isPropagationStopped(),y.current||S.stopPropagation())})}),k&&Fe.jsx(Ek,{control:m,bubbles:!y.current,name:r,value:c,checked:g,required:a,disabled:i,form:f,style:{transform:"translateX(-100%)"},defaultChecked:Ko(s)?!1:s})]})});Ck.displayName=Zd;var Tk="CheckboxIndicator",Mk=p.forwardRef((e,t)=>{const{__scopeCheckbox:n,forceMount:r,...o}=e,s=tD(Tk,n);return Fe.jsx(Pc,{present:r||Ko(s.state)||s.state===!0,children:Fe.jsx(pr.span,{"data-state":Ik(s.state),"data-disabled":s.disabled?"":void 0,...o,ref:t,style:{pointerEvents:"none",...e.style}})})});Mk.displayName=Tk;var nD="CheckboxBubbleInput",Ek=p.forwardRef(({__scopeCheckbox:e,control:t,checked:n,bubbles:r=!0,defaultChecked:o,...s},a)=>{const i=p.useRef(null),c=tr(i,a),l=xk(n),f=E_(t);p.useEffect(()=>{const m=i.current;if(!m)return;const v=window.HTMLInputElement.prototype,y=Object.getOwnPropertyDescriptor(v,"checked").set;if(l!==n&&y){const k=new Event("click",{bubbles:r});m.indeterminate=Ko(n),y.call(m,Ko(n)?!1:n),m.dispatchEvent(k)}},[l,n,r]);const d=p.useRef(Ko(n)?!1:n);return Fe.jsx(pr.input,{type:"checkbox","aria-hidden":!0,defaultChecked:o??d.current,...s,tabIndex:-1,ref:c,style:{...s.style,...f,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Ek.displayName=nD;function Ko(e){return e==="indeterminate"}function Ik(e){return Ko(e)?"indeterminate":e?"checked":"unchecked"}var rD=Ck,oD=Mk;function sD(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var Mu=sD(p),aD=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},iD=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},gv=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=iD(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return Mu.createElement("svg",aD({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),Mu.createElement("path",{d:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"}))},cD=Mu.memo?Mu.memo(gv):gv,lD=cD;const uD=yt(lD),so=J.label`
  display: block;
  color: var(--color-text-secondary);
  font-size: 0.8rem;
  font-family: inherit;
`,dD=J(rD)`
  border: 1px solid var(--color-divider);
  background-color: var(--color-background);
  width: 1.5rem;
  height: 1.5rem;
  border-radius: 0.25rem;
  display: flex;
  align-items: center;
  justify-content: center;

  &:hover {
    border-color: var(--color-text-secondary);
  }
`,fD=J(oD)`
  display: flex;
  align-items: center;
  justify-content: center;
`,hD=J(uD)`
  fill: var(--color-text);
  width: 1rem;
  height: 1rem;
`,pD=J.span`
  margin-left: 0.5rem;
`,wc=({label:e,style:t,...n})=>G(so,{style:{display:"flex",alignItems:"center",...t},children:[u(dD,{...n,children:u(fD,{children:u(hD,{})})}),u(pD,{children:e})]});function mD(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var Eu=mD(p),gD=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},vD=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},vv=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=vD(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return Eu.createElement("svg",gD({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),Eu.createElement("path",{d:"M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"}))},bD=Eu.memo?Eu.memo(vv):vv,_D=bD;const o1=yt(_D);function yD(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var Iu=yD(p),SD=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},kD=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},bv=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=kD(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return Iu.createElement("svg",SD({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),Iu.createElement("path",{d:"M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z"}))},wD=Iu.memo?Iu.memo(bv):bv,xD=wD;const CD=yt(xD),TD=J.div`
  font-size: 150%;
  font-family: var(--font-mono);
  background: var(--color-background);
  border: 1px solid var(--color-divider);
  width: 2em;
  padding: 0.25em;
  text-align: center;
`,MD=J.div`
  display: flex;
  flex-direction: column;
  align-items: center;

  svg {
    color: var(--color-text-secondary);
  }

  svg:hover {
    color: var(--color-text);
  }
`,ED=({value:e,prevValue:t,nextValue:n,className:r,onChange:o})=>{function s(a){o(a.deltaY<0?t():n())}return G(MD,{className:r,children:[u("div",{className:"button-up",onClick:()=>o(n()),children:u(CD,{})}),u(TD,{onWheel:s,children:e}),u("div",{className:"button-down",onClick:()=>o(t()),children:u(o1,{})})]})},ID=J.div`
  background: var(--color-background-secondary);
  border: 1px solid var(--color-popup-border);
  box-shadow: 0 1rem 3rem var(--color-shadow);
  padding: 0.5rem 1rem;
  border-radius: 0.5rem;
  display: flex;
  position: relative;
  top: 1rem;
  left: 0.25rem;

  &::before {
    content: "";
    width: 1rem;
    height: 1rem;
    background: var(--color-background-secondary);
    position: absolute;
    top: -0.5rem;
    left: calc(50% - 1rem);
    transform: rotate(45deg);
  }

  .button-up {
    margin-bottom: -0.4rem;
  }

  .button-down {
    margin-top: -0.1rem;
  }
`,AD=J.div`
  display: flex;
  flex-direction: column;
  justify-content: center;
  margin-left: 1rem;
`;function RD({value:e=8,values:t,triplet:n,dotted:r,onChangeValue:o,onChangeTriplet:s,onChangeDotted:a,trigger:i}){return G(YB,{children:[u(qB,{asChild:!0,children:i}),u(ZB,{children:u(OD,{children:G(ID,{children:[u(ED,{value:e,prevValue:()=>{const f=Math.max(t.indexOf(e)-1,0);return t[f]},nextValue:()=>{const f=Math.min(t.indexOf(e)+1,t.length-1);return t[f]},onChange:o}),G(AD,{children:[u(wc,{onCheckedChange:f=>s(f===!0),checked:n,label:u(N,{name:"triplet"}),style:{marginBottom:"0.5rem"}}),u(wc,{onCheckedChange:f=>a(f===!0),checked:r,label:u(N,{name:"dotted"})})]})]})})})]})}const OD=p.forwardRef(({...e},t)=>{const n=p.useRef(null);return u(QB,{onOpenAutoFocus:Jt(e.onOpenAutoFocus,()=>{n.current=document.activeElement}),onCloseAutoFocus:Jt(e.onCloseAutoFocus,()=>{var r;(r=n.current)==null||r.focus()}),ref:t,...e})}),PD=J(dk)`
  margin-right: 1em;
  align-items: stretch;
`,BD=J(Tu)`
  padding: 0.4rem;
`,DD=J(Yd)`
  top: -0.5rem;
  left: 0.1rem;
  position: relative;
  width: 0.5rem;
  height: 0.5rem;
  margin: 0 -0.1rem;
`,ND=J.span`
  color: var(--color-text-secondary);
  font-size: 70%;
  padding: 0 0.24em;
`,LD=J(Tu)`
  padding: 0;
`,zD=J.div`
  min-width: 3em;
  pointer-events: none;
  font-size: 0.9rem;
  font-family: var(--font-mono);
`,FD=J(AB)`
  width: 1.1rem;
`;function Li(e,t,n){let r=e;return t&&(r/=1.5),n&&(r*=1.5),r}const WD=it.memo(({value:e,enabled:t,onSelect:n,onClickSwitch:r})=>{const o=e%1!==0&&e*1.5%1===0,s=e/1.5%1===0,a=Li(e,s,o),i=[1,2,4,8,16,32,64,128];return G(PD,{children:[u(dr,{title:u(N,{name:"snap-to-grid"}),children:u(BD,{selected:t,onMouseDown:r,children:u(FD,{})})}),u(RD,{value:a,values:i,dotted:o,triplet:s,onChangeValue:c=>n(Li(c,o,s)),onChangeDotted:c=>n(Li(a,c,!1)),onChangeTriplet:c=>n(Li(a,!1,c)),trigger:u(LD,{onWheel:c=>{const l=i.indexOf(a),f=c.deltaY<0?1:-1,d=Math.min(i.length-1,Math.max(0,l+f));n(Li(i[d],o,s))},children:G(zD,{children:[u("span",{className:"denominator",children:a}),s&&u(ND,{children:"3"}),o&&u(DD,{})]})})})]})}),s1=()=>{const{quantize:e,setQuantize:t,isQuantizeEnabled:n,setIsQuantizeEnabled:r}=Nn(),o=p.useCallback(()=>{r(!n)},[r,n]);return u(WD,{value:e,enabled:n,onSelect:t,onClickSwitch:o})},a1=J.div`
  display: flex;
  align-items: center;
  padding: 0.5rem 1rem;
  height: 3rem;
  box-sizing: border-box;

  background: var(--color-background);
`,$D=J.div`
  font-weight: bold;
  font-size: 1rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 14rem;
  min-width: 3em;
  margin-left: 0.5rem;
`,VD=J.div`
  flex-grow: 1;
`,jD=()=>G(a1,{children:[u($D,{children:u(N,{name:"arrangement-view"})}),u(VD,{}),u(s1,{}),u(n1,{})]}),Ak=({open:e,onClickOK:t,onClose:n})=>{const[r,o]=p.useState("0");p.useEffect(()=>{e&&o("")},[e]);const s=()=>{const a=parseInt(r);t(isNaN(a)?0:a),n()};return G(hn,{open:e,onOpenChange:n,children:[u(bn,{children:u(N,{name:"transpose"})}),u(qt,{children:u(Ld,{type:"number",value:r,onChange:a=>o(a.target.value),autoFocus:!0,placeholder:"0",onKeyPress:a=>{a.key==="Enter"&&s()}})}),G(gn,{children:[u(Et,{onClick:n,children:u(N,{name:"close"})}),u(xo,{onClick:s,children:u(N,{name:"ok"})})]})]})},HD=()=>{const{openTransposeDialog:e,setOpenTransposeDialog:t}=sn(),n=PS(),r=p.useCallback(()=>t(!1),[t]),o=p.useCallback(s=>{n(s),t(!1)},[t,n]);return u(Ak,{open:e,onClose:r,onClickOK:o})},Rk=J.div`
  display: inline-flex;
  width: 1.25rem;
  height: 1.25rem;
  border: 1px solid var(--color-divider);
  align-items: center;
  justify-content: center;
  border-radius: 9999px;
`,UD=J(r5)`
  fill: var(--color-text);
  width: 0.7rem;
  height: 0.7rem;
`,GD=J.div`
  display: flex;
  padding: 0.5rem 0;
  align-items: center;

  &:hover ${Rk} {
    border-color: var(--color-text-secondary);
  }
`,XD=J.span`
  margin-left: 0.5rem;
  font-size: 0.8rem;
  color: var(--color-text-secondary);
`,Hl=({label:e,isSelected:t,onClick:n})=>G(GD,{onClick:n,children:[u(Rk,{children:t&&u(UD,{})}),u(XD,{children:e})]});function Ok(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]]);return n}var xc;(function(e){e.event="event",e.props="prop"})(xc||(xc={}));function Uo(){}function KD(e){var t,n=void 0;return function(){for(var r=[],o=arguments.length;o--;)r[o]=arguments[o];return t&&r.length===t.length&&r.every(function(s,a){return s===t[a]})||(t=r,n=e.apply(void 0,r)),n}}function Cc(e){return!!(e||"").match(/\d/)}function wa(e){return e==null}function YD(e){return typeof e=="number"&&isNaN(e)}function Pk(e){return wa(e)||YD(e)||typeof e=="number"&&!isFinite(e)}function Bk(e){return e.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}function qD(e){switch(e){case"lakh":return/(\d+?)(?=(\d\d)+(\d)(?!\d))(\.\d+)?/g;case"wan":return/(\d)(?=(\d{4})+(?!\d))/g;case"thousand":default:return/(\d)(?=(\d{3})+(?!\d))/g}}function ZD(e,t,n){var r=qD(n),o=e.search(/[1-9]/);return o=o===-1?e.length:o,e.substring(0,o)+e.substring(o,e.length).replace(r,"$1"+t)}function QD(e){var t=p.useRef(e);t.current=e;var n=p.useRef(function(){for(var r=[],o=arguments.length;o--;)r[o]=arguments[o];return t.current.apply(t,r)});return n.current}function i1(e,t){t===void 0&&(t=!0);var n=e[0]==="-",r=n&&t;e=e.replace("-","");var o=e.split("."),s=o[0],a=o[1]||"";return{beforeDecimal:s,afterDecimal:a,hasNegation:n,addNegation:r}}function JD(e){if(!e)return e;var t=e[0]==="-";t&&(e=e.substring(1,e.length));var n=e.split("."),r=n[0].replace(/^0+/,"")||"0",o=n[1]||"";return(t?"-":"")+r+(o?"."+o:"")}function Dk(e,t,n){for(var r="",o=n?"0":"",s=0;s<=t-1;s++)r+=e[s]||o;return r}function _v(e,t){return Array(t+1).join(e)}function Nk(e){var t=e+"",n=t[0]==="-"?"-":"";n&&(t=t.substring(1));var r=t.split(/[eE]/g),o=r[0],s=r[1];if(s=Number(s),!s)return n+o;o=o.replace(".","");var a=1+s,i=o.length;return a<0?o="0."+_v("0",Math.abs(a))+o:a>=i?o=o+_v("0",a-i):o=(o.substring(0,a)||"0")+"."+o.substring(a),n+o}function yv(e,t,n){if(["","-"].indexOf(e)!==-1)return e;var r=(e.indexOf(".")!==-1||n)&&t,o=i1(e),s=o.beforeDecimal,a=o.afterDecimal,i=o.hasNegation,c=parseFloat("0."+(a||"0")),l=a.length<=t?"0."+a:c.toFixed(t),f=l.split("."),d=s;s&&Number(f[0])&&(d=s.split("").reverse().reduce(function(y,k,g){return y.length>g?(Number(y[0])+Number(k)).toString()+y.substring(1,y.length):k+y},f[0]));var m=Dk(f[1]||"",t,n),v=i?"-":"",_=r?".":"";return""+v+d+_+m}function ys(e,t){if(e.value=e.value,e!==null){if(e.createTextRange){var n=e.createTextRange();return n.move("character",t),n.select(),!0}return e.selectionStart||e.selectionStart===0?(e.focus(),e.setSelectionRange(t,t),!0):(e.focus(),!1)}}var Lk=KD(function(e,t){for(var n=0,r=0,o=e.length,s=t.length;e[n]===t[n]&&n<o;)n++;for(;e[o-1-r]===t[s-1-r]&&s-r>n&&o-r>n;)r++;return{from:{start:n,end:o-r},to:{start:n,end:s-r}}}),eN=function(e,t){var n=Math.min(e.selectionStart,t);return{from:{start:n,end:e.selectionEnd},to:{start:n,end:t}}};function tN(e,t,n){return Math.min(Math.max(e,t),n)}function nh(e){return Math.max(e.selectionStart,e.selectionEnd)}function nN(){return typeof navigator<"u"&&!(navigator.platform&&/iPhone|iPod/.test(navigator.platform))}function rN(e){return{from:{start:0,end:0},to:{start:0,end:e.length},lastValue:""}}function oN(e){var t=e.currentValue,n=e.formattedValue,r=e.currentValueIndex,o=e.formattedValueIndex;return t[r]===n[o]}function sN(e,t,n,r,o,s,a){a===void 0&&(a=oN);var i=o.findIndex(function(S){return S}),c=e.slice(0,i);!t&&!n.startsWith(c)&&(t=c,n=c+n,r=r+c.length);for(var l=n.length,f=e.length,d={},m=new Array(l),v=0;v<l;v++){m[v]=-1;for(var _=0,y=f;_<y;_++){var k=a({currentValue:n,lastValue:t,formattedValue:e,currentValueIndex:v,formattedValueIndex:_});if(k&&d[_]!==!0){m[v]=_,d[_]=!0;break}}}for(var g=r;g<l&&(m[g]===-1||!s(n[g]));)g++;var b=g===l||m[g]===-1?f:m[g];for(g=r-1;g>0&&m[g]===-1;)g--;var h=g===-1||m[g]===-1?0:m[g]+1;return h>b?b:r-h<b-r?h:b}function Sv(e,t,n,r){var o=e.length;if(t=tN(t,0,o),r==="left"){for(;t>=0&&!n[t];)t--;t===-1&&(t=n.indexOf(!0))}else{for(;t<=o&&!n[t];)t++;t>o&&(t=n.lastIndexOf(!0))}return t===-1&&(t=o),t}function aN(e){for(var t=Array.from({length:e.length+1}).map(function(){return!0}),n=0,r=t.length;n<r;n++)t[n]=!!(Cc(e[n])||Cc(e[n-1]));return t}function zk(e,t,n,r,o,s){s===void 0&&(s=Uo);var a=QD(function(_,y){var k,g;return Pk(_)?(g="",k=""):typeof _=="number"||y?(g=typeof _=="number"?Nk(_):_,k=r(g)):(g=o(_,void 0),k=r(g)),{formattedValue:k,numAsString:g}}),i=p.useState(function(){return a(wa(e)?t:e,n)}),c=i[0],l=i[1],f=function(_,y){_.formattedValue!==c.formattedValue&&l({formattedValue:_.formattedValue,numAsString:_.value}),s(_,y)},d=e,m=n;wa(e)&&(d=c.numAsString,m=!0);var v=a(d,m);return p.useMemo(function(){l(v)},[v.formattedValue]),[c,f]}function iN(e){return e.replace(/[^0-9]/g,"")}function cN(e){return e}function lN(e){var t=e.type;t===void 0&&(t="text");var n=e.displayType;n===void 0&&(n="input");var r=e.customInput,o=e.renderText,s=e.getInputRef,a=e.format;a===void 0&&(a=cN);var i=e.removeFormatting;i===void 0&&(i=iN);var c=e.defaultValue,l=e.valueIsNumericString,f=e.onValueChange,d=e.isAllowed,m=e.onChange;m===void 0&&(m=Uo);var v=e.onKeyDown;v===void 0&&(v=Uo);var _=e.onMouseUp;_===void 0&&(_=Uo);var y=e.onFocus;y===void 0&&(y=Uo);var k=e.onBlur;k===void 0&&(k=Uo);var g=e.value,b=e.getCaretBoundary;b===void 0&&(b=aN);var h=e.isValidInputCharacter;h===void 0&&(h=Cc);var S=e.isCharacterSame,x=Ok(e,["type","displayType","customInput","renderText","getInputRef","format","removeFormatting","defaultValue","valueIsNumericString","onValueChange","isAllowed","onChange","onKeyDown","onMouseUp","onFocus","onBlur","value","getCaretBoundary","isValidInputCharacter","isCharacterSame"]),w=zk(g,c,!!l,a,i,f),I=w[0],M=I.formattedValue,H=I.numAsString,j=w[1],W=p.useRef(),A=p.useRef({formattedValue:M,numAsString:H}),L=function(Ee,Ge){A.current={formattedValue:Ee.formattedValue,numAsString:Ee.value},j(Ee,Ge)},B=p.useState(!1),P=B[0],V=B[1],U=p.useRef(null),X=p.useRef({setCaretTimeout:null,focusTimeout:null});p.useEffect(function(){return V(!0),function(){clearTimeout(X.current.setCaretTimeout),clearTimeout(X.current.focusTimeout)}},[]);var te=a,Y=function(Ee,Ge){var T=parseFloat(Ge);return{formattedValue:Ee,value:Ge,floatValue:isNaN(T)?void 0:T}},R=function(Ee,Ge,T){Ee.selectionStart===0&&Ee.selectionEnd===Ee.value.length||(ys(Ee,Ge),X.current.setCaretTimeout=setTimeout(function(){Ee.value===T&&Ee.selectionStart!==Ge&&ys(Ee,Ge)},0))},E=function(Ee,Ge,T){return Sv(Ee,Ge,b(Ee),T)},C=function(Ee,Ge,T){var D=b(Ge),we=sN(Ge,M,Ee,T,D,h,S);return we=Sv(Ge,we,D),we},O=function(Ee){var Ge=Ee.formattedValue;Ge===void 0&&(Ge="");var T=Ee.input,D=Ee.source,we=Ee.event,ke=Ee.numAsString,Be;if(T){var He=Ee.inputValue||T.value,Ue=nh(T);T.value=Ge,Be=C(He,Ge,Ue),Be!==void 0&&R(T,Be,Ge)}Ge!==M&&L(Y(Ge,ke),{event:we,source:D})};p.useEffect(function(){var Ee=A.current,Ge=Ee.formattedValue,T=Ee.numAsString;(M!==Ge||H!==T)&&L(Y(M,H),{event:void 0,source:xc.props})},[M,H]);var $=U.current?nh(U.current):void 0,ne=typeof window<"u"?p.useLayoutEffect:p.useEffect;ne(function(){var Ee=U.current;if(M!==A.current.formattedValue&&Ee){var Ge=C(A.current.formattedValue,M,$);Ee.value=M,R(Ee,Ge,M)}},[M]);var fe=function(Ee,Ge,T){var D=Ge.target,we=W.current?eN(W.current,D.selectionEnd):Lk(M,Ee),ke=Object.assign(Object.assign({},we),{lastValue:M}),Be=i(Ee,ke),He=te(Be);if(Be=i(He,void 0),d&&!d(Y(He,Be))){var Ue=Ge.target,Le=nh(Ue),et=C(Ee,M,Le);return Ue.value=M,R(Ue,et,M),!1}return O({formattedValue:He,numAsString:Be,inputValue:Ee,event:Ge,source:T,input:Ge.target}),!0},Z=function(Ee,Ge){Ge===void 0&&(Ge=0);var T=Ee.selectionStart,D=Ee.selectionEnd;W.current={selectionStart:T,selectionEnd:D+Ge}},se=function(Ee){var Ge=Ee.target,T=Ge.value,D=fe(T,Ee,xc.event);D&&m(Ee),W.current=void 0},de=function(Ee){var Ge=Ee.target,T=Ee.key,D=Ge.selectionStart,we=Ge.selectionEnd,ke=Ge.value;ke===void 0&&(ke="");var Be;T==="ArrowLeft"||T==="Backspace"?Be=Math.max(D-1,0):T==="ArrowRight"?Be=Math.min(D+1,ke.length):T==="Delete"&&(Be=D);var He=0;T==="Delete"&&D===we&&(He=1);var Ue=T==="ArrowLeft"||T==="ArrowRight";if(Be===void 0||D!==we&&!Ue){v(Ee),Z(Ge,He);return}var Le=Be;if(Ue){var et=T==="ArrowLeft"?"left":"right";Le=E(ke,Be,et),Le!==Be&&Ee.preventDefault()}else T==="Delete"&&!h(ke[Be])?Le=E(ke,Be,"right"):T==="Backspace"&&!h(ke[Be])&&(Le=E(ke,Be,"left"));Le!==Be&&R(Ge,Le,ke),v(Ee),Z(Ge,He)},_e=function(Ee){var Ge=Ee.target,T=function(){var D=Ge.selectionStart,we=Ge.selectionEnd,ke=Ge.value;if(ke===void 0&&(ke=""),D===we){var Be=E(ke,D);Be!==D&&R(Ge,Be,ke)}};T(),requestAnimationFrame(function(){T()}),_(Ee),Z(Ge)},Ie=function(Ee){Ee.persist&&Ee.persist();var Ge=Ee.target,T=Ee.currentTarget;U.current=Ge,X.current.focusTimeout=setTimeout(function(){var D=Ge.selectionStart,we=Ge.selectionEnd,ke=Ge.value;ke===void 0&&(ke="");var Be=E(ke,D);Be!==D&&!(D===0&&we===ke.length)&&R(Ge,Be,ke),y(Object.assign(Object.assign({},Ee),{currentTarget:T}))},0)},Ne=function(Ee){U.current=null,clearTimeout(X.current.focusTimeout),clearTimeout(X.current.setCaretTimeout),k(Ee)},Re=P&&nN()?"numeric":void 0,Pe=Object.assign({inputMode:Re},x,{type:t,value:M,onChange:se,onKeyDown:de,onMouseUp:_e,onFocus:Ie,onBlur:Ne});if(n==="text")return o?it.createElement(it.Fragment,null,o(M,x)||null):it.createElement("span",Object.assign({},x,{ref:s}),M);if(r){var je=r;return it.createElement(je,Object.assign({},Pe,{ref:s}))}return it.createElement("input",Object.assign({},Pe,{ref:s}))}function kv(e,t){var n=t.decimalScale,r=t.fixedDecimalScale,o=t.prefix;o===void 0&&(o="");var s=t.suffix;s===void 0&&(s="");var a=t.allowNegative,i=t.thousandsGroupStyle;if(i===void 0&&(i="thousand"),e===""||e==="-")return e;var c=Qd(t),l=c.thousandSeparator,f=c.decimalSeparator,d=n!==0&&e.indexOf(".")!==-1||n&&r,m=i1(e,a),v=m.beforeDecimal,_=m.afterDecimal,y=m.addNegation;return n!==void 0&&(_=Dk(_,n,!!r)),l&&(v=ZD(v,l,i)),o&&(v=o+v),s&&(_=_+s),y&&(v="-"+v),e=v+(d&&f||"")+_,e}function Qd(e){var t=e.decimalSeparator;t===void 0&&(t=".");var n=e.thousandSeparator,r=e.allowedDecimalSeparators;return n===!0&&(n=","),r||(r=[t,"."]),{decimalSeparator:t,thousandSeparator:n,allowedDecimalSeparators:r}}function uN(e,t){e===void 0&&(e="");var n=new RegExp("(-)"),r=new RegExp("(-)(.)*(-)"),o=n.test(e),s=r.test(e);return e=e.replace(/-/g,""),o&&!s&&t&&(e="-"+e),e}function dN(e,t){return new RegExp("(^-)|[0-9]|"+Bk(e),"g")}function fN(e,t,n){return e===""?!0:!(t!=null&&t.match(/\d/))&&!(n!=null&&n.match(/\d/))&&typeof e=="string"&&!isNaN(Number(e))}function hN(e,t,n){var r;t===void 0&&(t=rN(e));var o=n.allowNegative,s=n.prefix;s===void 0&&(s="");var a=n.suffix;a===void 0&&(a="");var i=n.decimalScale,c=t.from,l=t.to,f=l.start,d=l.end,m=Qd(n),v=m.allowedDecimalSeparators,_=m.decimalSeparator,y=e[d]===_;if(Cc(e)&&(e===s||e===a)&&t.lastValue==="")return e;if(d-f===1&&v.indexOf(e[f])!==-1){var k=i===0?"":_;e=e.substring(0,f)+k+e.substring(f+1,e.length)}var g=function(U,X,te){var Y=!1,R=!1;s.startsWith("-")?Y=!1:U.startsWith("--")?(Y=!1,R=!0):a.startsWith("-")&&U.length===a.length?Y=!1:U[0]==="-"&&(Y=!0);var E=Y?1:0;return R&&(E=2),E&&(U=U.substring(E),X-=E,te-=E),{value:U,start:X,end:te,hasNegation:Y}},b=g(e,f,d),h=b.hasNegation;r=b,e=r.value,f=r.start,d=r.end;var S=g(t.lastValue,c.start,c.end),x=S.start,w=S.end,I=S.value,M=e.substring(f,d);e.length&&I.length&&(x>I.length-a.length||w<s.length)&&!(M&&a.startsWith(M))&&(e=I);var H=0;e.startsWith(s)?H+=s.length:f<s.length&&(H=f),e=e.substring(H),d-=H;var j=e.length,W=e.length-a.length;e.endsWith(a)?j=W:(d>W||d>e.length-a.length)&&(j=d),e=e.substring(0,j),e=uN(h?"-"+e:e,o),e=(e.match(dN(_))||[]).join("");var A=e.indexOf(_);e=e.replace(new RegExp(Bk(_),"g"),function(U,X){return X===A?".":""});var L=i1(e,o),B=L.beforeDecimal,P=L.afterDecimal,V=L.addNegation;return l.end-l.start<c.end-c.start&&B===""&&y&&!parseFloat(P)&&(e=V?"-":""),e}function pN(e,t){var n=t.prefix;n===void 0&&(n="");var r=t.suffix;r===void 0&&(r="");var o=Array.from({length:e.length+1}).map(function(){return!0}),s=e[0]==="-";o.fill(!1,0,n.length+(s?1:0));var a=e.length;return o.fill(!1,a-r.length+1,a+1),o}function mN(e){var t=Qd(e),n=t.thousandSeparator,r=t.decimalSeparator,o=e.prefix;o===void 0&&(o="");var s=e.allowNegative;if(s===void 0&&(s=!0),n===r)throw new Error(`
        Decimal separator can't be same as thousand separator.
        thousandSeparator: `+n+` (thousandSeparator = {true} is same as thousandSeparator = ",")
        decimalSeparator: `+r+` (default value for decimalSeparator is .)
     `);return o.startsWith("-")&&s&&(console.error(`
      Prefix can't start with '-' when allowNegative is true.
      prefix: `+o+`
      allowNegative: `+s+`
    `),s=!1),Object.assign(Object.assign({},e),{allowNegative:s})}function gN(e){e=mN(e),e.decimalSeparator,e.allowedDecimalSeparators,e.thousandsGroupStyle;var t=e.suffix,n=e.allowNegative,r=e.allowLeadingZeros,o=e.onKeyDown;o===void 0&&(o=Uo);var s=e.onBlur;s===void 0&&(s=Uo);var a=e.thousandSeparator,i=e.decimalScale,c=e.fixedDecimalScale,l=e.prefix;l===void 0&&(l="");var f=e.defaultValue,d=e.value,m=e.valueIsNumericString,v=e.onValueChange,_=Ok(e,["decimalSeparator","allowedDecimalSeparators","thousandsGroupStyle","suffix","allowNegative","allowLeadingZeros","onKeyDown","onBlur","thousandSeparator","decimalScale","fixedDecimalScale","prefix","defaultValue","value","valueIsNumericString","onValueChange"]),y=Qd(e),k=y.decimalSeparator,g=y.allowedDecimalSeparators,b=function(V){return kv(V,e)},h=function(V,U){return hN(V,U,e)},S=wa(d)?f:d,x=m??fN(S,l,t);wa(d)?wa(f)||(x=x||typeof f=="number"):x=x||typeof d=="number";var w=function(V){return Pk(V)?V:(typeof V=="number"&&(V=Nk(V)),x&&typeof i=="number"?yv(V,i,!!c):V)},I=zk(w(d),w(f),!!x,b,h,v),M=I[0],H=M.numAsString,j=M.formattedValue,W=I[1],A=function(V){var U=V.target,X=V.key,te=U.selectionStart,Y=U.selectionEnd,R=U.value;if(R===void 0&&(R=""),(X==="Backspace"||X==="Delete")&&Y<l.length){V.preventDefault();return}if(te!==Y){o(V);return}X==="Backspace"&&R[0]==="-"&&te===l.length+1&&n&&ys(U,1),i&&c&&(X==="Backspace"&&R[te-1]===k?(ys(U,te-1),V.preventDefault()):X==="Delete"&&R[te]===k&&V.preventDefault()),g!=null&&g.includes(X)&&R[te]===k&&ys(U,te+1);var E=a===!0?",":a;X==="Backspace"&&R[te-1]===E&&ys(U,te-1),X==="Delete"&&R[te]===E&&ys(U,te+1),o(V)},L=function(V){var U=H;if(U.match(/\d/g)||(U=""),r||(U=JD(U)),c&&i&&(U=yv(U,i,c)),U!==H){var X=kv(U,e);W({formattedValue:X,value:U,floatValue:parseFloat(U)},{event:V,source:xc.event})}s(V)},B=function(V){return V===k?!0:Cc(V)},P=function(V){var U=V.currentValue,X=V.lastValue,te=V.formattedValue,Y=V.currentValueIndex,R=V.formattedValueIndex,E=U[Y],C=te[R],O=Lk(X,U),$=O.to,ne=function(fe){return h(fe).indexOf(".")+l.length};return d===0&&c&&i&&U[$.start]===k&&ne(U)<Y&&ne(te)>R?!1:Y>=$.start&&Y<$.end&&g&&g.includes(E)&&C===k?!0:E===C};return Object.assign(Object.assign({},_),{value:j,valueIsNumericString:!1,isValidInputCharacter:B,isCharacterSame:P,onValueChange:W,format:b,removeFormatting:h,getCaretBoundary:function(V){return pN(V,e)},onKeyDown:A,onBlur:L})}function vN(e){var t=gN(e);return it.createElement(lN,Object.assign({},t))}const Fk=({value:e,min:t,max:n,step:r,id:o,allowNegative:s=!1,onChange:a,onEnter:i,style:c,className:l})=>u(vN,{value:e,onValueChange:({floatValue:f})=>{f!==void 0&&a(f)},fixedDecimalScale:!0,allowNegative:s,style:c,className:l,onKeyDown:f=>{f.key==="Enter"&&(i==null||i())},min:t,max:n,step:r,id:o}),bN=J(Fk)`
  display: block;
  appearance: none;
  border: none;
  background: inherit;
  border: 1px solid var(--color-divider);
  border-radius: 0.25rem;
  height: 3rem;
  padding: 0 1rem;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  color: inherit;
  font-size: 1rem;
  font-family: var(--font-mono);
  outline: none;

  &:focus {
    border-color: var(--color-theme);
  }
`,_N=J.div`
  display: flex;
  flex-direction: column;
  gap: 1rem;
`,yN=J.div`
  display: flex;
  gap: 2rem;
`,Wk=({open:e,value:t,onClickOK:n,onClose:r})=>{const[o,s]=p.useState("set"),[a,i]=p.useState(t);p.useEffect(()=>{e&&i(t)},[e]);const c=p.useCallback(()=>{n(a,o),r()},[a,o,n,r]);return G(hn,{open:e,style:{minWidth:"20rem"},children:[u(bn,{children:u(N,{name:"velocity"})}),u(qt,{children:G(_N,{children:[u(bN,{value:a,onChange:i,style:{flexGrow:1},onEnter:c,allowNegative:o==="add"}),G(yN,{children:[u(Hl,{label:u(N,{name:"operation-set"}),isSelected:o==="set",onClick:()=>s("set")}),u(Hl,{label:u(N,{name:"operation-add"}),isSelected:o==="add",onClick:()=>s("add")}),u(Hl,{label:u(N,{name:"operation-multiply"}),isSelected:o==="multiply",onClick:()=>s("multiply")})]})]})}),G(gn,{children:[u(Et,{onClick:r,children:u(N,{name:"cancel"})}),u(Et,{onClick:c,children:u(N,{name:"ok"})})]})]})},SN=()=>{const{newNoteVelocity:e}=Me(),{openVelocityDialog:t,setOpenVelocityDialog:n}=sn(),r=PO(),o=p.useCallback(()=>n(!1),[n]),s=p.useCallback((a,i)=>{r({type:i,value:a}),n(!1)},[n,r]);return u(Wk,{open:t,value:e,onClickOK:s,onClose:o})},xa=e=>{if(!e.shiftKey&&e.deltaX!==0||e.shiftKey&&e.deltaY!==0)return!0;const{wheelDeltaY:t}=e;return Number.isInteger(e.deltaX)&&Number.isInteger(e.deltaY)&&Math.abs(t)%120!==0},Ks=()=>{const[e,t]=p.useState({mouseX:0,mouseY:0,isOpen:!1}),n=p.useCallback(s=>{s.preventDefault(),t({mouseX:s.clientX-2,mouseY:s.clientY-4,isOpen:!0})},[]),r=p.useCallback(()=>{t(s=>({...s,isOpen:!1}))},[]),o=p.useMemo(()=>({x:e.mouseX,y:e.mouseY}),[e.mouseX,e.mouseY]);return{onContextMenu:n,menuProps:{handleClose:r,isOpen:e.isOpen,position:o}}},kN=20;function $k(){const e=GO(),{transform:t,canvasWidth:n,scrollLeft:r}=kt(),{timeSignatures:o}=_t(),s=hi(),{quantizeRound:a}=Nn(),i=Oe(Xi),c=p.useMemo(()=>{const v=[],_=s.length>1&&s[1].x-s[0].x<=5;for(let y=0;y<s.length;y++){const k=s[y];(k.beat===0||!_)&&v.push({label:k.beat===0&&(!_||k.measure%2===0)?`${k.measure+1}`:null,x:k.x,beat:k.beat})}return v},[s]),l=p.useMemo(()=>o.filter(js(Ft.fromLength(t.getTick(r),t.getTick(n)))).map(v=>({x:t.getX(v.tick),label:`${v.numerator}/${v.denominator}`,isSelected:i.has(v.id),event:v})),[r,n,t,i,o]),f=p.useCallback(v=>{const _=v+r;return Qe.findLast(l,y=>y.x<_&&y.x+kN>=_)},[l,r]),d=p.useCallback(v=>t.getTick(v+r),[t,r]),m=p.useCallback(v=>a(d(v)),[a,d]);return{rulerBeats:c,timeSignatures:l,get selectedTimeSignatureEventIds(){return Oe(Xi)},timeSignatureHitTest:f,selectTimeSignature:xe(wN),clearSelectedTimeSignature:xe(xN),updateTimeSignature:Qo(p.useCallback((v,_,y,k)=>{v(Xi).forEach(g=>{e(g,y,k)})},[e])),getQuantizedTick:m}}const Xi=me(new Set),wN=me(null,(e,t,n)=>{t(Xi,new Set([n]))}),xN=me(null,(e,t)=>{t(Xi,new Set)});class Vk extends p.Component{constructor(){super(...arguments);ee(this,"canvas");ee(this,"ctx")}componentDidMount(){var r;const n=(r=this.canvas)==null?void 0:r.getContext("2d");if(n===null)throw new Error("failed to getContext 2d");this.ctx=n,this.drawCanvas()}componentDidUpdate(){this.drawCanvas()}drawCanvas(){this.props.draw&&this.ctx&&(this.ctx.save(),this.ctx.scale(window.devicePixelRatio,window.devicePixelRatio),this.props.draw(this.ctx),this.ctx.restore())}render(){const{width:n,height:r,draw:o,style:s,...a}=this.props;return u("canvas",{ref:i=>i&&(this.canvas=i),...a,width:Qe.isNumber(n)?n*window.devicePixelRatio:void 0,height:Qe.isNumber(r)?r*window.devicePixelRatio:void 0,style:{...s,width:n,height:r}})}}const ut=(()=>{switch(navigator.userAgent.indexOf("Mac")!=-1?"macOS":"PC"){case"macOS":return{cmdOrCtrl:"Cmd",altOrOption:"Option"};case"PC":return{cmdOrCtrl:"Ctrl",altOrOption:"Alt"}}})(),qa=({top:e,left:t,right:n,bottom:r,width:o,height:s,style:a,children:i,...c})=>{const l=p.useMemo(()=>({position:"absolute",top:e,left:t,right:n,bottom:r,width:o,height:s,...a}),[e,t,n,r,o,s,a]);return u("div",{...c,style:l,children:i})},nn=J.div`
  font-size: 0.9em;
  flex-grow: 1;
  text-align: right;
  color: var(--color-text-secondary);
  margin-left: 2em;
`,CN=J.div`
  position: fixed;
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
`,TN=J(qa)`
  background: var(--color-background-secondary);
  border-radius: 0.5rem;
  box-shadow: 0 1rem 3rem var(--color-shadow);
  border: 1px solid var(--color-popup-border);
  padding: 0.5rem 0;
`,MN=J.ul`
  list-style: none;
  padding: 0;
  margin: 0;
`,EN=200,ea=({isOpen:e,handleClose:t,position:n,children:r})=>{const o=p.useCallback(a=>a.stopPropagation(),[]);if(p.useEffect(()=>{const a=i=>{e&&i.key==="Escape"&&t()};return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[e]),!e)return u(Ke,{});const s=Math.min(n.x,window.innerWidth-EN);return u(I_,{children:u(CN,{onClick:t,children:u(qm,{children:u(TN,{left:s,top:n.y,onClick:o,children:u(MN,{children:r})})})})})};function IN(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var Au=IN(p),AN=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},RN=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},wv=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=RN(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return Au.createElement("svg",AN({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),Au.createElement("path",{d:"M7,10L12,15L17,10H7Z"}))},ON=Au.memo?Au.memo(wv):wv,PN=ON;const jk=yt(PN),BN=J.select`
  display: block;
  width: 100%;
  appearance: none;
  border: none;
  background: inherit;
  border: 1px solid var(--color-divider);
  border-radius: 0.25rem;
  height: 3rem;
  padding: 0 1rem;
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  color: inherit;
  font-size: 1rem;
  font-family: inherit;
  outline: none;

  &:focus {
    border-color: var(--color-theme);
  }

  option {
    color: var(--color-text);
    background: var(--color-background);
  }
`,DN=J(jk)`
  position: absolute;
  right: 0.5rem;
  top: 0.8rem;
  pointer-events: none;
`,NN=J.div`
  position: relative;
`,Za=e=>G(NN,{children:[u(BN,{...e}),u(DN,{})]}),LN=J(Ld)`
  width: 3em;
  text-align: center;
  font-size: 1rem;
  padding: 0.2rem 0;

  &::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
`,Hk=({initialNumerator:e=4,initialDenominator:t=4,open:n,onClose:r,onClickOK:o})=>{const[s,a]=p.useState(e),[i,c]=p.useState(t);return p.useEffect(()=>{n&&(a(e),c(t))},[n]),G(hn,{open:n,onOpenChange:r,children:[u(bn,{children:u(N,{name:"time-signature"})}),u(qt,{children:G("div",{style:{display:"flex",alignItems:"stretch",justifyContent:"center"},children:[u(LN,{value:s,type:"number",min:1,max:32,onChange:l=>a(parseInt(l.target.value)),onBlur:()=>a(Math.max(1,Math.min(32,s))),onKeyPress:l=>{l.key==="Enter"&&(l.preventDefault(),l.currentTarget.blur())}}),u("span",{style:{width:"3em",display:"flex",alignItems:"center",justifyContent:"center"},children:"/"}),u(Za,{style:{minWidth:"5em"},value:i.toString(),onChange:l=>c(parseInt(l.target.value)),children:Qe.range(0,6).map(l=>Math.pow(2,l)).map(l=>u("option",{value:l.toString(),children:l},l))})]})}),G(gn,{children:[u(Et,{autoFocus:!0,onClick:r,children:u(N,{name:"cancel"})}),u(xo,{onClick:()=>{o({numerator:s,denominator:i}),r()},disabled:isNaN(s)&&s<=32&&s>0,children:u(N,{name:"ok"})})]})]})},zN=({tick:e,...t})=>{const{handleClose:n}=t,{setLoopBegin:r,setLoopEnd:o}=Lt(),{selectedTimeSignatureEventIds:s}=$k(),{removeEvents:a}=io(),i=UO(),[c,l]=p.useState(!1),f=s.size>0,d=p.useCallback(()=>{l(!0),n()},[n]),m=p.useCallback(()=>{a(Array.from(s)),n()},[a,s,n]),v=p.useCallback(()=>{r(e),n()},[e,r,n]),_=p.useCallback(()=>{o(e),n()},[e,o,n]),y=p.useCallback(()=>{l(!1)},[]),k=p.useCallback(({numerator:g,denominator:b})=>{i(e,g,b)},[e,i]);return G(Ke,{children:[G(ea,{...t,children:[G(We,{onClick:v,children:[u(N,{name:"set-loop-start"}),G(nn,{children:[ut.cmdOrCtrl,"+Click"]})]}),G(We,{onClick:_,children:[u(N,{name:"set-loop-end"}),u(nn,{children:"Alt+Click"})]}),u(We,{onClick:d,children:u(N,{name:"add-time-signature"})}),u(We,{onClick:m,disabled:!f,children:u(N,{name:"remove-time-signature"})})]}),u(Hk,{open:c,onClose:y,onClickOK:k})]})},va=2;function FN(e,t,n,r){e.strokeStyle=r.secondaryTextColor,e.lineWidth=1,e.beginPath(),n.forEach(({beat:o,x:s,label:a})=>{o===0?(e.moveTo(s,t/2),e.lineTo(s,t)):(e.moveTo(s,t*.8),e.lineTo(s,t)),a&&(e.textBaseline="top",e.font=`12px ${r.canvasFont}`,e.fillStyle=r.secondaryTextColor,e.fillText(a,s+va,va))}),e.closePath(),e.stroke()}function WN(e,t,n,r,o){e.lineWidth=1,e.fillStyle=t.enabled?o.themeColor:o.secondaryTextColor,e.strokeStyle=t.enabled?o.themeColor:o.secondaryTextColor,e.beginPath();const a=r.getX(t.begin),i=r.getX(t.end);if(t.begin!==null){const c=a;e.moveTo(c,0),e.lineTo(c,n),e.moveTo(c,0),e.lineTo(c+8,0),e.lineTo(c,8)}if(t.end!==null){const c=i;e.moveTo(c,0),e.lineTo(c,n),e.moveTo(c,0),e.lineTo(c-8,0),e.lineTo(c,8)}e.closePath(),e.fill(),e.stroke()}function $N(e,t,n,r,o,s){e.beginPath(),e.moveTo(t,n),e.lineTo(t+r+s,n),e.lineTo(t+r,n+o),e.lineTo(t,n+o),e.lineTo(t,n),e.closePath(),e.fill()}function VN(e,t,n,r){e.textBaseline="bottom",e.font=`11px ${r.canvasFont}`,n.forEach(o=>{const s=e.measureText(o.label),a=s.actualBoundingBoxAscent+s.actualBoundingBoxDescent;e.fillStyle=o.isSelected?r.themeColor:r.secondaryBackgroundColor;const i=a+va*4;$N(e,o.x,t-i,s.width+va*2,i,a),e.fillStyle=o.isSelected?r.onSurfaceColor:r.textColor,e.fillText(o.label,o.x+va,t-va)})}const c1=({onMouseDown:e,style:t,className:n})=>{const r=$t(),{onContextMenu:o,menuProps:s}=Ks(),[a,i]=p.useState(null),[c,l]=p.useState(0),{loop:f,setLoopBegin:d,setLoopEnd:m,setPosition:v}=Lt(),_=Vt.rulerHeight,{rulerBeats:y,timeSignatures:k,timeSignatureHitTest:g,selectTimeSignature:b,clearSelectedTimeSignature:h,updateTimeSignature:S,getQuantizedTick:x}=$k(),{canvasWidth:w,scrollLeft:I,transform:M}=kt(),H=p.useCallback((P,V)=>{V.detail==2?i(P):(b(P.id),V.button===2&&(l(x(V.nativeEvent.offsetX)),o(V)))},[b,i,x,o]),j=p.useCallback(P=>{const V=x(P.nativeEvent.offsetX);P.nativeEvent.ctrlKey?d(V):P.nativeEvent.altKey?m(V):v(V)},[x,d,m,v]),W=p.useCallback(P=>{const V=g(P.nativeEvent.offsetX);V!==void 0?(H(V.event,P),j(P)):P.button==2?(l(x(P.nativeEvent.offsetX)),o(P)):(h(),j(P)),e==null||e(P)},[x,g,h,H,j,l,o,e]),A=p.useCallback(P=>{P.clearRect(0,0,w,_),P.save(),P.translate(-I+.5,0),FN(P,_,y,r),f!==null&&WN(P,f,_,M,r),VN(P,_,k,r),P.restore()},[w,_,M,I,y,k,f,r]),L=p.useCallback(()=>{i(null)},[]),B=p.useCallback(({numerator:P,denominator:V})=>S(P,V),[S]);return G(Ke,{children:[u(Vk,{draw:A,width:w,height:_,onMouseDown:W,onContextMenu:P=>P.preventDefault(),style:t,className:n}),u(zN,{...s,tick:c}),u(Hk,{open:a!=null,initialNumerator:a==null?void 0:a.numerator,initialDenominator:a==null?void 0:a.denominator,onClose:L,onClickOK:B})]})},Jd=({trackId:e})=>{const{name:t,channel:n}=wt(e);return t&&t.length>0?u(Ke,{children:t}):n===void 0?u(Ke,{children:u(N,{name:"conductor-track"})}):G(Ke,{children:[u(N,{name:"track"})," ",n+1]})};function jN(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var Ru=jN(p),HN=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},UN=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},xv=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=UN(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return Ru.createElement("svg",HN({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),Ru.createElement("path",{d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"}))},GN=Ru.memo?Ru.memo(xv):xv,XN=GN;const l1=yt(XN);function KN(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var Ou=KN(p),YN=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},qN=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},Cv=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=qN(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return Ou.createElement("svg",YN({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),Ou.createElement("path",{d:"M19,13H5V11H19V13Z"}))},ZN=Ou.memo?Ou.memo(Cv):Cv,QN=ZN;const Uk=yt(QN),Ca=J.div`
  display: flex;
  align-items: center;
  justify-content: center;

  > svg {
    width: 15px;
    height: 15px;
    transform: scale(0.8);
  }
`,JN=e=>{const t=p.useRef(null),n=zr(t),r=cr,o=n.width-r*3,s={width:r,height:r};return G(Ad,{ref:t,isVertical:!1,...e,barLength:o,children:[u(Ca,{style:s,onClick:e.onClickScaleDown,children:u(Uk,{})}),u(Ca,{style:s,onClick:e.onClickScaleReset,children:u(Yd,{})}),u(Ca,{style:s,onClick:e.onClickScaleUp,children:u(l1,{})})]})},eL=e=>{const t=p.useRef(null),n=zr(t),r=cr,o=n.height-r*3,s={width:r,height:r};return G(Ad,{ref:t,isVertical:!0,...e,barLength:o,children:[u(Ca,{style:s,onClick:e.onClickScaleUp,children:u(l1,{})}),u(Ca,{style:s,onClick:e.onClickScaleReset,children:u(Yd,{})}),u(Ca,{style:s,onClick:e.onClickScaleDown,children:u(Uk,{})})]})},Gk=(e,t)=>e.scrollOffset===t.scrollOffset&&e.contentLength===t.contentLength&&e.onScroll===t.onScroll&&e.onClickScaleDown===t.onClickScaleDown&&e.onClickScaleReset===t.onClickScaleReset&&e.onClickScaleUp===t.onClickScaleUp,Xk=it.memo(JN,Gk),Kk=it.memo(eL,Gk),tL=e=>{const{handleClose:t}=e,n=an(),{selection:r,setOpenVelocityDialog:o,setOpenTransposeDialog:s}=sn(),a=qc(),i=Wd(),c=Hm(),l=BS(),f=PS(),d=p.useMemo(()=>r!==null&&n.arrange.hasSelectionNotes(r),[r,n]),m=p.useCallback(()=>{o(!0),t()},[t,o]);return G(ea,{...e,children:[G(We,{onClick:v=>{v.stopPropagation(),t(),a(),i()},disabled:!d,children:[u(N,{name:"cut"}),G(nn,{children:[ut.cmdOrCtrl,"+X"]})]}),G(We,{onClick:v=>{v.stopPropagation(),t(),a()},disabled:!d,children:[u(N,{name:"copy"}),G(nn,{children:[ut.cmdOrCtrl,"+C"]})]}),G(We,{onClick:v=>{v.stopPropagation(),t(),c()},children:[u(N,{name:"paste"}),G(nn,{children:[ut.cmdOrCtrl,"+V"]})]}),G(We,{onClick:v=>{v.stopPropagation(),t(),l()},disabled:!d,children:[u(N,{name:"duplicate"}),G(nn,{children:[ut.cmdOrCtrl,"+D"]})]}),G(We,{onClick:v=>{v.stopPropagation(),t(),i()},disabled:!d,children:[u(N,{name:"delete"}),u(nn,{children:"Del"})]}),u(qn,{}),u(We,{onClick:v=>{v.stopPropagation(),t(),f(12)},disabled:!d,children:u(N,{name:"one-octave-up"})}),u(We,{onClick:v=>{v.stopPropagation(),t(),f(-12)},disabled:!d,children:u(N,{name:"one-octave-down"})}),G(We,{onClick:v=>{v.stopPropagation(),t(),s(!0)},disabled:!d,children:[u(N,{name:"transpose"}),u(nn,{children:"T"})]}),u(We,{onClick:m,disabled:!d,children:u(N,{name:"velocity"})})]})},nL=e=>{const{handleClose:t}=e,{selectedTrackIndex:n,selectedTrackId:r}=sn(),{tracks:o}=_t(),s=uP(),a=QS(),i=dP();return G(ea,{...e,children:[u(We,{onClick:c=>{c.stopPropagation(),s(n+1),t()},children:u(N,{name:"add-track"})}),n>0&&o.length>2&&r!==void 0&&u(We,{onClick:c=>{c.stopPropagation(),a(r),t()},children:u(N,{name:"delete-track"})}),n>0&&r!==void 0&&u(We,{onClick:c=>{c.stopPropagation(),i(r),t()},children:u(N,{name:"duplicate-track"})})]})};var mn=1e-6,Fr=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function ta(){var e=new Fr(16);return Fr!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function rL(e,t,n){var r=t[0],o=t[1],s=t[2],a=t[3],i=t[4],c=t[5],l=t[6],f=t[7],d=t[8],m=t[9],v=t[10],_=t[11],y=t[12],k=t[13],g=t[14],b=t[15],h=n[0],S=n[1],x=n[2],w=n[3];return e[0]=h*r+S*i+x*d+w*y,e[1]=h*o+S*c+x*m+w*k,e[2]=h*s+S*l+x*v+w*g,e[3]=h*a+S*f+x*_+w*b,h=n[4],S=n[5],x=n[6],w=n[7],e[4]=h*r+S*i+x*d+w*y,e[5]=h*o+S*c+x*m+w*k,e[6]=h*s+S*l+x*v+w*g,e[7]=h*a+S*f+x*_+w*b,h=n[8],S=n[9],x=n[10],w=n[11],e[8]=h*r+S*i+x*d+w*y,e[9]=h*o+S*c+x*m+w*k,e[10]=h*s+S*l+x*v+w*g,e[11]=h*a+S*f+x*_+w*b,h=n[12],S=n[13],x=n[14],w=n[15],e[12]=h*r+S*i+x*d+w*y,e[13]=h*o+S*c+x*m+w*k,e[14]=h*s+S*l+x*v+w*g,e[15]=h*a+S*f+x*_+w*b,e}function oL(e,t,n){var r=n[0],o=n[1],s=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function sL(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function aL(e,t,n,r,o,s,a){var i=1/(t-n),c=1/(r-o),l=1/(s-a);return e[0]=-2*i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+n)*i,e[13]=(o+r)*c,e[14]=(a+s)*l,e[15]=1,e}var iL=aL;function u1(e,t){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],i=e[5],c=e[6],l=e[7],f=e[8],d=e[9],m=e[10],v=e[11],_=e[12],y=e[13],k=e[14],g=e[15],b=t[0],h=t[1],S=t[2],x=t[3],w=t[4],I=t[5],M=t[6],H=t[7],j=t[8],W=t[9],A=t[10],L=t[11],B=t[12],P=t[13],V=t[14],U=t[15];return Math.abs(n-b)<=mn*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(r-h)<=mn*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(o-S)<=mn*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(s-x)<=mn*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(a-w)<=mn*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(i-I)<=mn*Math.max(1,Math.abs(i),Math.abs(I))&&Math.abs(c-M)<=mn*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(l-H)<=mn*Math.max(1,Math.abs(l),Math.abs(H))&&Math.abs(f-j)<=mn*Math.max(1,Math.abs(f),Math.abs(j))&&Math.abs(d-W)<=mn*Math.max(1,Math.abs(d),Math.abs(W))&&Math.abs(m-A)<=mn*Math.max(1,Math.abs(m),Math.abs(A))&&Math.abs(v-L)<=mn*Math.max(1,Math.abs(v),Math.abs(L))&&Math.abs(_-B)<=mn*Math.max(1,Math.abs(_),Math.abs(B))&&Math.abs(y-P)<=mn*Math.max(1,Math.abs(y),Math.abs(P))&&Math.abs(k-V)<=mn*Math.max(1,Math.abs(k),Math.abs(V))&&Math.abs(g-U)<=mn*Math.max(1,Math.abs(g),Math.abs(U))}function cL(){var e=new Fr(3);return Fr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Yk(e,t,n){var r=new Fr(3);return r[0]=e,r[1]=t,r[2]=n,r}(function(){var e=cL();return function(t,n,r,o,s,a){var i,c;for(n||(n=3),r||(r=0),o?c=Math.min(o*n+r,t.length):c=t.length,i=r;i<c;i+=n)e[0]=t[i],e[1]=t[i+1],e[2]=t[i+2],s(e,e,a),t[i]=e[0],t[i+1]=e[1],t[i+2]=e[2];return t}})();function Qa(){var e=new Fr(4);return Fr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function lL(e,t,n,r){var o=new Fr(4);return o[0]=e,o[1]=t,o[2]=n,o[3]=r,o}function uL(e,t,n,r){var o=t[0],s=t[1],a=t[2],i=t[3];return e[0]=o+r*(n[0]-o),e[1]=s+r*(n[1]-s),e[2]=a+r*(n[2]-a),e[3]=i+r*(n[3]-i),e}function dL(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function d1(e,t){var n=e[0],r=e[1],o=e[2],s=e[3],a=t[0],i=t[1],c=t[2],l=t[3];return Math.abs(n-a)<=mn*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-i)<=mn*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(o-c)<=mn*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(s-l)<=mn*Math.max(1,Math.abs(s),Math.abs(l))}(function(){var e=Qa();return function(t,n,r,o,s,a){var i,c;for(n||(n=4),r||(r=0),o?c=Math.min(o*n+r,t.length):c=t.length,i=r;i<c;i+=n)e[0]=t[i],e[1]=t[i+1],e[2]=t[i+2],e[3]=t[i+3],s(e,e,a),t[i]=e[0],t[i+1]=e[1],t[i+2]=e[2],t[i+3]=e[3];return t}})();function Pu(){var e=new Fr(2);return Fr!=Float32Array&&(e[0]=0,e[1]=0),e}function hp(e,t){var n=new Fr(2);return n[0]=e,n[1]=t,n}function pp(e,t,n){var r=t[0],o=t[1];return e[0]=n[0]*r+n[4]*o+n[12],e[1]=n[1]*r+n[5]*o+n[13],e}(function(){var e=Pu();return function(t,n,r,o,s,a){var i,c;for(n||(n=2),r||(r=0),o?c=Math.min(o*n+r,t.length):c=t.length,i=r;i<c;i+=n)e[0]=t[i],e[1]=t[i+1],s(e,e,a),t[i]=e[0],t[i+1]=e[1];return t}})();function qk(e){const r=ta(),o=e.clientWidth/e.width;return oL(r,r,Yk(o,o,o)),iL(r,0,e.clientWidth,e.clientHeight,0,0,100),r}class fL{constructor(){ee(this,"hitAreas",{});ee(this,"hoveredHitArea",null);ee(this,"onCursorChange")}setOnCursorChange(t){this.onCursorChange=t}updateCursor(){var n;if(!this.onCursorChange)return;const t=((n=this.hoveredHitArea)==null?void 0:n.cursor)??null;this.onCursorChange(t)}addHitArea(t){this.hitAreas[t.id]=t}removeHitArea(t){delete this.hitAreas[t]}getAllHitAreas(){return Object.values(this.hitAreas)}findTarget(t,n){const r=qk(n),o=pL(t,n),s=hL(o,r),a=this.getAllHitAreas();a.sort((i,c)=>c.zIndex-i.zIndex);for(const i of a)if(mL(i,s))return i;return null}handleHitAreaEvent(t,n,r){const o=t[n];if(o){let s=!1;const a=r.stopPropagation;return r.stopPropagation=function(){s=!0,a.call(this)},o(r),r.stopPropagation=a,{handled:!0,propagationStopped:s}}return{handled:!1,propagationStopped:!1}}handleGenericEvent(t,n,r){const o=this.findTarget(t,n);return o?this.handleHitAreaEvent(o,r,t):{handled:!1,propagationStopped:!1}}handleGenericMoveEvent(t,n,r){const o=this.findTarget(t,n);return o!==this.hoveredHitArea&&(this.hoveredHitArea=o,this.updateCursor()),o?this.handleHitAreaEvent(o,r,t):{handled:!1,propagationStopped:!1}}handleMouseDown(t,n){return this.handleGenericEvent(t,n,"onMouseDown")}handleMouseUp(t,n){return this.handleGenericEvent(t,n,"onMouseUp")}handleMouseMove(t,n){return this.handleGenericMoveEvent(t,n,"onMouseMove")}handleClick(t,n){return this.handleGenericEvent(t,n,"onClick")}handleWheel(t,n){return this.handleGenericEvent(t,n,"onWheel")}handlePointerDown(t,n){return this.handleGenericEvent(t,n,"onPointerDown")}handlePointerUp(t,n){return this.handleGenericEvent(t,n,"onPointerUp")}handlePointerMove(t,n){return this.handleGenericMoveEvent(t,n,"onPointerMove")}handlePointerCancel(t,n){return this.handleGenericEvent(t,n,"onPointerCancel")}}function hL(e,t){const n=Pu();return pp(n,e,t),n}function pL(e,t){const n=t.getBoundingClientRect(),r=e.clientX-n.left,o=e.clientY-n.top;return hp(r,o)}function mL({bounds:e,transform:t},n){const r=Pu(),o=Pu();return pp(r,hp(e.x,e.y),t),pp(o,hp(e.x+e.width,e.y+e.height),t),n[0]>=r[0]&&n[0]<o[0]&&n[1]<=r[1]&&n[1]>o[1]}const Zk=p.createContext(null),gL=()=>p.useContext(Zk),f1=p.createContext(null),Qk=()=>p.useContext(f1),h1=p.createContext(null),nr=()=>p.useContext(h1);let ef=class{constructor(t,n=(r,o)=>r===o){ee(this,"_isDirty");ee(this,"_value");ee(this,"isEqual");this._value=t,this._isDirty=!0,this.isEqual=n}get isDirty(){return this._isDirty}set value(t){this.isEqual(this._value,t)||(this._isDirty=!0,this._value=t)}get value(){return this._value}mark(){this._isDirty=!1}};class vL{constructor(t){ee(this,"gl");ee(this,"viewSize",new ef({width:0,height:0},(t,n)=>t.width===n.width&&t.height===n.height));ee(this,"objects",[]);ee(this,"isQueued",!1);this.gl=t}setNeedsDisplay(){this.isQueued||(this.isQueued=!0,requestAnimationFrame(()=>{this.isQueued=!1,this.render()}))}setObjects(t){this.objects=t}addObject(t){this.objects.push(t)}removeObject(t){this.objects=this.objects.filter(n=>n!==t)}clear(){const{gl:t}=this;t.clearColor(0,0,0,0),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}render(){const{gl:t}=this;this.viewSize.value={width:t.canvas.width,height:t.canvas.height},this.viewSize.isDirty&&t.viewport(0,0,t.canvas.width,t.canvas.height),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.disable(t.SAMPLE_COVERAGE),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this.clear(),this.objects.sort((n,r)=>(n.zIndex??0)-(r.zIndex??0)).forEach(n=>n.draw())}}function bL(e,t){return e.getContext("webgl2",t)??e.getContext("webgl",t)}const tl=p.forwardRef(({width:e,height:t,style:n,children:r,onInitError:o,contextAttributes:s,cursor:a,...i},c)=>{const l=p.useRef(null);p.useImperativeHandle(c,()=>l.current);const[f,d]=p.useState(null),[m,v]=p.useState(null),[_,y]=p.useState(null),k=zr(l),g=p.useCallback(B=>alert(B),[]);p.useEffect(()=>{const B=l.current;if(B===null)throw new Error("canvas is not mounted");const P=bL(B,s??{alpha:!0,antialias:!1,depth:!1,powerPreference:"high-performance",premultipliedAlpha:!0,preserveDrawingBuffer:!1});if(P===null){(o??g)("WebGL can't be initialized. May be browser doesn't support");return}const V=new vL(P),U=new fL;U.setOnCursorChange(y),d(V),v(U)},[o]);const b=p.useMemo(()=>l.current?qk(l.current):ta(),[k.width,k.height]),h=p.useCallback(B=>{var V;let P=!1;m&&l.current&&(P=m.handleMouseDown(B.nativeEvent,l.current).propagationStopped),P||(V=i.onMouseDown)==null||V.call(i,B)},[m,i.onMouseDown]),S=p.useCallback(B=>{var V;let P=!1;m&&l.current&&(P=m.handleMouseUp(B.nativeEvent,l.current).propagationStopped),P||(V=i.onMouseUp)==null||V.call(i,B)},[m,i.onMouseUp]),x=p.useCallback(B=>{var V;let P=!1;m&&l.current&&(P=m.handleMouseMove(B.nativeEvent,l.current).propagationStopped),P||(V=i.onMouseMove)==null||V.call(i,B)},[m,i.onMouseMove]),w=p.useCallback(B=>{var V;let P=!1;m&&l.current&&(P=m.handleClick(B.nativeEvent,l.current).propagationStopped),P||(V=i.onClick)==null||V.call(i,B)},[m,i.onClick]),I=p.useCallback(B=>{var V;let P=!1;m&&l.current&&(P=m.handlePointerDown(B.nativeEvent,l.current).propagationStopped),P||(V=i.onPointerDown)==null||V.call(i,B)},[m,i.onPointerDown]),M=p.useCallback(B=>{var V;let P=!1;m&&l.current&&(P=m.handlePointerUp(B.nativeEvent,l.current).propagationStopped),P||(V=i.onPointerUp)==null||V.call(i,B)},[m,i.onPointerUp]),H=p.useCallback(B=>{var V;let P=!1;m&&l.current&&(P=m.handlePointerMove(B.nativeEvent,l.current).propagationStopped),P||(V=i.onPointerMove)==null||V.call(i,B)},[m,i.onPointerMove]),j=p.useCallback(B=>{var V;let P=!1;m&&l.current&&(P=m.handlePointerCancel(B.nativeEvent,l.current).propagationStopped),P||(V=i.onPointerCancel)==null||V.call(i,B)},[m,i.onPointerCancel]),W=p.useCallback(B=>{var V;let P=!1;m&&l.current&&(P=m.handleWheel(B.nativeEvent,l.current).propagationStopped),P||(V=i.onWheel)==null||V.call(i,B)},[m,i.onWheel]),A=window.devicePixelRatio,L=p.useMemo(()=>({...n,width:e,height:t,cursor:_??a??"default"}),[n,e,t,a,_]);return Fe.jsxs(Fe.Fragment,{children:[Fe.jsx("canvas",{...i,ref:l,width:e*A,height:t*A,style:L,onMouseDown:h,onMouseUp:S,onMouseMove:x,onClick:w,onPointerDown:I,onPointerUp:M,onPointerMove:H,onPointerCancel:j,onWheel:W}),f&&m&&Fe.jsx(f1.Provider,{value:f,children:Fe.jsx(Zk.Provider,{value:m,children:Fe.jsx(h1.Provider,{value:b,children:r})})})]})});function Cr(e){return[e.x,e.y,e.x+e.width,e.y,e.x,e.y+e.height,e.x+e.width,e.y,e.x+e.width,e.y+e.height,e.x,e.y+e.height]}function p1(e){const t=[e.x,e.y,e.width,e.height];return Array(6).fill(t).flat()}let Tc=class{constructor(t,n,r,o,s=t.FLOAT){ee(this,"gl");ee(this,"position");ee(this,"size");ee(this,"type");if(this.gl=t,this.position=t.getAttribLocation(n,r),this.position<0)throw new Error(`failed to getAttribLocation ${r}`);this.size=o,this.type=s}upload(t){const{gl:n}=this;n.bindBuffer(n.ARRAY_BUFFER,t),n.vertexAttribPointer(this.position,this.size,this.type,!1,0,0),n.enableVertexAttribArray(this.position)}};function Jk(e,t,n){const r=Tv(e,e.VERTEX_SHADER,t),o=Tv(e,e.FRAGMENT_SHADER,n),s=e.createProgram();if(e.attachShader(s,r),e.attachShader(s,o),e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS)){const a=e.getProgramInfoLog(s);throw e.deleteProgram(s),new Error("Unable to initialize the shader program: "+a)}return s}function Tv(e,t,n){const r=e.createShader(t);if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){const o=e.getShaderInfoLog(r);throw e.deleteShader(r),new Error("An error occurred compiling the shaders: "+o)}return r}let m1=class{constructor(t,n,r,o,s,a){ee(this,"gl");ee(this,"bufferFactory");ee(this,"program");ee(this,"attributes");ee(this,"uniforms");this.gl=t,this.bufferFactory=a;const i=Jk(t,n,r);this.program=i,this.attributes=o(i),this.uniforms=s(i)}setUniforms(t){for(let n in t)this.uniforms[n].value=t[n]}draw(t){if(t.vertexCount===0)return;const{gl:n}=this;Object.keys(this.attributes).forEach(r=>this.attributes[r].upload(t.buffers[r])),n.useProgram(this.program),Object.values(this.uniforms).forEach(r=>r.upload(n)),n.drawArrays(n.TRIANGLES,0,t.vertexCount)}createBuffer(){return this.bufferFactory(this.gl)}},ew=class{constructor(t,n,r,o,s){ee(this,"location");ee(this,"prop");ee(this,"uploadFunc");const a=t.getUniformLocation(n,r);if(a===null)throw new Error(`failed to getUniformLocation ${r}`);this.location=a,this.prop=o,this.uploadFunc=s}set value(t){this.prop.value=t}get value(){return this.prop.value}upload(t){this.prop.isDirty&&(this.uploadFunc(t,this.location,this.prop.value),this.prop.mark())}};const g1=(e,t,n,r=ta())=>new ew(e,t,n,new ef(r,u1),(o,s,a)=>o.uniformMatrix4fv(s,!1,a)),Mc=(e,t,n,r=Qa())=>new ew(e,t,n,new ef(r,d1),(o,s,a)=>o.uniform4fv(s,a));let _L=class{constructor(t){ee(this,"gl");ee(this,"buffers");ee(this,"_vertexCount",0);this.gl=t,this.buffers={position:t.createBuffer(),bounds:t.createBuffer()}}update(t){const{gl:n}=this,r=t.flatMap(Cr);n.bindBuffer(n.ARRAY_BUFFER,this.buffers.position),n.bufferData(n.ARRAY_BUFFER,new Float32Array(r),n.DYNAMIC_DRAW);const o=t.flatMap(p1);n.bindBuffer(n.ARRAY_BUFFER,this.buffers.bounds),n.bufferData(n.ARRAY_BUFFER,new Float32Array(o),n.DYNAMIC_DRAW),this._vertexCount=t.length*6}get vertexCount(){return this._vertexCount}};const yL=e=>new m1(e,`
      precision lowp float;
      attribute vec4 aVertexPosition;

      // XYZW -> X, Y, Width, Height
      attribute vec4 aBounds;

      uniform mat4 uTransform;
      varying vec4 vBounds;
      varying vec2 vPosition;

      void main() {
        gl_Position = uTransform * aVertexPosition;
        vBounds = aBounds;
        vPosition = aVertexPosition.xy;
      }
    `,`
      precision lowp float;

      uniform vec4 uFillColor;
      uniform vec4 uStrokeColor;

      varying vec4 vBounds;
      varying vec2 vPosition;

      void main() {
        float border = 1.0;
        
        float r = vBounds.w / 2.0;
        vec2 center = vBounds.xy + vBounds.zw / 2.0;
        float len = length(vPosition - center);

        if (len < r - border) {
          gl_FragColor = uFillColor;
        } else if (len < r) {
          gl_FragColor = uStrokeColor;
        }
      }
    `,t=>({position:new Tc(e,t,"aVertexPosition",2),bounds:new Tc(e,t,"aBounds",4)}),t=>({transform:g1(e,t,"uTransform"),fillColor:Mc(e,t,"uFillColor"),strokeColor:Mc(e,t,"uStrokeColor")}),t=>new _L(t));class tw extends p.Component{constructor(n){super(n);ee(this,"node",null)}componentDidUpdate(){var n;(n=this.node)==null||n.update(this.props.buffer),this.context.setNeedsDisplay()}componentDidMount(){if(this.context===null)throw new Error("Must provide RendererContext");const n=this.context.gl;this.node=this.props.createNode(n),this.node.update(this.props.buffer),this.context.addObject(this),this.context.setNeedsDisplay()}componentWillUnmount(){this.context.removeObject(this)}shouldComponentUpdate(n){return this.props.buffer!==n.buffer||this.props.uniforms!==n.uniforms||this.props.zIndex!==n.zIndex}draw(){this.node!==null&&(this.node.setUniforms(this.props.uniforms),this.node.draw())}render(){return Fe.jsx(Fe.Fragment,{})}get zIndex(){return this.props.zIndex??0}}ee(tw,"contextType",f1);class Mv{constructor(t,n){ee(this,"shader");ee(this,"buffer");this.shader=t,this.buffer=n}update(t){this.buffer.update(t)}setUniforms(t){this.shader.setUniforms(t)}draw(){this.shader.draw(this.buffer)}}function Tr({shader:e,shaderFallback:t,uniforms:n,buffer:r,zIndex:o}){const s=p.useCallback(a=>{if(a instanceof WebGL2RenderingContext){const i=e(a),c=i.createBuffer();return new Mv(i,c)}if(t){const i=t(a),c=i.createBuffer();return new Mv(i,c)}throw new Error("Unsupported WebGL context")},[e,t]);return Fe.jsx(tw,{createNode:s,uniforms:n,buffer:r,zIndex:o})}let SL=class{constructor(t,n,r,o,s){ee(this,"location");ee(this,"prop");ee(this,"uploadFunc");const a=t.getUniformLocation(n,r);if(a===null)throw new Error(`failed to getUniformLocation ${r}`);this.location=a,this.prop=o,this.uploadFunc=s}set value(t){this.prop.value=t}get value(){return this.prop.value}upload(t){this.prop.isDirty&&(this.uploadFunc(t,this.location,this.prop.value),this.prop.mark())}};const Oo=(e=ta())=>({initialValue:e,isEqual:u1,upload:(t,n,r)=>t.uniformMatrix4fv(n,!1,r)}),fn=(e=Qa())=>({initialValue:e,isEqual:d1,upload:(t,n,r)=>t.uniform4fv(n,r)}),mp=(e=0)=>({initialValue:e,isEqual:(t,n)=>t===n,upload:(t,n,r)=>t.uniform1f(n,r)});class kL{constructor(t,n,r){ee(this,"gl");ee(this,"vao");ee(this,"buffers");this.gl=t,t.useProgram(n),this.vao=t.createVertexArray();const o={};t.bindVertexArray(this.vao),Object.keys(r).forEach(s=>{const a=r[s],i=t.getAttribLocation(n,s);if(i<0)throw new Error(`failed to getAttribLocation ${s}`);const c=t.createBuffer();o[s]=c,t.bindBuffer(t.ARRAY_BUFFER,c),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,a.size,a.type,!1,0,0),a.divisor!==void 0&&t.vertexAttribDivisor(i,a.divisor)}),t.bindVertexArray(null),this.buffers=o}updateBuffer(t,n){const{gl:r}=this;r.bindBuffer(r.ARRAY_BUFFER,this.buffers[t]),r.bufferData(r.ARRAY_BUFFER,n,r.STATIC_DRAW)}updateAllBuffers(t){Object.keys(t).forEach(n=>{this.updateBuffer(n,t[n])})}bind(){this.gl.bindVertexArray(this.vao)}unbind(){this.gl.bindVertexArray(null)}}let Po=class{constructor(t,n,r,o,s,a){ee(this,"gl");ee(this,"inputs");ee(this,"bufferFactory");ee(this,"program");ee(this,"uniforms");this.gl=t,this.inputs=o,this.bufferFactory=a,this.program=Jk(t,n,r),this.uniforms=Object.fromEntries(Object.keys(s).map(i=>{const c=i,l=s[c];return[c,new SL(t,this.program,i,new ef(l.initialValue,l.isEqual),l.upload)]}))}setUniforms(t){for(let n in t)this.uniforms[n].value=t[n]}createVertexArray(){return new kL(this.gl,this.program,this.inputs)}createBuffer(){const t=this.createVertexArray();return this.bufferFactory(t)}draw(t){if(t.vertexCount===0||"instanceCount"in t&&t.instanceCount===0)return;const{gl:n}=this;n.useProgram(this.program),t.vertexArray.bind(),Object.keys(this.uniforms).forEach(r=>this.uniforms[r].upload(n)),"instanceCount"in t?n.drawArraysInstanced(n.TRIANGLES,0,t.vertexCount,t.instanceCount):n.drawArrays(n.TRIANGLES,0,t.vertexCount),t.vertexArray.unbind()}};class nw{constructor(t){ee(this,"vertexArray");ee(this,"_instanceCount",0);this.vertexArray=t,this.vertexArray.updateBuffer("position",new Float32Array(Cr({x:0,y:0,width:1,height:1})))}update(t){this.vertexArray.updateBuffer("bounds",new Float32Array(t.flatMap(n=>[n.x,n.y,n.width,n.height]))),this._instanceCount=t.length}get vertexCount(){return 6}get instanceCount(){return this._instanceCount}}const wL=e=>new Po(e,`#version 300 es
      precision lowp float;
      in vec4 position;
      in vec4 bounds;  // x, y, width, height

      uniform mat4 transform;
      out vec4 vBounds;
      out vec2 vPosition;

      void main() {
        vec4 transformedPosition = vec4((position.xy * bounds.zw + bounds.xy), position.zw);
        gl_Position = transform * transformedPosition;
        vBounds = bounds;
        vPosition = transformedPosition.xy;
      }
    `,`#version 300 es
      precision lowp float;

      uniform vec4 fillColor;
      uniform vec4 strokeColor;

      in vec4 vBounds;
      in vec2 vPosition;

      out vec4 outColor;

      void main() {
        float border = 1.0;
        
        float r = vBounds.w / 2.0;
        vec2 center = vBounds.xy + vBounds.zw / 2.0;
        float len = length(vPosition - center);

        if (len < r - border) {
          outColor = fillColor;
        } else if (len < r) {
          outColor = strokeColor;
        }
      }
    `,{position:{size:2,type:e.FLOAT},bounds:{size:4,type:e.FLOAT,divisor:1}},{transform:Oo(),fillColor:fn(),strokeColor:fn()},t=>new nw(t)),Ev=({rects:e,fillColor:t,strokeColor:n,zIndex:r})=>{const o=nr(),s=p.useMemo(()=>({transform:o,fillColor:t,strokeColor:n}),[o,t,n]);return Fe.jsx(Tr,{shader:wL,shaderFallback:yL,uniforms:s,buffer:e,zIndex:r})};class xL{constructor(t){ee(this,"gl");ee(this,"buffers");ee(this,"_vertexCount",0);this.gl=t,this.buffers={position:t.createBuffer(),bounds:t.createBuffer()}}update(t){const{gl:n}=this,r=t.flatMap(Cr);n.bindBuffer(n.ARRAY_BUFFER,this.buffers.position),n.bufferData(n.ARRAY_BUFFER,new Float32Array(r),n.DYNAMIC_DRAW);const o=t.flatMap(p1);n.bindBuffer(n.ARRAY_BUFFER,this.buffers.bounds),n.bufferData(n.ARRAY_BUFFER,new Float32Array(o),n.DYNAMIC_DRAW),this._vertexCount=t.length*6}get vertexCount(){return this._vertexCount}}const CL=e=>new m1(e,`
      precision lowp float;
      attribute vec4 aVertexPosition;

      // XYZW -> X, Y, Width, Height
      attribute vec4 aBounds;

      uniform mat4 uTransform;
      varying vec4 vBounds;
      varying vec2 vPosition;

      void main() {
        gl_Position = uTransform * aVertexPosition;
        vBounds = aBounds;
        vPosition = aVertexPosition.xy;
      }
    `,`
      precision lowp float;

      uniform vec4 uFillColor;
      uniform vec4 uStrokeColor;

      varying vec4 vBounds;
      varying vec2 vPosition;

      void main() {
        float border = 1.0;
        float localX = vPosition.x - vBounds.x;
        float localY = vPosition.y - vBounds.y;

        if ((localX < border) || (localX >= (vBounds.z - border)) || (localY < border) || (localY > (vBounds.w - border))) {
          // draw outline
          gl_FragColor = uStrokeColor;
        } else {
          gl_FragColor = uFillColor;
        }
      }
    `,t=>({position:new Tc(e,t,"aVertexPosition",2),bounds:new Tc(e,t,"aBounds",4)}),t=>({transform:g1(e,t,"uTransform"),fillColor:Mc(e,t,"uFillColor"),strokeColor:Mc(e,t,"uStrokeColor")}),t=>new xL(t)),TL=e=>new Po(e,`#version 300 es
      precision lowp float;
      in vec4 position;
      in vec4 bounds;  // x, y, width, height

      uniform mat4 transform;
      out vec4 vBounds;
      out vec2 vPosition;

      void main() {
        vec4 transformedPosition = vec4((position.xy * bounds.zw + bounds.xy), position.zw);
        gl_Position = transform * transformedPosition;
        vBounds = bounds;
        vPosition = transformedPosition.xy;
      }
    `,`#version 300 es
      precision lowp float;

      uniform vec4 fillColor;
      uniform vec4 strokeColor;

      in vec4 vBounds;
      in vec2 vPosition;

      out vec4 outColor;

      void main() {
        float border = 1.0;
        float localX = vPosition.x - vBounds.x;
        float localY = vPosition.y - vBounds.y;

        if ((localX < border) || (localX >= (vBounds.z - border)) || (localY < border) || (localY > (vBounds.w - border))) {
          // draw outline
          outColor = strokeColor;
        } else {
          outColor = fillColor;
        }
      }
    `,{position:{size:2,type:e.FLOAT},bounds:{size:4,type:e.FLOAT,divisor:1}},{transform:Oo(),fillColor:fn(),strokeColor:fn()},t=>new nw(t)),ML=({rects:e,fillColor:t,strokeColor:n,zIndex:r})=>{const o=nr(),s=p.useMemo(()=>({transform:o,fillColor:t,strokeColor:n}),[o,t,n]);return Fe.jsx(Tr,{shader:TL,shaderFallback:CL,uniforms:s,buffer:e,zIndex:r})};function nl({component:e,fallback:t,...n}){const r=Qk(),o=p.useMemo(()=>(r==null?void 0:r.gl)instanceof WebGL2RenderingContext,[r]);return r?o?Fe.jsx(e,{...n}):Fe.jsx(t,{...n}):null}const Nr=({bounds:e,zIndex:t=0,cursor:n,onMouseDown:r,onMouseUp:o,onMouseMove:s,onClick:a,onWheel:i,onPointerDown:c,onPointerUp:l,onPointerMove:f,onPointerCancel:d})=>{const m=gL(),v=nr(),_=p.useId(),y=p.useMemo(()=>({id:_,bounds:e,transform:v,zIndex:t,cursor:n,onMouseDown:r,onMouseUp:o,onMouseMove:s,onClick:a,onWheel:i,onPointerDown:c,onPointerUp:l,onPointerMove:f,onPointerCancel:d}),[_,e,v,t,n,r,o,s,a,i,c,l,f,d]);return p.useEffect(()=>(m.addHitArea(y),()=>{m.removeHitArea(_)}),[m,y]),null};class EL{constructor(t){ee(this,"gl");ee(this,"buffers");ee(this,"_vertexCount",0);this.gl=t,this.buffers={position:t.createBuffer()}}update(t){const{gl:n}=this,r=t.flatMap(Cr);n.bindBuffer(n.ARRAY_BUFFER,this.buffers.position),n.bufferData(n.ARRAY_BUFFER,new Float32Array(r),n.DYNAMIC_DRAW),this._vertexCount=t.length*6}get vertexCount(){return this._vertexCount}}const IL=e=>new m1(e,`
      precision lowp float;
      attribute vec4 aVertexPosition;
      uniform mat4 uTransform;

      void main() {
        gl_Position = uTransform * aVertexPosition;
      }
    `,`
      precision lowp float;

      uniform vec4 uColor;

      void main() {
        gl_FragColor = uColor;
      }
    `,t=>({position:new Tc(e,t,"aVertexPosition",2)}),t=>({transform:g1(e,t,"uTransform"),color:Mc(e,t,"uColor")}),t=>new EL(t));class AL{constructor(t){ee(this,"vertexArray");ee(this,"_instanceCount",0);this.vertexArray=t,this.vertexArray.updateBuffer("position",new Float32Array(Cr({x:0,y:0,width:1,height:1})))}update(t){this.vertexArray.updateBuffer("bounds",new Float32Array(t.flatMap(n=>[n.x,n.y,n.width,n.height]))),this._instanceCount=t.length}get vertexCount(){return 6}get instanceCount(){return this._instanceCount}}const RL=e=>new Po(e,`#version 300 es
    precision lowp float;
    layout (location = 0) in vec4 position;
    layout (location = 1) in vec4 bounds; // x, y, width, height
    uniform mat4 transform;

    void main() {
      vec4 transformedPosition = vec4((position.xy * bounds.zw + bounds.xy), position.zw);
      gl_Position = transform * transformedPosition;
    }
    `,`#version 300 es
    precision lowp float;
    uniform vec4 color;
    out vec4 outColor;

    void main() {
      outColor = color;
    }
    `,{position:{size:2,type:e.FLOAT},bounds:{size:4,type:e.FLOAT,divisor:1}},{transform:Oo(),color:fn()},t=>new AL(t)),os=({rects:e,color:t,zIndex:n})=>{const r=nr(),o=p.useMemo(()=>({transform:r,color:t}),[r,t]);return Fe.jsx(Tr,{shader:RL,shaderFallback:IL,uniforms:o,buffer:e,zIndex:n})},bo=({matrix:e,children:t})=>{const n=nr(),r=ta();return rL(r,n,e),Fe.jsx(h1.Provider,{value:r,children:t})},_o=(e,t)=>{const n=ta();return sL(n,Yk(e,t,0)),n},St=e=>{const t=e.rgb().array();return[t[0]/255,t[1]/255,t[2]/255,e.alpha()]},rw=(e,t,n)=>t?e.lighten(n):e.darken(n),OL=({height:e,beats:t,zIndex:n})=>{const r=$t(),o=d=>({x:d,y:0,width:1,height:e}),[s,a]=Qe.partition(t,d=>d.beat===0),i=a.map(d=>o(d.x)),c=s.map(d=>o(d.x)),l=St(gt(r.dividerColor).alpha(.2)),f=St(gt(r.dividerColor).alpha(.5));return G(Ke,{children:[u(os,{rects:i,color:l,zIndex:n}),u(os,{rects:c,color:f,zIndex:n+.1})]})};class PL{constructor(t){ee(this,"_instanceCount",0);this.vertexArray=t,this.vertexArray.updateBuffer("position",new Float32Array(Cr({x:0,y:0,width:1,height:1})))}update(t){this.vertexArray.updateBuffer("x",new Float32Array(t)),this._instanceCount=t.length}get vertexCount(){return 6}get instanceCount(){return this._instanceCount}}const BL=e=>new Po(e,`#version 300 es
    precision lowp float;
    layout (location = 0) in vec4 position;
    layout (location = 1) in float x;
    uniform mat4 projectionMatrix;
    uniform float height;
    uniform float lineWidth;

    void main() {
      vec4 screenPosition = vec4(position.xy * vec2(lineWidth, height) + vec2(x, 0.0), position.zw);
      gl_Position = projectionMatrix * screenPosition;
    }
    `,`#version 300 es
    precision lowp float;
    uniform vec4 color;
    out vec4 outColor;

    void main() {
      outColor = color;
    }
    `,{position:{size:2,type:e.FLOAT},x:{size:1,type:e.FLOAT,divisor:1}},{projectionMatrix:Oo(),color:fn(),height:mp(),lineWidth:mp()},t=>new PL(t)),Iv=({xArray:e,color:t,height:n,lineWidth:r,zIndex:o})=>{const s=nr();return u(Tr,{shader:BL,uniforms:{projectionMatrix:s,color:t,height:n,lineWidth:r},buffer:e,zIndex:o})},rl=e=>u(nl,{component:DL,fallback:OL,...e}),DL=({height:e,beats:t,zIndex:n})=>{const r=$t(),[o,s]=Qe.partition(t,f=>f.beat===0),a=s.map(f=>f.x),i=o.map(f=>f.x),c=p.useMemo(()=>St(gt(r.editorSecondaryGridColor)),[r]),l=p.useMemo(()=>St(gt(r.editorGridColor)),[r]);return G(Ke,{children:[u(Iv,{xArray:a,color:c,height:e,lineWidth:1,zIndex:n}),u(Iv,{xArray:i,color:l,height:e,lineWidth:1,zIndex:n+.1})]})},ol=({x:e,height:t,zIndex:n})=>{const r=lL(1,0,0,1);return u(os,{rects:[{x:e,y:0,width:1,height:t}],color:r,zIndex:n})},tf=({rect:e,zIndex:t})=>{const n=$t(),{activePane:r}=Me(),o=p.useMemo(()=>r==="notes",[r]),s=p.useMemo(()=>St(o?gt(n.themeColor).fade(.9):gt(n.themeColor).fade(.95)),[o,n]),a=p.useMemo(()=>St(o?gt(n.themeColor):gt(n.themeColor).fade(.7)),[o,n]);return e===null?u(Ke,{}):u(ML,{rects:[e],fillColor:s,strokeColor:a,zIndex:t})},NL=()=>{const e=an(),{pushHistory:t}=ht(),{selection:n,trackTransform:r,setSelection:o}=sn(),{quantizeRound:s}=Nn(),{tracks:a}=_t();return{onMouseDown:p.useCallback((i,c,l)=>{if(n===null)return;let f=!1,d=n,m=e.arrange.getEventsInSelection(d);jr({onMouseMove:v=>{if(d===null)return;const _=on.sub(Qn(v),c),y=on.add(_,l);(_.x!==0||_.y!==0)&&!f&&(f=!0,t());let k=r.getArrangePoint(y);k={tick:s(k.tick),trackIndex:Math.round(k.trackIndex)},k=mu.clamp(k,a.length-(d.toTrackIndex-d.fromTrackIndex));const g=mu.sub(k,za.start(d));g.tick===0&&g.trackIndex===0||(d=za.moved(d,g),m=e.arrange.moveEventsBetweenTracks(m,g),o(d))}})},[t,s,r,a,o,n,e])}},LL=({zIndex:e})=>{const{selection:t,trackTransform:n}=sn(),{transform:r}=kt(),o=NL(),s=p.useMemo(()=>{if(t===null)return null;const i=r.getX(t.fromTick),c=r.getX(t.toTick),l=n.getY(t.fromTrackIndex),f=n.getY(t.toTrackIndex);return{x:i,width:c-i,y:l,height:f-l}},[t,n,r]),a=p.useCallback(i=>{if(s===null||i.button!==0)return;i.stopPropagation();const c=Qn(i);o.onMouseDown(i,c,s)},[o,s]);return s===null?u(Ke,{}):G(Ke,{children:[u(tf,{rect:s,zIndex:e}),u(Nr,{bounds:s,zIndex:e,onMouseDown:a})]})},zL=({width:e,zIndex:t})=>{const{trackTransform:n}=sn(),{tracks:r}=_t(),o=$t(),s=p.useCallback(l=>({x:0,y:l,width:e,height:1}),[e]),a=r.length,i=p.useMemo(()=>Qe.range(a).map((l,f)=>n.getY(f+1)-1).map(s),[a,n,s]),c=St(gt(o.dividerColor));return u(os,{rects:i,color:c,zIndex:t})};function FL(){const{songStore:e}=Ht(),t=p.useCallback(()=>new gS(()=>e.song.tracks.flatMap((n,r)=>ks(n.events.filter(en).map(o=>({tick:o.tick,duration:o.duration,event:o,trackId:n.id,trackIndex:r}))))),[e]);return vS(t)}function WL(){const e=FL();return Om(e),p.useSyncExternalStore(e.subscribe,e.getEvents)}const $L=1;function VL(){const{transform:e,trackTransform:t}=sn(),n=WL();return p.useMemo(()=>n.map(r=>{const o=e.getRect(r.event);return{...o,height:$L,y:t.getY(r.trackIndex)+o.y}}),[n,e,t])}const jL=({zIndex:e})=>{const t=VL(),n=$t();return u(os,{rects:t,color:St(gt(n.themeColor)),zIndex:e})},HL=()=>{const{scrollTop:e,setScrollTop:t}=As(),{scrollLeft:n,setScrollLeftInPixels:r,setAutoScroll:o}=kt(),s=p.useCallback(i=>{r(i),o(!1)},[r,o]);return{onMouseDown:p.useCallback(i=>{function c(f){return{x:f.clientX,y:f.clientY}}const l=c(i.nativeEvent);jr({onMouseMove(f){const d=c(f),m=on.sub(d,l);s(Math.max(0,n-m.x)),t(Math.max(0,e-m.y))}})},[n,e,s,t])}},UL=()=>{const{isPlaying:e,setPosition:t}=Lt(),{trackTransform:n,setSelectedTrackIndex:r,resetSelection:o,setSelection:s}=sn(),{quantizeRound:a,quantizeFloor:i,quantizeCeil:c}=Nn(),{tracks:l}=_t(),f=p.useCallback((d,m)=>za.fromPoints(d,m,{quantizeFloor:i,quantizeCeil:c},l.length),[i,c,l.length]);return{onMouseDown:p.useCallback((d,m,v)=>{const _=n.getArrangePoint(v);o(),e||t(a(_.tick)),r(Math.floor(_.trackIndex));let y=null;jr({onMouseMove:k=>{const g=on.sub(Qn(k),m),b=on.add(v,g),h=n.getArrangePoint(b);y=f(_,h),s(y)}})},[e,t,a,n,o,r,f,s])}},GL=()=>{const{scrollTop:e}=As(),{scrollLeft:t}=kt(),n=UL();return{onMouseDown:p.useCallback(o=>{const s={x:o.nativeEvent.offsetX+t,y:o.nativeEvent.offsetY+e},a=Qn(o.nativeEvent);n.onMouseDown(o,a,s)},[t,e,n])}},XL=({width:e,onContextMenu:t})=>{const n=hi(),{scrollTop:r,contentHeight:o}=As(),{cursorX:s,scrollLeft:a}=kt(),i=$t(),c=GL(),l=HL(),f=p.useMemo(()=>_o(-a,0),[a]),d=p.useMemo(()=>_o(0,-r),[r]),m=p.useMemo(()=>_o(-a,-r),[a,r]),v=p.useCallback(_=>{switch(_.button){case 0:c.onMouseDown(_);break;case 1:l.onMouseDown(_);break;case 2:t(_);break}},[c,l,t]);return G(tl,{width:e,height:o,onMouseDown:v,onContextMenu:p.useCallback(_=>_.preventDefault(),[]),style:{backgroundColor:i.editorBackgroundColor},children:[u(bo,{matrix:d,children:u(zL,{width:e,zIndex:0})}),G(bo,{matrix:f,children:[u(rl,{height:o,beats:n,zIndex:1}),u(ol,{x:s,height:o,zIndex:4})]}),G(bo,{matrix:m,children:[u(jL,{zIndex:2}),u(LL,{zIndex:3})]})]})},KL=()=>{const{trackTransform:e,resetSelection:t,setSelection:n}=sn(),{quantizeFloor:r,quantizeCeil:o}=Nn(),{tracks:s}=_t(),{transform:a,scrollLeft:i}=kt(),c=p.useCallback(d=>za.fromPoints({tick:d[0],trackIndex:0},{tick:d[1],trackIndex:s.length},{quantizeFloor:r,quantizeCeil:o},s.length),[r,o,s.length]);let l=null;return{onMouseDown:p.useCallback(d=>{if(d.button!==0||d.ctrlKey||d.altKey)return;const m=d.nativeEvent.offsetX+i,v=d.nativeEvent.clientX,_=a.getTick(m);t(),jr({onMouseMove:y=>{const k=y.clientX-v,g=m+k,b=a.getTick(g);l=c([_,b]),n(l)}})},[i,a,e,c,s,t])}},YL=J.div`
  flex-grow: 1;
  display: flex;
  flex-direction: row;
  position: relative;
  background: var(--color-background);
  overflow: hidden;
`,qL=J.div`
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: var(--size-ruler-height);
  box-sizing: border-box;
  border-bottom: 1px solid var(--color-divider);
  background: var(--color-background);
`,ZL=J.div`
  position: absolute;
  left: 0;
  bottom: 0;
  width: 100%;
  background: var(--color-background);
`,QL=J.div`
  width: 8rem;
  padding: 0 0.5rem;
  box-sizing: border-box;
  display: flex;
  border-bottom: 1px solid var(--color-divider);
  align-items: center;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  background: var(--color-background);

  &[data-selected="true"] {
    background-color: var(--color-background-secondary);
  }
`,JL=J.div`
  position: relative;
  border-right: 1px solid var(--color-divider);
`,ez=()=>{const{transform:e,scrollBy:t,selectedTrackIndex:n,setSelectedTrackIndex:r}=sn(),{tracks:o}=_t(),{trackHeight:s,contentHeight:a,scaleY:i,scrollTop:c,setCanvasHeight:l,setScrollTop:f,setScaleY:d}=As(),{setCanvasWidth:m,setScrollLeftInPixels:v,setScaleX:_,scaleAroundPointX:y}=kt(),{contentWidth:k,scrollLeft:g,setAutoScroll:b}=kt(),{setPath:h}=ds(),S=JS(),x=KL(),w=p.useRef(null),I=zr(w),M=p.useCallback(C=>{v(C),b(!1)},[v,b]),H=I.width,j=$t();p.useEffect(()=>{m(H)},[H,m]),p.useEffect(()=>{l(I.height)},[I.height,l]);const W=p.useCallback(()=>y(.2,0),[y]),A=p.useCallback(()=>y(-.2,0),[y]),L=p.useCallback(()=>_(1),[_]),B=p.useCallback(()=>d(i*(1+.2)),[d,i]),P=p.useCallback(()=>d(i*(1-.2)),[d,i]),V=p.useCallback(()=>d(1),[d]),{onContextMenu:U,menuProps:X}=Ks(),{onContextMenu:te,menuProps:Y}=Ks(),R=p.useCallback(C=>{if(C.shiftKey&&(C.altKey||C.ctrlKey)){let O=xa(C.nativeEvent)?.02*C.deltaY:.01*C.deltaX;O=Qe.clamp(O,-.15,.15),d(i*(1+O))}else if(C.altKey||C.ctrlKey){const O=xa(C.nativeEvent)?.01:-.01,$=Qe.clamp(C.deltaY*O,-.15,.15);y($,C.nativeEvent.offsetX)}else{const O=xa(C.nativeEvent)?1:20*e.pixelsPerKey*__,$=C.deltaY*O;t(-C.deltaX,-$)}},[d,i,y,t,e.pixelsPerKey]),E=C=>{h("/track"),S(C)};return G(YL,{children:[G(JL,{children:[u("div",{style:{marginTop:Vt.rulerHeight,transform:`translateY(${-c}px)`},children:o.map((C,O)=>u(QL,{style:{height:s},"data-selected":O===n,onClick:()=>r(O),onDoubleClick:()=>E(C.id),onContextMenu:$=>{r(O),te($)},children:u(Jd,{trackId:C.id})},O))}),u(ZL,{style:{height:cr}})]}),u(qL,{}),G("div",{style:{display:"flex",flexGrow:1,flexDirection:"column",position:"relative",overflow:"hidden"},children:[G("div",{ref:w,onWheel:R,style:{display:"flex",flexGrow:1,flexDirection:"column",position:"relative",overflow:"hidden",background:j.darkBackgroundColor},children:[u(c1,{...x,style:{background:j.backgroundColor,borderBottom:`1px solid ${j.dividerColor}`,boxSizing:"border-box"}}),u(XL,{width:H,onContextMenu:U})]}),u("div",{style:{width:`calc(100% - ${cr}px)`,position:"absolute",bottom:0},children:u(Xk,{scrollOffset:g,contentLength:k,onScroll:M,onClickScaleUp:W,onClickScaleDown:A,onClickScaleReset:L})})]}),u("div",{style:{height:`calc(100% - ${cr}px)`,position:"absolute",top:0,right:0},children:u(Kk,{scrollOffset:c,contentLength:a-cr,onScroll:f,onClickScaleUp:B,onClickScaleDown:P,onClickScaleReset:V})}),u("div",{style:{width:cr,height:cr,position:"absolute",bottom:0,right:0,background:j.backgroundColor}}),u(tL,{...X}),u(nL,{...Y})]})},tz=J.div`
  overflow: hidden;
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  position: relative;
  outline: none;
`,nz=()=>{const e=FP(),t=Qm();return G(Ke,{children:[G(tz,{...e,tabIndex:0,ref:t,children:[u(jD,{}),u(ez,{})]}),u(HD,{}),u(SN,{})]})},rz=()=>u(hA,{children:u(nz,{})});J.div`
  position: absolute;
  right: 0;
  top: 0;
  pointer-events: none;
  background: black;
  color: #00ffd3;
  opacity: 0.5;
  z-index: 999999;
  padding: 0.25em 0.5em;
  font-size: 0.7rem;
  font-family: Consolas, monospace;
`;const oz=()=>u(Ke,{});function sz(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var Bu=sz(p),az=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},iz=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},Av=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=iz(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return Bu.createElement("svg",az({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),Bu.createElement("path",{d:"M11,4H13V16L18.5,10.5L19.92,11.92L12,19.84L4.08,11.92L5.5,10.5L11,16V4Z"}))},cz=Bu.memo?Bu.memo(Av):Av,lz=cz;const uz=yt(lz);function dz(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var Du=dz(p),fz=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},hz=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},Rv=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=hz(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return Du.createElement("svg",fz({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),Du.createElement("path",{d:"M13,20H11V8L5.5,13.5L4.08,12.08L12,4.16L19.92,12.08L18.5,13.5L13,8V20Z"}))},pz=Du.memo?Du.memo(Rv):Rv,mz=pz;const gz=yt(mz),vz=()=>async e=>{const t=await pi.get(e.songDataId),n=Md(t);return n.name=e.name,n.cloudSongId=e.id,n.cloudSongDataId=e.songDataId,n.isSaved=!0,n},bz=()=>{const{onUserExplicitAction:e}=Ao();return async t=>{const n=rs(t),r=await pi.create({data:n}),o=await Js.create({name:t.name,songDataId:r});t.cloudSongDataId=r,t.cloudSongId=o,t.isSaved=!0,e()}},_z=()=>{const{onUserExplicitAction:e}=Ao();return async t=>{if(t.cloudSongId===null||t.cloudSongDataId===null)throw new Error("This song is not loaded from the cloud");const n=rs(t);await Js.update(t.cloudSongId,{name:t.name}),await pi.update(t.cloudSongDataId,{data:n}),t.isSaved=!0,e()}},yz=()=>async e=>{const t=await T0.storeMidiFile(e),n=await T0.get(t),r=Md(n);return r.name=Nm(e)??"",r.isSaved=!0,r},Sz=()=>async e=>{const t=await Rm.getCurrentUser();if(t===null)throw new Error("Failed to get current user, please re-sign in");if(e.cloudSongId===null||e.cloudSongDataId===null)throw new Error("This song is not saved in the cloud");await pi.publish(e.cloudSongDataId),await Js.publish(e.cloudSongId,t)},kz=()=>async e=>{if(e.cloudSongId===null||e.cloudSongDataId===null)throw new Error("This song is not loaded from the cloud");await pi.unpublish(e.cloudSongDataId),await Js.unpublish(e.cloudSongId)},nf=()=>{const{setOpenCloudFileDialog:e,setOpenPublishDialog:t}=Ln(),{cloudSongId:n,name:r,setName:o,isSaved:s,getSong:a}=_t(),i=Io(),c=o5(),l=A_(),{show:f}=R_(),d=er(),m=Ro(),v=qS(),_=YS(),y=XS(),k=_z(),g=bz(),{onUserExplicitAction:b}=Ao(),h=aw(),S=xz(),x=async()=>{if(n!==null){if(r.length===0){const M=await c.show({title:d["save-as"]});M!==null&&M.length>0&&o(M)}const I=f(d["song-saving"]);try{await k(a()),i.success(d["song-saved"])}catch(M){alert(M.message)}finally{I()}}else{if(r.length===0){const M=await c.show({title:d["save-as"]});M!==null&&M.length>0&&o(M)}const I=f(d["song-saving"]);try{await g(a()),i.success(d["song-created"])}catch(M){alert(M.message)}finally{I()}}},w=async()=>{if(s)return!0;switch(await l.show({title:d["save-changes"],actions:[{title:d.yes,key:"yes"},{title:d.no,key:"no"},{title:d.cancel,key:"cancel"}]})){case"yes":return await x(),!0;case"no":return!0;case"cancel":return!1}};return{get isLoading(){return Oe(ow)},get dateType(){return Oe(vp)},get files(){return Oe(wz)},get selectedColumn(){return Oe(gp)},get sortAscending(){return Oe(bp)},setDateType:xe(vp),setSelectedColumn:xe(gp),setSortAscending:xe(bp),loadFiles:h,async createNewSong(){try{if(!await w())return;const I=gm();m(I),await g(I),i.success(d["song-created"])}catch(I){i.error(I.message)}},async openSong(){try{if(!await w())return;e(!0)}catch(I){i.error(I.message)}},async saveSong(){await x()},async saveAsSong(){try{const I=await c.show({title:d["save-as"],initialText:r});if(I!==null&&I.length>0)o(I);else return;await g(a()),i.success(d["song-saved"])}catch(I){i.error(I.message)}},async renameSong(){try{const I=await c.show({title:d.rename});if(I!==null&&I.length>0)o(I);else return Promise.resolve(!1);n!==null?await k(a()):await g(a()),i.success(d["song-saved"])}catch(I){i.error(I.message)}},async importSong(){try{if(!await w())return;await y(),await x()}catch(I){i.error(I.message)}},async importSongLegacy(I){try{await v(I.currentTarget),await x()}catch(M){i.error(M.message)}},async exportSong(){try{Rr?(await Ym(a()),b()):_()}catch(I){i.error(I.message)}},async publishSong(){t(!0)},deleteSong:S}},ow=me(!1),gp=me("date"),vp=me("created"),bp=me(!1),sw=me([]),wz=me(e=>{const t=e(sw),n=e(gp),r=e(vp),o=e(bp);return Qe.orderBy(t,s=>{switch(n){case"name":return s.name;case"date":switch(r){case"created":return s.createdAt.getTime();case"updated":return s.updatedAt.getTime()}}},o?"asc":"desc")});function xz(){const{songStore:e}=Ht(),t=aw();return async n=>{await pi.delete(n.songDataId),await Js.delete(n.id),e.song.cloudSongId===n.id&&(e.song.cloudSongId=null,e.song.cloudSongDataId=null),await t()}}function aw(){const e=xe(ow),t=xe(sw);return async()=>{e(!0);const n=await Js.getMySongs();t(n),e(!1)}}const iw=J.button`
  width: 2rem;
  height: 2rem;
  display: flex;
  align-items: center;
  justify-content: center;
  border: none;
  border-radius: 999px;
  background: none;
  color: var(--color-text-secondary);
  cursor: pointer;

  &:hover {
    background: var(--color-highlight);
  }
`;function Cz(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var Nu=Cz(p),Tz=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Mz=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},Ov=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=Mz(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return Nu.createElement("svg",Tz({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),Nu.createElement("path",{d:"M16,12A2,2 0 0,1 18,10A2,2 0 0,1 20,12A2,2 0 0,1 18,14A2,2 0 0,1 16,12M10,12A2,2 0 0,1 12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12M4,12A2,2 0 0,1 6,10A2,2 0 0,1 8,12A2,2 0 0,1 6,14A2,2 0 0,1 4,12Z"}))},Ez=Nu.memo?Nu.memo(Ov):Ov,Iz=Ez;const cw=yt(Iz),Az=J.div`
  display: flex;
  cursor: pointer;
  height: 2.5rem;
  overflow: hidden;

  &:hover {
    background: var(--color-background-secondary);
  }
`,v1=J.div`
  display: flex;
  align-items: center;
  padding: 0 1rem;
  box-sizing: border-box;
`,Rz=J(v1)`
  overflow: hidden;
  flex-grow: 1;
`,Oz=J(v1)`
  width: 12rem;
  flex-shrink: 0;
`,Pz=J(v1)`
  width: 4rem;
  flex-shrink: 0;
`,Bz=J.span`
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
`,Dz=({song:e,onClick:t,dateType:n})=>{const r=$t(),o=Io(),s=er(),{deleteSong:a}=nf(),i=(()=>{switch(n){case"created":return e.createdAt;case"updated":return e.updatedAt}})(),c=e.name.length>0?e.name:s["untitled-song"],l=i.toLocaleDateString()+" "+i.toLocaleTimeString();return G(Az,{onClick:t,children:[u(Rz,{children:u(Bz,{children:c})}),u(Oz,{children:l}),u(Pz,{children:u(Qc,{trigger:u(iw,{style:{marginLeft:"0.2em"},children:u(cw,{style:{fill:r.secondaryTextColor}})}),children:u(We,{onClick:async f=>{f.stopPropagation();try{await a(e),o.info(s["song-deleted"])}catch(d){console.error(d),o.error(s["song-delete-failed"])}},children:u(N,{name:"delete"})})})})]})},Nz=J(gz)`
  width: 1.1rem;
  height: 1.1rem;
`,Lz=J(uz)`
  width: 1.1rem;
  height: 1.1rem;
`,b1=J.div`
  display: flex;
  align-items: center;
  background: var(--color-background);
  cursor: pointer;
  padding: 0 1rem;
  box-sizing: border-box;

  &:hover {
    background: var(--color-background-secondary);
  }

  &[data-selected="true"] {
    font-weight: bold;
  }
`,zz=J(b1)`
  flex-grow: 1;
`,Fz=J(b1)`
  width: 12rem;
`,Wz=J(b1)`
  width: 4rem;
`,$z=J.div`
  max-height: 20rem;
  overflow-y: auto;

  tr:hover td {
    background: var(--color-background-secondary);
  }
`,Pv=({sortAscending:e})=>e?u(Lz,{}):u(Nz,{}),Vz=J.div``,jz=J.div`
  display: flex;
  height: 2.5rem;
`,Hz=()=>{const{isLoading:e,dateType:t,files:n,selectedColumn:r,sortAscending:o,loadFiles:s,setDateType:a,setSelectedColumn:i,setSortAscending:c}=nf(),{setOpenCloudFileDialog:l}=Ln(),f=Ro(),d=vz(),m=Io(),v=$t(),_=er();p.useEffect(()=>{s()},[]);const y=async g=>{try{const b=await d(g);f(b),l(!1)}catch(b){m.error(b.message)}};if(e)return u(Kc,{});if(n.length===0)return u(N,{name:"no-files"});const k=(()=>{switch(t){case"created":return _["created-date"];case"updated":return _["modified-date"]}})();return G(Vz,{children:[G(jz,{children:[G(zz,{onClick:()=>{r==="name"?c(!o):i("name")},"data-selected":r==="name",children:[u(N,{name:"name"}),u("div",{style:{width:"0.5rem"}}),r==="name"&&u(Pv,{sortAscending:o})]}),G(Fz,{onClick:()=>{r==="date"?c(!o):i("date")},"data-selected":r==="date",children:[k,G(Qc,{trigger:u(iw,{style:{marginLeft:"0.2em"},children:u(jk,{style:{fill:v.secondaryTextColor}})}),children:[u(We,{onClick:()=>a("created"),children:u(N,{name:"created-date"})}),u(We,{onClick:()=>a("updated"),children:u(N,{name:"modified-date"})})]}),r==="date"&&u(Pv,{sortAscending:o})]}),u(Wz,{})]}),u($z,{children:n.map(g=>u(Dz,{song:g,dateType:t,onClick:()=>y(g)},g.id))})]})},Uz=()=>{const{openCloudFileDialog:e,setOpenCloudFileDialog:t}=Ln(),n=p.useCallback(()=>t(!1),[t]);return G(hn,{open:e,onOpenChange:n,style:{minWidth:"30rem"},children:[u(bn,{children:u(N,{name:"files"})}),u(qt,{children:u(Hz,{})}),u(gn,{children:u(Et,{onClick:n,children:u(N,{name:"close"})})})]})};function Gz(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return p.useMemo(()=>r=>{t.forEach(o=>o(r))},t)}const rf=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function yi(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function _1(e){return"nodeType"in e}function rr(e){var t,n;return e?yi(e)?e:_1(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function y1(e){const{Document:t}=rr(e);return e instanceof t}function sl(e){return yi(e)?!1:e instanceof rr(e).HTMLElement}function lw(e){return e instanceof rr(e).SVGElement}function Si(e){return e?yi(e)?e.document:_1(e)?y1(e)?e:sl(e)||lw(e)?e.ownerDocument:document:document:document}const ao=rf?p.useLayoutEffect:p.useEffect;function S1(e){const t=p.useRef(e);return ao(()=>{t.current=e}),p.useCallback(function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t.current==null?void 0:t.current(...r)},[])}function Xz(){const e=p.useRef(null),t=p.useCallback((r,o)=>{e.current=setInterval(r,o)},[]),n=p.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function Ec(e,t){t===void 0&&(t=[e]);const n=p.useRef(e);return ao(()=>{n.current!==e&&(n.current=e)},t),n}function al(e,t){const n=p.useRef();return p.useMemo(()=>{const r=e(n.current);return n.current=r,r},[...t])}function Lu(e){const t=S1(e),n=p.useRef(null),r=p.useCallback(o=>{o!==n.current&&(t==null||t(o,n.current)),n.current=o},[]);return[n,r]}function _p(e){const t=p.useRef();return p.useEffect(()=>{t.current=e},[e]),t.current}let rh={};function il(e,t){return p.useMemo(()=>{if(t)return t;const n=rh[e]==null?0:rh[e]+1;return rh[e]=n,e+"-"+n},[e,t])}function uw(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return r.reduce((s,a)=>{const i=Object.entries(a);for(const[c,l]of i){const f=s[c];f!=null&&(s[c]=f+e*l)}return s},{...t})}}const Ta=uw(1),zu=uw(-1);function Kz(e){return"clientX"in e&&"clientY"in e}function k1(e){if(!e)return!1;const{KeyboardEvent:t}=rr(e.target);return t&&e instanceof t}function Yz(e){if(!e)return!1;const{TouchEvent:t}=rr(e.target);return t&&e instanceof t}function yp(e){if(Yz(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return Kz(e)?{x:e.clientX,y:e.clientY}:null}const Ic=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[Ic.Translate.toString(e),Ic.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),Bv="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function qz(e){return e.matches(Bv)?e:e.querySelector(Bv)}const Zz={display:"none"};function Qz(e){let{id:t,value:n}=e;return it.createElement("div",{id:t,style:Zz},n)}function Jz(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;const o={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return it.createElement("div",{id:t,style:o,role:"status","aria-live":r,"aria-atomic":!0},n)}function eF(){const[e,t]=p.useState("");return{announce:p.useCallback(r=>{r!=null&&t(r)},[]),announcement:e}}const dw=p.createContext(null);function tF(e){const t=p.useContext(dw);p.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function nF(){const[e]=p.useState(()=>new Set),t=p.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[p.useCallback(r=>{let{type:o,event:s}=r;e.forEach(a=>{var i;return(i=a[o])==null?void 0:i.call(a,s)})},[e]),t]}const rF={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},oF={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function sF(e){let{announcements:t=oF,container:n,hiddenTextDescribedById:r,screenReaderInstructions:o=rF}=e;const{announce:s,announcement:a}=eF(),i=il("DndLiveRegion"),[c,l]=p.useState(!1);if(p.useEffect(()=>{l(!0)},[]),tF(p.useMemo(()=>({onDragStart(d){let{active:m}=d;s(t.onDragStart({active:m}))},onDragMove(d){let{active:m,over:v}=d;t.onDragMove&&s(t.onDragMove({active:m,over:v}))},onDragOver(d){let{active:m,over:v}=d;s(t.onDragOver({active:m,over:v}))},onDragEnd(d){let{active:m,over:v}=d;s(t.onDragEnd({active:m,over:v}))},onDragCancel(d){let{active:m,over:v}=d;s(t.onDragCancel({active:m,over:v}))}}),[s,t])),!c)return null;const f=it.createElement(it.Fragment,null,it.createElement(Qz,{id:r,value:o.draggable}),it.createElement(Jz,{id:i,announcement:a}));return n?Wi.createPortal(f,n):f}var vn;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(vn||(vn={}));function Fu(){}function aF(e,t){return p.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function iF(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return p.useMemo(()=>[...t].filter(r=>r!=null),[...t])}const Wr=Object.freeze({x:0,y:0});function cF(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function lF(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return n-r}function uF(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function dF(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function Dv(e,t,n){return t===void 0&&(t=e.left),n===void 0&&(n=e.top),{x:t+e.width*.5,y:n+e.height*.5}}const fF=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const o=Dv(t,t.left,t.top),s=[];for(const a of r){const{id:i}=a,c=n.get(i);if(c){const l=cF(Dv(c),o);s.push({id:i,data:{droppableContainer:a,value:l}})}}return s.sort(lF)};function hF(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),o=Math.min(t.left+t.width,e.left+e.width),s=Math.min(t.top+t.height,e.top+e.height),a=o-r,i=s-n;if(r<o&&n<s){const c=t.width*t.height,l=e.width*e.height,f=a*i,d=f/(c+l-f);return Number(d.toFixed(4))}return 0}const pF=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const o=[];for(const s of r){const{id:a}=s,i=n.get(a);if(i){const c=hF(i,t);c>0&&o.push({id:a,data:{droppableContainer:s,value:c}})}}return o.sort(uF)};function mF(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function fw(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:Wr}function gF(e){return function(n){for(var r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];return o.reduce((a,i)=>({...a,top:a.top+e*i.y,bottom:a.bottom+e*i.y,left:a.left+e*i.x,right:a.right+e*i.x}),{...n})}}const vF=gF(1);function bF(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function _F(e,t,n){const r=bF(t);if(!r)return e;const{scaleX:o,scaleY:s,x:a,y:i}=r,c=e.left-a-(1-o)*parseFloat(n),l=e.top-i-(1-s)*parseFloat(n.slice(n.indexOf(" ")+1)),f=o?e.width/o:e.width,d=s?e.height/s:e.height;return{width:f,height:d,top:l,right:c+f,bottom:l+d,left:c}}const yF={ignoreTransform:!1};function ki(e,t){t===void 0&&(t=yF);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:l,transformOrigin:f}=rr(e).getComputedStyle(e);l&&(n=_F(n,l,f))}const{top:r,left:o,width:s,height:a,bottom:i,right:c}=n;return{top:r,left:o,width:s,height:a,bottom:i,right:c}}function Nv(e){return ki(e,{ignoreTransform:!0})}function SF(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function kF(e,t){return t===void 0&&(t=rr(e).getComputedStyle(e)),t.position==="fixed"}function wF(e,t){t===void 0&&(t=rr(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(o=>{const s=t[o];return typeof s=="string"?n.test(s):!1})}function w1(e,t){const n=[];function r(o){if(t!=null&&n.length>=t||!o)return n;if(y1(o)&&o.scrollingElement!=null&&!n.includes(o.scrollingElement))return n.push(o.scrollingElement),n;if(!sl(o)||lw(o)||n.includes(o))return n;const s=rr(e).getComputedStyle(o);return o!==e&&wF(o,s)&&n.push(o),kF(o,s)?n:r(o.parentNode)}return e?r(e):n}function hw(e){const[t]=w1(e,1);return t??null}function oh(e){return!rf||!e?null:yi(e)?e:_1(e)?y1(e)||e===Si(e).scrollingElement?window:sl(e)?e:null:null}function pw(e){return yi(e)?e.scrollX:e.scrollLeft}function mw(e){return yi(e)?e.scrollY:e.scrollTop}function Sp(e){return{x:pw(e),y:mw(e)}}var kn;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(kn||(kn={}));function gw(e){return!rf||!e?!1:e===document.scrollingElement}function vw(e){const t={x:0,y:0},n=gw(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},o=e.scrollTop<=t.y,s=e.scrollLeft<=t.x,a=e.scrollTop>=r.y,i=e.scrollLeft>=r.x;return{isTop:o,isLeft:s,isBottom:a,isRight:i,maxScroll:r,minScroll:t}}const xF={x:.2,y:.2};function CF(e,t,n,r,o){let{top:s,left:a,right:i,bottom:c}=n;r===void 0&&(r=10),o===void 0&&(o=xF);const{isTop:l,isBottom:f,isLeft:d,isRight:m}=vw(e),v={x:0,y:0},_={x:0,y:0},y={height:t.height*o.y,width:t.width*o.x};return!l&&s<=t.top+y.height?(v.y=kn.Backward,_.y=r*Math.abs((t.top+y.height-s)/y.height)):!f&&c>=t.bottom-y.height&&(v.y=kn.Forward,_.y=r*Math.abs((t.bottom-y.height-c)/y.height)),!m&&i>=t.right-y.width?(v.x=kn.Forward,_.x=r*Math.abs((t.right-y.width-i)/y.width)):!d&&a<=t.left+y.width&&(v.x=kn.Backward,_.x=r*Math.abs((t.left+y.width-a)/y.width)),{direction:v,speed:_}}function TF(e){if(e===document.scrollingElement){const{innerWidth:s,innerHeight:a}=window;return{top:0,left:0,right:s,bottom:a,width:s,height:a}}const{top:t,left:n,right:r,bottom:o}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:o,width:e.clientWidth,height:e.clientHeight}}function bw(e){return e.reduce((t,n)=>Ta(t,Sp(n)),Wr)}function MF(e){return e.reduce((t,n)=>t+pw(n),0)}function EF(e){return e.reduce((t,n)=>t+mw(n),0)}function IF(e,t){if(t===void 0&&(t=ki),!e)return;const{top:n,left:r,bottom:o,right:s}=t(e);hw(e)&&(o<=0||s<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const AF=[["x",["left","right"],MF],["y",["top","bottom"],EF]];class x1{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=w1(n),o=bw(r);this.rect={...t},this.width=t.width,this.height=t.height;for(const[s,a,i]of AF)for(const c of a)Object.defineProperty(this,c,{get:()=>{const l=i(r),f=o[s]-l;return this.rect[c]+f},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Ki{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=t}add(t,n,r){var o;(o=this.target)==null||o.addEventListener(t,n,r),this.listeners.push([t,n,r])}}function RF(e){const{EventTarget:t}=rr(e);return e instanceof t?e:Si(e)}function sh(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t?r>t.y:!1}var _r;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(_r||(_r={}));function Lv(e){e.preventDefault()}function OF(e){e.stopPropagation()}var Pt;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(Pt||(Pt={}));const _w={start:[Pt.Space,Pt.Enter],cancel:[Pt.Esc],end:[Pt.Space,Pt.Enter,Pt.Tab]},PF=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case Pt.Right:return{...n,x:n.x+25};case Pt.Left:return{...n,x:n.x-25};case Pt.Down:return{...n,y:n.y+25};case Pt.Up:return{...n,y:n.y-25}}};class yw{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new Ki(Si(n)),this.windowListeners=new Ki(rr(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(_r.Resize,this.handleCancel),this.windowListeners.add(_r.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(_r.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,r=t.node.current;r&&IF(r),n(Wr)}handleKeyDown(t){if(k1(t)){const{active:n,context:r,options:o}=this.props,{keyboardCodes:s=_w,coordinateGetter:a=PF,scrollBehavior:i="smooth"}=o,{code:c}=t;if(s.end.includes(c)){this.handleEnd(t);return}if(s.cancel.includes(c)){this.handleCancel(t);return}const{collisionRect:l}=r.current,f=l?{x:l.left,y:l.top}:Wr;this.referenceCoordinates||(this.referenceCoordinates=f);const d=a(t,{active:n,context:r.current,currentCoordinates:f});if(d){const m=zu(d,f),v={x:0,y:0},{scrollableAncestors:_}=r.current;for(const y of _){const k=t.code,{isTop:g,isRight:b,isLeft:h,isBottom:S,maxScroll:x,minScroll:w}=vw(y),I=TF(y),M={x:Math.min(k===Pt.Right?I.right-I.width/2:I.right,Math.max(k===Pt.Right?I.left:I.left+I.width/2,d.x)),y:Math.min(k===Pt.Down?I.bottom-I.height/2:I.bottom,Math.max(k===Pt.Down?I.top:I.top+I.height/2,d.y))},H=k===Pt.Right&&!b||k===Pt.Left&&!h,j=k===Pt.Down&&!S||k===Pt.Up&&!g;if(H&&M.x!==d.x){const W=y.scrollLeft+m.x,A=k===Pt.Right&&W<=x.x||k===Pt.Left&&W>=w.x;if(A&&!m.y){y.scrollTo({left:W,behavior:i});return}A?v.x=y.scrollLeft-W:v.x=k===Pt.Right?y.scrollLeft-x.x:y.scrollLeft-w.x,v.x&&y.scrollBy({left:-v.x,behavior:i});break}else if(j&&M.y!==d.y){const W=y.scrollTop+m.y,A=k===Pt.Down&&W<=x.y||k===Pt.Up&&W>=w.y;if(A&&!m.x){y.scrollTo({top:W,behavior:i});return}A?v.y=y.scrollTop-W:v.y=k===Pt.Down?y.scrollTop-x.y:y.scrollTop-w.y,v.y&&y.scrollBy({top:-v.y,behavior:i});break}}this.handleMove(t,Ta(zu(d,this.referenceCoordinates),v))}}}handleMove(t,n){const{onMove:r}=this.props;t.preventDefault(),r(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}yw.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=_w,onActivation:o}=t,{active:s}=n;const{code:a}=e.nativeEvent;if(r.start.includes(a)){const i=s.activatorNode.current;return i&&e.target!==i?!1:(e.preventDefault(),o==null||o({event:e.nativeEvent}),!0)}return!1}}];function zv(e){return!!(e&&"distance"in e)}function Fv(e){return!!(e&&"delay"in e)}class C1{constructor(t,n,r){var o;r===void 0&&(r=RF(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:s}=t,{target:a}=s;this.props=t,this.events=n,this.document=Si(a),this.documentListeners=new Ki(this.document),this.listeners=new Ki(r),this.windowListeners=new Ki(rr(a)),this.initialCoordinates=(o=yp(s))!=null?o:Wr,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(_r.Resize,this.handleCancel),this.windowListeners.add(_r.DragStart,Lv),this.windowListeners.add(_r.VisibilityChange,this.handleCancel),this.windowListeners.add(_r.ContextMenu,Lv),this.documentListeners.add(_r.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Fv(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(zv(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:r,onPending:o}=this.props;o(r,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(_r.Click,OF,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(_r.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:r,initialCoordinates:o,props:s}=this,{onMove:a,options:{activationConstraint:i}}=s;if(!o)return;const c=(n=yp(t))!=null?n:Wr,l=zu(o,c);if(!r&&i){if(zv(i)){if(i.tolerance!=null&&sh(l,i.tolerance))return this.handleCancel();if(sh(l,i.distance))return this.handleStart()}if(Fv(i)&&sh(l,i.tolerance))return this.handleCancel();this.handlePending(i,l);return}t.cancelable&&t.preventDefault(),a(c)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===Pt.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const BF={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class T1 extends C1{constructor(t){const{event:n}=t,r=Si(n.target);super(t,BF,r)}}T1.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!n.isPrimary||n.button!==0?!1:(r==null||r({event:n}),!0)}}];const DF={move:{name:"mousemove"},end:{name:"mouseup"}};var kp;(function(e){e[e.RightClick=2]="RightClick"})(kp||(kp={}));class NF extends C1{constructor(t){super(t,DF,Si(t.event.target))}}NF.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button===kp.RightClick?!1:(r==null||r({event:n}),!0)}}];const ah={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class LF extends C1{constructor(t){super(t,ah)}static setup(){return window.addEventListener(ah.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(ah.move.name,t)};function t(){}}}LF.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:o}=n;return o.length>1?!1:(r==null||r({event:n}),!0)}}];var Yi;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(Yi||(Yi={}));var Wu;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(Wu||(Wu={}));function zF(e){let{acceleration:t,activator:n=Yi.Pointer,canScroll:r,draggingRect:o,enabled:s,interval:a=5,order:i=Wu.TreeOrder,pointerCoordinates:c,scrollableAncestors:l,scrollableAncestorRects:f,delta:d,threshold:m}=e;const v=WF({delta:d,disabled:!s}),[_,y]=Xz(),k=p.useRef({x:0,y:0}),g=p.useRef({x:0,y:0}),b=p.useMemo(()=>{switch(n){case Yi.Pointer:return c?{top:c.y,bottom:c.y,left:c.x,right:c.x}:null;case Yi.DraggableRect:return o}},[n,o,c]),h=p.useRef(null),S=p.useCallback(()=>{const w=h.current;if(!w)return;const I=k.current.x*g.current.x,M=k.current.y*g.current.y;w.scrollBy(I,M)},[]),x=p.useMemo(()=>i===Wu.TreeOrder?[...l].reverse():l,[i,l]);p.useEffect(()=>{if(!s||!l.length||!b){y();return}for(const w of x){if((r==null?void 0:r(w))===!1)continue;const I=l.indexOf(w),M=f[I];if(!M)continue;const{direction:H,speed:j}=CF(w,M,b,t,m);for(const W of["x","y"])v[W][H[W]]||(j[W]=0,H[W]=0);if(j.x>0||j.y>0){y(),h.current=w,_(S,a),k.current=j,g.current=H;return}}k.current={x:0,y:0},g.current={x:0,y:0},y()},[t,S,r,y,s,a,JSON.stringify(b),JSON.stringify(v),_,l,x,f,JSON.stringify(m)])}const FF={x:{[kn.Backward]:!1,[kn.Forward]:!1},y:{[kn.Backward]:!1,[kn.Forward]:!1}};function WF(e){let{delta:t,disabled:n}=e;const r=_p(t);return al(o=>{if(n||!r||!o)return FF;const s={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[kn.Backward]:o.x[kn.Backward]||s.x===-1,[kn.Forward]:o.x[kn.Forward]||s.x===1},y:{[kn.Backward]:o.y[kn.Backward]||s.y===-1,[kn.Forward]:o.y[kn.Forward]||s.y===1}}},[n,t,r])}function $F(e,t){const n=t!=null?e.get(t):void 0,r=n?n.node.current:null;return al(o=>{var s;return t==null?null:(s=r??o)!=null?s:null},[r,t])}function VF(e,t){return p.useMemo(()=>e.reduce((n,r)=>{const{sensor:o}=r,s=o.activators.map(a=>({eventName:a.eventName,handler:t(a.handler,r)}));return[...n,...s]},[]),[e,t])}var Ac;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(Ac||(Ac={}));var wp;(function(e){e.Optimized="optimized"})(wp||(wp={}));const Wv=new Map;function jF(e,t){let{dragging:n,dependencies:r,config:o}=t;const[s,a]=p.useState(null),{frequency:i,measure:c,strategy:l}=o,f=p.useRef(e),d=k(),m=Ec(d),v=p.useCallback(function(g){g===void 0&&(g=[]),!m.current&&a(b=>b===null?g:b.concat(g.filter(h=>!b.includes(h))))},[m]),_=p.useRef(null),y=al(g=>{if(d&&!n)return Wv;if(!g||g===Wv||f.current!==e||s!=null){const b=new Map;for(let h of e){if(!h)continue;if(s&&s.length>0&&!s.includes(h.id)&&h.rect.current){b.set(h.id,h.rect.current);continue}const S=h.node.current,x=S?new x1(c(S),S):null;h.rect.current=x,x&&b.set(h.id,x)}return b}return g},[e,s,n,d,c]);return p.useEffect(()=>{f.current=e},[e]),p.useEffect(()=>{d||v()},[n,d]),p.useEffect(()=>{s&&s.length>0&&a(null)},[JSON.stringify(s)]),p.useEffect(()=>{d||typeof i!="number"||_.current!==null||(_.current=setTimeout(()=>{v(),_.current=null},i))},[i,d,v,...r]),{droppableRects:y,measureDroppableContainers:v,measuringScheduled:s!=null};function k(){switch(l){case Ac.Always:return!1;case Ac.BeforeDragging:return n;default:return!n}}}function Sw(e,t){return al(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function HF(e,t){return Sw(e,t)}function UF(e){let{callback:t,disabled:n}=e;const r=S1(t),o=p.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:s}=window;return new s(r)},[r,n]);return p.useEffect(()=>()=>o==null?void 0:o.disconnect(),[o]),o}function of(e){let{callback:t,disabled:n}=e;const r=S1(t),o=p.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:s}=window;return new s(r)},[n]);return p.useEffect(()=>()=>o==null?void 0:o.disconnect(),[o]),o}function GF(e){return new x1(ki(e),e)}function $v(e,t,n){t===void 0&&(t=GF);const[r,o]=p.useState(null);function s(){o(c=>{if(!e)return null;if(e.isConnected===!1){var l;return(l=c??n)!=null?l:null}const f=t(e);return JSON.stringify(c)===JSON.stringify(f)?c:f})}const a=UF({callback(c){if(e)for(const l of c){const{type:f,target:d}=l;if(f==="childList"&&d instanceof HTMLElement&&d.contains(e)){s();break}}}}),i=of({callback:s});return ao(()=>{s(),e?(i==null||i.observe(e),a==null||a.observe(document.body,{childList:!0,subtree:!0})):(i==null||i.disconnect(),a==null||a.disconnect())},[e]),r}function XF(e){const t=Sw(e);return fw(e,t)}const Vv=[];function KF(e){const t=p.useRef(e),n=al(r=>e?r&&r!==Vv&&e&&t.current&&e.parentNode===t.current.parentNode?r:w1(e):Vv,[e]);return p.useEffect(()=>{t.current=e},[e]),n}function YF(e){const[t,n]=p.useState(null),r=p.useRef(e),o=p.useCallback(s=>{const a=oh(s.target);a&&n(i=>i?(i.set(a,Sp(a)),new Map(i)):null)},[]);return p.useEffect(()=>{const s=r.current;if(e!==s){a(s);const i=e.map(c=>{const l=oh(c);return l?(l.addEventListener("scroll",o,{passive:!0}),[l,Sp(l)]):null}).filter(c=>c!=null);n(i.length?new Map(i):null),r.current=e}return()=>{a(e),a(s)};function a(i){i.forEach(c=>{const l=oh(c);l==null||l.removeEventListener("scroll",o)})}},[o,e]),p.useMemo(()=>e.length?t?Array.from(t.values()).reduce((s,a)=>Ta(s,a),Wr):bw(e):Wr,[e,t])}function jv(e,t){t===void 0&&(t=[]);const n=p.useRef(null);return p.useEffect(()=>{n.current=null},t),p.useEffect(()=>{const r=e!==Wr;r&&!n.current&&(n.current=e),!r&&n.current&&(n.current=null)},[e]),n.current?zu(e,n.current):Wr}function qF(e){p.useEffect(()=>{if(!rf)return;const t=e.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of t)n==null||n()}},e.map(t=>{let{sensor:n}=t;return n}))}function ZF(e,t){return p.useMemo(()=>e.reduce((n,r)=>{let{eventName:o,handler:s}=r;return n[o]=a=>{s(a,t)},n},{}),[e,t])}function kw(e){return p.useMemo(()=>e?SF(e):null,[e])}const Hv=[];function QF(e,t){t===void 0&&(t=ki);const[n]=e,r=kw(n?rr(n):null),[o,s]=p.useState(Hv);function a(){s(()=>e.length?e.map(c=>gw(c)?r:new x1(t(c),c)):Hv)}const i=of({callback:a});return ao(()=>{i==null||i.disconnect(),a(),e.forEach(c=>i==null?void 0:i.observe(c))},[e]),o}function JF(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return sl(t)?t:e}function eW(e){let{measure:t}=e;const[n,r]=p.useState(null),o=p.useCallback(l=>{for(const{target:f}of l)if(sl(f)){r(d=>{const m=t(f);return d?{...d,width:m.width,height:m.height}:m});break}},[t]),s=of({callback:o}),a=p.useCallback(l=>{const f=JF(l);s==null||s.disconnect(),f&&(s==null||s.observe(f)),r(f?t(f):null)},[t,s]),[i,c]=Lu(a);return p.useMemo(()=>({nodeRef:i,rect:n,setRef:c}),[n,i,c])}const tW=[{sensor:T1,options:{}},{sensor:yw,options:{}}],nW={current:{}},Ul={draggable:{measure:Nv},droppable:{measure:Nv,strategy:Ac.WhileDragging,frequency:wp.Optimized},dragOverlay:{measure:ki}};class qi extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,r;return(n=(r=this.get(t))==null?void 0:r.node.current)!=null?n:void 0}}const rW={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new qi,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Fu},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Ul,measureDroppableContainers:Fu,windowRect:null,measuringScheduled:!1},oW={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Fu,draggableNodes:new Map,over:null,measureDroppableContainers:Fu},sf=p.createContext(oW),ww=p.createContext(rW);function sW(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new qi}}}function aW(e,t){switch(t.type){case vn.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case vn.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case vn.DragEnd:case vn.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case vn.RegisterDroppable:{const{element:n}=t,{id:r}=n,o=new qi(e.droppable.containers);return o.set(r,n),{...e,droppable:{...e.droppable,containers:o}}}case vn.SetDroppableDisabled:{const{id:n,key:r,disabled:o}=t,s=e.droppable.containers.get(n);if(!s||r!==s.key)return e;const a=new qi(e.droppable.containers);return a.set(n,{...s,disabled:o}),{...e,droppable:{...e.droppable,containers:a}}}case vn.UnregisterDroppable:{const{id:n,key:r}=t,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const s=new qi(e.droppable.containers);return s.delete(n),{...e,droppable:{...e.droppable,containers:s}}}default:return e}}function iW(e){let{disabled:t}=e;const{active:n,activatorEvent:r,draggableNodes:o}=p.useContext(sf),s=_p(r),a=_p(n==null?void 0:n.id);return p.useEffect(()=>{if(!t&&!r&&s&&a!=null){if(!k1(s)||document.activeElement===s.target)return;const i=o.get(a);if(!i)return;const{activatorNode:c,node:l}=i;if(!c.current&&!l.current)return;requestAnimationFrame(()=>{for(const f of[c.current,l.current]){if(!f)continue;const d=qz(f);if(d){d.focus();break}}})}},[r,t,o,a,s]),null}function cW(e,t){let{transform:n,...r}=t;return e!=null&&e.length?e.reduce((o,s)=>s({transform:o,...r}),n):n}function lW(e){return p.useMemo(()=>({draggable:{...Ul.draggable,...e==null?void 0:e.draggable},droppable:{...Ul.droppable,...e==null?void 0:e.droppable},dragOverlay:{...Ul.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function uW(e){let{activeNode:t,measure:n,initialRect:r,config:o=!0}=e;const s=p.useRef(!1),{x:a,y:i}=typeof o=="boolean"?{x:o,y:o}:o;ao(()=>{if(!a&&!i||!t){s.current=!1;return}if(s.current||!r)return;const l=t==null?void 0:t.node.current;if(!l||l.isConnected===!1)return;const f=n(l),d=fw(f,r);if(a||(d.x=0),i||(d.y=0),s.current=!0,Math.abs(d.x)>0||Math.abs(d.y)>0){const m=hw(l);m&&m.scrollBy({top:d.y,left:d.x})}},[t,a,i,r,n])}const xw=p.createContext({...Wr,scaleX:1,scaleY:1});var Vo;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Vo||(Vo={}));const dW=p.memo(function(t){var n,r,o,s;let{id:a,accessibility:i,autoScroll:c=!0,children:l,sensors:f=tW,collisionDetection:d=pF,measuring:m,modifiers:v,..._}=t;const y=p.useReducer(aW,void 0,sW),[k,g]=y,[b,h]=nF(),[S,x]=p.useState(Vo.Uninitialized),w=S===Vo.Initialized,{draggable:{active:I,nodes:M,translate:H},droppable:{containers:j}}=k,W=I!=null?M.get(I):null,A=p.useRef({initial:null,translated:null}),L=p.useMemo(()=>{var ie;return I!=null?{id:I,data:(ie=W==null?void 0:W.data)!=null?ie:nW,rect:A}:null},[I,W]),B=p.useRef(null),[P,V]=p.useState(null),[U,X]=p.useState(null),te=Ec(_,Object.values(_)),Y=il("DndDescribedBy",a),R=p.useMemo(()=>j.getEnabled(),[j]),E=lW(m),{droppableRects:C,measureDroppableContainers:O,measuringScheduled:$}=jF(R,{dragging:w,dependencies:[H.x,H.y],config:E.droppable}),ne=$F(M,I),fe=p.useMemo(()=>U?yp(U):null,[U]),Z=he(),se=HF(ne,E.draggable.measure);uW({activeNode:I!=null?M.get(I):null,config:Z.layoutShiftCompensation,initialRect:se,measure:E.draggable.measure});const de=$v(ne,E.draggable.measure,se),_e=$v(ne?ne.parentElement:null),Ie=p.useRef({activatorEvent:null,active:null,activeNode:ne,collisionRect:null,collisions:null,droppableRects:C,draggableNodes:M,draggingNode:null,draggingNodeRect:null,droppableContainers:j,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Ne=j.getNodeFor((n=Ie.current.over)==null?void 0:n.id),Re=eW({measure:E.dragOverlay.measure}),Pe=(r=Re.nodeRef.current)!=null?r:ne,je=w?(o=Re.rect)!=null?o:de:null,Ee=!!(Re.nodeRef.current&&Re.rect),Ge=XF(Ee?null:de),T=kw(Pe?rr(Pe):null),D=KF(w?Ne??ne:null),we=QF(D),ke=cW(v,{transform:{x:H.x-Ge.x,y:H.y-Ge.y,scaleX:1,scaleY:1},activatorEvent:U,active:L,activeNodeRect:de,containerNodeRect:_e,draggingNodeRect:je,over:Ie.current.over,overlayNodeRect:Re.rect,scrollableAncestors:D,scrollableAncestorRects:we,windowRect:T}),Be=fe?Ta(fe,H):null,He=YF(D),Ue=jv(He),Le=jv(He,[de]),et=Ta(ke,Ue),Ze=je?vF(je,ke):null,Ae=L&&Ze?d({active:L,collisionRect:Ze,droppableRects:C,droppableContainers:R,pointerCoordinates:Be}):null,xt=dF(Ae,"id"),[It,z]=p.useState(null),F=Ee?ke:Ta(ke,Le),q=mF(F,(s=It==null?void 0:It.rect)!=null?s:null,de),Q=p.useRef(null),re=p.useCallback((ie,ue)=>{let{sensor:Se,options:Ye}=ue;if(B.current==null)return;const ge=M.get(B.current);if(!ge)return;const $e=ie.nativeEvent,le=new Se({active:B.current,activeNode:ge,event:$e,options:Ye,context:Ie,onAbort(tt){if(!M.get(tt))return;const{onDragAbort:De}=te.current,ve={id:tt};De==null||De(ve),b({type:"onDragAbort",event:ve})},onPending(tt,be,De,ve){if(!M.get(tt))return;const{onDragPending:At}=te.current,Te={id:tt,constraint:be,initialCoordinates:De,offset:ve};At==null||At(Te),b({type:"onDragPending",event:Te})},onStart(tt){const be=B.current;if(be==null)return;const De=M.get(be);if(!De)return;const{onDragStart:ve}=te.current,Je={activatorEvent:$e,active:{id:be,data:De.data,rect:A}};Wi.unstable_batchedUpdates(()=>{ve==null||ve(Je),x(Vo.Initializing),g({type:vn.DragStart,initialCoordinates:tt,active:be}),b({type:"onDragStart",event:Je}),V(Q.current),X($e)})},onMove(tt){g({type:vn.DragMove,coordinates:tt})},onEnd:ze(vn.DragEnd),onCancel:ze(vn.DragCancel)});Q.current=le;function ze(tt){return async function(){const{active:De,collisions:ve,over:Je,scrollAdjustedTranslate:At}=Ie.current;let Te=null;if(De&&At){const{cancelDrop:rt}=te.current;Te={activatorEvent:$e,active:De,collisions:ve,delta:At,over:Je},tt===vn.DragEnd&&typeof rt=="function"&&await Promise.resolve(rt(Te))&&(tt=vn.DragCancel)}B.current=null,Wi.unstable_batchedUpdates(()=>{g({type:tt}),x(Vo.Uninitialized),z(null),V(null),X(null),Q.current=null;const rt=tt===vn.DragEnd?"onDragEnd":"onDragCancel";if(Te){const ct=te.current[rt];ct==null||ct(Te),b({type:rt,event:Te})}})}}},[M]),K=p.useCallback((ie,ue)=>(Se,Ye)=>{const ge=Se.nativeEvent,$e=M.get(Ye);if(B.current!==null||!$e||ge.dndKit||ge.defaultPrevented)return;const le={active:$e};ie(Se,ue.options,le)===!0&&(ge.dndKit={capturedBy:ue.sensor},B.current=Ye,re(Se,ue))},[M,re]),ae=VF(f,K);qF(f),ao(()=>{de&&S===Vo.Initializing&&x(Vo.Initialized)},[de,S]),p.useEffect(()=>{const{onDragMove:ie}=te.current,{active:ue,activatorEvent:Se,collisions:Ye,over:ge}=Ie.current;if(!ue||!Se)return;const $e={active:ue,activatorEvent:Se,collisions:Ye,delta:{x:et.x,y:et.y},over:ge};Wi.unstable_batchedUpdates(()=>{ie==null||ie($e),b({type:"onDragMove",event:$e})})},[et.x,et.y]),p.useEffect(()=>{const{active:ie,activatorEvent:ue,collisions:Se,droppableContainers:Ye,scrollAdjustedTranslate:ge}=Ie.current;if(!ie||B.current==null||!ue||!ge)return;const{onDragOver:$e}=te.current,le=Ye.get(xt),ze=le&&le.rect.current?{id:le.id,rect:le.rect.current,data:le.data,disabled:le.disabled}:null,tt={active:ie,activatorEvent:ue,collisions:Se,delta:{x:ge.x,y:ge.y},over:ze};Wi.unstable_batchedUpdates(()=>{z(ze),$e==null||$e(tt),b({type:"onDragOver",event:tt})})},[xt]),ao(()=>{Ie.current={activatorEvent:U,active:L,activeNode:ne,collisionRect:Ze,collisions:Ae,droppableRects:C,draggableNodes:M,draggingNode:Pe,draggingNodeRect:je,droppableContainers:j,over:It,scrollableAncestors:D,scrollAdjustedTranslate:et},A.current={initial:je,translated:Ze}},[L,ne,Ae,Ze,M,Pe,je,C,j,It,D,et]),zF({...Z,delta:H,draggingRect:Ze,pointerCoordinates:Be,scrollableAncestors:D,scrollableAncestorRects:we});const ce=p.useMemo(()=>({active:L,activeNode:ne,activeNodeRect:de,activatorEvent:U,collisions:Ae,containerNodeRect:_e,dragOverlay:Re,draggableNodes:M,droppableContainers:j,droppableRects:C,over:It,measureDroppableContainers:O,scrollableAncestors:D,scrollableAncestorRects:we,measuringConfiguration:E,measuringScheduled:$,windowRect:T}),[L,ne,de,U,Ae,_e,Re,M,j,C,It,O,D,we,E,$,T]),oe=p.useMemo(()=>({activatorEvent:U,activators:ae,active:L,activeNodeRect:de,ariaDescribedById:{draggable:Y},dispatch:g,draggableNodes:M,over:It,measureDroppableContainers:O}),[U,ae,L,de,g,Y,M,It,O]);return it.createElement(dw.Provider,{value:h},it.createElement(sf.Provider,{value:oe},it.createElement(ww.Provider,{value:ce},it.createElement(xw.Provider,{value:q},l)),it.createElement(iW,{disabled:(i==null?void 0:i.restoreFocus)===!1})),it.createElement(sF,{...i,hiddenTextDescribedById:Y}));function he(){const ie=(P==null?void 0:P.autoScrollEnabled)===!1,ue=typeof c=="object"?c.enabled===!1:c===!1,Se=w&&!ie&&!ue;return typeof c=="object"?{...c,enabled:Se}:{enabled:Se}}}),fW=p.createContext(null),Uv="button",hW="Draggable";function pW(e){let{id:t,data:n,disabled:r=!1,attributes:o}=e;const s=il(hW),{activators:a,activatorEvent:i,active:c,activeNodeRect:l,ariaDescribedById:f,draggableNodes:d,over:m}=p.useContext(sf),{role:v=Uv,roleDescription:_="draggable",tabIndex:y=0}=o??{},k=(c==null?void 0:c.id)===t,g=p.useContext(k?xw:fW),[b,h]=Lu(),[S,x]=Lu(),w=ZF(a,t),I=Ec(n);ao(()=>(d.set(t,{id:t,key:s,node:b,activatorNode:S,data:I}),()=>{const H=d.get(t);H&&H.key===s&&d.delete(t)}),[d,t]);const M=p.useMemo(()=>({role:v,tabIndex:y,"aria-disabled":r,"aria-pressed":k&&v===Uv?!0:void 0,"aria-roledescription":_,"aria-describedby":f.draggable}),[r,v,y,k,_,f.draggable]);return{active:c,activatorEvent:i,activeNodeRect:l,attributes:M,isDragging:k,listeners:r?void 0:w,node:b,over:m,setNodeRef:h,setActivatorNodeRef:x,transform:g}}function mW(){return p.useContext(ww)}const gW="Droppable",vW={timeout:25};function bW(e){let{data:t,disabled:n=!1,id:r,resizeObserverConfig:o}=e;const s=il(gW),{active:a,dispatch:i,over:c,measureDroppableContainers:l}=p.useContext(sf),f=p.useRef({disabled:n}),d=p.useRef(!1),m=p.useRef(null),v=p.useRef(null),{disabled:_,updateMeasurementsFor:y,timeout:k}={...vW,...o},g=Ec(y??r),b=p.useCallback(()=>{if(!d.current){d.current=!0;return}v.current!=null&&clearTimeout(v.current),v.current=setTimeout(()=>{l(Array.isArray(g.current)?g.current:[g.current]),v.current=null},k)},[k]),h=of({callback:b,disabled:_||!a}),S=p.useCallback((M,H)=>{h&&(H&&(h.unobserve(H),d.current=!1),M&&h.observe(M))},[h]),[x,w]=Lu(S),I=Ec(t);return p.useEffect(()=>{!h||!x.current||(h.disconnect(),d.current=!1,h.observe(x.current))},[x,h]),p.useEffect(()=>(i({type:vn.RegisterDroppable,element:{id:r,key:s,disabled:n,node:x,rect:m,data:I}}),()=>i({type:vn.UnregisterDroppable,key:s,id:r})),[r]),p.useEffect(()=>{n!==f.current.disabled&&(i({type:vn.SetDroppableDisabled,id:r,key:s,disabled:n}),f.current.disabled=n)},[r,s,n,i]),{active:a,rect:m,isOver:(c==null?void 0:c.id)===r,node:x,over:c,setNodeRef:w}}function M1(e,t,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(t,1)[0]),r}function _W(e,t){return e.reduce((n,r,o)=>{const s=t.get(r);return s&&(n[o]=s),n},Array(e.length))}function Il(e){return e!==null&&e>=0}function yW(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function SW(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const Cw=e=>{let{rects:t,activeIndex:n,overIndex:r,index:o}=e;const s=M1(t,r,n),a=t[o],i=s[o];return!i||!a?null:{x:i.left-a.left,y:i.top-a.top,scaleX:i.width/a.width,scaleY:i.height/a.height}},Al={scaleX:1,scaleY:1},kW=e=>{var t;let{activeIndex:n,activeNodeRect:r,index:o,rects:s,overIndex:a}=e;const i=(t=s[n])!=null?t:r;if(!i)return null;if(o===n){const l=s[a];return l?{x:0,y:n<a?l.top+l.height-(i.top+i.height):l.top-i.top,...Al}:null}const c=wW(s,o,n);return o>n&&o<=a?{x:0,y:-i.height-c,...Al}:o<n&&o>=a?{x:0,y:i.height+c,...Al}:{x:0,y:0,...Al}};function wW(e,t,n){const r=e[t],o=e[t-1],s=e[t+1];return r?n<t?o?r.top-(o.top+o.height):s?s.top-(r.top+r.height):0:s?s.top-(r.top+r.height):o?r.top-(o.top+o.height):0:0}const Tw="Sortable",Mw=it.createContext({activeIndex:-1,containerId:Tw,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Cw,disabled:{draggable:!1,droppable:!1}});function xW(e){let{children:t,id:n,items:r,strategy:o=Cw,disabled:s=!1}=e;const{active:a,dragOverlay:i,droppableRects:c,over:l,measureDroppableContainers:f}=mW(),d=il(Tw,n),m=i.rect!==null,v=p.useMemo(()=>r.map(w=>typeof w=="object"&&"id"in w?w.id:w),[r]),_=a!=null,y=a?v.indexOf(a.id):-1,k=l?v.indexOf(l.id):-1,g=p.useRef(v),b=!yW(v,g.current),h=k!==-1&&y===-1||b,S=SW(s);ao(()=>{b&&_&&f(v)},[b,v,_,f]),p.useEffect(()=>{g.current=v},[v]);const x=p.useMemo(()=>({activeIndex:y,containerId:d,disabled:S,disableTransforms:h,items:v,overIndex:k,useDragOverlay:m,sortedRects:_W(v,c),strategy:o}),[y,d,S.draggable,S.droppable,h,v,k,c,m,o]);return it.createElement(Mw.Provider,{value:x},t)}const CW=e=>{let{id:t,items:n,activeIndex:r,overIndex:o}=e;return M1(n,r,o).indexOf(t)},TW=e=>{let{containerId:t,isSorting:n,wasDragging:r,index:o,items:s,newIndex:a,previousItems:i,previousContainerId:c,transition:l}=e;return!l||!r||i!==s&&o===a?!1:n?!0:a!==o&&t===c},MW={duration:200,easing:"ease"},Ew="transform",EW=Ic.Transition.toString({property:Ew,duration:0,easing:"linear"}),IW={roleDescription:"sortable"};function AW(e){let{disabled:t,index:n,node:r,rect:o}=e;const[s,a]=p.useState(null),i=p.useRef(n);return ao(()=>{if(!t&&n!==i.current&&r.current){const c=o.current;if(c){const l=ki(r.current,{ignoreTransform:!0}),f={x:c.left-l.left,y:c.top-l.top,scaleX:c.width/l.width,scaleY:c.height/l.height};(f.x||f.y)&&a(f)}}n!==i.current&&(i.current=n)},[t,n,r,o]),p.useEffect(()=>{s&&a(null)},[s]),s}function RW(e){let{animateLayoutChanges:t=TW,attributes:n,disabled:r,data:o,getNewIndex:s=CW,id:a,strategy:i,resizeObserverConfig:c,transition:l=MW}=e;const{items:f,containerId:d,activeIndex:m,disabled:v,disableTransforms:_,sortedRects:y,overIndex:k,useDragOverlay:g,strategy:b}=p.useContext(Mw),h=OW(r,v),S=f.indexOf(a),x=p.useMemo(()=>({sortable:{containerId:d,index:S,items:f},...o}),[d,o,S,f]),w=p.useMemo(()=>f.slice(f.indexOf(a)),[f,a]),{rect:I,node:M,isOver:H,setNodeRef:j}=bW({id:a,data:x,disabled:h.droppable,resizeObserverConfig:{updateMeasurementsFor:w,...c}}),{active:W,activatorEvent:A,activeNodeRect:L,attributes:B,setNodeRef:P,listeners:V,isDragging:U,over:X,setActivatorNodeRef:te,transform:Y}=pW({id:a,data:x,attributes:{...IW,...n},disabled:h.draggable}),R=Gz(j,P),E=!!W,C=E&&!_&&Il(m)&&Il(k),O=!g&&U,$=O&&C?Y:null,fe=C?$??(i??b)({rects:y,activeNodeRect:L,activeIndex:m,overIndex:k,index:S}):null,Z=Il(m)&&Il(k)?s({id:a,items:f,activeIndex:m,overIndex:k}):S,se=W==null?void 0:W.id,de=p.useRef({activeId:se,items:f,newIndex:Z,containerId:d}),_e=f!==de.current.items,Ie=t({active:W,containerId:d,isDragging:U,isSorting:E,id:a,index:S,items:f,newIndex:de.current.newIndex,previousItems:de.current.items,previousContainerId:de.current.containerId,transition:l,wasDragging:de.current.activeId!=null}),Ne=AW({disabled:!Ie,index:S,node:M,rect:I});return p.useEffect(()=>{E&&de.current.newIndex!==Z&&(de.current.newIndex=Z),d!==de.current.containerId&&(de.current.containerId=d),f!==de.current.items&&(de.current.items=f)},[E,Z,d,f]),p.useEffect(()=>{if(se===de.current.activeId)return;if(se!=null&&de.current.activeId==null){de.current.activeId=se;return}const Pe=setTimeout(()=>{de.current.activeId=se},50);return()=>clearTimeout(Pe)},[se]),{active:W,activeIndex:m,attributes:B,data:x,rect:I,index:S,newIndex:Z,items:f,isOver:H,isSorting:E,isDragging:U,listeners:V,node:M,overIndex:k,over:X,setNodeRef:R,setActivatorNodeRef:te,setDroppableNodeRef:j,setDraggableNodeRef:P,transform:Ne??fe,transition:Re()};function Re(){if(Ne||_e&&de.current.newIndex===S)return EW;if(!(O&&!k1(A)||!l)&&(E||Ie))return Ic.Transition.toString({...l,property:Ew})}}function OW(e,t){var n,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e==null?void 0:e.draggable)!=null?n:t.draggable,droppable:(r=e==null?void 0:e.droppable)!=null?r:t.droppable}}Pt.Down,Pt.Right,Pt.Up,Pt.Left;function PW(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var $u=PW(p),BW=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},DW=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},Gv=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=DW(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return $u.createElement("svg",BW({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),$u.createElement("path",{d:"M18.41,7.41L17,6L11,12L17,18L18.41,16.59L13.83,12L18.41,7.41M12.41,7.41L11,6L5,12L11,18L12.41,16.59L7.83,12L12.41,7.41Z"}))},NW=$u.memo?$u.memo(Gv):Gv,LW=NW;const zW=yt(LW);function FW(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var Vu=FW(p),WW=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},$W=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},Xv=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=$W(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return Vu.createElement("svg",WW({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),Vu.createElement("path",{d:"M5.59,7.41L7,6L13,12L7,18L5.59,16.59L10.17,12L5.59,7.41M11.59,7.41L13,6L19,12L13,18L11.59,16.59L16.17,12L11.59,7.41Z"}))},VW=Vu.memo?Vu.memo(Xv):Xv,jW=VW;const HW=yt(jW),xp=({mode:e})=>{switch(e.type){case"velocity":return u(N,{name:"velocity"});case"pitchBend":return u(N,{name:"pitch-bend"});case"controller":switch(e.controllerType){case Zr.MSB_MAIN_VOLUME:return u(N,{name:"volume"});case Zr.MSB_PAN:return u(N,{name:"panpot"});case Zr.MSB_EXPRESSION:return u(N,{name:"expression"});case Zr.SUSTAIN:return u(N,{name:"hold-pedal"});default:return u(Ke,{children:Ch[e.controllerType]==="Undefined"?`CC${e.controllerType}`:Ch[e.controllerType]})}}},UW=e=>{let{transform:t}=e;return{...t,x:0}},GW=e=>{const{attributes:t,listeners:n,setNodeRef:r,transform:o,transition:s}=RW({id:e.id}),a={transform:Ic.Transform.toString(o),transition:s};return u("div",{ref:r,style:a,...t,...n,tabIndex:-1,children:e.children})},Iw=({items:e,render:t,getItemId:n,onItemMoved:r})=>{const o=e.map(a=>({id:n(a),item:a})),s=iF(aF(T1,{activationConstraint:{distance:5}}));return u(dW,{sensors:s,collisionDetection:fF,onDragEnd:a=>{const{active:i,over:c}=a;c!==null&&i.id!==c.id&&r(i.id,c.id)},modifiers:[UW],children:u(xW,{items:o,strategy:kW,children:o.map(a=>u(GW,{id:a.id,children:t(a.item)},a.id))})})},XW=[{type:"velocity"},{type:"pitchBend"}],KW=()=>XW.concat(Qe.range(0,128).map(e=>({type:"controller",controllerType:e}))),Kv=J.div`
  padding: 0.5rem 1rem;
  white-space: nowrap;

  &[data-selected="true"] {
    background: var(--color-theme);
  }
`,YW=J.div`
  max-height: 30rem;
  display: flex;
`,Yv=J.div`
  flex-grow: 1;
  flex-basis: 0;
  overflow: auto;
  background: var(--color-background-secondary);
`,qW=J.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 1rem;
`,qv=J(Et)`
  background: var(--color-background-secondary);
  display: flex;
  align-items: center;
  margin-bottom: 1rem;
  min-width: 7rem;
  justify-content: center;
`,ZW=()=>{const{openControlSettingDialog:e,setOpenControlSettingDialog:t}=Ln(),{controlModes:n,setControlModes:r}=Yt(),[o,s]=p.useState(null),[a,i]=p.useState(null),c=n,l=KW().filter(g=>!n.some(b=>ji(b,g))),f=c.map(g=>({mode:g,isSelected:o!==null&&ji(g,o)})),d=l.map(g=>({mode:g,isSelected:a!==null&&ji(g,a)})),m=p.useCallback(()=>t(!1),[t]),v=()=>{a&&(r([...n,a]),i(null))},_=()=>{o&&(r(n.filter(g=>!ji(g,o))),s(null))},y=(g,b)=>{const h=f.findIndex(x=>Di(x.mode)===g),S=f.findIndex(x=>Di(x.mode)===b);h===-1||S===-1||r(M1(n,h,S))},k=()=>{r(RS)};return G(hn,{open:e,onOpenChange:m,style:{maxWidth:"40rem"},children:[u(bn,{children:u(N,{name:"control-settings"})}),u(qt,{children:G(YW,{children:[u(Yv,{children:u(Iw,{items:f,getItemId:g=>Di(g.mode),onItemMoved:y,render:g=>u(Kv,{"data-selected":g.isSelected,onClick:()=>{s(g.mode),i(null)},children:u(xp,{mode:g.mode})},Di(g.mode))})}),G(qW,{children:[G(qv,{onClick:v,children:[u(zW,{style:{width:"1.25rem"}})," Add"]}),G(qv,{onClick:_,children:["Remove ",u(HW,{style:{width:"1.25rem"}})]})]}),u(Yv,{children:d.map(g=>u(Kv,{"data-selected":g.isSelected,onClick:()=>{s(null),i(g.mode)},children:u(xp,{mode:g.mode})},Di(g.mode)))})]})}),G(gn,{children:[u(Et,{onClick:k,children:u(N,{name:"restore-defaults"})}),u("div",{style:{flex:1}}),u(Et,{onClick:m,children:u(N,{name:"close"})})]})]})};function QW(e){return new Int8Array(e)}function JW(e){return new Int16Array(e)}function Aw(e){return new Int32Array(e)}function Rw(e){return new Float32Array(e)}function e$(e){return new Float64Array(e)}function Ow(e){if(e.length==1)return Rw(e[0]);var t=e[0];e=e.slice(1);for(var n=[],r=0;r<t;r++)n.push(Ow(e));return n}function Pw(e){if(e.length==1)return Aw(e[0]);var t=e[0];e=e.slice(1);for(var n=[],r=0;r<t;r++)n.push(Pw(e));return n}function Bw(e){if(e.length==1)return JW(e[0]);var t=e[0];e=e.slice(1);for(var n=[],r=0;r<t;r++)n.push(Bw(e));return n}function Dw(e){if(e.length==1)return new Array(e[0]);var t=e[0];e=e.slice(1);for(var n=[],r=0;r<t;r++)n.push(Dw(e));return n}var Nw={};Nw.fill=function(e,t,n,r){if(arguments.length==2)for(var o=0;o<e.length;o++)e[o]=arguments[1];else for(var o=t;o<n;o++)e[o]=r};var cl={};cl.arraycopy=function(e,t,n,r,o){for(var s=t+o;t<s;)n[r++]=e[t++]};cl.out={};cl.out.println=function(e){console.log(e)};cl.out.printf=function(){console.log.apply(console,arguments)};var af={};af.SQRT2=1.4142135623730951;af.FAST_LOG10=function(e){return Math.log10(e)};af.FAST_LOG10_X=function(e,t){return Math.log10(e)*t};function Eo(e){this.ordinal=e}Eo.short_block_allowed=new Eo(0);Eo.short_block_coupled=new Eo(1);Eo.short_block_dispensed=new Eo(2);Eo.short_block_forced=new Eo(3);var Lw={};Lw.MAX_VALUE=34028235e31;function hr(e){this.ordinal=e}hr.vbr_off=new hr(0);hr.vbr_mt=new hr(1);hr.vbr_rh=new hr(2);hr.vbr_abr=new hr(3);hr.vbr_mtrh=new hr(4);hr.vbr_default=hr.vbr_mtrh;var t$=function(e){},Zt={System:cl,VbrMode:hr,Float:Lw,ShortBlock:Eo,Util:af,Arrays:Nw,new_array_n:Dw,new_byte:QW,new_double:e$,new_float:Rw,new_float_n:Ow,new_int:Aw,new_int_n:Pw,new_short_n:Bw,assert:t$},ih,Zv;function n$(){if(Zv)return ih;Zv=1;var e=Zt,t=e.System,n=e.Util,r=e.Arrays,o=e.new_float,s=zn();function a(){var i=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*n.SQRT2*.5/2384e-9,.017876148*n.SQRT2*.5/2384e-9,.003134727*n.SQRT2*.5/2384e-9,.002457142*n.SQRT2*.5/2384e-9,971317e-9*n.SQRT2*.5/2384e-9,218868e-9*n.SQRT2*.5/2384e-9,101566e-9*n.SQRT2*.5/2384e-9,13828e-9*n.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],c=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],l=c[s.SHORT_TYPE],f=c[s.SHORT_TYPE],d=c[s.SHORT_TYPE],m=c[s.SHORT_TYPE],v=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function _(g,b,h){for(var S=10,x=b+238-14-286,w=-15;w<0;w++){var I,M,H;I=i[S+-10],M=g[x+-224]*I,H=g[b+224]*I,I=i[S+-9],M+=g[x+-160]*I,H+=g[b+160]*I,I=i[S+-8],M+=g[x+-96]*I,H+=g[b+96]*I,I=i[S+-7],M+=g[x+-32]*I,H+=g[b+32]*I,I=i[S+-6],M+=g[x+32]*I,H+=g[b+-32]*I,I=i[S+-5],M+=g[x+96]*I,H+=g[b+-96]*I,I=i[S+-4],M+=g[x+160]*I,H+=g[b+-160]*I,I=i[S+-3],M+=g[x+224]*I,H+=g[b+-224]*I,I=i[S+-2],M+=g[b+-256]*I,H-=g[x+256]*I,I=i[S+-1],M+=g[b+-192]*I,H-=g[x+192]*I,I=i[S+0],M+=g[b+-128]*I,H-=g[x+128]*I,I=i[S+1],M+=g[b+-64]*I,H-=g[x+64]*I,I=i[S+2],M+=g[b+0]*I,H-=g[x+0]*I,I=i[S+3],M+=g[b+64]*I,H-=g[x+-64]*I,I=i[S+4],M+=g[b+128]*I,H-=g[x+-128]*I,I=i[S+5],M+=g[b+192]*I,H-=g[x+-192]*I,M*=i[S+6],I=H-M,h[30+w*2]=H+M,h[31+w*2]=i[S+7]*I,S+=18,b--,x++}{var M,H,j,W;H=g[b+-16]*i[S+-10],M=g[b+-32]*i[S+-2],H+=(g[b+-48]-g[b+16])*i[S+-9],M+=g[b+-96]*i[S+-1],H+=(g[b+-80]+g[b+48])*i[S+-8],M+=g[b+-160]*i[S+0],H+=(g[b+-112]-g[b+80])*i[S+-7],M+=g[b+-224]*i[S+1],H+=(g[b+-144]+g[b+112])*i[S+-6],M-=g[b+32]*i[S+2],H+=(g[b+-176]-g[b+144])*i[S+-5],M-=g[b+96]*i[S+3],H+=(g[b+-208]+g[b+176])*i[S+-4],M-=g[b+160]*i[S+4],H+=(g[b+-240]-g[b+208])*i[S+-3],M-=g[b+224],j=M-H,W=M+H,H=h[14],M=h[15]-H,h[31]=W+H,h[30]=j+M,h[15]=j-M,h[14]=W-H}{var A;A=h[28]-h[0],h[0]+=h[28],h[28]=A*i[S+-2*18+7],A=h[29]-h[1],h[1]+=h[29],h[29]=A*i[S+-2*18+7],A=h[26]-h[2],h[2]+=h[26],h[26]=A*i[S+-4*18+7],A=h[27]-h[3],h[3]+=h[27],h[27]=A*i[S+-4*18+7],A=h[24]-h[4],h[4]+=h[24],h[24]=A*i[S+-6*18+7],A=h[25]-h[5],h[5]+=h[25],h[25]=A*i[S+-6*18+7],A=h[22]-h[6],h[6]+=h[22],h[22]=A*n.SQRT2,A=h[23]-h[7],h[7]+=h[23],h[23]=A*n.SQRT2-h[7],h[7]-=h[6],h[22]-=h[7],h[23]-=h[22],A=h[6],h[6]=h[31]-A,h[31]=h[31]+A,A=h[7],h[7]=h[30]-A,h[30]=h[30]+A,A=h[22],h[22]=h[15]-A,h[15]=h[15]+A,A=h[23],h[23]=h[14]-A,h[14]=h[14]+A,A=h[20]-h[8],h[8]+=h[20],h[20]=A*i[S+-10*18+7],A=h[21]-h[9],h[9]+=h[21],h[21]=A*i[S+-10*18+7],A=h[18]-h[10],h[10]+=h[18],h[18]=A*i[S+-12*18+7],A=h[19]-h[11],h[11]+=h[19],h[19]=A*i[S+-12*18+7],A=h[16]-h[12],h[12]+=h[16],h[16]=A*i[S+-14*18+7],A=h[17]-h[13],h[13]+=h[17],h[17]=A*i[S+-14*18+7],A=-h[20]+h[24],h[20]+=h[24],h[24]=A*i[S+-12*18+7],A=-h[21]+h[25],h[21]+=h[25],h[25]=A*i[S+-12*18+7],A=h[4]-h[8],h[4]+=h[8],h[8]=A*i[S+-12*18+7],A=h[5]-h[9],h[5]+=h[9],h[9]=A*i[S+-12*18+7],A=h[0]-h[12],h[0]+=h[12],h[12]=A*i[S+-4*18+7],A=h[1]-h[13],h[1]+=h[13],h[13]=A*i[S+-4*18+7],A=h[16]-h[28],h[16]+=h[28],h[28]=A*i[S+-4*18+7],A=-h[17]+h[29],h[17]+=h[29],h[29]=A*i[S+-4*18+7],A=n.SQRT2*(h[2]-h[10]),h[2]+=h[10],h[10]=A,A=n.SQRT2*(h[3]-h[11]),h[3]+=h[11],h[11]=A,A=n.SQRT2*(-h[18]+h[26]),h[18]+=h[26],h[26]=A-h[18],A=n.SQRT2*(-h[19]+h[27]),h[19]+=h[27],h[27]=A-h[19],A=h[2],h[19]-=h[3],h[3]-=A,h[2]=h[31]-A,h[31]+=A,A=h[3],h[11]-=h[19],h[18]-=A,h[3]=h[30]-A,h[30]+=A,A=h[18],h[27]-=h[11],h[19]-=A,h[18]=h[15]-A,h[15]+=A,A=h[19],h[10]-=A,h[19]=h[14]-A,h[14]+=A,A=h[10],h[11]-=A,h[10]=h[23]-A,h[23]+=A,A=h[11],h[26]-=A,h[11]=h[22]-A,h[22]+=A,A=h[26],h[27]-=A,h[26]=h[7]-A,h[7]+=A,A=h[27],h[27]=h[6]-A,h[6]+=A,A=n.SQRT2*(h[0]-h[4]),h[0]+=h[4],h[4]=A,A=n.SQRT2*(h[1]-h[5]),h[1]+=h[5],h[5]=A,A=n.SQRT2*(h[16]-h[20]),h[16]+=h[20],h[20]=A,A=n.SQRT2*(h[17]-h[21]),h[17]+=h[21],h[21]=A,A=-n.SQRT2*(h[8]-h[12]),h[8]+=h[12],h[12]=A-h[8],A=-n.SQRT2*(h[9]-h[13]),h[9]+=h[13],h[13]=A-h[9],A=-n.SQRT2*(h[25]-h[29]),h[25]+=h[29],h[29]=A-h[25],A=-n.SQRT2*(h[24]+h[28]),h[24]-=h[28],h[28]=A-h[24],A=h[24]-h[16],h[24]=A,A=h[20]-A,h[20]=A,A=h[28]-A,h[28]=A,A=h[25]-h[17],h[25]=A,A=h[21]-A,h[21]=A,A=h[29]-A,h[29]=A,A=h[17]-h[1],h[17]=A,A=h[9]-A,h[9]=A,A=h[25]-A,h[25]=A,A=h[5]-A,h[5]=A,A=h[21]-A,h[21]=A,A=h[13]-A,h[13]=A,A=h[29]-A,h[29]=A,A=h[1]-h[0],h[1]=A,A=h[16]-A,h[16]=A,A=h[17]-A,h[17]=A,A=h[8]-A,h[8]=A,A=h[9]-A,h[9]=A,A=h[24]-A,h[24]=A,A=h[25]-A,h[25]=A,A=h[4]-A,h[4]=A,A=h[5]-A,h[5]=A,A=h[20]-A,h[20]=A,A=h[21]-A,h[21]=A,A=h[12]-A,h[12]=A,A=h[13]-A,h[13]=A,A=h[28]-A,h[28]=A,A=h[29]-A,h[29]=A,A=h[0],h[0]+=h[31],h[31]-=A,A=h[1],h[1]+=h[30],h[30]-=A,A=h[16],h[16]+=h[15],h[15]-=A,A=h[17],h[17]+=h[14],h[14]-=A,A=h[8],h[8]+=h[23],h[23]-=A,A=h[9],h[9]+=h[22],h[22]-=A,A=h[24],h[24]+=h[7],h[7]-=A,A=h[25],h[25]+=h[6],h[6]-=A,A=h[4],h[4]+=h[27],h[27]-=A,A=h[5],h[5]+=h[26],h[26]-=A,A=h[20],h[20]+=h[11],h[11]-=A,A=h[21],h[21]+=h[10],h[10]-=A,A=h[12],h[12]+=h[19],h[19]-=A,A=h[13],h[13]+=h[18],h[18]-=A,A=h[28],h[28]+=h[3],h[3]-=A,A=h[29],h[29]+=h[2],h[2]-=A}}function y(g,b){for(var h=0;h<3;h++){var S,x,w,I,M,H;I=g[b+2*3]*c[s.SHORT_TYPE][0]-g[b+5*3],S=g[b+0*3]*c[s.SHORT_TYPE][2]-g[b+3*3],x=I+S,w=I-S,I=g[b+5*3]*c[s.SHORT_TYPE][0]+g[b+2*3],S=g[b+3*3]*c[s.SHORT_TYPE][2]+g[b+0*3],M=I+S,H=-I+S,S=(g[b+1*3]*c[s.SHORT_TYPE][1]-g[b+4*3])*2069978111953089e-26,I=(g[b+4*3]*c[s.SHORT_TYPE][1]+g[b+1*3])*2069978111953089e-26,g[b+3*0]=x*190752519173728e-25+S,g[b+3*5]=-M*190752519173728e-25+I,w=w*.8660254037844387*1907525191737281e-26,M=M*.5*1907525191737281e-26+I,g[b+3*1]=w-M,g[b+3*2]=w+M,x=x*.5*1907525191737281e-26-S,H=H*.8660254037844387*1907525191737281e-26,g[b+3*3]=x+H,g[b+3*4]=x-H,b++}}function k(g,b,h){var S,x;{var w,I,M,H,j,W,A,L;w=h[17]-h[9],M=h[15]-h[11],H=h[14]-h[12],j=h[0]+h[8],W=h[1]+h[7],A=h[2]+h[6],L=h[3]+h[5],g[b+17]=j+A-L-(W-h[4]),x=(j+A-L)*f[19]+(W-h[4]),S=(w-M-H)*f[18],g[b+5]=S+x,g[b+6]=S-x,I=(h[16]-h[10])*f[18],W=W*f[19]+h[4],S=w*f[12]+I+M*f[13]+H*f[14],x=-j*f[16]+W-A*f[17]+L*f[15],g[b+1]=S+x,g[b+2]=S-x,S=w*f[13]-I-M*f[14]+H*f[12],x=-j*f[17]+W-A*f[15]+L*f[16],g[b+9]=S+x,g[b+10]=S-x,S=w*f[14]-I+M*f[12]-H*f[13],x=j*f[15]-W+A*f[16]-L*f[17],g[b+13]=S+x,g[b+14]=S-x}{var B,P,V,U,X,te,Y,R;B=h[8]-h[0],V=h[6]-h[2],U=h[5]-h[3],X=h[17]+h[9],te=h[16]+h[10],Y=h[15]+h[11],R=h[14]+h[12],g[b+0]=X+Y+R+(te+h[13]),S=(X+Y+R)*f[19]-(te+h[13]),x=(B-V+U)*f[18],g[b+11]=S+x,g[b+12]=S-x,P=(h[7]-h[1])*f[18],te=h[13]-te*f[19],S=X*f[15]-te+Y*f[16]+R*f[17],x=B*f[14]+P+V*f[12]+U*f[13],g[b+3]=S+x,g[b+4]=S-x,S=-X*f[17]+te-Y*f[15]-R*f[16],x=B*f[13]+P-V*f[14]-U*f[12],g[b+7]=S+x,g[b+8]=S-x,S=-X*f[16]+te-Y*f[17]-R*f[15],x=B*f[12]-P+V*f[13]-U*f[14],g[b+15]=S+x,g[b+16]=S-x}}this.mdct_sub48=function(g,b,h){for(var S=b,x=286,w=0;w<g.channels_out;w++){for(var I=0;I<g.mode_gr;I++){for(var M,H=g.l3_side.tt[I][w],j=H.xr,W=0,A=g.sb_sample[w][1-I],L=0,B=0;B<18/2;B++)for(_(S,x,A[L]),_(S,x+32,A[L+1]),L+=2,x+=64,M=1;M<32;M+=2)A[L-1][M]*=-1;for(M=0;M<32;M++,W+=18){var P=H.block_type,V=g.sb_sample[w][I],U=g.sb_sample[w][1-I];if(H.mixed_block_flag!=0&&M<2&&(P=0),g.amp_filter[M]<1e-12)r.fill(j,W+0,W+18,0);else{if(g.amp_filter[M]<1)for(var B=0;B<18;B++)U[B][v[M]]*=g.amp_filter[M];if(P==s.SHORT_TYPE){for(var B=-12/4;B<0;B++){var X=c[s.SHORT_TYPE][B+3];j[W+B*3+9]=V[9+B][v[M]]*X-V[8-B][v[M]],j[W+B*3+18]=V[14-B][v[M]]*X+V[15+B][v[M]],j[W+B*3+10]=V[15+B][v[M]]*X-V[14-B][v[M]],j[W+B*3+19]=U[2-B][v[M]]*X+U[3+B][v[M]],j[W+B*3+11]=U[3+B][v[M]]*X-U[2-B][v[M]],j[W+B*3+20]=U[8-B][v[M]]*X+U[9+B][v[M]]}y(j,W)}else{for(var te=o(18),B=-36/4;B<0;B++){var Y,R;Y=c[P][B+27]*U[B+9][v[M]]+c[P][B+36]*U[8-B][v[M]],R=c[P][B+9]*V[B+9][v[M]]-c[P][B+18]*V[8-B][v[M]],te[B+9]=Y-R*l[3+B+9],te[B+18]=Y*l[3+B+9]+R}k(j,W,te)}}if(P!=s.SHORT_TYPE&&M!=0)for(var B=7;B>=0;--B){var E,C;E=j[W+B]*d[20+B]+j[W+-1-B]*m[28+B],C=j[W+B]*m[28+B]-j[W+-1-B]*d[20+B],j[W+-1-B]=E,j[W+B]=C}}}if(S=h,x=286,g.mode_gr==1)for(var O=0;O<18;O++)t.arraycopy(g.sb_sample[w][1][O],0,g.sb_sample[w][0][O],0,32)}}}return ih=a,ih}var ch,Qv;function zw(){if(Qv)return ch;Qv=1;var e=zn(),t=Zt,n=t.System,r=t.new_float,o=t.new_float_n;function s(){this.l=r(e.SBMAX_l),this.s=o([e.SBMAX_s,3]);var a=this;this.assign=function(i){n.arraycopy(i.l,0,a.l,0,e.SBMAX_l);for(var c=0;c<e.SBMAX_s;c++)for(var l=0;l<3;l++)a.s[c][l]=i.s[c][l]}}return ch=s,ch}var lh,Jv;function r$(){if(Jv)return lh;Jv=1;var e=zw();function t(){this.thm=new e,this.en=new e}return lh=t,lh}function $r(e){var t=e;this.ordinal=function(){return t}}$r.STEREO=new $r(0);$r.JOINT_STEREO=new $r(1);$r.DUAL_CHANNEL=new $r(2);$r.MONO=new $r(3);$r.NOT_SET=new $r(4);var ll=$r,uh,eb;function zn(){if(eb)return uh;eb=1;var e=Zt,t=e.System,n=e.VbrMode,r=e.new_array_n,o=e.new_float,s=e.new_float_n,a=e.new_int,i=e.assert;c.ENCDELAY=576,c.POSTDELAY=1152,c.MDCTDELAY=48,c.FFTOFFSET=224+c.MDCTDELAY,c.DECDELAY=528,c.SBLIMIT=32,c.CBANDS=64,c.SBPSY_l=21,c.SBPSY_s=12,c.SBMAX_l=22,c.SBMAX_s=13,c.PSFB21=6,c.PSFB12=6,c.BLKSIZE=1024,c.HBLKSIZE=c.BLKSIZE/2+1,c.BLKSIZE_s=256,c.HBLKSIZE_s=c.BLKSIZE_s/2+1,c.NORM_TYPE=0,c.START_TYPE=1,c.SHORT_TYPE=2,c.STOP_TYPE=3,c.MPG_MD_LR_LR=0,c.MPG_MD_LR_I=1,c.MPG_MD_MS_LR=2,c.MPG_MD_MS_I=3,c.fircoef=[-.0207887*5,-.0378413*5,-.0432472*5,-.031183*5,779609e-23*5,.0467745*5,.10091*5,.151365*5,.187098*5];function c(){var l=n$(),f=r$(),d=ll,m=c.FFTOFFSET,v=c.MPG_MD_MS_LR,_=null;this.psy=null;var y=null,k=null,g=null;this.setModules=function(w,I,M,H){_=w,this.psy=I,y=I,k=H,g=M};var b=new l;function h(w){var I,M;if(w.ATH.useAdjust==0){w.ATH.adjust=1;return}if(M=w.loudness_sq[0][0],I=w.loudness_sq[1][0],w.channels_out==2?(M+=w.loudness_sq[0][1],I+=w.loudness_sq[1][1]):(M+=M,I+=I),w.mode_gr==2&&(M=Math.max(M,I)),M*=.5,M*=w.ATH.aaSensitivityP,M>.03125)w.ATH.adjust>=1?w.ATH.adjust=1:w.ATH.adjust<w.ATH.adjustLimit&&(w.ATH.adjust=w.ATH.adjustLimit),w.ATH.adjustLimit=1;else{var H=31.98*M+625e-6;w.ATH.adjust>=H?(w.ATH.adjust*=H*.075+.925,w.ATH.adjust<H&&(w.ATH.adjust=H)):w.ATH.adjustLimit>=H?w.ATH.adjust=H:w.ATH.adjust<w.ATH.adjustLimit&&(w.ATH.adjust=w.ATH.adjustLimit),w.ATH.adjustLimit=H}}function S(w){var I,M;for(i(0<=w.bitrate_index&&w.bitrate_index<16),i(0<=w.mode_ext&&w.mode_ext<4),w.bitrate_stereoMode_Hist[w.bitrate_index][4]++,w.bitrate_stereoMode_Hist[15][4]++,w.channels_out==2&&(w.bitrate_stereoMode_Hist[w.bitrate_index][w.mode_ext]++,w.bitrate_stereoMode_Hist[15][w.mode_ext]++),I=0;I<w.mode_gr;++I)for(M=0;M<w.channels_out;++M){var H=w.l3_side.tt[I][M].block_type|0;w.l3_side.tt[I][M].mixed_block_flag!=0&&(H=4),w.bitrate_blockType_Hist[w.bitrate_index][H]++,w.bitrate_blockType_Hist[w.bitrate_index][5]++,w.bitrate_blockType_Hist[15][H]++,w.bitrate_blockType_Hist[15][5]++}}function x(w,I){var M=w.internal_flags,H,j;if(M.lame_encode_frame_init==0){var W,A,L=o(2014),B=o(2014);for(M.lame_encode_frame_init=1,W=0,A=0;W<286+576*(1+M.mode_gr);++W)W<576*M.mode_gr?(L[W]=0,M.channels_out==2&&(B[W]=0)):(L[W]=I[0][A],M.channels_out==2&&(B[W]=I[1][A]),++A);for(j=0;j<M.mode_gr;j++)for(H=0;H<M.channels_out;H++)M.l3_side.tt[j][H].block_type=c.SHORT_TYPE;b.mdct_sub48(M,L,B),i(576>=c.FFTOFFSET),i(M.mf_size>=c.BLKSIZE+w.framesize-c.FFTOFFSET),i(M.mf_size>=512+w.framesize-32)}}this.lame_encode_mp3_frame=function(w,I,M,H,j,W){var A,L=r([2,2]);L[0][0]=new f,L[0][1]=new f,L[1][0]=new f,L[1][1]=new f;var B=r([2,2]);B[0][0]=new f,B[0][1]=new f,B[1][0]=new f,B[1][1]=new f;var P,V=[null,null],U=w.internal_flags,X=s([2,4]),te=[.5,.5],Y=[[0,0],[0,0]],R=[[0,0],[0,0]],E,C,O;if(V[0]=I,V[1]=M,U.lame_encode_frame_init==0&&x(w,V),U.padding=0,(U.slot_lag-=U.frac_SpF)<0&&(U.slot_lag+=w.out_samplerate,U.padding=1),U.psymodel!=0){var $,ne=[null,null],fe=0,Z=a(2);for(O=0;O<U.mode_gr;O++){for(C=0;C<U.channels_out;C++)ne[C]=V[C],fe=576+O*576-c.FFTOFFSET;if(w.VBR==n.vbr_mtrh||w.VBR==n.vbr_mt?$=y.L3psycho_anal_vbr(w,ne,fe,O,L,B,Y[O],R[O],X[O],Z):$=y.L3psycho_anal_ns(w,ne,fe,O,L,B,Y[O],R[O],X[O],Z),$!=0)return-4;for(w.mode==d.JOINT_STEREO&&(te[O]=X[O][2]+X[O][3],te[O]>0&&(te[O]=X[O][3]/te[O])),C=0;C<U.channels_out;C++){var se=U.l3_side.tt[O][C];se.block_type=Z[C],se.mixed_block_flag=0}}}else for(O=0;O<U.mode_gr;O++)for(C=0;C<U.channels_out;C++)U.l3_side.tt[O][C].block_type=c.NORM_TYPE,U.l3_side.tt[O][C].mixed_block_flag=0,R[O][C]=Y[O][C]=700;if(h(U),b.mdct_sub48(U,V[0],V[1]),U.mode_ext=c.MPG_MD_LR_LR,w.force_ms)U.mode_ext=c.MPG_MD_MS_LR;else if(w.mode==d.JOINT_STEREO){var de=0,_e=0;for(O=0;O<U.mode_gr;O++)for(C=0;C<U.channels_out;C++)de+=R[O][C],_e+=Y[O][C];if(de<=1*_e){var Ie=U.l3_side.tt[0],Ne=U.l3_side.tt[U.mode_gr-1];Ie[0].block_type==Ie[1].block_type&&Ne[0].block_type==Ne[1].block_type&&(U.mode_ext=c.MPG_MD_MS_LR)}}if(U.mode_ext==v?(P=B,E=R):(P=L,E=Y),w.analysis&&U.pinfo!=null)for(O=0;O<U.mode_gr;O++)for(C=0;C<U.channels_out;C++)U.pinfo.ms_ratio[O]=U.ms_ratio[O],U.pinfo.ms_ener_ratio[O]=te[O],U.pinfo.blocktype[O][C]=U.l3_side.tt[O][C].block_type,U.pinfo.pe[O][C]=E[O][C],t.arraycopy(U.l3_side.tt[O][C].xr,0,U.pinfo.xr[O][C],0,576),U.mode_ext==v&&(U.pinfo.ers[O][C]=U.pinfo.ers[O][C+2],t.arraycopy(U.pinfo.energy[O][C+2],0,U.pinfo.energy[O][C],0,U.pinfo.energy[O][C].length));if(w.VBR==n.vbr_off||w.VBR==n.vbr_abr){var Re,Pe;for(Re=0;Re<18;Re++)U.nsPsy.pefirbuf[Re]=U.nsPsy.pefirbuf[Re+1];for(Pe=0,O=0;O<U.mode_gr;O++)for(C=0;C<U.channels_out;C++)Pe+=E[O][C];for(U.nsPsy.pefirbuf[18]=Pe,Pe=U.nsPsy.pefirbuf[9],Re=0;Re<9;Re++)Pe+=(U.nsPsy.pefirbuf[Re]+U.nsPsy.pefirbuf[18-Re])*c.fircoef[Re];for(Pe=670*5*U.mode_gr*U.channels_out/Pe,O=0;O<U.mode_gr;O++)for(C=0;C<U.channels_out;C++)E[O][C]*=Pe}if(U.iteration_loop.iteration_loop(w,E,te,P),_.format_bitstream(w),A=_.copy_buffer(U,H,j,W,1),w.bWriteVbrTag&&k.addVbrFrame(w),w.analysis&&U.pinfo!=null){for(C=0;C<U.channels_out;C++){var je;for(je=0;je<m;je++)U.pinfo.pcmdata[C][je]=U.pinfo.pcmdata[C][je+w.framesize];for(je=m;je<1600;je++)U.pinfo.pcmdata[C][je]=V[C][je-m]}g.set_frame_pinfo(w,P)}return S(U),A}}return uh=c,uh}var Fw=Zt,tb=Fw.Util,nb=Fw.new_float,ln=zn();function o$(){var e=nb(ln.BLKSIZE),t=nb(ln.BLKSIZE_s/2),n=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function r(s,a,i){var c=0,l,f,d;i<<=1;var m=a+i;l=4;do{var v,_,y,k,g,b,h;h=l>>1,k=l,g=l<<1,b=g+k,l=g<<1,f=a,d=f+h;do{var S,x,w,I;x=s[f+0]-s[f+k],S=s[f+0]+s[f+k],I=s[f+g]-s[f+b],w=s[f+g]+s[f+b],s[f+g]=S-w,s[f+0]=S+w,s[f+b]=x-I,s[f+k]=x+I,x=s[d+0]-s[d+k],S=s[d+0]+s[d+k],I=tb.SQRT2*s[d+b],w=tb.SQRT2*s[d+g],s[d+g]=S-w,s[d+0]=S+w,s[d+b]=x-I,s[d+k]=x+I,d+=l,f+=l}while(f<m);for(_=n[c+0],v=n[c+1],y=1;y<h;y++){var M,H;M=1-2*v*v,H=2*v*_,f=a+y,d=a+k-y;do{var j,W,A,S,x,L,w,B,I,P;W=H*s[f+k]-M*s[d+k],j=M*s[f+k]+H*s[d+k],x=s[f+0]-j,S=s[f+0]+j,L=s[d+0]-W,A=s[d+0]+W,W=H*s[f+b]-M*s[d+b],j=M*s[f+b]+H*s[d+b],I=s[f+g]-j,w=s[f+g]+j,P=s[d+g]-W,B=s[d+g]+W,W=v*w-_*P,j=_*w+v*P,s[f+g]=S-j,s[f+0]=S+j,s[d+b]=L-W,s[d+k]=L+W,W=_*B-v*I,j=v*B+_*I,s[d+g]=A-j,s[d+0]=A+j,s[f+b]=x-W,s[f+k]=x+W,d+=l,f+=l}while(f<m);M=_,_=M*n[c+0]-v*n[c+1],v=M*n[c+1]+v*n[c+0]}c+=2}while(l<i)}var o=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(s,a,i,c,l){for(var f=0;f<3;f++){var d=ln.BLKSIZE_s/2,m=65535&576/3*(f+1),v=ln.BLKSIZE_s/8-1;do{var _,y,k,g,b,h=o[v<<2]&255;_=t[h]*c[i][l+h+m],b=t[127-h]*c[i][l+h+m+128],y=_-b,_=_+b,k=t[h+64]*c[i][l+h+m+64],b=t[63-h]*c[i][l+h+m+192],g=k-b,k=k+b,d-=4,a[f][d+0]=_+k,a[f][d+2]=_-k,a[f][d+1]=y+g,a[f][d+3]=y-g,_=t[h+1]*c[i][l+h+m+1],b=t[126-h]*c[i][l+h+m+129],y=_-b,_=_+b,k=t[h+65]*c[i][l+h+m+65],b=t[62-h]*c[i][l+h+m+193],g=k-b,k=k+b,a[f][d+ln.BLKSIZE_s/2+0]=_+k,a[f][d+ln.BLKSIZE_s/2+2]=_-k,a[f][d+ln.BLKSIZE_s/2+1]=y+g,a[f][d+ln.BLKSIZE_s/2+3]=y-g}while(--v>=0);r(a[f],d,ln.BLKSIZE_s/2)}},this.fft_long=function(s,a,i,c,l){var f=ln.BLKSIZE/8-1,d=ln.BLKSIZE/2;do{var m,v,_,y,k,g=o[f]&255;m=e[g]*c[i][l+g],k=e[g+512]*c[i][l+g+512],v=m-k,m=m+k,_=e[g+256]*c[i][l+g+256],k=e[g+768]*c[i][l+g+768],y=_-k,_=_+k,d-=4,a[d+0]=m+_,a[d+2]=m-_,a[d+1]=v+y,a[d+3]=v-y,m=e[g+1]*c[i][l+g+1],k=e[g+513]*c[i][l+g+513],v=m-k,m=m+k,_=e[g+257]*c[i][l+g+257],k=e[g+769]*c[i][l+g+769],y=_-k,_=_+k,a[d+ln.BLKSIZE/2+0]=m+_,a[d+ln.BLKSIZE/2+2]=m-_,a[d+ln.BLKSIZE/2+1]=v+y,a[d+ln.BLKSIZE/2+3]=v-y}while(--f>=0);r(a,d,ln.BLKSIZE/2)},this.init_fft=function(s){for(var a=0;a<ln.BLKSIZE;a++)e[a]=.42-.5*Math.cos(2*Math.PI*(a+.5)/ln.BLKSIZE)+.08*Math.cos(4*Math.PI*(a+.5)/ln.BLKSIZE);for(var a=0;a<ln.BLKSIZE_s/2;a++)t[a]=.5*(1-Math.cos(2*Math.PI*(a+.5)/ln.BLKSIZE_s))}}var s$=o$,Bo=Zt,sa=Bo.VbrMode,rb=Bo.Float,aa=Bo.ShortBlock,Un=Bo.Util,a$=Bo.Arrays,pn=Bo.new_float,vr=Bo.new_float_n,ms=Bo.new_int,lt=Bo.assert,i$=s$,pe=zn();function c$(){var e=ll,t=new i$,n=2.302585092994046,r=2,o=16,s=2,a=16,i=.34,c=1/(14752*14752)/(pe.BLKSIZE/2),l=.01,f=.8,d=.6,m=.3,v=3.5,_=21,y=.2302585093;function k(z,F){for(var q=0,Q=0;Q<pe.BLKSIZE/2;++Q)q+=z[Q]*F.ATH.eql_w[Q];return q*=c,q}function g(z,F,q,Q,re,K,ae,ce,oe,he,ie){var ue=z.internal_flags;if(oe<2)t.fft_long(ue,Q[re],oe,he,ie),t.fft_short(ue,K[ae],oe,he,ie);else if(oe==2){for(var Se=pe.BLKSIZE-1;Se>=0;--Se){var Ye=Q[re+0][Se],ge=Q[re+1][Se];Q[re+0][Se]=(Ye+ge)*Un.SQRT2*.5,Q[re+1][Se]=(Ye-ge)*Un.SQRT2*.5}for(var $e=2;$e>=0;--$e)for(var Se=pe.BLKSIZE_s-1;Se>=0;--Se){var Ye=K[ae+0][$e][Se],ge=K[ae+1][$e][Se];K[ae+0][$e][Se]=(Ye+ge)*Un.SQRT2*.5,K[ae+1][$e][Se]=(Ye-ge)*Un.SQRT2*.5}}F[0]=Q[re+0][0],F[0]*=F[0];for(var Se=pe.BLKSIZE/2-1;Se>=0;--Se){var le=Q[re+0][pe.BLKSIZE/2-Se],ze=Q[re+0][pe.BLKSIZE/2+Se];F[pe.BLKSIZE/2-Se]=(le*le+ze*ze)*.5}for(var $e=2;$e>=0;--$e){q[$e][0]=K[ae+0][$e][0],q[$e][0]*=q[$e][0];for(var Se=pe.BLKSIZE_s/2-1;Se>=0;--Se){var le=K[ae+0][$e][pe.BLKSIZE_s/2-Se],ze=K[ae+0][$e][pe.BLKSIZE_s/2+Se];q[$e][pe.BLKSIZE_s/2-Se]=(le*le+ze*ze)*.5}}{for(var tt=0,Se=11;Se<pe.HBLKSIZE;Se++)tt+=F[Se];ue.tot_ener[oe]=tt}if(z.analysis){for(var Se=0;Se<pe.HBLKSIZE;Se++)ue.pinfo.energy[ce][oe][Se]=ue.pinfo.energy_save[oe][Se],ue.pinfo.energy_save[oe][Se]=F[Se];ue.pinfo.pe[ce][oe]=ue.pe[oe]}z.athaa_loudapprox==2&&oe<2&&(ue.loudness_sq[ce][oe]=ue.loudness_sq_save[oe],ue.loudness_sq_save[oe]=k(F,ue))}var b=8,h=23,S=15,x,w,I,M=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749];function H(){x=Math.pow(10,(b+1)/16),w=Math.pow(10,(h+1)/16),I=Math.pow(10,S/10)}var j=[3.3246*3.3246,3.23837*3.23837,3.15437*3.15437,3.00412*3.00412,2.86103*2.86103,2.65407*2.65407,2.46209*2.46209,2.284*2.284,2.11879*2.11879,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,1.56911*1.56911,1.46658*1.46658,1.37074*1.37074,1.31036*1.31036,1.25264*1.25264,1.20648*1.20648,1.16203*1.16203,1.12765*1.12765,1.09428*1.09428,1.0659*1.0659,1.03826*1.03826,1.01895*1.01895,1],W=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1],A=[2.35364*2.35364,2.29259*2.29259,2.23313*2.23313,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,1.49999*1.49999,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.11084*1.11084,1.03826*1.03826];function L(z,F,q,Q,re,K){var ae;if(F>z)if(F<z*w)ae=F/z;else return z+F;else{if(z>=F*w)return z+F;ae=z/F}if(z+=F,Q+3<=6){if(ae>=x)return z;var ce=0|Un.FAST_LOG10_X(ae,16);return z*W[ce]}var ce=0|Un.FAST_LOG10_X(ae,16);if(F=re.ATH.cb_l[q]*re.ATH.adjust,z<I*F){if(z>F){var oe,he;return oe=1,ce<=13&&(oe=A[ce]),he=Un.FAST_LOG10_X(z/F,10/15),z*((j[ce]-oe)*he+oe)}return ce>13?z:z*A[ce]}return z*j[ce]}var B=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1];function P(z,F,q){var Q;if(z<0&&(z=0),F<0&&(F=0),z<=0)return F;if(F<=0)return z;if(F>z?Q=F/z:Q=z/F,-2<=q&&q<=2){if(Q>=x)return z+F;var re=0|Un.FAST_LOG10_X(Q,16);return(z+F)*B[re]}return Q<w?z+F:(z<F&&(z=F),z)}function V(z,F){var q=z.internal_flags;if(q.channels_out>1){for(var Q=0;Q<pe.SBMAX_l;Q++){var re=q.thm[0].l[Q],K=q.thm[1].l[Q];q.thm[0].l[Q]+=K*F,q.thm[1].l[Q]+=re*F}for(var Q=0;Q<pe.SBMAX_s;Q++)for(var ae=0;ae<3;ae++){var re=q.thm[0].s[Q][ae],K=q.thm[1].s[Q][ae];q.thm[0].s[Q][ae]+=K*F,q.thm[1].s[Q][ae]+=re*F}}}function U(z){for(var F=0;F<pe.SBMAX_l;F++)if(!(z.thm[0].l[F]>1.58*z.thm[1].l[F]||z.thm[1].l[F]>1.58*z.thm[0].l[F])){var q=z.mld_l[F]*z.en[3].l[F],Q=Math.max(z.thm[2].l[F],Math.min(z.thm[3].l[F],q));q=z.mld_l[F]*z.en[2].l[F];var re=Math.max(z.thm[3].l[F],Math.min(z.thm[2].l[F],q));z.thm[2].l[F]=Q,z.thm[3].l[F]=re}for(var F=0;F<pe.SBMAX_s;F++)for(var K=0;K<3;K++)if(!(z.thm[0].s[F][K]>1.58*z.thm[1].s[F][K]||z.thm[1].s[F][K]>1.58*z.thm[0].s[F][K])){var q=z.mld_s[F]*z.en[3].s[F][K],Q=Math.max(z.thm[2].s[F][K],Math.min(z.thm[3].s[F][K],q));q=z.mld_s[F]*z.en[2].s[F][K];var re=Math.max(z.thm[3].s[F][K],Math.min(z.thm[2].s[F][K],q));z.thm[2].s[F][K]=Q,z.thm[3].s[F][K]=re}}function X(z,F,q){var Q=F,re=Math.pow(10,q);F*=2,Q*=2;for(var K=0;K<pe.SBMAX_l;K++){var ae,ce,oe,he;if(he=z.ATH.cb_l[z.bm_l[K]]*re,ae=Math.min(Math.max(z.thm[0].l[K],he),Math.max(z.thm[1].l[K],he)),ce=Math.max(z.thm[2].l[K],he),oe=Math.max(z.thm[3].l[K],he),ae*F<ce+oe){var ie=ae*Q/(ce+oe);ce*=ie,oe*=ie}z.thm[2].l[K]=Math.min(ce,z.thm[2].l[K]),z.thm[3].l[K]=Math.min(oe,z.thm[3].l[K])}re*=pe.BLKSIZE_s/pe.BLKSIZE;for(var K=0;K<pe.SBMAX_s;K++)for(var ue=0;ue<3;ue++){var ae,ce,oe,he;if(he=z.ATH.cb_s[z.bm_s[K]]*re,ae=Math.min(Math.max(z.thm[0].s[K][ue],he),Math.max(z.thm[1].s[K][ue],he)),ce=Math.max(z.thm[2].s[K][ue],he),oe=Math.max(z.thm[3].s[K][ue],he),ae*F<ce+oe){var ie=ae*F/(ce+oe);ce*=ie,oe*=ie}z.thm[2].s[K][ue]=Math.min(z.thm[2].s[K][ue],ce),z.thm[3].s[K][ue]=Math.min(z.thm[3].s[K][ue],oe)}}function te(z,F,q,Q,re){var K,ae,ce=0,oe=0;for(K=ae=0;K<pe.SBMAX_s;++ae,++K){for(var he=z.bo_s[K],ie=z.npart_s,ue=he<ie?he:ie;ae<ue;)lt(F[ae]>=0),lt(q[ae]>=0),ce+=F[ae],oe+=q[ae],ae++;if(z.en[Q].s[K][re]=ce,z.thm[Q].s[K][re]=oe,ae>=ie){++K;break}lt(F[ae]>=0),lt(q[ae]>=0);{var Se=z.PSY.bo_s_weight[K],Ye=1-Se;ce=Se*F[ae],oe=Se*q[ae],z.en[Q].s[K][re]+=ce,z.thm[Q].s[K][re]+=oe,ce=Ye*F[ae],oe=Ye*q[ae]}}for(;K<pe.SBMAX_s;++K)z.en[Q].s[K][re]=0,z.thm[Q].s[K][re]=0}function Y(z,F,q,Q){var re,K,ae=0,ce=0;for(re=K=0;re<pe.SBMAX_l;++K,++re){for(var oe=z.bo_l[re],he=z.npart_l,ie=oe<he?oe:he;K<ie;)lt(F[K]>=0),lt(q[K]>=0),ae+=F[K],ce+=q[K],K++;if(z.en[Q].l[re]=ae,z.thm[Q].l[re]=ce,K>=he){++re;break}lt(F[K]>=0),lt(q[K]>=0);{var ue=z.PSY.bo_l_weight[re],Se=1-ue;ae=ue*F[K],ce=ue*q[K],z.en[Q].l[re]+=ae,z.thm[Q].l[re]+=ce,ae=Se*F[K],ce=Se*q[K]}}for(;re<pe.SBMAX_l;++re)z.en[Q].l[re]=0,z.thm[Q].l[re]=0}function R(z,F,q,Q,re,K){var ae=z.internal_flags,ce,oe;for(oe=ce=0;oe<ae.npart_s;++oe){for(var he=0,ie=ae.numlines_s[oe],ue=0;ue<ie;++ue,++ce){var Se=F[K][ce];he+=Se}q[oe]=he}for(lt(oe==ae.npart_s),ce=oe=0;oe<ae.npart_s;oe++){var Ye=ae.s3ind_s[oe][0],ge=ae.s3_ss[ce++]*q[Ye];for(++Ye;Ye<=ae.s3ind_s[oe][1];)ge+=ae.s3_ss[ce]*q[Ye],++ce,++Ye;{var $e=s*ae.nb_s1[re][oe];Q[oe]=Math.min(ge,$e)}if(ae.blocktype_old[re&1]==pe.SHORT_TYPE){var $e=a*ae.nb_s2[re][oe],le=Q[oe];Q[oe]=Math.min($e,le)}ae.nb_s2[re][oe]=ae.nb_s1[re][oe],ae.nb_s1[re][oe]=ge,lt(Q[oe]>=0)}for(;oe<=pe.CBANDS;++oe)q[oe]=0,Q[oe]=0}function E(z,F,q,Q){var re=z.internal_flags;z.short_blocks==aa.short_block_coupled&&!(F[0]!=0&&F[1]!=0)&&(F[0]=F[1]=0);for(var K=0;K<re.channels_out;K++)Q[K]=pe.NORM_TYPE,z.short_blocks==aa.short_block_dispensed&&(F[K]=1),z.short_blocks==aa.short_block_forced&&(F[K]=0),F[K]!=0?(lt(re.blocktype_old[K]!=pe.START_TYPE),re.blocktype_old[K]==pe.SHORT_TYPE&&(Q[K]=pe.STOP_TYPE)):(Q[K]=pe.SHORT_TYPE,re.blocktype_old[K]==pe.NORM_TYPE&&(re.blocktype_old[K]=pe.START_TYPE),re.blocktype_old[K]==pe.STOP_TYPE&&(re.blocktype_old[K]=pe.SHORT_TYPE)),q[K]=re.blocktype_old[K],re.blocktype_old[K]=Q[K]}function C(z,F,q){return q>=1?z:q<=0?F:F>0?Math.pow(z/F,q)*F:0}var O=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function $(z,F){for(var q=309.07,Q=0;Q<pe.SBMAX_s-1;Q++)for(var re=0;re<3;re++){var K=z.thm.s[Q][re];if(K>0){var ae=K*F,ce=z.en.s[Q][re];ce>ae&&(ce>ae*1e10?q+=O[Q]*(10*n):q+=O[Q]*Un.FAST_LOG10(ce/ae))}}return q}var ne=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function fe(z,F){for(var q=281.0575,Q=0;Q<pe.SBMAX_l-1;Q++){var re=z.thm.l[Q];if(re>0){var K=re*F,ae=z.en.l[Q];ae>K&&(ae>K*1e10?q+=ne[Q]*(10*n):q+=ne[Q]*Un.FAST_LOG10(ae/K))}}return q}function Z(z,F,q,Q,re){var K,ae;for(K=ae=0;K<z.npart_l;++K){var ce=0,oe=0,he;for(he=0;he<z.numlines_l[K];++he,++ae){var ie=F[ae];ce+=ie,oe<ie&&(oe=ie)}q[K]=ce,Q[K]=oe,re[K]=ce*z.rnumlines_l[K],lt(z.rnumlines_l[K]>=0),lt(q[K]>=0),lt(Q[K]>=0),lt(re[K]>=0)}}function se(z,F,q,Q){var re=M.length-1,K=0,ae=q[K]+q[K+1];if(ae>0){var ce=F[K];ce<F[K+1]&&(ce=F[K+1]),lt(z.numlines_l[K]+z.numlines_l[K+1]-1>0),ae=20*(ce*2-ae)/(ae*(z.numlines_l[K]+z.numlines_l[K+1]-1));var oe=0|ae;oe>re&&(oe=re),Q[K]=oe}else Q[K]=0;for(K=1;K<z.npart_l-1;K++)if(ae=q[K-1]+q[K]+q[K+1],ae>0){var ce=F[K-1];ce<F[K]&&(ce=F[K]),ce<F[K+1]&&(ce=F[K+1]),lt(z.numlines_l[K-1]+z.numlines_l[K]+z.numlines_l[K+1]-1>0),ae=20*(ce*3-ae)/(ae*(z.numlines_l[K-1]+z.numlines_l[K]+z.numlines_l[K+1]-1));var oe=0|ae;oe>re&&(oe=re),Q[K]=oe}else Q[K]=0;if(lt(K==z.npart_l-1),ae=q[K-1]+q[K],ae>0){var ce=F[K-1];ce<F[K]&&(ce=F[K]),lt(z.numlines_l[K-1]+z.numlines_l[K]-1>0),ae=20*(ce*2-ae)/(ae*(z.numlines_l[K-1]+z.numlines_l[K]-1));var oe=0|ae;oe>re&&(oe=re),Q[K]=oe}else Q[K]=0;lt(K==z.npart_l-1)}var de=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];this.L3psycho_anal_ns=function(z,F,q,Q,re,K,ae,ce,oe,he){var ie=z.internal_flags,ue=vr([2,pe.BLKSIZE]),Se=vr([2,3,pe.BLKSIZE_s]),Ye=pn(pe.CBANDS+1),ge=pn(pe.CBANDS+1),$e=pn(pe.CBANDS+2),le=ms(2),ze=ms(2),tt,be,De,ve,Je,At,Te,rt,ct=vr([2,576]),Ut,or=ms(pe.CBANDS+2),cn=ms(pe.CBANDS+2);for(a$.fill(cn,0),tt=ie.channels_out,z.mode==e.JOINT_STEREO&&(tt=4),z.VBR==sa.vbr_off?Ut=ie.ResvMax==0?0:ie.ResvSize/ie.ResvMax*.5:z.VBR==sa.vbr_rh||z.VBR==sa.vbr_mtrh||z.VBR==sa.vbr_mt?Ut=.6:Ut=1,be=0;be<ie.channels_out;be++){var Gt=F[be],jn=q+576-350-_+192;for(ve=0;ve<576;ve++){var sr,ar;for(sr=Gt[jn+ve+10],ar=0,Je=0;Je<(_-1)/2-1;Je+=2)sr+=de[Je]*(Gt[jn+ve+Je]+Gt[jn+ve+_-Je]),ar+=de[Je+1]*(Gt[jn+ve+Je+1]+Gt[jn+ve+_-Je-1]);ct[be][ve]=sr+ar}re[Q][be].en.assign(ie.en[be]),re[Q][be].thm.assign(ie.thm[be]),tt>2&&(K[Q][be].en.assign(ie.en[be+2]),K[Q][be].thm.assign(ie.thm[be+2]))}for(be=0;be<tt;be++){var Mr,Er,An=pn(12),Hr=[0,0,0,0],na=pn(12),bf=1,eg,tg=pn(pe.CBANDS),ng=pn(pe.CBANDS),Xt=[0,0,0,0],rg=pn(pe.HBLKSIZE),og=vr([3,pe.HBLKSIZE_s]);for(lt(ie.npart_s<=pe.CBANDS),lt(ie.npart_l<=pe.CBANDS),ve=0;ve<3;ve++)An[ve]=ie.nsPsy.last_en_subshort[be][ve+6],lt(ie.nsPsy.last_en_subshort[be][ve+4]>0),na[ve]=An[ve]/ie.nsPsy.last_en_subshort[be][ve+4],Hr[0]+=An[ve];if(be==2)for(ve=0;ve<576;ve++){var _f,yf;_f=ct[0][ve],yf=ct[1][ve],ct[0][ve]=_f+yf,ct[1][ve]=_f-yf}{var sg=ct[be&1],Mi=0;for(ve=0;ve<9;ve++){for(var J3=Mi+64,_n=1;Mi<J3;Mi++)_n<Math.abs(sg[Mi])&&(_n=Math.abs(sg[Mi]));ie.nsPsy.last_en_subshort[be][ve]=An[ve+3]=_n,Hr[1+ve/3]+=_n,_n>An[ve+3-2]?(lt(An[ve+3-2]>0),_n=_n/An[ve+3-2]):An[ve+3-2]>_n*10?_n=An[ve+3-2]/(_n*10):_n=0,na[ve+3]=_n}}if(z.analysis){var Sf=na[0];for(ve=1;ve<12;ve++)Sf<na[ve]&&(Sf=na[ve]);ie.pinfo.ers[Q][be]=ie.pinfo.ers_save[be],ie.pinfo.ers_save[be]=Sf}for(eg=be==3?ie.nsPsy.attackthre_s:ie.nsPsy.attackthre,ve=0;ve<12;ve++)Xt[ve/3]==0&&na[ve]>eg&&(Xt[ve/3]=ve%3+1);for(ve=1;ve<4;ve++){var kf;Hr[ve-1]>Hr[ve]?(lt(Hr[ve]>0),kf=Hr[ve-1]/Hr[ve]):(lt(Hr[ve-1]>0),kf=Hr[ve]/Hr[ve-1]),kf<1.7&&(Xt[ve]=0,ve==1&&(Xt[0]=0))}for(Xt[0]!=0&&ie.nsPsy.lastAttacks[be]!=0&&(Xt[0]=0),(ie.nsPsy.lastAttacks[be]==3||Xt[0]+Xt[1]+Xt[2]+Xt[3]!=0)&&(bf=0,Xt[1]!=0&&Xt[0]!=0&&(Xt[1]=0),Xt[2]!=0&&Xt[1]!=0&&(Xt[2]=0),Xt[3]!=0&&Xt[2]!=0&&(Xt[3]=0)),be<2?ze[be]=bf:bf==0&&(ze[0]=ze[1]=0),oe[be]=ie.tot_ener[be],Er=Se,Mr=ue,g(z,rg,og,Mr,be&1,Er,be&1,Q,be,F,q),Z(ie,rg,Ye,tg,ng),se(ie,tg,ng,or),rt=0;rt<3;rt++){var wf,Hn;for(R(z,og,ge,$e,be,rt),te(ie,ge,$e,be,rt),Te=0;Te<pe.SBMAX_s;Te++){if(Hn=ie.thm[be].s[Te][rt],Hn*=f,Xt[rt]>=2||Xt[rt+1]==1){var Ei=rt!=0?rt-1:2,_n=C(ie.thm[be].s[Te][Ei],Hn,d*Ut);Hn=Math.min(Hn,_n)}if(Xt[rt]==1){var Ei=rt!=0?rt-1:2,_n=C(ie.thm[be].s[Te][Ei],Hn,m*Ut);Hn=Math.min(Hn,_n)}else if(rt!=0&&Xt[rt-1]==3||rt==0&&ie.nsPsy.lastAttacks[be]==3){var Ei=rt!=2?rt+1:0,_n=C(ie.thm[be].s[Te][Ei],Hn,m*Ut);Hn=Math.min(Hn,_n)}wf=An[rt*3+3]+An[rt*3+4]+An[rt*3+5],An[rt*3+5]*6<wf&&(Hn*=.5,An[rt*3+4]*6<wf&&(Hn*=.5)),ie.thm[be].s[Te][rt]=Hn}}for(ie.nsPsy.lastAttacks[be]=Xt[2],At=0,De=0;De<ie.npart_l;De++){for(var hs=ie.s3ind[De][0],xf=Ye[hs]*M[or[hs]],ps=ie.s3_ll[At++]*xf;++hs<=ie.s3ind[De][1];)xf=Ye[hs]*M[or[hs]],ps=L(ps,ie.s3_ll[At++]*xf,hs,hs-De,ie);ps*=.158489319246111,ie.blocktype_old[be&1]==pe.SHORT_TYPE?$e[De]=ps:$e[De]=C(Math.min(ps,Math.min(r*ie.nb_1[be][De],o*ie.nb_2[be][De])),ps,Ut),ie.nb_2[be][De]=ie.nb_1[be][De],ie.nb_1[be][De]=ps}for(;De<=pe.CBANDS;++De)Ye[De]=0,$e[De]=0;Y(ie,Ye,$e,be)}if((z.mode==e.STEREO||z.mode==e.JOINT_STEREO)&&z.interChRatio>0&&V(z,z.interChRatio),z.mode==e.JOINT_STEREO){var Cf;U(ie),Cf=z.msfix,Math.abs(Cf)>0&&X(ie,Cf,z.ATHlower*ie.ATH.adjust)}for(E(z,ze,he,le),be=0;be<tt;be++){var Ii,Ai=0,fl,hl;be>1?(Ii=ce,Ai=-2,fl=pe.NORM_TYPE,(he[0]==pe.SHORT_TYPE||he[1]==pe.SHORT_TYPE)&&(fl=pe.SHORT_TYPE),hl=K[Q][be-2]):(Ii=ae,Ai=0,fl=he[be],hl=re[Q][be]),fl==pe.SHORT_TYPE?Ii[Ai+be]=$(hl,ie.masking_lower):Ii[Ai+be]=fe(hl,ie.masking_lower),z.analysis&&(ie.pinfo.pe[Q][be]=Ii[Ai+be])}return 0};function _e(z,F,q,Q,re,K,ae,ce){var oe=z.internal_flags;if(Q<2)t.fft_long(oe,ae[ce],Q,F,q);else if(Q==2)for(var he=pe.BLKSIZE-1;he>=0;--he){var ie=ae[ce+0][he],ue=ae[ce+1][he];ae[ce+0][he]=(ie+ue)*Un.SQRT2*.5,ae[ce+1][he]=(ie-ue)*Un.SQRT2*.5}K[0]=ae[ce+0][0],K[0]*=K[0];for(var he=pe.BLKSIZE/2-1;he>=0;--he){var Se=ae[ce+0][pe.BLKSIZE/2-he],Ye=ae[ce+0][pe.BLKSIZE/2+he];K[pe.BLKSIZE/2-he]=(Se*Se+Ye*Ye)*.5}{for(var ge=0,he=11;he<pe.HBLKSIZE;he++)ge+=K[he];oe.tot_ener[Q]=ge}if(z.analysis){for(var he=0;he<pe.HBLKSIZE;he++)oe.pinfo.energy[re][Q][he]=oe.pinfo.energy_save[Q][he],oe.pinfo.energy_save[Q][he]=K[he];oe.pinfo.pe[re][Q]=oe.pe[Q]}}function Ie(z,F,q,Q,re,K,ae,ce){var oe=z.internal_flags;if(re==0&&Q<2&&t.fft_short(oe,ae[ce],Q,F,q),Q==2)for(var he=pe.BLKSIZE_s-1;he>=0;--he){var ie=ae[ce+0][re][he],ue=ae[ce+1][re][he];ae[ce+0][re][he]=(ie+ue)*Un.SQRT2*.5,ae[ce+1][re][he]=(ie-ue)*Un.SQRT2*.5}K[re][0]=ae[ce+0][re][0],K[re][0]*=K[re][0];for(var he=pe.BLKSIZE_s/2-1;he>=0;--he){var Se=ae[ce+0][re][pe.BLKSIZE_s/2-he],Ye=ae[ce+0][re][pe.BLKSIZE_s/2+he];K[re][pe.BLKSIZE_s/2-he]=(Se*Se+Ye*Ye)*.5}}function Ne(z,F,q,Q){var re=z.internal_flags;z.athaa_loudapprox==2&&q<2&&(re.loudness_sq[F][q]=re.loudness_sq_save[q],re.loudness_sq_save[q]=k(Q,re))}var Re=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];function Pe(z,F,q,Q,re,K,ae,ce,oe,he){for(var ie=vr([2,576]),ue=z.internal_flags,Se=ue.channels_out,Ye=z.mode==e.JOINT_STEREO?4:Se,ge=0;ge<Se;ge++){firbuf=F[ge];for(var $e=q+576-350-_+192,le=0;le<576;le++){var ze,tt;ze=firbuf[$e+le+10],tt=0;for(var be=0;be<(_-1)/2-1;be+=2)ze+=Re[be]*(firbuf[$e+le+be]+firbuf[$e+le+_-be]),tt+=Re[be+1]*(firbuf[$e+le+be+1]+firbuf[$e+le+_-be-1]);ie[ge][le]=ze+tt}re[Q][ge].en.assign(ue.en[ge]),re[Q][ge].thm.assign(ue.thm[ge]),Ye>2&&(K[Q][ge].en.assign(ue.en[ge+2]),K[Q][ge].thm.assign(ue.thm[ge+2]))}for(var ge=0;ge<Ye;ge++){var De=pn(12),ve=pn(12),Je=[0,0,0,0],At=ie[ge&1],Te=0,rt=ge==3?ue.nsPsy.attackthre_s:ue.nsPsy.attackthre,ct=1;if(ge==2)for(var le=0,be=576;be>0;++le,--be){var Ut=ie[0][le],or=ie[1][le];ie[0][le]=Ut+or,ie[1][le]=Ut-or}for(var le=0;le<3;le++)ve[le]=ue.nsPsy.last_en_subshort[ge][le+6],lt(ue.nsPsy.last_en_subshort[ge][le+4]>0),De[le]=ve[le]/ue.nsPsy.last_en_subshort[ge][le+4],Je[0]+=ve[le];for(var le=0;le<9;le++){for(var cn=Te+64,Gt=1;Te<cn;Te++)Gt<Math.abs(At[Te])&&(Gt=Math.abs(At[Te]));ue.nsPsy.last_en_subshort[ge][le]=ve[le+3]=Gt,Je[1+le/3]+=Gt,Gt>ve[le+3-2]?(lt(ve[le+3-2]>0),Gt=Gt/ve[le+3-2]):ve[le+3-2]>Gt*10?Gt=ve[le+3-2]/(Gt*10):Gt=0,De[le+3]=Gt}for(var le=0;le<3;++le){var jn=ve[le*3+3]+ve[le*3+4]+ve[le*3+5],sr=1;ve[le*3+5]*6<jn&&(sr*=.5,ve[le*3+4]*6<jn&&(sr*=.5)),ce[ge][le]=sr}if(z.analysis){for(var ar=De[0],le=1;le<12;le++)ar<De[le]&&(ar=De[le]);ue.pinfo.ers[Q][ge]=ue.pinfo.ers_save[ge],ue.pinfo.ers_save[ge]=ar}for(var le=0;le<12;le++)oe[ge][le/3]==0&&De[le]>rt&&(oe[ge][le/3]=le%3+1);for(var le=1;le<4;le++){var Mr=Je[le-1],Er=Je[le],An=Math.max(Mr,Er);An<4e4&&Mr<1.7*Er&&Er<1.7*Mr&&(le==1&&oe[ge][0]<=oe[ge][le]&&(oe[ge][0]=0),oe[ge][le]=0)}oe[ge][0]<=ue.nsPsy.lastAttacks[ge]&&(oe[ge][0]=0),(ue.nsPsy.lastAttacks[ge]==3||oe[ge][0]+oe[ge][1]+oe[ge][2]+oe[ge][3]!=0)&&(ct=0,oe[ge][1]!=0&&oe[ge][0]!=0&&(oe[ge][1]=0),oe[ge][2]!=0&&oe[ge][1]!=0&&(oe[ge][2]=0),oe[ge][3]!=0&&oe[ge][2]!=0&&(oe[ge][3]=0)),ge<2?he[ge]=ct:ct==0&&(he[0]=he[1]=0),ae[ge]=ue.tot_ener[ge]}}function je(z,F,q){if(q==0)for(var Q=0;Q<z.npart_s;Q++)z.nb_s2[F][Q]=z.nb_s1[F][Q],z.nb_s1[F][Q]=0}function Ee(z,F){for(var q=0;q<z.npart_l;q++)z.nb_2[F][q]=z.nb_1[F][q],z.nb_1[F][q]=0}function Ge(z,F,q,Q){var re=M.length-1,K=0,ae=q[K]+q[K+1];if(ae>0){var ce=F[K];ce<F[K+1]&&(ce=F[K+1]),lt(z.numlines_s[K]+z.numlines_s[K+1]-1>0),ae=20*(ce*2-ae)/(ae*(z.numlines_s[K]+z.numlines_s[K+1]-1));var oe=0|ae;oe>re&&(oe=re),Q[K]=oe}else Q[K]=0;for(K=1;K<z.npart_s-1;K++)if(ae=q[K-1]+q[K]+q[K+1],lt(K+1<z.npart_s),ae>0){var ce=F[K-1];ce<F[K]&&(ce=F[K]),ce<F[K+1]&&(ce=F[K+1]),lt(z.numlines_s[K-1]+z.numlines_s[K]+z.numlines_s[K+1]-1>0),ae=20*(ce*3-ae)/(ae*(z.numlines_s[K-1]+z.numlines_s[K]+z.numlines_s[K+1]-1));var oe=0|ae;oe>re&&(oe=re),Q[K]=oe}else Q[K]=0;if(lt(K==z.npart_s-1),ae=q[K-1]+q[K],ae>0){var ce=F[K-1];ce<F[K]&&(ce=F[K]),lt(z.numlines_s[K-1]+z.numlines_s[K]-1>0),ae=20*(ce*2-ae)/(ae*(z.numlines_s[K-1]+z.numlines_s[K]-1));var oe=0|ae;oe>re&&(oe=re),Q[K]=oe}else Q[K]=0;lt(K==z.npart_s-1)}function T(z,F,q,Q,re,K){var ae=z.internal_flags,ce=new float[pe.CBANDS],oe=pn(pe.CBANDS),he,ie,ue,Se=new int[pe.CBANDS];for(ue=ie=0;ue<ae.npart_s;++ue){var Ye=0,ge=0,$e=ae.numlines_s[ue];for(he=0;he<$e;++he,++ie){var le=F[K][ie];Ye+=le,ge<le&&(ge=le)}q[ue]=Ye,ce[ue]=ge,oe[ue]=Ye/$e,lt(oe[ue]>=0)}for(lt(ue==ae.npart_s);ue<pe.CBANDS;++ue)ce[ue]=0,oe[ue]=0;for(Ge(ae,ce,oe,Se),ie=ue=0;ue<ae.npart_s;ue++){var ze=ae.s3ind_s[ue][0],tt=ae.s3ind_s[ue][1],be,De,ve,Je,At;for(be=Se[ze],De=1,Je=ae.s3_ss[ie]*q[ze]*M[Se[ze]],++ie,++ze;ze<=tt;)be+=Se[ze],De+=1,ve=ae.s3_ss[ie]*q[ze]*M[Se[ze]],Je=P(Je,ve,ze-ue),++ie,++ze;be=(1+2*be)/(2*De),At=M[be]*.5,Je*=At,Q[ue]=Je,ae.nb_s2[re][ue]=ae.nb_s1[re][ue],ae.nb_s1[re][ue]=Je,ve=ce[ue],ve*=ae.minval_s[ue],ve*=At,Q[ue]>ve&&(Q[ue]=ve),ae.masking_lower>1&&(Q[ue]*=ae.masking_lower),Q[ue]>q[ue]&&(Q[ue]=q[ue]),ae.masking_lower<1&&(Q[ue]*=ae.masking_lower),lt(Q[ue]>=0)}for(;ue<pe.CBANDS;++ue)q[ue]=0,Q[ue]=0}function D(z,F,q,Q,re){var K=pn(pe.CBANDS),ae=pn(pe.CBANDS),ce=ms(pe.CBANDS+2),oe;Z(z,F,q,K,ae),se(z,K,ae,ce);var he=0;for(oe=0;oe<z.npart_l;oe++){var ie,ue,Se,Ye,ge=z.s3ind[oe][0],$e=z.s3ind[oe][1],le=0,ze=0;for(le=ce[ge],ze+=1,ue=z.s3_ll[he]*q[ge]*M[ce[ge]],++he,++ge;ge<=$e;)le+=ce[ge],ze+=1,ie=z.s3_ll[he]*q[ge]*M[ce[ge]],Ye=P(ue,ie,ge-oe),ue=Ye,++he,++ge;if(le=(1+2*le)/(2*ze),Se=M[le]*.5,ue*=Se,z.blocktype_old[re&1]==pe.SHORT_TYPE){var tt=r*z.nb_1[re][oe];tt>0?Q[oe]=Math.min(ue,tt):Q[oe]=Math.min(ue,q[oe]*m)}else{var be=o*z.nb_2[re][oe],De=r*z.nb_1[re][oe],tt;be<=0&&(be=ue),De<=0&&(De=ue),z.blocktype_old[re&1]==pe.NORM_TYPE?tt=Math.min(De,be):tt=De,Q[oe]=Math.min(ue,tt)}z.nb_2[re][oe]=z.nb_1[re][oe],z.nb_1[re][oe]=ue,ie=K[oe],ie*=z.minval_l[oe],ie*=Se,Q[oe]>ie&&(Q[oe]=ie),z.masking_lower>1&&(Q[oe]*=z.masking_lower),Q[oe]>q[oe]&&(Q[oe]=q[oe]),z.masking_lower<1&&(Q[oe]*=z.masking_lower),lt(Q[oe]>=0)}for(;oe<pe.CBANDS;++oe)q[oe]=0,Q[oe]=0}function we(z,F){var q=z.internal_flags;z.short_blocks==aa.short_block_coupled&&!(F[0]!=0&&F[1]!=0)&&(F[0]=F[1]=0);for(var Q=0;Q<q.channels_out;Q++)z.short_blocks==aa.short_block_dispensed&&(F[Q]=1),z.short_blocks==aa.short_block_forced&&(F[Q]=0)}function ke(z,F,q){for(var Q=z.internal_flags,re=0;re<Q.channels_out;re++){var K=pe.NORM_TYPE;F[re]!=0?(lt(Q.blocktype_old[re]!=pe.START_TYPE),Q.blocktype_old[re]==pe.SHORT_TYPE&&(K=pe.STOP_TYPE)):(K=pe.SHORT_TYPE,Q.blocktype_old[re]==pe.NORM_TYPE&&(Q.blocktype_old[re]=pe.START_TYPE),Q.blocktype_old[re]==pe.STOP_TYPE&&(Q.blocktype_old[re]=pe.SHORT_TYPE)),q[re]=Q.blocktype_old[re],Q.blocktype_old[re]=K}}function Be(z,F,q,Q,re,K,ae){for(var ce=K*2,oe=K>0?Math.pow(10,re):1,he,ie,ue=0;ue<ae;++ue){var Se=z[2][ue],Ye=z[3][ue],ge=F[0][ue],$e=F[1][ue],le=F[2][ue],ze=F[3][ue];if(ge<=1.58*$e&&$e<=1.58*ge){var tt=q[ue]*Ye,be=q[ue]*Se;ie=Math.max(le,Math.min(ze,tt)),he=Math.max(ze,Math.min(le,be))}else ie=le,he=ze;if(K>0){var De,ve,Je=Q[ue]*oe;if(De=Math.min(Math.max(ge,Je),Math.max($e,Je)),le=Math.max(ie,Je),ze=Math.max(he,Je),ve=le+ze,ve>0&&De*ce<ve){var At=De*ce/ve;le*=At,ze*=At}ie=Math.min(le,ie),he=Math.min(ze,he)}ie>Se&&(ie=Se),he>Ye&&(he=Ye),F[2][ue]=ie,F[3][ue]=he}}this.L3psycho_anal_vbr=function(z,F,q,Q,re,K,ae,ce,oe,he){var ie=z.internal_flags,ue,Se,Ye=pn(pe.HBLKSIZE),ge=vr([3,pe.HBLKSIZE_s]),$e=vr([2,pe.BLKSIZE]),le=vr([2,3,pe.BLKSIZE_s]),ze=vr([4,pe.CBANDS]),tt=vr([4,pe.CBANDS]),be=vr([4,3]),De=.6,ve=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],Je=ms(2),At=z.mode==e.JOINT_STEREO?4:ie.channels_out;Pe(z,F,q,Q,re,K,oe,be,ve,Je),we(z,Je);{for(var Te=0;Te<At;Te++){var rt=Te&1;ue=$e,_e(z,F,q,Te,Q,Ye,ue,rt),Ne(z,Q,Te,Ye),Je[rt]!=0?D(ie,Ye,ze[Te],tt[Te],Te):Ee(ie,Te)}Je[0]+Je[1]==2&&z.mode==e.JOINT_STEREO&&Be(ze,tt,ie.mld_cb_l,ie.ATH.cb_l,z.ATHlower*ie.ATH.adjust,z.msfix,ie.npart_l);for(var Te=0;Te<At;Te++){var rt=Te&1;Je[rt]!=0&&Y(ie,ze[Te],tt[Te],Te)}}{for(var ct=0;ct<3;ct++){for(var Te=0;Te<At;++Te){var rt=Te&1;Je[rt]!=0?je(ie,Te,ct):(Se=le,Ie(z,F,q,Te,ct,ge,Se,rt),T(z,ge,ze[Te],tt[Te],Te,ct))}Je[0]+Je[1]==0&&z.mode==e.JOINT_STEREO&&Be(ze,tt,ie.mld_cb_s,ie.ATH.cb_s,z.ATHlower*ie.ATH.adjust,z.msfix,ie.npart_s);for(var Te=0;Te<At;++Te){var rt=Te&1;Je[rt]==0&&te(ie,ze[Te],tt[Te],Te,ct)}}for(var Te=0;Te<At;Te++){var rt=Te&1;if(Je[rt]==0)for(var Ut=0;Ut<pe.SBMAX_s;Ut++){for(var or=pn(3),ct=0;ct<3;ct++){var cn=ie.thm[Te].s[Ut][ct];if(cn*=f,ve[Te][ct]>=2||ve[Te][ct+1]==1){var Gt=ct!=0?ct-1:2,jn=C(ie.thm[Te].s[Ut][Gt],cn,d*De);cn=Math.min(cn,jn)}else if(ve[Te][ct]==1){var Gt=ct!=0?ct-1:2,jn=C(ie.thm[Te].s[Ut][Gt],cn,m*De);cn=Math.min(cn,jn)}else if(ct!=0&&ve[Te][ct-1]==3||ct==0&&ie.nsPsy.lastAttacks[Te]==3){var Gt=ct!=2?ct+1:0,jn=C(ie.thm[Te].s[Ut][Gt],cn,m*De);cn=Math.min(cn,jn)}cn*=be[Te][ct],or[ct]=cn}for(var ct=0;ct<3;ct++)ie.thm[Te].s[Ut][ct]=or[ct]}}}for(var Te=0;Te<At;Te++)ie.nsPsy.lastAttacks[Te]=ve[Te][2];ke(z,Je,he);for(var Te=0;Te<At;Te++){var sr,ar,Mr,Er;Te>1?(sr=ce,ar=-2,Mr=pe.NORM_TYPE,(he[0]==pe.SHORT_TYPE||he[1]==pe.SHORT_TYPE)&&(Mr=pe.SHORT_TYPE),Er=K[Q][Te-2]):(sr=ae,ar=0,Mr=he[Te],Er=re[Q][Te]),Mr==pe.SHORT_TYPE?sr[ar+Te]=$(Er,ie.masking_lower):sr[ar+Te]=fe(Er,ie.masking_lower),z.analysis&&(ie.pinfo.pe[Q][Te]=sr[ar+Te])}return 0};function He(z,F){var q=z,Q;return q>=0?Q=-q*27:Q=q*F,Q<=-72?0:Math.exp(Q*y)}function Ue(z){var F=0,q=0;{var Q=0,re,K;for(Q=0;He(Q,z)>1e-20;Q-=1);for(re=Q,K=0;Math.abs(K-re)>1e-12;)Q=(K+re)/2,He(Q,z)>0?K=Q:re=Q;F=re}{var Q=0,re,K;for(Q=0;He(Q,z)>1e-20;Q+=1);for(re=0,K=Q;Math.abs(K-re)>1e-12;)Q=(K+re)/2,He(Q,z)>0?re=Q:K=Q;q=K}{var ae=0,ce=1e3,oe;for(oe=0;oe<=ce;++oe){var Q=F+oe*(q-F)/ce,he=He(Q,z);ae+=he}{var ie=(ce+1)/(ae*(q-F));return ie}}}function Le(z){var F,q,Q,re;return F=z,F>=0?F*=3:F*=1.5,F>=.5&&F<=2.5?(re=F-.5,q=8*(re*re-2*re)):q=0,F+=.474,Q=15.811389+7.5*F-17.5*Math.sqrt(1+F*F),Q<=-60?0:(F=Math.exp((q+Q)*y),F/=.6609193,F)}function et(z){return z<0&&(z=0),z=z*.001,13*Math.atan(.76*z)+3.5*Math.atan(z*z/(7.5*7.5))}function Ze(z,F,q,Q,re,K,ae,ce,oe,he,ie,ue){var Se=pn(pe.CBANDS+1),Ye=ce/(ue>15?2*576:2*192),ge=ms(pe.HBLKSIZE),$e;ce/=oe;var le=0,ze=0;for($e=0;$e<pe.CBANDS;$e++){var tt,be;for(tt=et(ce*le),Se[$e]=ce*le,be=le;et(ce*be)-tt<i&&be<=oe/2;be++);for(z[$e]=be-le,ze=$e+1;le<be;)lt(le<pe.HBLKSIZE),ge[le++]=$e;if(le>oe/2){le=oe/2,++$e;break}}lt($e<pe.CBANDS),Se[$e]=ce*le;for(var De=0;De<ue;De++){var ve,Je,At,Te,rt;At=he[De],Te=he[De+1],ve=0|Math.floor(.5+ie*(At-.5)),ve<0&&(ve=0),Je=0|Math.floor(.5+ie*(Te-.5)),Je>oe/2&&(Je=oe/2),q[De]=(ge[ve]+ge[Je])/2,F[De]=ge[Je];var ct=Ye*Te;ae[De]=(ct-Se[F[De]])/(Se[F[De]+1]-Se[F[De]]),ae[De]<0?ae[De]=0:ae[De]>1&&(ae[De]=1),rt=et(ce*he[De]*ie),rt=Math.min(rt,15.5)/15.5,K[De]=Math.pow(10,1.25*(1-Math.cos(Math.PI*rt))-2.5)}le=0;for(var Ut=0;Ut<ze;Ut++){var or=z[Ut],tt,cn;tt=et(ce*le),cn=et(ce*(le+or-1)),Q[Ut]=.5*(tt+cn),tt=et(ce*(le-.5)),cn=et(ce*(le+or-.5)),re[Ut]=cn-tt,le+=or}return ze}function Ae(z,F,q,Q,re,K){var ae=vr([pe.CBANDS,pe.CBANDS]),ce,oe=0;if(K)for(var he=0;he<F;he++)for(ce=0;ce<F;ce++){var ie=Le(q[he]-q[ce])*Q[ce];ae[he][ce]=ie*re[he]}else for(ce=0;ce<F;ce++)for(var ue=15+Math.min(21/q[ce],12),Se=Ue(ue),he=0;he<F;he++){var ie=Se*He(q[he]-q[ce],ue)*Q[ce];ae[he][ce]=ie*re[he]}for(var he=0;he<F;he++){for(ce=0;ce<F&&!(ae[he][ce]>0);ce++);for(z[he][0]=ce,ce=F-1;ce>0&&!(ae[he][ce]>0);ce--);z[he][1]=ce,oe+=z[he][1]-z[he][0]+1}for(var Ye=pn(oe),ge=0,he=0;he<F;he++)for(ce=z[he][0];ce<=z[he][1];ce++)Ye[ge++]=ae[he][ce];return Ye}function xt(z){var F=et(z);return F=Math.min(F,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*F))-2.5)}this.psymodel_init=function(z){var F=z.internal_flags,q,Q=!0,re=13,K=24,ae=0,ce=0,oe=-8.25,he=-4.5,ie=pn(pe.CBANDS),ue=pn(pe.CBANDS),Se=pn(pe.CBANDS),Ye=z.out_samplerate;switch(z.experimentalZ){default:case 0:Q=!0;break;case 1:Q=!(z.VBR==sa.vbr_mtrh||z.VBR==sa.vbr_mt);break;case 2:Q=!1;break;case 3:re=8,ae=-1.75,ce=-.0125,oe=-8.25,he=-2.25;break}for(F.ms_ener_ratio_old=.25,F.blocktype_old[0]=F.blocktype_old[1]=pe.NORM_TYPE,q=0;q<4;++q){for(var le=0;le<pe.CBANDS;++le)F.nb_1[q][le]=1e20,F.nb_2[q][le]=1e20,F.nb_s1[q][le]=F.nb_s2[q][le]=1;for(var ge=0;ge<pe.SBMAX_l;ge++)F.en[q].l[ge]=1e20,F.thm[q].l[ge]=1e20;for(var le=0;le<3;++le){for(var ge=0;ge<pe.SBMAX_s;ge++)F.en[q].s[ge][le]=1e20,F.thm[q].s[ge][le]=1e20;F.nsPsy.lastAttacks[q]=0}for(var le=0;le<9;le++)F.nsPsy.last_en_subshort[q][le]=10}for(F.loudness_sq_save[0]=F.loudness_sq_save[1]=0,F.npart_l=Ze(F.numlines_l,F.bo_l,F.bm_l,ie,ue,F.mld_l,F.PSY.bo_l_weight,Ye,pe.BLKSIZE,F.scalefac_band.l,pe.BLKSIZE/(2*576),pe.SBMAX_l),lt(F.npart_l<pe.CBANDS),q=0;q<F.npart_l;q++){var $e=ae;ie[q]>=re&&($e=ce*(ie[q]-re)/(K-re)+ae*(K-ie[q])/(K-re)),Se[q]=Math.pow(10,$e/10),F.numlines_l[q]>0?F.rnumlines_l[q]=1/F.numlines_l[q]:F.rnumlines_l[q]=0}F.s3_ll=Ae(F.s3ind,F.npart_l,ie,ue,Se,Q);var le=0;for(q=0;q<F.npart_l;q++){var ze;ze=rb.MAX_VALUE;for(var tt=0;tt<F.numlines_l[q];tt++,le++){var be=Ye*le/(1e3*pe.BLKSIZE),De;De=this.ATHformula(be*1e3,z)-20,De=Math.pow(10,.1*De),De*=F.numlines_l[q],ze>De&&(ze=De)}F.ATH.cb_l[q]=ze,ze=-20+ie[q]*20/10,ze>6&&(ze=100),ze<-15&&(ze=-15),ze-=8,F.minval_l[q]=Math.pow(10,ze/10)*F.numlines_l[q]}for(F.npart_s=Ze(F.numlines_s,F.bo_s,F.bm_s,ie,ue,F.mld_s,F.PSY.bo_s_weight,Ye,pe.BLKSIZE_s,F.scalefac_band.s,pe.BLKSIZE_s/(2*192),pe.SBMAX_s),lt(F.npart_s<pe.CBANDS),le=0,q=0;q<F.npart_s;q++){var ze,$e=oe;ie[q]>=re&&($e=he*(ie[q]-re)/(K-re)+oe*(K-ie[q])/(K-re)),Se[q]=Math.pow(10,$e/10),ze=rb.MAX_VALUE;for(var tt=0;tt<F.numlines_s[q];tt++,le++){var be=Ye*le/(1e3*pe.BLKSIZE_s),De;De=this.ATHformula(be*1e3,z)-20,De=Math.pow(10,.1*De),De*=F.numlines_s[q],ze>De&&(ze=De)}F.ATH.cb_s[q]=ze,ze=-7+ie[q]*7/12,ie[q]>12&&(ze*=1+Math.log(1+ze)*3.1),ie[q]<12&&(ze*=1+Math.log(1-ze)*2.3),ze<-15&&(ze=-15),ze-=8,F.minval_s[q]=Math.pow(10,ze/10)*F.numlines_s[q]}F.s3_ss=Ae(F.s3ind_s,F.npart_s,ie,ue,Se,Q),H(),t.init_fft(F),F.decay=Math.exp(-1*n/(l*Ye/192));{var ve;ve=v,z.exp_nspsytune&2&&(ve=1),Math.abs(z.msfix)>0&&(ve=z.msfix),z.msfix=ve;for(var Je=0;Je<F.npart_l;Je++)F.s3ind[Je][1]>F.npart_l-1&&(F.s3ind[Je][1]=F.npart_l-1)}var At=576*F.mode_gr/Ye;if(F.ATH.decay=Math.pow(10,-12/10*At),F.ATH.adjust=.01,F.ATH.adjustLimit=1,lt(F.bo_l[pe.SBMAX_l-1]<=F.npart_l),lt(F.bo_s[pe.SBMAX_s-1]<=F.npart_s),z.ATHtype!=-1){var be,Te=z.out_samplerate/pe.BLKSIZE,rt=0;for(be=0,q=0;q<pe.BLKSIZE/2;++q)be+=Te,F.ATH.eql_w[q]=1/Math.pow(10,this.ATHformula(be,z)/10),rt+=F.ATH.eql_w[q];for(rt=1/rt,q=pe.BLKSIZE/2;--q>=0;)F.ATH.eql_w[q]*=rt}{for(var Je=le=0;Je<F.npart_s;++Je)for(q=0;q<F.numlines_s[Je];++q)++le;for(var Je=le=0;Je<F.npart_l;++Je)for(q=0;q<F.numlines_l[Je];++q)++le}for(le=0,q=0;q<F.npart_l;q++){var be=Ye*(le+F.numlines_l[q]/2)/(1*pe.BLKSIZE);F.mld_cb_l[q]=xt(be),le+=F.numlines_l[q]}for(;q<pe.CBANDS;++q)F.mld_cb_l[q]=1;for(le=0,q=0;q<F.npart_s;q++){var be=Ye*(le+F.numlines_s[q]/2)/(1*pe.BLKSIZE_s);F.mld_cb_s[q]=xt(be),le+=F.numlines_s[q]}for(;q<pe.CBANDS;++q)F.mld_cb_s[q]=1;return 0};function It(z,F){z<-.3&&(z=3410),z/=1e3,z=Math.max(.1,z);var q=3.64*Math.pow(z,-.8)-6.8*Math.exp(-.6*Math.pow(z-3.4,2))+6*Math.exp(-.15*Math.pow(z-8.7,2))+(.6+.04*F)*.001*Math.pow(z,4);return q}this.ATHformula=function(z,F){var q;switch(F.ATHtype){case 0:q=It(z,9);break;case 1:q=It(z,-1);break;case 2:q=It(z,0);break;case 3:q=It(z,1)+6;break;case 4:q=It(z,F.ATHcurve);break;default:q=It(z,0);break}return q}}var l$=c$,u$=ll;function d$(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=u$.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}var f$=d$,h$=zn(),Ww={};Ww.SFBMAX=h$.SBMAX_s*3;var cf=Ww,$w=Zt,p$=$w.new_float,gs=$w.new_int,dh=cf;function m$(){this.xr=p$(576),this.l3_enc=gs(576),this.scalefac=gs(dh.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=gs(3),this.subblock_gain=gs(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=gs(dh.SFBMAX),this.window=gs(dh.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=gs(4),this.max_nonzero_coeff=0;var e=this;function t(r){return new Int32Array(r)}function n(r){return new Float32Array(r)}this.assign=function(r){e.xr=n(r.xr),e.l3_enc=t(r.l3_enc),e.scalefac=t(r.scalefac),e.xrpow_max=r.xrpow_max,e.part2_3_length=r.part2_3_length,e.big_values=r.big_values,e.count1=r.count1,e.global_gain=r.global_gain,e.scalefac_compress=r.scalefac_compress,e.block_type=r.block_type,e.mixed_block_flag=r.mixed_block_flag,e.table_select=t(r.table_select),e.subblock_gain=t(r.subblock_gain),e.region0_count=r.region0_count,e.region1_count=r.region1_count,e.preflag=r.preflag,e.scalefac_scale=r.scalefac_scale,e.count1table_select=r.count1table_select,e.part2_length=r.part2_length,e.sfb_lmax=r.sfb_lmax,e.sfb_smin=r.sfb_smin,e.psy_lmax=r.psy_lmax,e.sfbmax=r.sfbmax,e.psymax=r.psymax,e.sfbdivide=r.sfbdivide,e.width=t(r.width),e.window=t(r.window),e.count1bits=r.count1bits,e.sfb_partition_table=r.sfb_partition_table.slice(0),e.slen=t(r.slen),e.max_nonzero_coeff=r.max_nonzero_coeff}}var E1=m$,g$=Zt,ob=g$.new_int,v$=E1;function b$(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[ob(4),ob(4)];for(var e=0;e<2;e++)for(var t=0;t<2;t++)this.tt[e][t]=new v$}var _$=b$,Vw=Zt,Rl=Vw.System,Ol=Vw.new_int,Pl=zn();function y$(e,t,n,r){this.l=Ol(1+Pl.SBMAX_l),this.s=Ol(1+Pl.SBMAX_s),this.psfb21=Ol(1+Pl.PSFB21),this.psfb12=Ol(1+Pl.PSFB12);var o=this.l,s=this.s;arguments.length==4&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],Rl.arraycopy(this.arrL,0,o,0,Math.min(this.arrL.length,this.l.length)),Rl.arraycopy(this.arrS,0,s,0,Math.min(this.arrS.length,this.s.length)),Rl.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),Rl.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}var jw=y$,I1=Zt,fh=I1.new_float,S$=I1.new_float_n,k$=I1.new_int,sb=zn();function w$(){this.last_en_subshort=S$([4,9]),this.lastAttacks=k$(4),this.pefirbuf=fh(19),this.longfact=fh(sb.SBMAX_l),this.shortfact=fh(sb.SBMAX_s),this.attackthre=0,this.attackthre_s=0}var x$=w$;function C$(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}var T$=C$,wi=Zt,M$=wi.new_byte,E$=wi.new_double,br=wi.new_float,vs=wi.new_float_n,Ir=wi.new_int,Bl=wi.new_int_n,I$=_$,A$=jw,R$=x$,O$=T$,ab=zw(),tn=zn(),P$=cf;yo.MFSIZE=3*1152+tn.ENCDELAY-tn.MDCTDELAY;yo.MAX_HEADER_BUF=256;yo.MAX_BITS_PER_CHANNEL=4095;yo.MAX_BITS_PER_GRANULE=7680;yo.BPC=320;function yo(){var e=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=vs([2,yo.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new I$,this.ms_ratio=br(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=Ir(2),this.CurrentStep=Ir(2),this.masking_lower=0,this.bv_scf=Ir(576),this.pseudohalf=Ir(P$.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*yo.BPC+1),this.itime=E$(2),this.sideinfo_len=0,this.sb_sample=vs([2,2,18,tn.SBLIMIT]),this.amp_filter=br(32);function t(){this.write_timing=0,this.ptr=0,this.buf=M$(e)}this.header=new Array(yo.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new A$,this.minval_l=br(tn.CBANDS),this.minval_s=br(tn.CBANDS),this.nb_1=vs([4,tn.CBANDS]),this.nb_2=vs([4,tn.CBANDS]),this.nb_s1=vs([4,tn.CBANDS]),this.nb_s2=vs([4,tn.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=br(4),this.loudness_sq=vs([2,2]),this.loudness_sq_save=br(2),this.mld_l=br(tn.SBMAX_l),this.mld_s=br(tn.SBMAX_s),this.bm_l=Ir(tn.SBMAX_l),this.bo_l=Ir(tn.SBMAX_l),this.bm_s=Ir(tn.SBMAX_s),this.bo_s=Ir(tn.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=Bl([tn.CBANDS,2]),this.s3ind_s=Bl([tn.CBANDS,2]),this.numlines_s=Ir(tn.CBANDS),this.numlines_l=Ir(tn.CBANDS),this.rnumlines_l=br(tn.CBANDS),this.mld_cb_l=br(tn.CBANDS),this.mld_cb_s=br(tn.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=br(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=Ir(2),this.nsPsy=new R$,this.VBR_seek_table=new O$,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=Bl([16,5]),this.bitrate_blockType_Hist=Bl([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var n=0;n<this.en.length;n++)this.en[n]=new ab;for(var n=0;n<this.thm.length;n++)this.thm[n]=new ab;for(var n=0;n<this.header.length;n++)this.header[n]=new t}var lf=yo,B$=Zt,bs=B$.new_float,_s=zn();function D$(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=bs(_s.SBMAX_l),this.s=bs(_s.SBMAX_s),this.psfb21=bs(_s.PSFB21),this.psfb12=bs(_s.PSFB12),this.cb_l=bs(_s.CBANDS),this.cb_s=bs(_s.CBANDS),this.eql_w=bs(_s.BLKSIZE/2)}var N$=D$,Hw=Zt,Gn=Hw.System,ib=Hw.Arrays;rn.STEPS_per_dB=100;rn.MAX_dB=120;rn.GAIN_NOT_ENOUGH_SAMPLES=-24601;rn.GAIN_ANALYSIS_ERROR=0;rn.GAIN_ANALYSIS_OK=1;rn.INIT_GAIN_ANALYSIS_ERROR=0;rn.INIT_GAIN_ANALYSIS_OK=1;rn.YULE_ORDER=10;rn.MAX_ORDER=rn.YULE_ORDER;rn.MAX_SAMP_FREQ=48e3;rn.RMS_WINDOW_TIME_NUMERATOR=1;rn.RMS_WINDOW_TIME_DENOMINATOR=20;rn.MAX_SAMPLES_PER_WINDOW=rn.MAX_SAMP_FREQ*rn.RMS_WINDOW_TIME_NUMERATOR/rn.RMS_WINDOW_TIME_DENOMINATOR+1;function rn(){var e=64.82,t=.95,n=rn.RMS_WINDOW_TIME_NUMERATOR,r=rn.RMS_WINDOW_TIME_DENOMINATOR,o=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],s=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function a(d,m,v,_,y,k){for(;y--!=0;)v[_]=1e-10+d[m+0]*k[0]-v[_-1]*k[1]+d[m-1]*k[2]-v[_-2]*k[3]+d[m-2]*k[4]-v[_-3]*k[5]+d[m-3]*k[6]-v[_-4]*k[7]+d[m-4]*k[8]-v[_-5]*k[9]+d[m-5]*k[10]-v[_-6]*k[11]+d[m-6]*k[12]-v[_-7]*k[13]+d[m-7]*k[14]-v[_-8]*k[15]+d[m-8]*k[16]-v[_-9]*k[17]+d[m-9]*k[18]-v[_-10]*k[19]+d[m-10]*k[20],++_,++m}function i(d,m,v,_,y,k){for(;y--!=0;)v[_]=d[m+0]*k[0]-v[_-1]*k[1]+d[m-1]*k[2]-v[_-2]*k[3]+d[m-2]*k[4],++_,++m}function c(d,m){for(var v=0;v<MAX_ORDER;v++)d.linprebuf[v]=d.lstepbuf[v]=d.loutbuf[v]=d.rinprebuf[v]=d.rstepbuf[v]=d.routbuf[v]=0;switch(0|m){case 48e3:d.reqindex=0;break;case 44100:d.reqindex=1;break;case 32e3:d.reqindex=2;break;case 24e3:d.reqindex=3;break;case 22050:d.reqindex=4;break;case 16e3:d.reqindex=5;break;case 12e3:d.reqindex=6;break;case 11025:d.reqindex=7;break;case 8e3:d.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return d.sampleWindow=0|(m*n+r-1)/r,d.lsum=0,d.rsum=0,d.totsamp=0,ib.ill(d.A,0),INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(d,m){return c(d,m)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(d.linpre=MAX_ORDER,d.rinpre=MAX_ORDER,d.lstep=MAX_ORDER,d.rstep=MAX_ORDER,d.lout=MAX_ORDER,d.rout=MAX_ORDER,ib.fill(d.B,0),INIT_GAIN_ANALYSIS_OK)};function l(d){return d*d}this.AnalyzeSamples=function(d,m,v,_,y,k,g){var b,h,S,x,w,I,M;if(k==0)return GAIN_ANALYSIS_OK;switch(M=0,w=k,g){case 1:_=m,y=v;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(k<MAX_ORDER?(Gn.arraycopy(m,v,d.linprebuf,MAX_ORDER,k),Gn.arraycopy(_,y,d.rinprebuf,MAX_ORDER,k)):(Gn.arraycopy(m,v,d.linprebuf,MAX_ORDER,MAX_ORDER),Gn.arraycopy(_,y,d.rinprebuf,MAX_ORDER,MAX_ORDER));w>0;){I=w>d.sampleWindow-d.totsamp?d.sampleWindow-d.totsamp:w,M<MAX_ORDER?(b=d.linpre+M,h=d.linprebuf,S=d.rinpre+M,x=d.rinprebuf,I>MAX_ORDER-M&&(I=MAX_ORDER-M)):(b=v+M,h=m,S=y+M,x=_),a(h,b,d.lstepbuf,d.lstep+d.totsamp,I,o[d.reqindex]),a(x,S,d.rstepbuf,d.rstep+d.totsamp,I,o[d.reqindex]),i(d.lstepbuf,d.lstep+d.totsamp,d.loutbuf,d.lout+d.totsamp,I,s[d.reqindex]),i(d.rstepbuf,d.rstep+d.totsamp,d.routbuf,d.rout+d.totsamp,I,s[d.reqindex]),b=d.lout+d.totsamp,h=d.loutbuf,S=d.rout+d.totsamp,x=d.routbuf;for(var H=I%8;H--!=0;)d.lsum+=l(h[b++]),d.rsum+=l(x[S++]);for(H=I/8;H--!=0;)d.lsum+=l(h[b+0])+l(h[b+1])+l(h[b+2])+l(h[b+3])+l(h[b+4])+l(h[b+5])+l(h[b+6])+l(h[b+7]),b+=8,d.rsum+=l(x[S+0])+l(x[S+1])+l(x[S+2])+l(x[S+3])+l(x[S+4])+l(x[S+5])+l(x[S+6])+l(x[S+7]),S+=8;if(w-=I,M+=I,d.totsamp+=I,d.totsamp==d.sampleWindow){var j=rn.STEPS_per_dB*10*Math.log10((d.lsum+d.rsum)/d.totsamp*.5+1e-37),W=j<=0?0:0|j;W>=d.A.length&&(W=d.A.length-1),d.A[W]++,d.lsum=d.rsum=0,Gn.arraycopy(d.loutbuf,d.totsamp,d.loutbuf,0,MAX_ORDER),Gn.arraycopy(d.routbuf,d.totsamp,d.routbuf,0,MAX_ORDER),Gn.arraycopy(d.lstepbuf,d.totsamp,d.lstepbuf,0,MAX_ORDER),Gn.arraycopy(d.rstepbuf,d.totsamp,d.rstepbuf,0,MAX_ORDER),d.totsamp=0}if(d.totsamp>d.sampleWindow)return GAIN_ANALYSIS_ERROR}return k<MAX_ORDER?(Gn.arraycopy(d.linprebuf,k,d.linprebuf,0,MAX_ORDER-k),Gn.arraycopy(d.rinprebuf,k,d.rinprebuf,0,MAX_ORDER-k),Gn.arraycopy(m,v,d.linprebuf,MAX_ORDER-k,k),Gn.arraycopy(_,y,d.rinprebuf,MAX_ORDER-k,k)):(Gn.arraycopy(m,v+k-MAX_ORDER,d.linprebuf,0,MAX_ORDER),Gn.arraycopy(_,y+k-MAX_ORDER,d.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK};function f(d,m){var v,_=0;for(v=0;v<m;v++)_+=d[v];if(_==0)return GAIN_NOT_ENOUGH_SAMPLES;var y=0|Math.ceil(_*(1-t));for(v=m;v-- >0&&!((y-=d[v])<=0););return e-v/rn.STEPS_per_dB}this.GetTitleGain=function(d){for(var m=f(d.A,d.A.length),v=0;v<d.A.length;v++)d.B[v]+=d.A[v],d.A[v]=0;for(var v=0;v<MAX_ORDER;v++)d.linprebuf[v]=d.lstepbuf[v]=d.loutbuf[v]=d.rinprebuf[v]=d.rstepbuf[v]=d.routbuf[v]=0;return d.totsamp=0,d.lsum=d.rsum=0,m}}var Uw=rn,Gw=Zt,ia=Gw.new_float,cb=Gw.new_int,Xn=Uw;function L$(){this.linprebuf=ia(Xn.MAX_ORDER*2),this.linpre=0,this.lstepbuf=ia(Xn.MAX_SAMPLES_PER_WINDOW+Xn.MAX_ORDER),this.lstep=0,this.loutbuf=ia(Xn.MAX_SAMPLES_PER_WINDOW+Xn.MAX_ORDER),this.lout=0,this.rinprebuf=ia(Xn.MAX_ORDER*2),this.rinpre=0,this.rstepbuf=ia(Xn.MAX_SAMPLES_PER_WINDOW+Xn.MAX_ORDER),this.rstep=0,this.routbuf=ia(Xn.MAX_SAMPLES_PER_WINDOW+Xn.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=cb(0|Xn.STEPS_per_dB*Xn.MAX_dB),this.B=cb(0|Xn.STEPS_per_dB*Xn.MAX_dB)}var z$=L$;function F$(e){this.bits=e}var Xw=F$,A1=Zt,lb=A1.new_float,W$=A1.new_int,ub=A1.assert,$$=Xw,db=zn(),V$=cf,j$=lf;function H$(e){var t=e;this.quantize=t,this.iteration_loop=function(n,r,o,s){var a=n.internal_flags,i=lb(V$.SFBMAX),c=lb(576),l=W$(2),f=0,d,m=a.l3_side,v=new $$(f);this.quantize.rv.ResvFrameBegin(n,v),f=v.bits;for(var _=0;_<a.mode_gr;_++){d=this.quantize.qupvt.on_pe(n,r,l,f,_,_),a.mode_ext==db.MPG_MD_MS_LR&&(this.quantize.ms_convert(a.l3_side,_),this.quantize.qupvt.reduce_side(l,o[_],f,d));for(var y=0;y<a.channels_out;y++){var k,g,b=m.tt[_][y];b.block_type!=db.SHORT_TYPE?(k=0,g=a.PSY.mask_adjust-k):(k=0,g=a.PSY.mask_adjust_short-k),a.masking_lower=Math.pow(10,g*.1),this.quantize.init_outer_loop(a,b),this.quantize.init_xrpow(a,b,c)&&(this.quantize.qupvt.calc_xmin(n,s[_][y],b,i),this.quantize.outer_loop(n,b,i,c,y,l[y])),this.quantize.iteration_finish_one(a,_,y),ub(b.part2_3_length<=j$.MAX_BITS_PER_CHANNEL),ub(b.part2_3_length<=l[y])}}this.quantize.rv.ResvFrameEnd(a,f)}}var U$=H$;function Ct(e,t,n,r){this.xlen=e,this.linmax=t,this.table=n,this.hlen=r}var ye={};ye.t1HB=[1,1,1,0];ye.t2HB=[1,2,1,3,1,1,3,2,0];ye.t3HB=[3,2,1,1,1,1,3,2,0];ye.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0];ye.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0];ye.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0];ye.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0];ye.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0];ye.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0];ye.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0];ye.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0];ye.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1];ye.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0];ye.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3];ye.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3];ye.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16];ye.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0];ye.t1l=[1,4,3,5];ye.t2l=[1,4,7,4,5,7,6,7,8];ye.t3l=[2,3,7,4,4,7,6,7,8];ye.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10];ye.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9];ye.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12];ye.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13];ye.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11];ye.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13];ye.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12];ye.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12];ye.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18];ye.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15];ye.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12];ye.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10];ye.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6];ye.t32l=[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10];ye.t33l=[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8];ye.ht=[new Ct(0,0,null,null),new Ct(2,0,ye.t1HB,ye.t1l),new Ct(3,0,ye.t2HB,ye.t2l),new Ct(3,0,ye.t3HB,ye.t3l),new Ct(0,0,null,null),new Ct(4,0,ye.t5HB,ye.t5l),new Ct(4,0,ye.t6HB,ye.t6l),new Ct(6,0,ye.t7HB,ye.t7l),new Ct(6,0,ye.t8HB,ye.t8l),new Ct(6,0,ye.t9HB,ye.t9l),new Ct(8,0,ye.t10HB,ye.t10l),new Ct(8,0,ye.t11HB,ye.t11l),new Ct(8,0,ye.t12HB,ye.t12l),new Ct(16,0,ye.t13HB,ye.t13l),new Ct(0,0,null,ye.t16_5l),new Ct(16,0,ye.t15HB,ye.t15l),new Ct(1,1,ye.t16HB,ye.t16l),new Ct(2,3,ye.t16HB,ye.t16l),new Ct(3,7,ye.t16HB,ye.t16l),new Ct(4,15,ye.t16HB,ye.t16l),new Ct(6,63,ye.t16HB,ye.t16l),new Ct(8,255,ye.t16HB,ye.t16l),new Ct(10,1023,ye.t16HB,ye.t16l),new Ct(13,8191,ye.t16HB,ye.t16l),new Ct(4,15,ye.t24HB,ye.t24l),new Ct(5,31,ye.t24HB,ye.t24l),new Ct(6,63,ye.t24HB,ye.t24l),new Ct(7,127,ye.t24HB,ye.t24l),new Ct(8,255,ye.t24HB,ye.t24l),new Ct(9,511,ye.t24HB,ye.t24l),new Ct(11,2047,ye.t24HB,ye.t24l),new Ct(13,8191,ye.t24HB,ye.t24l),new Ct(0,0,ye.t32HB,ye.t32l),new Ct(0,0,ye.t33HB,ye.t33l)];ye.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366];ye.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296];ye.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369];ye.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]];ye.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]];ye.scfsi_band=[0,6,11,16,21];var R1=ye,hh,fb;function Kw(){if(fb)return hh;fb=1;var e=jw,t=Zt,n=t.VbrMode,r=t.Float,o=t.Util,s=t.new_float,a=t.new_int,i=t.assert,c=zn(),l=Xw,f=lf;d.Q_MAX=257,d.Q_MAX2=116,d.LARGE_BITS=1e5,d.IXMAX_VAL=8206;function d(){var m=O1(),v=null,_=null,y=null;this.setModules=function(P,V,U){v=P,_=V,y=U};function k(P){return i(0<=P+d.Q_MAX2&&P<d.Q_MAX),M[P+d.Q_MAX2]}this.IPOW20=function(P){return i(0<=P&&P<d.Q_MAX),H[P]};var g=2220446049250313e-31,b=d.IXMAX_VAL,h=b+2,S=d.Q_MAX,x=d.Q_MAX2;d.LARGE_BITS;var w=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var I=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=I,this.sfBandIndex=[new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new e([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0/3,24/3,48/3,72/3,108/3,156/3,216/3,288/3,372/3,480/3,486/3,492/3,498/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var M=s(S+x+1),H=s(S),j=s(h),W=s(h);this.adj43=W;function A(P,V){var U=y.ATHformula(V,P);return U-=w,U=Math.pow(10,U/10+P.ATHlower),U}function L(P){for(var V=P.internal_flags.ATH.l,U=P.internal_flags.ATH.psfb21,X=P.internal_flags.ATH.s,te=P.internal_flags.ATH.psfb12,Y=P.internal_flags,R=P.out_samplerate,E=0;E<c.SBMAX_l;E++){var C=Y.scalefac_band.l[E],O=Y.scalefac_band.l[E+1];V[E]=r.MAX_VALUE;for(var $=C;$<O;$++){var ne=$*R/1152,fe=A(P,ne);V[E]=Math.min(V[E],fe)}}for(var E=0;E<c.PSFB21;E++){var C=Y.scalefac_band.psfb21[E],O=Y.scalefac_band.psfb21[E+1];U[E]=r.MAX_VALUE;for(var $=C;$<O;$++){var ne=$*R/1152,fe=A(P,ne);U[E]=Math.min(U[E],fe)}}for(var E=0;E<c.SBMAX_s;E++){var C=Y.scalefac_band.s[E],O=Y.scalefac_band.s[E+1];X[E]=r.MAX_VALUE;for(var $=C;$<O;$++){var ne=$*R/384,fe=A(P,ne);X[E]=Math.min(X[E],fe)}X[E]*=Y.scalefac_band.s[E+1]-Y.scalefac_band.s[E]}for(var E=0;E<c.PSFB12;E++){var C=Y.scalefac_band.psfb12[E],O=Y.scalefac_band.psfb12[E+1];te[E]=r.MAX_VALUE;for(var $=C;$<O;$++){var ne=$*R/384,fe=A(P,ne);te[E]=Math.min(te[E],fe)}te[E]*=Y.scalefac_band.s[13]-Y.scalefac_band.s[12]}if(P.noATH){for(var E=0;E<c.SBMAX_l;E++)V[E]=1e-20;for(var E=0;E<c.PSFB21;E++)U[E]=1e-20;for(var E=0;E<c.SBMAX_s;E++)X[E]=1e-20;for(var E=0;E<c.PSFB12;E++)te[E]=1e-20}Y.ATH.floor=10*Math.log10(A(P,-1))}this.iteration_init=function(P){var V=P.internal_flags,U=V.l3_side,X;if(V.iteration_init_init==0){for(V.iteration_init_init=1,U.main_data_begin=0,L(P),j[0]=0,X=1;X<h;X++)j[X]=Math.pow(X,4/3);for(X=0;X<h-1;X++)W[X]=X+1-Math.pow(.5*(j[X]+j[X+1]),.75);for(W[X]=.5,X=0;X<S;X++)H[X]=Math.pow(2,(X-210)*-.1875);for(X=0;X<=S+x;X++)M[X]=Math.pow(2,(X-210-x)*.25);v.huffman_init(V);{var te,Y,R,E;for(X=P.exp_nspsytune>>2&63,X>=32&&(X-=64),te=Math.pow(10,X/4/10),X=P.exp_nspsytune>>8&63,X>=32&&(X-=64),Y=Math.pow(10,X/4/10),X=P.exp_nspsytune>>14&63,X>=32&&(X-=64),R=Math.pow(10,X/4/10),X=P.exp_nspsytune>>20&63,X>=32&&(X-=64),E=R*Math.pow(10,X/4/10),X=0;X<c.SBMAX_l;X++){var C;X<=6?C=te:X<=13?C=Y:X<=20?C=R:C=E,V.nsPsy.longfact[X]=C}for(X=0;X<c.SBMAX_s;X++){var C;X<=5?C=te:X<=10?C=Y:X<=11?C=R:C=E,V.nsPsy.shortfact[X]=C}}}},this.on_pe=function(P,V,U,X,te,Y){var R=P.internal_flags,E=0,C,O=a(2),$,ne=new l(E),fe=_.ResvMaxBits(P,X,ne,Y);E=ne.bits;var Z=E+fe;for(Z>f.MAX_BITS_PER_GRANULE&&(Z=f.MAX_BITS_PER_GRANULE),C=0,$=0;$<R.channels_out;++$)U[$]=Math.min(f.MAX_BITS_PER_CHANNEL,E/R.channels_out),O[$]=0|U[$]*V[te][$]/700-U[$],O[$]>X*3/4&&(O[$]=X*3/4),O[$]<0&&(O[$]=0),O[$]+U[$]>f.MAX_BITS_PER_CHANNEL&&(O[$]=Math.max(0,f.MAX_BITS_PER_CHANNEL-U[$])),C+=O[$];if(C>fe)for($=0;$<R.channels_out;++$)O[$]=fe*O[$]/C;for($=0;$<R.channels_out;++$)U[$]+=O[$],fe-=O[$];for(C=0,$=0;$<R.channels_out;++$)C+=U[$];if(C>f.MAX_BITS_PER_GRANULE){var se=0;for($=0;$<R.channels_out;++$)U[$]*=f.MAX_BITS_PER_GRANULE,U[$]/=C,se+=U[$]}return Z},this.reduce_side=function(P,V,U,X){i(P[0]+P[1]<=f.MAX_BITS_PER_GRANULE);var te=.33*(.5-V)/.5;te<0&&(te=0),te>.5&&(te=.5);var Y=0|te*.5*(P[0]+P[1]);Y>f.MAX_BITS_PER_CHANNEL-P[0]&&(Y=f.MAX_BITS_PER_CHANNEL-P[0]),Y<0&&(Y=0),P[1]>=125&&(P[1]-Y>125?(P[0]<U&&(P[0]+=Y),P[1]-=Y):(P[0]+=P[1]-125,P[1]=125)),Y=P[0]+P[1],Y>X&&(P[0]=X*P[0]/Y,P[1]=X*P[1]/Y),i(P[0]<=f.MAX_BITS_PER_CHANNEL),i(P[1]<=f.MAX_BITS_PER_CHANNEL),i(P[0]+P[1]<=f.MAX_BITS_PER_GRANULE)},this.athAdjust=function(P,V,U){var X=90.30873362,te=94.82444863,Y=o.FAST_LOG10_X(V,10),R=P*P,E=0;return Y-=U,R>1e-20&&(E=1+o.FAST_LOG10_X(R,10/X)),E<0&&(E=0),Y*=E,Y+=U+X-te,Math.pow(10,.1*Y)},this.calc_xmin=function(P,V,U,X){var te=0,Y=P.internal_flags,R,E=0,C=0,O=Y.ATH,$=U.xr,ne=P.VBR==n.vbr_mtrh?1:0,fe=Y.masking_lower;for((P.VBR==n.vbr_mtrh||P.VBR==n.vbr_mt)&&(fe=1),R=0;R<U.psy_lmax;R++){var Z,se,de,_e,Ie,Ne;P.VBR==n.vbr_rh||P.VBR==n.vbr_mtrh?se=athAdjust(O.adjust,O.l[R],O.floor):se=O.adjust*O.l[R],Ie=U.width[R],de=se/Ie,_e=g,Ne=Ie>>1,Z=0;do{var Re,Pe;Re=$[E]*$[E],Z+=Re,_e+=Re<de?Re:de,E++,Pe=$[E]*$[E],Z+=Pe,_e+=Pe<de?Pe:de,E++}while(--Ne>0);if(Z>se&&C++,R==c.SBPSY_l){var je=se*Y.nsPsy.longfact[R];_e<je&&(_e=je)}if(ne!=0&&(se=_e),!P.ATHonly){var Ee=V.en.l[R];if(Ee>0){var je;je=Z*V.thm.l[R]*fe/Ee,ne!=0&&(je*=Y.nsPsy.longfact[R]),se<je&&(se=je)}}ne!=0?X[te++]=se:X[te++]=se*Y.nsPsy.longfact[R]}var Ge=575;if(U.block_type!=c.SHORT_TYPE)for(var T=576;T--!=0&&m.EQ($[T],0);)Ge=T;U.max_nonzero_coeff=Ge;for(var D=U.sfb_smin;R<U.psymax;D++,R+=3){var Ie,we,ke;for(P.VBR==n.vbr_rh||P.VBR==n.vbr_mtrh?ke=athAdjust(O.adjust,O.s[D],O.floor):ke=O.adjust*O.s[D],Ie=U.width[R],we=0;we<3;we++){var Z=0,se,de,_e,Ne=Ie>>1;de=ke/Ie,_e=g;do{var Re,Pe;Re=$[E]*$[E],Z+=Re,_e+=Re<de?Re:de,E++,Pe=$[E]*$[E],Z+=Pe,_e+=Pe<de?Pe:de,E++}while(--Ne>0);if(Z>ke&&C++,D==c.SBPSY_s){var je=ke*Y.nsPsy.shortfact[D];_e<je&&(_e=je)}if(ne!=0?se=_e:se=ke,!P.ATHonly&&!P.ATHshort){var Ee=V.en.s[D][we];if(Ee>0){var je;je=Z*V.thm.s[D][we]*fe/Ee,ne!=0&&(je*=Y.nsPsy.shortfact[D]),se<je&&(se=je)}}ne!=0?X[te++]=se:X[te++]=se*Y.nsPsy.shortfact[D]}P.useTemporal&&(X[te-3]>X[te-3+1]&&(X[te-3+1]+=(X[te-3]-X[te-3+1])*Y.decay),X[te-3+1]>X[te-3+2]&&(X[te-3+2]+=(X[te-3+1]-X[te-3+2])*Y.decay))}return C};function B(P){this.s=P}this.calc_noise_core=function(P,V,U,X){var te=0,Y=V.s,R=P.l3_enc;if(Y>P.count1)for(;U--!=0;){var E;E=P.xr[Y],Y++,te+=E*E,E=P.xr[Y],Y++,te+=E*E}else if(Y>P.big_values){var C=s(2);for(C[0]=0,C[1]=X;U--!=0;){var E;E=Math.abs(P.xr[Y])-C[R[Y]],Y++,te+=E*E,E=Math.abs(P.xr[Y])-C[R[Y]],Y++,te+=E*E}}else for(;U--!=0;){var E;E=Math.abs(P.xr[Y])-j[R[Y]]*X,Y++,te+=E*E,E=Math.abs(P.xr[Y])-j[R[Y]]*X,Y++,te+=E*E}return V.s=Y,te},this.calc_noise=function(P,V,U,X,te){var Y=0,R=0,E,C,O=0,$=0,ne=0,fe=-20,Z=0,se=P.scalefac,de=0;for(X.over_SSD=0,E=0;E<P.psymax;E++){var _e=P.global_gain-(se[de++]+(P.preflag!=0?I[E]:0)<<P.scalefac_scale+1)-P.subblock_gain[P.window[E]]*8,Ie=0;if(te!=null&&te.step[E]==_e)Ie=te.noise[E],Z+=P.width[E],U[Y++]=Ie/V[R++],Ie=te.noise_log[E];else{var Ne=k(_e);if(C=P.width[E]>>1,Z+P.width[E]>P.max_nonzero_coeff){var Re;Re=P.max_nonzero_coeff-Z+1,Re>0?C=Re>>1:C=0}var Pe=new B(Z);Ie=this.calc_noise_core(P,Pe,C,Ne),Z=Pe.s,te!=null&&(te.step[E]=_e,te.noise[E]=Ie),Ie=U[Y++]=Ie/V[R++],Ie=o.FAST_LOG10(Math.max(Ie,1e-20)),te!=null&&(te.noise_log[E]=Ie)}if(te!=null&&(te.global_gain=P.global_gain),ne+=Ie,Ie>0){var je;je=Math.max(0|Ie*10+.5,1),X.over_SSD+=je*je,O++,$+=Ie}fe=Math.max(fe,Ie)}return X.over_count=O,X.tot_noise=ne,X.over_noise=$,X.max_noise=fe,O},this.set_pinfo=function(P,V,U,X,te){var Y=P.internal_flags,R,E,C,O,$,ne=V.scalefac_scale==0?.5:1,fe=V.scalefac,Z=s(L3Side.SFBMAX),se=s(L3Side.SFBMAX),de=new CalcNoiseResult;calc_xmin(P,U,V,Z),calc_noise(V,Z,se,de,null);var _e=0;for(E=V.sfb_lmax,V.block_type!=c.SHORT_TYPE&&V.mixed_block_flag==0&&(E=22),R=0;R<E;R++){var Ie=Y.scalefac_band.l[R],Ne=Y.scalefac_band.l[R+1],Re=Ne-Ie;for(O=0;_e<Ne;_e++)O+=V.xr[_e]*V.xr[_e];O/=Re,$=1e15,Y.pinfo.en[X][te][R]=$*O,Y.pinfo.xfsf[X][te][R]=$*Z[R]*se[R]/Re,U.en.l[R]>0&&!P.ATHonly?O=O/U.en.l[R]:O=0,Y.pinfo.thr[X][te][R]=$*Math.max(O*U.thm.l[R],Y.ATH.l[R]),Y.pinfo.LAMEsfb[X][te][R]=0,V.preflag!=0&&R>=11&&(Y.pinfo.LAMEsfb[X][te][R]=-ne*I[R]),R<c.SBPSY_l&&(i(fe[R]>=0),Y.pinfo.LAMEsfb[X][te][R]-=ne*fe[R])}if(V.block_type==c.SHORT_TYPE)for(E=R,R=V.sfb_smin;R<c.SBMAX_s;R++)for(var Ie=Y.scalefac_band.s[R],Ne=Y.scalefac_band.s[R+1],Re=Ne-Ie,Pe=0;Pe<3;Pe++){for(O=0,C=Ie;C<Ne;C++)O+=V.xr[_e]*V.xr[_e],_e++;O=Math.max(O/Re,1e-20),$=1e15,Y.pinfo.en_s[X][te][3*R+Pe]=$*O,Y.pinfo.xfsf_s[X][te][3*R+Pe]=$*Z[E]*se[E]/Re,U.en.s[R][Pe]>0?O=O/U.en.s[R][Pe]:O=0,(P.ATHonly||P.ATHshort)&&(O=0),Y.pinfo.thr_s[X][te][3*R+Pe]=$*Math.max(O*U.thm.s[R][Pe],Y.ATH.s[R]),Y.pinfo.LAMEsfb_s[X][te][3*R+Pe]=-2*V.subblock_gain[Pe],R<c.SBPSY_s&&(Y.pinfo.LAMEsfb_s[X][te][3*R+Pe]-=ne*fe[E]),E++}Y.pinfo.LAMEqss[X][te]=V.global_gain,Y.pinfo.LAMEmainbits[X][te]=V.part2_3_length+V.part2_length,Y.pinfo.LAMEsfbits[X][te]=V.part2_length,Y.pinfo.over[X][te]=de.over_count,Y.pinfo.max_noise[X][te]=de.max_noise*10,Y.pinfo.over_noise[X][te]=de.over_noise*10,Y.pinfo.tot_noise[X][te]=de.tot_noise*10,Y.pinfo.over_SSD[X][te]=de.over_SSD}}return hh=d,hh}var ph,hb;function Yw(){if(hb)return ph;hb=1;var e=Zt,t=e.System,n=e.Arrays,r=e.new_int,o=e.assert,s=zn(),a=R1,i=E1,c=Kw();function l(){var f=null;this.qupvt=null,this.setModules=function(Y){this.qupvt=Y,f=Y};function d(Y){this.bits=0|Y}var m=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function v(Y,R,E,C,O,$){var ne=.5946/R;for(Y=Y>>1;Y--!=0;)O[$++]=ne>E[C++]?0:1,O[$++]=ne>E[C++]?0:1}function _(Y,R,E,C,O,$){Y=Y>>1;var ne=Y%2;for(Y=Y>>1;Y--!=0;){var fe,Z,se,de,_e,Ie,Ne,Re;fe=E[C++]*R,Z=E[C++]*R,_e=0|fe,se=E[C++]*R,Ie=0|Z,de=E[C++]*R,Ne=0|se,fe+=f.adj43[_e],Re=0|de,Z+=f.adj43[Ie],O[$++]=0|fe,se+=f.adj43[Ne],O[$++]=0|Z,de+=f.adj43[Re],O[$++]=0|se,O[$++]=0|de}if(ne!=0){var fe,Z,_e,Ie;fe=E[C++]*R,Z=E[C++]*R,_e=0|fe,Ie=0|Z,fe+=f.adj43[_e],Z+=f.adj43[Ie],O[$++]=0|fe,O[$++]=0|Z}}function y(Y,R,E,C,O){var $,ne,fe=0,Z,se=0,de=0,_e=0,Ie=R,Ne=0,Re=Ie,Pe=0,je=Y,Ee=0;for(Z=O!=null&&C.global_gain==O.global_gain,C.block_type==s.SHORT_TYPE?ne=38:ne=21,$=0;$<=ne;$++){var Ge=-1;if((Z||C.block_type==s.NORM_TYPE)&&(Ge=C.global_gain-(C.scalefac[$]+(C.preflag!=0?f.pretab[$]:0)<<C.scalefac_scale+1)-C.subblock_gain[C.window[$]]*8),o(C.width[$]>=0),Z&&O.step[$]==Ge)se!=0&&(_(se,E,je,Ee,Re,Pe),se=0),de!=0&&(v(de,E,je,Ee,Re,Pe),de=0);else{var T=C.width[$];if(fe+C.width[$]>C.max_nonzero_coeff){var D;D=C.max_nonzero_coeff-fe+1,n.fill(R,C.max_nonzero_coeff,576,0),T=D,T<0&&(T=0),$=ne+1}if(se==0&&de==0&&(Re=Ie,Pe=Ne,je=Y,Ee=_e),O!=null&&O.sfb_count1>0&&$>=O.sfb_count1&&O.step[$]>0&&Ge>=O.step[$]?(se!=0&&(_(se,E,je,Ee,Re,Pe),se=0,Re=Ie,Pe=Ne,je=Y,Ee=_e),de+=T):(de!=0&&(v(de,E,je,Ee,Re,Pe),de=0,Re=Ie,Pe=Ne,je=Y,Ee=_e),se+=T),T<=0){de!=0&&(v(de,E,je,Ee,Re,Pe),de=0),se!=0&&(_(se,E,je,Ee,Re,Pe),se=0);break}}$<=ne&&(Ne+=C.width[$],_e+=C.width[$],fe+=C.width[$])}se!=0&&(_(se,E,je,Ee,Re,Pe),se=0),de!=0&&(v(de,E,je,Ee,Re,Pe),de=0)}function k(Y,R,E){var C=0,O=0;do{var $=Y[R++],ne=Y[R++];C<$&&(C=$),O<ne&&(O=ne)}while(R<E);return C<O&&(C=O),C}function g(Y,R,E,C,O,$){var ne=a.ht[C].xlen*65536+a.ht[O].xlen,fe=0,Z;do{var se=Y[R++],de=Y[R++];se!=0&&(se>14&&(se=15,fe+=ne),se*=16),de!=0&&(de>14&&(de=15,fe+=ne),se+=de),fe+=a.largetbl[se]}while(R<E);return Z=fe&65535,fe>>=16,fe>Z&&(fe=Z,C=O),$.bits+=fe,C}function b(Y,R,E,C){var O=0,$=a.ht[1].hlen;do{var ne=Y[R+0]*2+Y[R+1];R+=2,O+=$[ne]}while(R<E);return C.bits+=O,1}function h(Y,R,E,C,O){var $=0,ne,fe=a.ht[C].xlen,Z;C==2?Z=a.table23:Z=a.table56;do{var se=Y[R+0]*fe+Y[R+1];R+=2,$+=Z[se]}while(R<E);return ne=$&65535,$>>=16,$>ne&&($=ne,C++),O.bits+=$,C}function S(Y,R,E,C,O){var $=0,ne=0,fe=0,Z=a.ht[C].xlen,se=a.ht[C].hlen,de=a.ht[C+1].hlen,_e=a.ht[C+2].hlen;do{var Ie=Y[R+0]*Z+Y[R+1];R+=2,$+=se[Ie],ne+=de[Ie],fe+=_e[Ie]}while(R<E);var Ne=C;return $>ne&&($=ne,Ne++),$>fe&&($=fe,Ne=C+2),O.bits+=$,Ne}var x=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function w(Y,R,E,C){var O=k(Y,R,E);switch(O){case 0:return O;case 1:return b(Y,R,E,C);case 2:case 3:return h(Y,R,E,x[O-1],C);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return S(Y,R,E,x[O-1],C);default:if(O>c.IXMAX_VAL)return C.bits=c.LARGE_BITS,-1;O-=15;var $;for($=24;$<32&&!(a.ht[$].linmax>=O);$++);var ne;for(ne=$-8;ne<24&&!(a.ht[ne].linmax>=O);ne++);return g(Y,R,E,ne,$,C)}}this.noquant_count_bits=function(Y,R,E){var C=R.l3_enc,O=Math.min(576,R.max_nonzero_coeff+2>>1<<1);for(E!=null&&(E.sfb_count1=0);O>1&&!(C[O-1]|C[O-2]);O-=2);R.count1=O;for(var $=0,ne=0;O>3;O-=4){var fe;if(((C[O-1]|C[O-2]|C[O-3]|C[O-4])&2147483647)>1)break;fe=((C[O-4]*2+C[O-3])*2+C[O-2])*2+C[O-1],$+=a.t32l[fe],ne+=a.t33l[fe]}var Z=$;if(R.count1table_select=0,$>ne&&(Z=ne,R.count1table_select=1),R.count1bits=Z,R.big_values=O,O==0)return Z;if(R.block_type==s.SHORT_TYPE)$=3*Y.scalefac_band.s[3],$>R.big_values&&($=R.big_values),ne=R.big_values;else if(R.block_type==s.NORM_TYPE){if($=R.region0_count=Y.bv_scf[O-2],ne=R.region1_count=Y.bv_scf[O-1],o($+ne+2<s.SBPSY_l),ne=Y.scalefac_band.l[$+ne+2],$=Y.scalefac_band.l[$+1],ne<O){var se=new d(Z);R.table_select[2]=w(C,ne,O,se),Z=se.bits}}else R.region0_count=7,R.region1_count=s.SBMAX_l-1-7-1,$=Y.scalefac_band.l[8],ne=O,$>ne&&($=ne);if($=Math.min($,O),ne=Math.min(ne,O),0<$){var se=new d(Z);R.table_select[0]=w(C,0,$,se),Z=se.bits}if($<ne){var se=new d(Z);R.table_select[1]=w(C,$,ne,se),Z=se.bits}if(Y.use_best_huffman==2&&(R.part2_3_length=Z,best_huffman_divide(Y,R),Z=R.part2_3_length),E!=null&&R.block_type==s.NORM_TYPE){for(var de=0;Y.scalefac_band.l[de]<R.big_values;)de++;E.sfb_count1=de}return Z},this.count_bits=function(Y,R,E,C){var O=E.l3_enc,$=c.IXMAX_VAL/f.IPOW20(E.global_gain);if(E.xrpow_max>$)return c.LARGE_BITS;if(y(R,O,f.IPOW20(E.global_gain),E,C),Y.substep_shaping&2)for(var ne=0,fe=E.global_gain+E.scalefac_scale,Z=.634521682242439/f.IPOW20(fe),se=0;se<E.sfbmax;se++){var de=E.width[se];if(Y.pseudohalf[se]==0)ne+=de;else{var _e;for(_e=ne,ne+=de;_e<ne;++_e)O[_e]=R[_e]>=Z?O[_e]:0}}return this.noquant_count_bits(Y,E,C)};function I(Y,R,E,C,O,$,ne){for(var fe=R.big_values,Z=0;Z<=22;Z++)C[Z]=c.LARGE_BITS;for(var Z=0;Z<16;Z++){var se=Y.scalefac_band.l[Z+1];if(se>=fe)break;var de=0,_e=new d(de),Ie=w(E,0,se,_e);de=_e.bits;for(var Ne=0;Ne<8;Ne++){var Re=Y.scalefac_band.l[Z+Ne+2];if(Re>=fe)break;var Pe=de;_e=new d(Pe);var je=w(E,se,Re,_e);Pe=_e.bits,C[Z+Ne]>Pe&&(C[Z+Ne]=Pe,O[Z+Ne]=Z,$[Z+Ne]=Ie,ne[Z+Ne]=je)}}}function M(Y,R,E,C,O,$,ne,fe){for(var Z=R.big_values,se=2;se<s.SBMAX_l+1;se++){var de=Y.scalefac_band.l[se];if(de>=Z)break;var _e=O[se-2]+R.count1bits;if(E.part2_3_length<=_e)break;var Ie=new d(_e),Ne=w(C,de,Z,Ie);_e=Ie.bits,!(E.part2_3_length<=_e)&&(E.assign(R),E.part2_3_length=_e,E.region0_count=$[se-2],E.region1_count=se-2-$[se-2],E.table_select[0]=ne[se-2],E.table_select[1]=fe[se-2],E.table_select[2]=Ne)}}this.best_huffman_divide=function(Y,R){var E=new i,C=R.l3_enc,O=r(23),$=r(23),ne=r(23),fe=r(23);if(!(R.block_type==s.SHORT_TYPE&&Y.mode_gr==1)){E.assign(R),R.block_type==s.NORM_TYPE&&(I(Y,R,C,O,$,ne,fe),M(Y,E,R,C,O,$,ne,fe));var Z=E.big_values;if(!(Z==0||(C[Z-2]|C[Z-1])>1)&&(Z=R.count1+2,!(Z>576))){E.assign(R),E.count1=Z;for(var se=0,de=0;Z>E.big_values;Z-=4){var _e=((C[Z-4]*2+C[Z-3])*2+C[Z-2])*2+C[Z-1];se+=a.t32l[_e],de+=a.t33l[_e]}if(E.big_values=Z,E.count1table_select=0,se>de&&(se=de,E.count1table_select=1),E.count1bits=se,E.block_type==s.NORM_TYPE)M(Y,E,R,C,O,$,ne,fe);else{if(E.part2_3_length=se,se=Y.scalefac_band.l[8],se>Z&&(se=Z),se>0){var Ie=new d(E.part2_3_length);E.table_select[0]=w(C,0,se,Ie),E.part2_3_length=Ie.bits}if(Z>se){var Ie=new d(E.part2_3_length);E.table_select[1]=w(C,se,Z,Ie),E.part2_3_length=Ie.bits}R.part2_3_length>E.part2_3_length&&R.assign(E)}}}};var H=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],j=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],W=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],A=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];l.slen1_tab=W,l.slen2_tab=A;function L(Y,R){for(var E,C=R.tt[1][Y],O=R.tt[0][Y],$=0;$<a.scfsi_band.length-1;$++){for(E=a.scfsi_band[$];E<a.scfsi_band[$+1]&&!(O.scalefac[E]!=C.scalefac[E]&&C.scalefac[E]>=0);E++);if(E==a.scfsi_band[$+1]){for(E=a.scfsi_band[$];E<a.scfsi_band[$+1];E++)C.scalefac[E]=-1;R.scfsi[Y][$]=1}}var ne=0,fe=0;for(E=0;E<11;E++)C.scalefac[E]!=-1&&(fe++,ne<C.scalefac[E]&&(ne=C.scalefac[E]));for(var Z=0,se=0;E<s.SBPSY_l;E++)C.scalefac[E]!=-1&&(se++,Z<C.scalefac[E]&&(Z=C.scalefac[E]));for(var $=0;$<16;$++)if(ne<H[$]&&Z<j[$]){var de=W[$]*fe+A[$]*se;C.part2_length>de&&(C.part2_length=de,C.scalefac_compress=$)}}this.best_scalefac_store=function(Y,R,E,C){var O=C.tt[R][E],$,ne,fe,Z,se=0;for(fe=0,$=0;$<O.sfbmax;$++){var de=O.width[$];for(fe+=de,Z=-de;Z<0&&O.l3_enc[Z+fe]==0;Z++);Z==0&&(O.scalefac[$]=se=-2)}if(O.scalefac_scale==0&&O.preflag==0){var _e=0;for($=0;$<O.sfbmax;$++)O.scalefac[$]>0&&(_e|=O.scalefac[$]);if(!(_e&1)&&_e!=0){for($=0;$<O.sfbmax;$++)O.scalefac[$]>0&&(O.scalefac[$]>>=1);O.scalefac_scale=se=1}}if(O.preflag==0&&O.block_type!=s.SHORT_TYPE&&Y.mode_gr==2){for($=11;$<s.SBPSY_l&&!(O.scalefac[$]<f.pretab[$]&&O.scalefac[$]!=-2);$++);if($==s.SBPSY_l){for($=11;$<s.SBPSY_l;$++)O.scalefac[$]>0&&(O.scalefac[$]-=f.pretab[$]);O.preflag=se=1}}for(ne=0;ne<4;ne++)C.scfsi[E][ne]=0;for(Y.mode_gr==2&&R==1&&C.tt[0][E].block_type!=s.SHORT_TYPE&&C.tt[1][E].block_type!=s.SHORT_TYPE&&(L(E,C),se=0),$=0;$<O.sfbmax;$++)O.scalefac[$]==-2&&(O.scalefac[$]=0);se!=0&&(Y.mode_gr==2?this.scale_bitcount(O):this.scale_bitcount_lsf(Y,O))};function B(Y,R){for(var E=0;E<R;++E)if(Y[E]<0)return!1;return!0}var P=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],V=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],U=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(Y){var R,E,C=0,O=0,$,ne=Y.scalefac;if(o(B(ne,Y.sfbmax)),Y.block_type==s.SHORT_TYPE)$=P,Y.mixed_block_flag!=0&&($=V);else if($=U,Y.preflag==0){for(E=11;E<s.SBPSY_l&&!(ne[E]<f.pretab[E]);E++);if(E==s.SBPSY_l)for(Y.preflag=1,E=11;E<s.SBPSY_l;E++)ne[E]-=f.pretab[E]}for(E=0;E<Y.sfbdivide;E++)C<ne[E]&&(C=ne[E]);for(;E<Y.sfbmax;E++)O<ne[E]&&(O=ne[E]);for(Y.part2_length=c.LARGE_BITS,R=0;R<16;R++)C<H[R]&&O<j[R]&&Y.part2_length>$[R]&&(Y.part2_length=$[R],Y.scalefac_compress=R);return Y.part2_length==c.LARGE_BITS};var X=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(Y,R){var E,C,O,$,ne,fe,Z,se,de=r(4),_e=R.scalefac;for(R.preflag!=0?E=2:E=0,Z=0;Z<4;Z++)de[Z]=0;if(R.block_type==s.SHORT_TYPE){C=1;var Ie=f.nr_of_sfb_block[E][C];for(se=0,O=0;O<4;O++)for($=Ie[O]/3,Z=0;Z<$;Z++,se++)for(ne=0;ne<3;ne++)_e[se*3+ne]>de[O]&&(de[O]=_e[se*3+ne])}else{C=0;var Ie=f.nr_of_sfb_block[E][C];for(se=0,O=0;O<4;O++)for($=Ie[O],Z=0;Z<$;Z++,se++)_e[se]>de[O]&&(de[O]=_e[se])}for(fe=!1,O=0;O<4;O++)de[O]>X[E][O]&&(fe=!0);if(!fe){var Ne,Re,Pe,je;for(R.sfb_partition_table=f.nr_of_sfb_block[E][C],O=0;O<4;O++)R.slen[O]=te[de[O]];switch(Ne=R.slen[0],Re=R.slen[1],Pe=R.slen[2],je=R.slen[3],E){case 0:R.scalefac_compress=(Ne*5+Re<<4)+(Pe<<2)+je;break;case 1:R.scalefac_compress=400+(Ne*5+Re<<2)+Pe;break;case 2:R.scalefac_compress=500+Ne*3+Re;break;default:t.err.printf(`intensity stereo not implemented yet
`);break}}if(!fe)for(o(R.sfb_partition_table!=null),R.part2_length=0,O=0;O<4;O++)R.part2_length+=R.slen[O]*R.sfb_partition_table[O];return fe};var te=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(Y){for(var R=2;R<=576;R+=2){for(var E=0,C;Y.scalefac_band.l[++E]<R;);for(C=m[E][0];Y.scalefac_band.l[C+1]>R;)C--;for(C<0&&(C=m[E][0]),Y.bv_scf[R-2]=C,C=m[E][1];Y.scalefac_band.l[C+Y.bv_scf[R-2]+2]>R;)C--;C<0&&(C=m[E][1]),Y.bv_scf[R-1]=C}}}return ph=l,ph}var mh,pb;function O1(){if(pb)return mh;pb=1;var e=Zt,t=e.System,n=e.Arrays,r=e.new_byte,o=e.new_float_n,s=e.new_int,a=e.assert,i=Yw(),c=R1,l=zn(),f=lf;d.EQ=function(m,v){return Math.abs(m)>Math.abs(v)?Math.abs(m-v)<=Math.abs(m)*1e-6:Math.abs(m-v)<=Math.abs(v)*1e-6},d.NEQ=function(m,v){return!d.EQ(m,v)};function d(){var m=P1(),v=this,_=32773,y=null,k=null,g=null,b=null;this.setModules=function(R,E,C,O){y=R,k=E,g=C,b=O};var h=null,S=0,x=0,w=0;this.getframebits=function(R){var E=R.internal_flags,C;E.bitrate_index!=0?C=c.bitrate_table[R.version][E.bitrate_index]:C=R.brate;var O=0|(R.version+1)*72e3*C/R.out_samplerate+E.padding;return 8*O};function I(R){t.arraycopy(R.header[R.w_ptr].buf,0,h,x,R.sideinfo_len),x+=R.sideinfo_len,S+=R.sideinfo_len*8,R.w_ptr=R.w_ptr+1&f.MAX_HEADER_BUF-1}function M(R,E,C){for(;C>0;){var O;w==0&&(w=8,x++,a(x<m.LAME_MAXMP3BUFFER),a(R.header[R.w_ptr].write_timing>=S),R.header[R.w_ptr].write_timing==S&&I(R),h[x]=0),O=Math.min(C,w),C-=O,w-=O,h[x]|=E>>C<<w,S+=O}}function H(R,E,C){for(;C>0;){var O;w==0&&(w=8,x++,a(x<m.LAME_MAXMP3BUFFER),h[x]=0),O=Math.min(C,w),C-=O,w-=O,h[x]|=E>>C<<w,S+=O}}function j(R,E){var C=R.internal_flags,O;if(E>=8&&(M(C,76,8),E-=8),E>=8&&(M(C,65,8),E-=8),E>=8&&(M(C,77,8),E-=8),E>=8&&(M(C,69,8),E-=8),E>=32){var $=g.getLameShortVersion();if(E>=32)for(O=0;O<$.length&&E>=8;++O)E-=8,M(C,$.charAt(O),8)}for(;E>=1;E-=1)M(C,C.ancillary_flag,1),C.ancillary_flag^=R.disable_reservoir?0:1}function W(R,E,C){for(var O=R.header[R.h_ptr].ptr;C>0;){var $=Math.min(C,8-(O&7));C-=$,R.header[R.h_ptr].buf[O>>3]|=E>>C<<8-(O&7)-$,O+=$}R.header[R.h_ptr].ptr=O}function A(R,E){R<<=8;for(var C=0;C<8;C++)R<<=1,E<<=1,(E^R)&65536&&(E^=_);return E}this.CRC_writeheader=function(R,E){var C=65535;C=A(E[2]&255,C),C=A(E[3]&255,C);for(var O=6;O<R.sideinfo_len;O++)C=A(E[O]&255,C);E[4]=byte(C>>8),E[5]=byte(C&255)};function L(R,E){var C=R.internal_flags,O,$,ne;if(O=C.l3_side,C.header[C.h_ptr].ptr=0,n.fill(C.header[C.h_ptr].buf,0,C.sideinfo_len,0),R.out_samplerate<16e3?W(C,4094,12):W(C,4095,12),W(C,R.version,1),W(C,1,2),W(C,R.error_protection?0:1,1),W(C,C.bitrate_index,4),W(C,C.samplerate_index,2),W(C,C.padding,1),W(C,R.extension,1),W(C,R.mode.ordinal(),2),W(C,C.mode_ext,2),W(C,R.copyright,1),W(C,R.original,1),W(C,R.emphasis,2),R.error_protection&&W(C,0,16),R.version==1){for(a(O.main_data_begin>=0),W(C,O.main_data_begin,9),C.channels_out==2?W(C,O.private_bits,3):W(C,O.private_bits,5),ne=0;ne<C.channels_out;ne++){var fe;for(fe=0;fe<4;fe++)W(C,O.scfsi[ne][fe],1)}for($=0;$<2;$++)for(ne=0;ne<C.channels_out;ne++){var Z=O.tt[$][ne];W(C,Z.part2_3_length+Z.part2_length,12),W(C,Z.big_values/2,9),W(C,Z.global_gain,8),W(C,Z.scalefac_compress,4),Z.block_type!=l.NORM_TYPE?(W(C,1,1),W(C,Z.block_type,2),W(C,Z.mixed_block_flag,1),Z.table_select[0]==14&&(Z.table_select[0]=16),W(C,Z.table_select[0],5),Z.table_select[1]==14&&(Z.table_select[1]=16),W(C,Z.table_select[1],5),W(C,Z.subblock_gain[0],3),W(C,Z.subblock_gain[1],3),W(C,Z.subblock_gain[2],3)):(W(C,0,1),Z.table_select[0]==14&&(Z.table_select[0]=16),W(C,Z.table_select[0],5),Z.table_select[1]==14&&(Z.table_select[1]=16),W(C,Z.table_select[1],5),Z.table_select[2]==14&&(Z.table_select[2]=16),W(C,Z.table_select[2],5),a(0<=Z.region0_count&&Z.region0_count<16),a(0<=Z.region1_count&&Z.region1_count<8),W(C,Z.region0_count,4),W(C,Z.region1_count,3)),W(C,Z.preflag,1),W(C,Z.scalefac_scale,1),W(C,Z.count1table_select,1)}}else for(a(O.main_data_begin>=0),W(C,O.main_data_begin,8),W(C,O.private_bits,C.channels_out),$=0,ne=0;ne<C.channels_out;ne++){var Z=O.tt[$][ne];W(C,Z.part2_3_length+Z.part2_length,12),W(C,Z.big_values/2,9),W(C,Z.global_gain,8),W(C,Z.scalefac_compress,9),Z.block_type!=l.NORM_TYPE?(W(C,1,1),W(C,Z.block_type,2),W(C,Z.mixed_block_flag,1),Z.table_select[0]==14&&(Z.table_select[0]=16),W(C,Z.table_select[0],5),Z.table_select[1]==14&&(Z.table_select[1]=16),W(C,Z.table_select[1],5),W(C,Z.subblock_gain[0],3),W(C,Z.subblock_gain[1],3),W(C,Z.subblock_gain[2],3)):(W(C,0,1),Z.table_select[0]==14&&(Z.table_select[0]=16),W(C,Z.table_select[0],5),Z.table_select[1]==14&&(Z.table_select[1]=16),W(C,Z.table_select[1],5),Z.table_select[2]==14&&(Z.table_select[2]=16),W(C,Z.table_select[2],5),a(0<=Z.region0_count&&Z.region0_count<16),a(0<=Z.region1_count&&Z.region1_count<8),W(C,Z.region0_count,4),W(C,Z.region1_count,3)),W(C,Z.scalefac_scale,1),W(C,Z.count1table_select,1)}R.error_protection&&CRC_writeheader(C,C.header[C.h_ptr].buf);{var se=C.h_ptr;a(C.header[se].ptr==C.sideinfo_len*8),C.h_ptr=se+1&f.MAX_HEADER_BUF-1,C.header[C.h_ptr].write_timing=C.header[se].write_timing+E,C.h_ptr==C.w_ptr&&t.err.println(`Error: MAX_HEADER_BUF too small in bitstream.c 
`)}}function B(R,E){var C=c.ht[E.count1table_select+32],O,$=0,ne=E.big_values,fe=E.big_values;for(a(E.count1table_select<2),O=(E.count1-E.big_values)/4;O>0;--O){var Z=0,se=0,de;de=E.l3_enc[ne+0],de!=0&&(se+=8,E.xr[fe+0]<0&&Z++),de=E.l3_enc[ne+1],de!=0&&(se+=4,Z*=2,E.xr[fe+1]<0&&Z++),de=E.l3_enc[ne+2],de!=0&&(se+=2,Z*=2,E.xr[fe+2]<0&&Z++),de=E.l3_enc[ne+3],de!=0&&(se++,Z*=2,E.xr[fe+3]<0&&Z++),ne+=4,fe+=4,M(R,Z+C.table[se],C.hlen[se]),$+=C.hlen[se]}return $}function P(R,E,C,O,$){var ne=c.ht[E],fe=0;if(E==0)return fe;for(var Z=C;Z<O;Z+=2){var se=0,de=0,_e=ne.xlen,Ie=ne.xlen,Ne=0,Re=$.l3_enc[Z],Pe=$.l3_enc[Z+1];if(Re!=0&&($.xr[Z]<0&&Ne++,se--),E>15){if(Re>14){var je=Re-15;a(je<=ne.linmax),Ne|=je<<1,de=_e,Re=15}if(Pe>14){var Ee=Pe-15;a(Ee<=ne.linmax),Ne<<=_e,Ne|=Ee,de+=_e,Pe=15}Ie=16}Pe!=0&&(Ne<<=1,$.xr[Z+1]<0&&Ne++,se--),Re=Re*Ie+Pe,de-=se,se+=ne.hlen[Re],M(R,ne.table[Re],se),M(R,Ne,de),fe+=se+de}return fe}function V(R,E){var C=3*R.scalefac_band.s[3];C>E.big_values&&(C=E.big_values);var O=P(R,E.table_select[0],0,C,E);return O+=P(R,E.table_select[1],C,E.big_values,E),O}function U(R,E){var C,O,$,ne;C=E.big_values;var fe=E.region0_count+1;return a(fe<R.scalefac_band.l.length),$=R.scalefac_band.l[fe],fe+=E.region1_count+1,a(fe<R.scalefac_band.l.length),ne=R.scalefac_band.l[fe],$>C&&($=C),ne>C&&(ne=C),O=P(R,E.table_select[0],0,$,E),O+=P(R,E.table_select[1],$,ne,E),O+=P(R,E.table_select[2],ne,C,E),O}function X(R){var E,C,O,$,ne=0,fe=R.internal_flags,Z=fe.l3_side;if(R.version==1)for(E=0;E<2;E++)for(C=0;C<fe.channels_out;C++){var se=Z.tt[E][C],de=i.slen1_tab[se.scalefac_compress],_e=i.slen2_tab[se.scalefac_compress];for($=0,O=0;O<se.sfbdivide;O++)se.scalefac[O]!=-1&&(M(fe,se.scalefac[O],de),$+=de);for(;O<se.sfbmax;O++)se.scalefac[O]!=-1&&(M(fe,se.scalefac[O],_e),$+=_e);a($==se.part2_length),se.block_type==l.SHORT_TYPE?$+=V(fe,se):$+=U(fe,se),$+=B(fe,se),a($==se.part2_3_length+se.part2_length),ne+=$}else for(E=0,C=0;C<fe.channels_out;C++){var se=Z.tt[E][C],Ie,Ne,Re=0;if(a(se.sfb_partition_table!=null),$=0,O=0,Ne=0,se.block_type==l.SHORT_TYPE){for(;Ne<4;Ne++){var Pe=se.sfb_partition_table[Ne]/3,je=se.slen[Ne];for(Ie=0;Ie<Pe;Ie++,O++)M(fe,Math.max(se.scalefac[O*3+0],0),je),M(fe,Math.max(se.scalefac[O*3+1],0),je),M(fe,Math.max(se.scalefac[O*3+2],0),je),Re+=3*je}$+=V(fe,se)}else{for(;Ne<4;Ne++){var Pe=se.sfb_partition_table[Ne],je=se.slen[Ne];for(Ie=0;Ie<Pe;Ie++,O++)M(fe,Math.max(se.scalefac[O],0),je),Re+=je}$+=U(fe,se)}$+=B(fe,se),a($==se.part2_3_length),a(Re==se.part2_length),ne+=Re+$}return ne}function te(){this.total=0}function Y(R,E){var C=R.internal_flags,O,$,ne,fe,Z;return Z=C.w_ptr,fe=C.h_ptr-1,fe==-1&&(fe=f.MAX_HEADER_BUF-1),O=C.header[fe].write_timing-S,E.total=O,O>=0&&($=1+fe-Z,fe<Z&&($=1+fe-Z+f.MAX_HEADER_BUF),O-=$*8*C.sideinfo_len),ne=v.getframebits(R),O+=ne,E.total+=ne,E.total%8!=0?E.total=1+E.total/8:E.total=E.total/8,E.total+=x+1,O<0&&t.err.println(`strange error flushing buffer ... 
`),O}this.flush_bitstream=function(R){var E=R.internal_flags,C,O,$=E.h_ptr-1;if($==-1&&($=f.MAX_HEADER_BUF-1),C=E.l3_side,!((O=Y(R,new te))<0)){if(j(R,O),a(E.header[$].write_timing+this.getframebits(R)==S),E.ResvSize=0,C.main_data_begin=0,E.findReplayGain){var ne=y.GetTitleGain(E.rgdata);a(NEQ(ne,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),E.RadioGain=Math.floor(ne*10+.5)|0}E.findPeakSample&&(E.noclipGainChange=Math.ceil(Math.log10(E.PeakSample/32767)*20*10)|0,E.noclipGainChange>0&&(EQ(R.scale,1)||EQ(R.scale,0))?E.noclipScale=Math.floor(32767/E.PeakSample*100)/100:E.noclipScale=-1)}},this.add_dummy_byte=function(R,E,C){for(var O=R.internal_flags,$;C-- >0;)for(H(O,E,8),$=0;$<f.MAX_HEADER_BUF;++$)O.header[$].write_timing+=8},this.format_bitstream=function(R){var E=R.internal_flags,C;C=E.l3_side;var O=this.getframebits(R);j(R,C.resvDrain_pre),L(R,O);var $=8*E.sideinfo_len;if($+=X(R),j(R,C.resvDrain_post),$+=C.resvDrain_post,C.main_data_begin+=(O-$)/8,Y(R,new te)!=E.ResvSize&&t.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),C.main_data_begin*8!=E.ResvSize&&(t.err.printf(`bit reservoir error: 
l3_side.main_data_begin: %d 
Resvoir size:             %d 
resv drain (post)         %d 
resv drain (pre)          %d 
header and sideinfo:      %d 
data bits:                %d 
total bits:               %d (remainder: %d) 
bitsperframe:             %d 
`,8*C.main_data_begin,E.ResvSize,C.resvDrain_post,C.resvDrain_pre,8*E.sideinfo_len,$-C.resvDrain_post-8*E.sideinfo_len,$,$%8,O),t.err.println("This is a fatal error.  It has several possible causes:"),t.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),t.err.println(" 9%%  Your system is overclocked"),t.err.println(" 1%%  bug in LAME encoding library"),E.ResvSize=C.main_data_begin*8),S>1e9){var ne;for(ne=0;ne<f.MAX_HEADER_BUF;++ne)E.header[ne].write_timing-=S;S=0}return 0},this.copy_buffer=function(R,E,C,O,$){var ne=x+1;if(ne<=0)return 0;if(O!=0&&ne>O)return-1;if(t.arraycopy(h,0,E,C,ne),x=-1,w=0,$!=0){var fe=s(1);if(fe[0]=R.nMusicCRC,b.updateMusicCRC(fe,E,C,ne),R.nMusicCRC=fe[0],ne>0&&(R.VBR_seek_table.nBytesWritten+=ne),R.decode_on_the_fly){for(var Z=o([2,1152]),se=ne,de=-1,_e;de!=0;)if(de=k.hip_decode1_unclipped(R.hip,E,C,se,Z[0],Z[1]),se=0,de==-1&&(de=0),de>0){if(R.findPeakSample){for(_e=0;_e<de;_e++)Z[0][_e]>R.PeakSample?R.PeakSample=Z[0][_e]:-Z[0][_e]>R.PeakSample&&(R.PeakSample=-Z[0][_e]);if(R.channels_out>1)for(_e=0;_e<de;_e++)Z[1][_e]>R.PeakSample?R.PeakSample=Z[1][_e]:-Z[1][_e]>R.PeakSample&&(R.PeakSample=-Z[1][_e])}if(R.findReplayGain&&y.AnalyzeSamples(R.rgdata,Z[0],0,Z[1],0,de,R.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}}return ne},this.init_bit_stream_w=function(R){h=r(m.LAME_MAXMP3BUFFER),R.h_ptr=R.w_ptr=0,R.header[R.h_ptr].write_timing=0,x=-1,w=0,S=0}}return mh=d,mh}var gh,mb;function P1(){if(mb)return gh;mb=1;var e=Zt,t=e.System,n=e.VbrMode,r=e.ShortBlock,o=e.new_float,s=e.new_int_n,a=e.new_short_n,i=e.assert,c=l$,l=f$,f=lf,d=N$,m=z$,v=U$,_=O1(),y=R1,k=zn();function g(){var b=ll,h=this,S=128*1024;g.V9=410,g.V8=420,g.V7=430,g.V6=440,g.V5=450,g.V4=460,g.V3=470,g.V2=480,g.V1=490,g.V0=500,g.R3MIX=1e3,g.STANDARD=1001,g.EXTREME=1002,g.INSANE=1003,g.STANDARD_FAST=1004,g.EXTREME_FAST=1005,g.MEDIUM=1006,g.MEDIUM_FAST=1007;var x=16384+S;g.LAME_MAXMP3BUFFER=x;var w,I,M,H,j,W=new c,A,L,B;this.enc=new k,this.setModules=function(T,D,we,ke,Be,He,Ue,Le,et){w=T,I=D,M=we,H=ke,j=Be,A=He,L=Le,B=et,this.enc.setModules(I,W,H,A)};function P(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=o(k.SBMAX_l),this.bo_s_weight=o(k.SBMAX_s)}function V(){this.lowerlimit=0}function U(T,D){this.lowpass=D}var X=4294479419;function te(T){var D;return T.class_id=X,D=T.internal_flags=new f,T.mode=b.NOT_SET,T.original=1,T.in_samplerate=44100,T.num_channels=2,T.num_samples=-1,T.bWriteVbrTag=!0,T.quality=-1,T.short_blocks=null,D.subblock_gain=-1,T.lowpassfreq=0,T.highpassfreq=0,T.lowpasswidth=-1,T.highpasswidth=-1,T.VBR=n.vbr_off,T.VBR_q=4,T.ATHcurve=-1,T.VBR_mean_bitrate_kbps=128,T.VBR_min_bitrate_kbps=0,T.VBR_max_bitrate_kbps=0,T.VBR_hard_min=0,D.VBR_min_bitrate=1,D.VBR_max_bitrate=13,T.quant_comp=-1,T.quant_comp_short=-1,T.msfix=-1,D.resample_ratio=1,D.OldValue[0]=180,D.OldValue[1]=180,D.CurrentStep[0]=4,D.CurrentStep[1]=4,D.masking_lower=1,D.nsPsy.attackthre=-1,D.nsPsy.attackthre_s=-1,T.scale=-1,T.athaa_type=-1,T.ATHtype=-1,T.athaa_loudapprox=-1,T.athaa_sensitivity=0,T.useTemporal=null,T.interChRatio=-1,D.mf_samples_to_encode=k.ENCDELAY+k.POSTDELAY,T.encoder_padding=0,D.mf_size=k.ENCDELAY-k.MDCTDELAY,T.findReplayGain=!1,T.decode_on_the_fly=!1,D.decode_on_the_fly=!1,D.findReplayGain=!1,D.findPeakSample=!1,D.RadioGain=0,D.AudiophileGain=0,D.noclipGainChange=0,D.noclipScale=-1,T.preset=0,T.write_id3tag_automatic=!0,0}this.lame_init=function(){var T=new l;return te(T),T.lame_allocated_gfp=1,T};function Y(T){return T>1?0:T<=0?1:Math.cos(Math.PI/2*T)}this.nearestBitrateFullIndex=function(T){var D=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],we=0,ke=0,Be=0,He=0;He=D[16],Be=16,ke=D[16],we=16;for(var Ue=0;Ue<16;Ue++)if(Math.max(T,D[Ue+1])!=T){He=D[Ue+1],Be=Ue+1,ke=D[Ue],we=Ue;break}return He-T>T-ke?we:Be};function R(T,D){var we=44100;return D>=48e3?we=48e3:D>=44100?we=44100:D>=32e3?we=32e3:D>=24e3?we=24e3:D>=22050?we=22050:D>=16e3?we=16e3:D>=12e3?we=12e3:D>=11025?we=11025:D>=8e3&&(we=8e3),T==-1?we:(T<=15960&&(we=44100),T<=15250&&(we=32e3),T<=11220&&(we=24e3),T<=9970&&(we=22050),T<=7230&&(we=16e3),T<=5420&&(we=12e3),T<=4510&&(we=11025),T<=3970&&(we=8e3),D<we?D>44100?48e3:D>32e3?44100:D>24e3?32e3:D>22050?24e3:D>16e3?22050:D>12e3?16e3:D>11025?12e3:D>8e3?11025:8e3:we)}function E(T,D){switch(T){case 44100:return D.version=1,0;case 48e3:return D.version=1,1;case 32e3:return D.version=1,2;case 22050:return D.version=0,0;case 24e3:return D.version=0,1;case 16e3:return D.version=0,2;case 11025:return D.version=0,0;case 12e3:return D.version=0,1;case 8e3:return D.version=0,2;default:return D.version=0,-1}}function C(T,D,we){we<16e3&&(D=2);for(var ke=y.bitrate_table[D][1],Be=2;Be<=14;Be++)y.bitrate_table[D][Be]>0&&Math.abs(y.bitrate_table[D][Be]-T)<Math.abs(ke-T)&&(ke=y.bitrate_table[D][Be]);return ke}function O(T,D,we){we<16e3&&(D=2);for(var ke=0;ke<=14;ke++)if(y.bitrate_table[D][ke]>0&&y.bitrate_table[D][ke]==T)return ke;return-1}function $(T,D){var we=[new U(8,2e3),new U(16,3700),new U(24,3900),new U(32,5500),new U(40,7e3),new U(48,7500),new U(56,1e4),new U(64,11e3),new U(80,13500),new U(96,15100),new U(112,15600),new U(128,17e3),new U(160,17500),new U(192,18600),new U(224,19400),new U(256,19700),new U(320,20500)],ke=h.nearestBitrateFullIndex(D);T.lowerlimit=we[ke].lowpass}function ne(T){var D=T.internal_flags,we=32,ke=-1;if(D.lowpass1>0){for(var Be=999,He=0;He<=31;He++){var Ue=He/31;Ue>=D.lowpass2&&(we=Math.min(we,He)),D.lowpass1<Ue&&Ue<D.lowpass2&&(Be=Math.min(Be,He))}Be==999?D.lowpass1=(we-.75)/31:D.lowpass1=(Be-.75)/31,D.lowpass2=we/31}if(D.highpass2>0&&D.highpass2<.9*(.75/31)&&(D.highpass1=0,D.highpass2=0,t.err.println(`Warning: highpass filter disabled.  highpass frequency too small
`)),D.highpass2>0){for(var Le=-1,He=0;He<=31;He++){var Ue=He/31;Ue<=D.highpass1&&(ke=Math.max(ke,He)),D.highpass1<Ue&&Ue<D.highpass2&&(Le=Math.max(Le,He))}D.highpass1=ke/31,Le==-1?D.highpass2=(ke+.75)/31:D.highpass2=(Le+.75)/31}for(var He=0;He<32;He++){var et,Ze,Ue=He/31;D.highpass2>D.highpass1?et=Y((D.highpass2-Ue)/(D.highpass2-D.highpass1+1e-20)):et=1,D.lowpass2>D.lowpass1?Ze=Y((Ue-D.lowpass1)/(D.lowpass2-D.lowpass1+1e-20)):Ze=1,D.amp_filter[He]=et*Ze}}function fe(T){var D=T.internal_flags;switch(T.quality){default:case 9:D.psymodel=0,D.noise_shaping=0,D.noise_shaping_amp=0,D.noise_shaping_stop=0,D.use_best_huffman=0,D.full_outer_loop=0;break;case 8:T.quality=7;case 7:D.psymodel=1,D.noise_shaping=0,D.noise_shaping_amp=0,D.noise_shaping_stop=0,D.use_best_huffman=0,D.full_outer_loop=0;break;case 6:D.psymodel=1,D.noise_shaping==0&&(D.noise_shaping=1),D.noise_shaping_amp=0,D.noise_shaping_stop=0,D.subblock_gain==-1&&(D.subblock_gain=1),D.use_best_huffman=0,D.full_outer_loop=0;break;case 5:D.psymodel=1,D.noise_shaping==0&&(D.noise_shaping=1),D.noise_shaping_amp=0,D.noise_shaping_stop=0,D.subblock_gain==-1&&(D.subblock_gain=1),D.use_best_huffman=0,D.full_outer_loop=0;break;case 4:D.psymodel=1,D.noise_shaping==0&&(D.noise_shaping=1),D.noise_shaping_amp=0,D.noise_shaping_stop=0,D.subblock_gain==-1&&(D.subblock_gain=1),D.use_best_huffman=1,D.full_outer_loop=0;break;case 3:D.psymodel=1,D.noise_shaping==0&&(D.noise_shaping=1),D.noise_shaping_amp=1,D.noise_shaping_stop=1,D.subblock_gain==-1&&(D.subblock_gain=1),D.use_best_huffman=1,D.full_outer_loop=0;break;case 2:D.psymodel=1,D.noise_shaping==0&&(D.noise_shaping=1),D.substep_shaping==0&&(D.substep_shaping=2),D.noise_shaping_amp=1,D.noise_shaping_stop=1,D.subblock_gain==-1&&(D.subblock_gain=1),D.use_best_huffman=1,D.full_outer_loop=0;break;case 1:D.psymodel=1,D.noise_shaping==0&&(D.noise_shaping=1),D.substep_shaping==0&&(D.substep_shaping=2),D.noise_shaping_amp=2,D.noise_shaping_stop=1,D.subblock_gain==-1&&(D.subblock_gain=1),D.use_best_huffman=1,D.full_outer_loop=0;break;case 0:D.psymodel=1,D.noise_shaping==0&&(D.noise_shaping=1),D.substep_shaping==0&&(D.substep_shaping=2),D.noise_shaping_amp=2,D.noise_shaping_stop=1,D.subblock_gain==-1&&(D.subblock_gain=1),D.use_best_huffman=1,D.full_outer_loop=0;break}}function Z(T){var D=T.internal_flags;T.frameNum=0,T.write_id3tag_automatic&&L.id3tag_write_v2(T),D.bitrate_stereoMode_Hist=s([16,5]),D.bitrate_blockType_Hist=s([16,6]),D.PeakSample=0,T.bWriteVbrTag&&A.InitVbrTag(T)}this.lame_init_params=function(T){var D=T.internal_flags;if(D.Class_ID=0,D.ATH==null&&(D.ATH=new d),D.PSY==null&&(D.PSY=new P),D.rgdata==null&&(D.rgdata=new m),D.channels_in=T.num_channels,D.channels_in==1&&(T.mode=b.MONO),D.channels_out=T.mode==b.MONO?1:2,D.mode_ext=k.MPG_MD_MS_LR,T.mode==b.MONO&&(T.force_ms=!1),T.VBR==n.vbr_off&&T.VBR_mean_bitrate_kbps!=128&&T.brate==0&&(T.brate=T.VBR_mean_bitrate_kbps),T.VBR==n.vbr_off||T.VBR==n.vbr_mtrh||T.VBR==n.vbr_mt||(T.free_format=!1),T.VBR==n.vbr_off&&T.brate==0&&_.EQ(T.compression_ratio,0)&&(T.compression_ratio=11.025),T.VBR==n.vbr_off&&T.compression_ratio>0&&(T.out_samplerate==0&&(T.out_samplerate=map2MP3Frequency(int(.97*T.in_samplerate))),T.brate=0|T.out_samplerate*16*D.channels_out/(1e3*T.compression_ratio),D.samplerate_index=E(T.out_samplerate,T),T.free_format||(T.brate=C(T.brate,T.version,T.out_samplerate))),T.out_samplerate!=0&&(T.out_samplerate<16e3?(T.VBR_mean_bitrate_kbps=Math.max(T.VBR_mean_bitrate_kbps,8),T.VBR_mean_bitrate_kbps=Math.min(T.VBR_mean_bitrate_kbps,64)):T.out_samplerate<32e3?(T.VBR_mean_bitrate_kbps=Math.max(T.VBR_mean_bitrate_kbps,8),T.VBR_mean_bitrate_kbps=Math.min(T.VBR_mean_bitrate_kbps,160)):(T.VBR_mean_bitrate_kbps=Math.max(T.VBR_mean_bitrate_kbps,32),T.VBR_mean_bitrate_kbps=Math.min(T.VBR_mean_bitrate_kbps,320))),T.lowpassfreq==0){var we=16e3;switch(T.VBR){case n.vbr_off:{var ke=new V;$(ke,T.brate),we=ke.lowerlimit;break}case n.vbr_abr:{var ke=new V;$(ke,T.VBR_mean_bitrate_kbps),we=ke.lowerlimit;break}case n.vbr_rh:{var Be=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=T.VBR_q&&T.VBR_q<=9){var He=Be[T.VBR_q],Ue=Be[T.VBR_q+1],Le=T.VBR_q_frac;we=linear_int(He,Ue,Le)}else we=19500;break}default:{var Be=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=T.VBR_q&&T.VBR_q<=9){var He=Be[T.VBR_q],Ue=Be[T.VBR_q+1],Le=T.VBR_q_frac;we=linear_int(He,Ue,Le)}else we=19500}}T.mode==b.MONO&&(T.VBR==n.vbr_off||T.VBR==n.vbr_abr)&&(we*=1.5),T.lowpassfreq=we|0}if(T.out_samplerate==0&&(2*T.lowpassfreq>T.in_samplerate&&(T.lowpassfreq=T.in_samplerate/2),T.out_samplerate=R(T.lowpassfreq|0,T.in_samplerate)),T.lowpassfreq=Math.min(20500,T.lowpassfreq),T.lowpassfreq=Math.min(T.out_samplerate/2,T.lowpassfreq),T.VBR==n.vbr_off&&(T.compression_ratio=T.out_samplerate*16*D.channels_out/(1e3*T.brate)),T.VBR==n.vbr_abr&&(T.compression_ratio=T.out_samplerate*16*D.channels_out/(1e3*T.VBR_mean_bitrate_kbps)),T.bWriteVbrTag||(T.findReplayGain=!1,T.decode_on_the_fly=!1,D.findPeakSample=!1),D.findReplayGain=T.findReplayGain,D.decode_on_the_fly=T.decode_on_the_fly,D.decode_on_the_fly&&(D.findPeakSample=!0),D.findReplayGain&&w.InitGainAnalysis(D.rgdata,T.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return T.internal_flags=null,-6;switch(D.decode_on_the_fly&&!T.decode_only&&(D.hip!=null&&B.hip_decode_exit(D.hip),D.hip=B.hip_decode_init()),D.mode_gr=T.out_samplerate<=24e3?1:2,T.framesize=576*D.mode_gr,T.encoder_delay=k.ENCDELAY,D.resample_ratio=T.in_samplerate/T.out_samplerate,T.VBR){case n.vbr_mt:case n.vbr_rh:case n.vbr_mtrh:{var et=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];T.compression_ratio=et[T.VBR_q]}break;case n.vbr_abr:T.compression_ratio=T.out_samplerate*16*D.channels_out/(1e3*T.VBR_mean_bitrate_kbps);break;default:T.compression_ratio=T.out_samplerate*16*D.channels_out/(1e3*T.brate);break}if(T.mode==b.NOT_SET&&(T.mode=b.JOINT_STEREO),T.highpassfreq>0?(D.highpass1=2*T.highpassfreq,T.highpasswidth>=0?D.highpass2=2*(T.highpassfreq+T.highpasswidth):D.highpass2=1*2*T.highpassfreq,D.highpass1/=T.out_samplerate,D.highpass2/=T.out_samplerate):(D.highpass1=0,D.highpass2=0),T.lowpassfreq>0?(D.lowpass2=2*T.lowpassfreq,T.lowpasswidth>=0?(D.lowpass1=2*(T.lowpassfreq-T.lowpasswidth),D.lowpass1<0&&(D.lowpass1=0)):D.lowpass1=1*2*T.lowpassfreq,D.lowpass1/=T.out_samplerate,D.lowpass2/=T.out_samplerate):(D.lowpass1=0,D.lowpass2=0),ne(T),D.samplerate_index=E(T.out_samplerate,T),D.samplerate_index<0)return T.internal_flags=null,-1;if(T.VBR==n.vbr_off){if(T.free_format)D.bitrate_index=0;else if(T.brate=C(T.brate,T.version,T.out_samplerate),D.bitrate_index=O(T.brate,T.version,T.out_samplerate),D.bitrate_index<=0)return T.internal_flags=null,-1}else D.bitrate_index=1;T.analysis&&(T.bWriteVbrTag=!1),D.pinfo!=null&&(T.bWriteVbrTag=!1),I.init_bit_stream_w(D);for(var Ze=D.samplerate_index+3*T.version+6*(T.out_samplerate<16e3?1:0),Ae=0;Ae<k.SBMAX_l+1;Ae++)D.scalefac_band.l[Ae]=H.sfBandIndex[Ze].l[Ae];for(var Ae=0;Ae<k.PSFB21+1;Ae++){var xt=(D.scalefac_band.l[22]-D.scalefac_band.l[21])/k.PSFB21,It=D.scalefac_band.l[21]+Ae*xt;D.scalefac_band.psfb21[Ae]=It}D.scalefac_band.psfb21[k.PSFB21]=576;for(var Ae=0;Ae<k.SBMAX_s+1;Ae++)D.scalefac_band.s[Ae]=H.sfBandIndex[Ze].s[Ae];for(var Ae=0;Ae<k.PSFB12+1;Ae++){var xt=(D.scalefac_band.s[13]-D.scalefac_band.s[12])/k.PSFB12,It=D.scalefac_band.s[12]+Ae*xt;D.scalefac_band.psfb12[Ae]=It}D.scalefac_band.psfb12[k.PSFB12]=192,T.version==1?D.sideinfo_len=D.channels_out==1?21:36:D.sideinfo_len=D.channels_out==1?13:21,T.error_protection&&(D.sideinfo_len+=2),Z(T),D.Class_ID=X;{var z;for(z=0;z<19;z++)D.nsPsy.pefirbuf[z]=700*D.mode_gr*D.channels_out;T.ATHtype==-1&&(T.ATHtype=4)}switch(i(T.VBR_q<=9),i(T.VBR_q>=0),T.VBR){case n.vbr_mt:T.VBR=n.vbr_mtrh;case n.vbr_mtrh:{T.useTemporal==null&&(T.useTemporal=!1),M.apply_preset(T,500-T.VBR_q*10,0),T.quality<0&&(T.quality=LAME_DEFAULT_QUALITY),T.quality<5&&(T.quality=0),T.quality>5&&(T.quality=5),D.PSY.mask_adjust=T.maskingadjust,D.PSY.mask_adjust_short=T.maskingadjust_short,T.experimentalY?D.sfb21_extra=!1:D.sfb21_extra=T.out_samplerate>44e3,D.iteration_loop=new VBRNewIterationLoop(j);break}case n.vbr_rh:{M.apply_preset(T,500-T.VBR_q*10,0),D.PSY.mask_adjust=T.maskingadjust,D.PSY.mask_adjust_short=T.maskingadjust_short,T.experimentalY?D.sfb21_extra=!1:D.sfb21_extra=T.out_samplerate>44e3,T.quality>6&&(T.quality=6),T.quality<0&&(T.quality=LAME_DEFAULT_QUALITY),D.iteration_loop=new VBROldIterationLoop(j);break}default:{var F;D.sfb21_extra=!1,T.quality<0&&(T.quality=LAME_DEFAULT_QUALITY),F=T.VBR,F==n.vbr_off&&(T.VBR_mean_bitrate_kbps=T.brate),M.apply_preset(T,T.VBR_mean_bitrate_kbps,0),T.VBR=F,D.PSY.mask_adjust=T.maskingadjust,D.PSY.mask_adjust_short=T.maskingadjust_short,F==n.vbr_off?D.iteration_loop=new v(j):D.iteration_loop=new ABRIterationLoop(j);break}}if(i(T.scale>=0),T.VBR!=n.vbr_off){if(D.VBR_min_bitrate=1,D.VBR_max_bitrate=14,T.out_samplerate<16e3&&(D.VBR_max_bitrate=8),T.VBR_min_bitrate_kbps!=0&&(T.VBR_min_bitrate_kbps=C(T.VBR_min_bitrate_kbps,T.version,T.out_samplerate),D.VBR_min_bitrate=O(T.VBR_min_bitrate_kbps,T.version,T.out_samplerate),D.VBR_min_bitrate<0)||T.VBR_max_bitrate_kbps!=0&&(T.VBR_max_bitrate_kbps=C(T.VBR_max_bitrate_kbps,T.version,T.out_samplerate),D.VBR_max_bitrate=O(T.VBR_max_bitrate_kbps,T.version,T.out_samplerate),D.VBR_max_bitrate<0))return-1;T.VBR_min_bitrate_kbps=y.bitrate_table[T.version][D.VBR_min_bitrate],T.VBR_max_bitrate_kbps=y.bitrate_table[T.version][D.VBR_max_bitrate],T.VBR_mean_bitrate_kbps=Math.min(y.bitrate_table[T.version][D.VBR_max_bitrate],T.VBR_mean_bitrate_kbps),T.VBR_mean_bitrate_kbps=Math.max(y.bitrate_table[T.version][D.VBR_min_bitrate],T.VBR_mean_bitrate_kbps)}return T.tune&&(D.PSY.mask_adjust+=T.tune_value_a,D.PSY.mask_adjust_short+=T.tune_value_a),fe(T),i(T.scale>=0),T.athaa_type<0?D.ATH.useAdjust=3:D.ATH.useAdjust=T.athaa_type,D.ATH.aaSensitivityP=Math.pow(10,T.athaa_sensitivity/-10),T.short_blocks==null&&(T.short_blocks=r.short_block_allowed),T.short_blocks==r.short_block_allowed&&(T.mode==b.JOINT_STEREO||T.mode==b.STEREO)&&(T.short_blocks=r.short_block_coupled),T.quant_comp<0&&(T.quant_comp=1),T.quant_comp_short<0&&(T.quant_comp_short=0),T.msfix<0&&(T.msfix=0),T.exp_nspsytune=T.exp_nspsytune|1,T.internal_flags.nsPsy.attackthre<0&&(T.internal_flags.nsPsy.attackthre=c.NSATTACKTHRE),T.internal_flags.nsPsy.attackthre_s<0&&(T.internal_flags.nsPsy.attackthre_s=c.NSATTACKTHRE_S),i(T.scale>=0),T.scale<0&&(T.scale=1),T.ATHtype<0&&(T.ATHtype=4),T.ATHcurve<0&&(T.ATHcurve=4),T.athaa_loudapprox<0&&(T.athaa_loudapprox=2),T.interChRatio<0&&(T.interChRatio=0),T.useTemporal==null&&(T.useTemporal=!0),D.slot_lag=D.frac_SpF=0,T.VBR==n.vbr_off&&(D.slot_lag=D.frac_SpF=(T.version+1)*72e3*T.brate%T.out_samplerate|0),H.iteration_init(T),W.psymodel_init(T),i(T.scale>=0),0};function se(T,D){(T.in_buffer_0==null||T.in_buffer_nsamples<D)&&(T.in_buffer_0=o(D),T.in_buffer_1=o(D),T.in_buffer_nsamples=D)}this.lame_encode_flush=function(T,D,we,ke){var Be=T.internal_flags,He=a([2,1152]),Ue=0,Le,et,Ze,Ae,xt=Be.mf_samples_to_encode-k.POSTDELAY,It=de(T);if(Be.mf_samples_to_encode<1)return 0;for(Le=0,T.in_samplerate!=T.out_samplerate&&(xt+=16*T.out_samplerate/T.in_samplerate),Ze=T.framesize-xt%T.framesize,Ze<576&&(Ze+=T.framesize),T.encoder_padding=Ze,Ae=(xt+Ze)/T.framesize;Ae>0&&Ue>=0;){var z=It-Be.mf_size,F=T.frameNum;z*=T.in_samplerate,z/=T.out_samplerate,z>1152&&(z=1152),z<1&&(z=1),et=ke-Le,ke==0&&(et=0),Ue=this.lame_encode_buffer(T,He[0],He[1],z,D,we,et),we+=Ue,Le+=Ue,Ae-=F!=T.frameNum?1:0}if(Be.mf_samples_to_encode=0,Ue<0||(et=ke-Le,ke==0&&(et=0),I.flush_bitstream(T),Ue=I.copy_buffer(Be,D,we,et,1),Ue<0))return Ue;if(we+=Ue,Le+=Ue,et=ke-Le,ke==0&&(et=0),T.write_id3tag_automatic){if(L.id3tag_write_v1(T),Ue=I.copy_buffer(Be,D,we,et,0),Ue<0)return Ue;Le+=Ue}return Le},this.lame_encode_buffer=function(T,D,we,ke,Be,He,Ue){var Le=T.internal_flags,et=[null,null];if(Le.Class_ID!=X)return-3;if(ke==0)return 0;se(Le,ke),et[0]=Le.in_buffer_0,et[1]=Le.in_buffer_1;for(var Ze=0;Ze<ke;Ze++)et[0][Ze]=D[Ze],Le.channels_in>1&&(et[1][Ze]=we[Ze]);return _e(T,et[0],et[1],ke,Be,He,Ue)};function de(T){var D=k.BLKSIZE+T.framesize-k.FFTOFFSET;return D=Math.max(D,512+T.framesize-32),D}function _e(T,D,we,ke,Be,He,Ue){var Le=T.internal_flags,et=0,Ze,Ae,xt,It,z,F=[null,null],q=[null,null];if(Le.Class_ID!=X)return-3;if(ke==0)return 0;if(z=I.copy_buffer(Le,Be,He,Ue,0),z<0)return z;if(He+=z,et+=z,q[0]=D,q[1]=we,_.NEQ(T.scale,0)&&_.NEQ(T.scale,1))for(Ae=0;Ae<ke;++Ae)q[0][Ae]*=T.scale,Le.channels_out==2&&(q[1][Ae]*=T.scale);if(_.NEQ(T.scale_left,0)&&_.NEQ(T.scale_left,1))for(Ae=0;Ae<ke;++Ae)q[0][Ae]*=T.scale_left;if(_.NEQ(T.scale_right,0)&&_.NEQ(T.scale_right,1))for(Ae=0;Ae<ke;++Ae)q[1][Ae]*=T.scale_right;if(T.num_channels==2&&Le.channels_out==1)for(Ae=0;Ae<ke;++Ae)q[0][Ae]=.5*(q[0][Ae]+q[1][Ae]),q[1][Ae]=0;It=de(T),F[0]=Le.mfbuf[0],F[1]=Le.mfbuf[1];for(var Q=0;ke>0;){var re=[null,null],K=0,ae=0;re[0]=q[0],re[1]=q[1];var ce=new Ne;if(Ge(T,F,re,Q,ke,ce),K=ce.n_in,ae=ce.n_out,Le.findReplayGain&&!Le.decode_on_the_fly&&w.AnalyzeSamples(Le.rgdata,F[0],Le.mf_size,F[1],Le.mf_size,ae,Le.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(ke-=K,Q+=K,Le.channels_out==2,Le.mf_size+=ae,i(Le.mf_size<=f.MFSIZE),Le.mf_samples_to_encode<1&&(Le.mf_samples_to_encode=k.ENCDELAY+k.POSTDELAY),Le.mf_samples_to_encode+=ae,Le.mf_size>=It){var oe=Ue-et;if(Ue==0&&(oe=0),Ze=Ie(T,F[0],F[1],Be,He,oe),Ze<0)return Ze;for(He+=Ze,et+=Ze,Le.mf_size-=T.framesize,Le.mf_samples_to_encode-=T.framesize,xt=0;xt<Le.channels_out;xt++)for(Ae=0;Ae<Le.mf_size;Ae++)F[xt][Ae]=F[xt][Ae+T.framesize]}}return et}function Ie(T,D,we,ke,Be,He){var Ue=h.enc.lame_encode_mp3_frame(T,D,we,ke,Be,He);return T.frameNum++,Ue}function Ne(){this.n_in=0,this.n_out=0}function Re(){this.num_used=0}function Pe(T,D){return D!=0?Pe(D,T%D):T}function je(T,D,we){var ke=Math.PI*D;T/=we,T<0&&(T=0),T>1&&(T=1);var Be=T-.5,He=.42-.5*Math.cos(2*T*Math.PI)+.08*Math.cos(4*T*Math.PI);return Math.abs(Be)<1e-9?ke/Math.PI:He*Math.sin(we*ke*Be)/(Math.PI*we*Be)}function Ee(T,D,we,ke,Be,He,Ue,Le,et){var Ze=T.internal_flags,Ae,xt=0,It,z=T.out_samplerate/Pe(T.out_samplerate,T.in_samplerate);z>f.BPC&&(z=f.BPC);var F=Math.abs(Ze.resample_ratio-Math.floor(.5+Ze.resample_ratio))<1e-4?1:0,q=1/Ze.resample_ratio;q>1&&(q=1);var Q=31;Q%2==0&&--Q,Q+=F;var re=Q+1;if(Ze.fill_buffer_resample_init==0){for(Ze.inbuf_old[0]=o(re),Ze.inbuf_old[1]=o(re),Ae=0;Ae<=2*z;++Ae)Ze.blackfilt[Ae]=o(re);for(Ze.itime[0]=0,Ze.itime[1]=0,xt=0;xt<=2*z;xt++){var K=0,ae=(xt-z)/(2*z);for(Ae=0;Ae<=Q;Ae++)K+=Ze.blackfilt[xt][Ae]=je(Ae-ae,q,Q);for(Ae=0;Ae<=Q;Ae++)Ze.blackfilt[xt][Ae]/=K}Ze.fill_buffer_resample_init=1}var ce=Ze.inbuf_old[et];for(It=0;It<ke;It++){var oe,he;if(oe=It*Ze.resample_ratio,xt=0|Math.floor(oe-Ze.itime[et]),Q+xt-Q/2>=Ue)break;var ae=oe-Ze.itime[et]-(xt+.5*(Q%2));he=0|Math.floor(ae*2*z+z+.5);var ie=0;for(Ae=0;Ae<=Q;++Ae){var ue=0|Ae+xt-Q/2,Se;Se=ue<0?ce[re+ue]:Be[He+ue],ie+=Se*Ze.blackfilt[he][Ae]}D[we+It]=ie}if(Le.num_used=Math.min(Ue,Q+xt-Q/2),Ze.itime[et]+=Le.num_used-It*Ze.resample_ratio,Le.num_used>=re)for(Ae=0;Ae<re;Ae++)ce[Ae]=Be[He+Le.num_used+Ae-re];else{var Ye=re-Le.num_used;for(Ae=0;Ae<Ye;++Ae)ce[Ae]=ce[Ae+Le.num_used];for(xt=0;Ae<re;++Ae,++xt)ce[Ae]=Be[He+xt];i(xt==Le.num_used)}return It}function Ge(T,D,we,ke,Be,He){var Ue=T.internal_flags;if(Ue.resample_ratio<.9999||Ue.resample_ratio>1.0001)for(var Le=0;Le<Ue.channels_out;Le++){var et=new Re;He.n_out=Ee(T,D[Le],Ue.mf_size,T.framesize,we[Le],ke,Be,et,Le),He.n_in=et.num_used}else{He.n_out=Math.min(T.framesize,Be),He.n_in=He.n_out;for(var Ze=0;Ze<He.n_out;++Ze)D[0][Ue.mf_size+Ze]=we[0][ke+Ze],Ue.channels_out==2&&(D[1][Ue.mf_size+Ze]=we[1][ke+Ze])}}}return gh=g,gh}var G$=Zt,Gr=G$.VbrMode;function X$(){var e=P1();function t(f,d,m,v,_,y,k,g,b,h,S,x,w,I,M){this.vbr_q=f,this.quant_comp=d,this.quant_comp_s=m,this.expY=v,this.st_lrm=_,this.st_s=y,this.masking_adj=k,this.masking_adj_short=g,this.ath_lower=b,this.ath_curve=h,this.ath_sensitivity=S,this.interch=x,this.safejoint=w,this.sfb21mod=I,this.msfix=M}function n(f,d,m,v,_,y,k,g,b,h,S,x,w,I){this.quant_comp=d,this.quant_comp_s=m,this.safejoint=v,this.nsmsfix=_,this.st_lrm=y,this.st_s=k,this.nsbass=g,this.scale=b,this.masking_adj=h,this.ath_lower=S,this.ath_curve=x,this.interch=w,this.sfscale=I}var r;this.setModules=function(f){r=f};var o=[new t(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new t(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new t(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new t(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new t(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new t(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new t(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new t(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new t(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new t(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new t(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],s=[new t(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new t(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new t(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new t(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new t(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new t(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new t(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new t(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new t(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new t(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new t(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function a(f,d,m){var v=f.VBR==Gr.vbr_rh?o:s,_=f.VBR_q_frac,y=v[d],k=v[d+1],g=y;y.st_lrm=y.st_lrm+_*(k.st_lrm-y.st_lrm),y.st_s=y.st_s+_*(k.st_s-y.st_s),y.masking_adj=y.masking_adj+_*(k.masking_adj-y.masking_adj),y.masking_adj_short=y.masking_adj_short+_*(k.masking_adj_short-y.masking_adj_short),y.ath_lower=y.ath_lower+_*(k.ath_lower-y.ath_lower),y.ath_curve=y.ath_curve+_*(k.ath_curve-y.ath_curve),y.ath_sensitivity=y.ath_sensitivity+_*(k.ath_sensitivity-y.ath_sensitivity),y.interch=y.interch+_*(k.interch-y.interch),y.msfix=y.msfix+_*(k.msfix-y.msfix),l(f,g.vbr_q),m!=0?f.quant_comp=g.quant_comp:Math.abs(f.quant_comp- -1)>0||(f.quant_comp=g.quant_comp),m!=0?f.quant_comp_short=g.quant_comp_s:Math.abs(f.quant_comp_short- -1)>0||(f.quant_comp_short=g.quant_comp_s),g.expY!=0&&(f.experimentalY=g.expY!=0),m!=0?f.internal_flags.nsPsy.attackthre=g.st_lrm:Math.abs(f.internal_flags.nsPsy.attackthre- -1)>0||(f.internal_flags.nsPsy.attackthre=g.st_lrm),m!=0?f.internal_flags.nsPsy.attackthre_s=g.st_s:Math.abs(f.internal_flags.nsPsy.attackthre_s- -1)>0||(f.internal_flags.nsPsy.attackthre_s=g.st_s),m!=0?f.maskingadjust=g.masking_adj:Math.abs(f.maskingadjust-0)>0||(f.maskingadjust=g.masking_adj),m!=0?f.maskingadjust_short=g.masking_adj_short:Math.abs(f.maskingadjust_short-0)>0||(f.maskingadjust_short=g.masking_adj_short),m!=0?f.ATHlower=-g.ath_lower/10:Math.abs(-f.ATHlower*10-0)>0||(f.ATHlower=-g.ath_lower/10),m!=0?f.ATHcurve=g.ath_curve:Math.abs(f.ATHcurve- -1)>0||(f.ATHcurve=g.ath_curve),m!=0?f.athaa_sensitivity=g.ath_sensitivity:Math.abs(f.athaa_sensitivity- -1)>0||(f.athaa_sensitivity=g.ath_sensitivity),g.interch>0&&(m!=0?f.interChRatio=g.interch:Math.abs(f.interChRatio- -1)>0||(f.interChRatio=g.interch)),g.safejoint>0&&(f.exp_nspsytune=f.exp_nspsytune|g.safejoint),g.sfb21mod>0&&(f.exp_nspsytune=f.exp_nspsytune|g.sfb21mod<<20),m!=0?f.msfix=g.msfix:Math.abs(f.msfix- -1)>0||(f.msfix=g.msfix),m==0&&(f.VBR_q=d,f.VBR_q_frac=_)}var i=[new n(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new n(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new n(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new n(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new n(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new n(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new n(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new n(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new n(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new n(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new n(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new n(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new n(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new n(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new n(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new n(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new n(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function c(f,d,m){var v=d,_=r.nearestBitrateFullIndex(d);if(f.VBR=Gr.vbr_abr,f.VBR_mean_bitrate_kbps=v,f.VBR_mean_bitrate_kbps=Math.min(f.VBR_mean_bitrate_kbps,320),f.VBR_mean_bitrate_kbps=Math.max(f.VBR_mean_bitrate_kbps,8),f.brate=f.VBR_mean_bitrate_kbps,f.VBR_mean_bitrate_kbps>320&&(f.disable_reservoir=!0),i[_].safejoint>0&&(f.exp_nspsytune=f.exp_nspsytune|2),i[_].sfscale>0&&(f.internal_flags.noise_shaping=2),Math.abs(i[_].nsbass)>0){var y=int(i[_].nsbass*4);y<0&&(y+=64),f.exp_nspsytune=f.exp_nspsytune|y<<2}return m!=0?f.quant_comp=i[_].quant_comp:Math.abs(f.quant_comp- -1)>0||(f.quant_comp=i[_].quant_comp),m!=0?f.quant_comp_short=i[_].quant_comp_s:Math.abs(f.quant_comp_short- -1)>0||(f.quant_comp_short=i[_].quant_comp_s),m!=0?f.msfix=i[_].nsmsfix:Math.abs(f.msfix- -1)>0||(f.msfix=i[_].nsmsfix),m!=0?f.internal_flags.nsPsy.attackthre=i[_].st_lrm:Math.abs(f.internal_flags.nsPsy.attackthre- -1)>0||(f.internal_flags.nsPsy.attackthre=i[_].st_lrm),m!=0?f.internal_flags.nsPsy.attackthre_s=i[_].st_s:Math.abs(f.internal_flags.nsPsy.attackthre_s- -1)>0||(f.internal_flags.nsPsy.attackthre_s=i[_].st_s),m!=0?f.scale=i[_].scale:Math.abs(f.scale- -1)>0||(f.scale=i[_].scale),m!=0?f.maskingadjust=i[_].masking_adj:Math.abs(f.maskingadjust-0)>0||(f.maskingadjust=i[_].masking_adj),i[_].masking_adj>0?m!=0?f.maskingadjust_short=i[_].masking_adj*.9:Math.abs(f.maskingadjust_short-0)>0||(f.maskingadjust_short=i[_].masking_adj*.9):m!=0?f.maskingadjust_short=i[_].masking_adj*1.1:Math.abs(f.maskingadjust_short-0)>0||(f.maskingadjust_short=i[_].masking_adj*1.1),m!=0?f.ATHlower=-i[_].ath_lower/10:Math.abs(-f.ATHlower*10-0)>0||(f.ATHlower=-i[_].ath_lower/10),m!=0?f.ATHcurve=i[_].ath_curve:Math.abs(f.ATHcurve- -1)>0||(f.ATHcurve=i[_].ath_curve),m!=0?f.interChRatio=i[_].interch:Math.abs(f.interChRatio- -1)>0||(f.interChRatio=i[_].interch),d}this.apply_preset=function(f,d,m){switch(d){case e.R3MIX:{d=e.V3,f.VBR=Gr.vbr_mtrh;break}case e.MEDIUM:{d=e.V4,f.VBR=Gr.vbr_rh;break}case e.MEDIUM_FAST:{d=e.V4,f.VBR=Gr.vbr_mtrh;break}case e.STANDARD:{d=e.V2,f.VBR=Gr.vbr_rh;break}case e.STANDARD_FAST:{d=e.V2,f.VBR=Gr.vbr_mtrh;break}case e.EXTREME:{d=e.V0,f.VBR=Gr.vbr_rh;break}case e.EXTREME_FAST:{d=e.V0,f.VBR=Gr.vbr_mtrh;break}case e.INSANE:return d=320,f.preset=d,c(f,d,m),f.VBR=Gr.vbr_off,d}switch(f.preset=d,d){case e.V9:return a(f,9,m),d;case e.V8:return a(f,8,m),d;case e.V7:return a(f,7,m),d;case e.V6:return a(f,6,m),d;case e.V5:return a(f,5,m),d;case e.V4:return a(f,4,m),d;case e.V3:return a(f,3,m),d;case e.V2:return a(f,2,m),d;case e.V1:return a(f,1,m),d;case e.V0:return a(f,0,m),d}return 8<=d&&d<=320?c(f,d,m):(f.preset=0,d)};function l(f,d){var m=0;return 0>d&&(m=-1,d=0),9<d&&(m=-1,d=9),f.VBR_q=d,f.VBR_q_frac=0,m}}var K$=X$;function Y$(){this.setModules=function(e,t){}}var q$=Y$;function Z$(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var Q$=Z$,qw=Zt,gb=qw.new_float,J$=qw.new_int;function eV(){this.global_gain=0,this.sfb_count1=0,this.step=J$(39),this.noise=gb(39),this.noise_log=gb(39)}var tV=eV,xi=Zt,Lo=xi.System,vb=xi.VbrMode,vh=xi.Util,ca=xi.Arrays,zi=xi.new_float,Fi=xi.assert,nV=q$,bh=Q$,rV=tV,Tt=zn(),bb=E1,_b=cf;function oV(){var e;this.rv=null;var t;this.qupvt=null;var n,r=new nV,o;this.setModules=function(g,b,h,S){e=g,t=b,this.rv=b,n=h,this.qupvt=h,o=S,r.setModules(n,o)},this.ms_convert=function(g,b){for(var h=0;h<576;++h){var S=g.tt[b][0].xr[h],x=g.tt[b][1].xr[h];g.tt[b][0].xr[h]=(S+x)*(vh.SQRT2*.5),g.tt[b][1].xr[h]=(S-x)*(vh.SQRT2*.5)}};function s(g,b,h,S){S=0;for(var x=0;x<=h;++x){var w=Math.abs(g.xr[x]);S+=w,b[x]=Math.sqrt(w*Math.sqrt(w)),b[x]>g.xrpow_max&&(g.xrpow_max=b[x])}return S}this.init_xrpow=function(g,b,h){var S=0,x=0|b.max_nonzero_coeff;if(b.xrpow_max=0,ca.fill(h,x,576,0),S=s(b,h,x,S),S>1e-20){var w=0;g.substep_shaping&2&&(w=1);for(var I=0;I<b.psymax;I++)g.pseudohalf[I]=w;return!0}return ca.fill(b.l3_enc,0,576,0),!1};function a(g,b){var h=g.ATH,S=b.xr;if(b.block_type!=Tt.SHORT_TYPE)for(var x=!1,w=Tt.PSFB21-1;w>=0&&!x;w--){var I=g.scalefac_band.psfb21[w],M=g.scalefac_band.psfb21[w+1],H=n.athAdjust(h.adjust,h.psfb21[w],h.floor);g.nsPsy.longfact[21]>1e-12&&(H*=g.nsPsy.longfact[21]);for(var j=M-1;j>=I;j--)if(Math.abs(S[j])<H)S[j]=0;else{x=!0;break}}else for(var W=0;W<3;W++)for(var x=!1,w=Tt.PSFB12-1;w>=0&&!x;w--){var I=g.scalefac_band.s[12]*3+(g.scalefac_band.s[13]-g.scalefac_band.s[12])*W+(g.scalefac_band.psfb12[w]-g.scalefac_band.psfb12[0]),M=I+(g.scalefac_band.psfb12[w+1]-g.scalefac_band.psfb12[w]),A=n.athAdjust(h.adjust,h.psfb12[w],h.floor);g.nsPsy.shortfact[12]>1e-12&&(A*=g.nsPsy.shortfact[12]);for(var j=M-1;j>=I;j--)if(Math.abs(S[j])<A)S[j]=0;else{x=!0;break}}}this.init_outer_loop=function(g,b){b.part2_3_length=0,b.big_values=0,b.count1=0,b.global_gain=210,b.scalefac_compress=0,b.table_select[0]=0,b.table_select[1]=0,b.table_select[2]=0,b.subblock_gain[0]=0,b.subblock_gain[1]=0,b.subblock_gain[2]=0,b.subblock_gain[3]=0,b.region0_count=0,b.region1_count=0,b.preflag=0,b.scalefac_scale=0,b.count1table_select=0,b.part2_length=0,b.sfb_lmax=Tt.SBPSY_l,b.sfb_smin=Tt.SBPSY_s,b.psy_lmax=g.sfb21_extra?Tt.SBMAX_l:Tt.SBPSY_l,b.psymax=b.psy_lmax,b.sfbmax=b.sfb_lmax,b.sfbdivide=11;for(var h=0;h<Tt.SBMAX_l;h++)b.width[h]=g.scalefac_band.l[h+1]-g.scalefac_band.l[h],b.window[h]=3;if(b.block_type==Tt.SHORT_TYPE){var S=zi(576);b.sfb_smin=0,b.sfb_lmax=0,b.mixed_block_flag!=0&&(b.sfb_smin=3,b.sfb_lmax=g.mode_gr*2+4),b.psymax=b.sfb_lmax+3*((g.sfb21_extra?Tt.SBMAX_s:Tt.SBPSY_s)-b.sfb_smin),b.sfbmax=b.sfb_lmax+3*(Tt.SBPSY_s-b.sfb_smin),b.sfbdivide=b.sfbmax-18,b.psy_lmax=b.sfb_lmax;var x=g.scalefac_band.l[b.sfb_lmax];Lo.arraycopy(b.xr,0,S,0,576);for(var h=b.sfb_smin;h<Tt.SBMAX_s;h++)for(var w=g.scalefac_band.s[h],I=g.scalefac_band.s[h+1],M=0;M<3;M++)for(var H=w;H<I;H++)b.xr[x++]=S[3*H+M];for(var j=b.sfb_lmax,h=b.sfb_smin;h<Tt.SBMAX_s;h++)b.width[j]=b.width[j+1]=b.width[j+2]=g.scalefac_band.s[h+1]-g.scalefac_band.s[h],b.window[j]=0,b.window[j+1]=1,b.window[j+2]=2,j+=3}b.count1bits=0,b.sfb_partition_table=n.nr_of_sfb_block[0][0],b.slen[0]=0,b.slen[1]=0,b.slen[2]=0,b.slen[3]=0,b.max_nonzero_coeff=575,ca.fill(b.scalefac,0),a(g,b)};function i(g){this.ordinal=g}i.BINSEARCH_NONE=new i(0),i.BINSEARCH_UP=new i(1),i.BINSEARCH_DOWN=new i(2);function c(g,b,h,S,x){var w,I=g.CurrentStep[S],M=!1,H=g.OldValue[S],j=i.BINSEARCH_NONE;for(b.global_gain=H,h-=b.part2_length;;){var W;if(w=o.count_bits(g,x,b,null),I==1||w==h)break;w>h?(j==i.BINSEARCH_DOWN&&(M=!0),M&&(I/=2),j=i.BINSEARCH_UP,W=I):(j==i.BINSEARCH_UP&&(M=!0),M&&(I/=2),j=i.BINSEARCH_DOWN,W=-I),b.global_gain+=W,b.global_gain<0&&(b.global_gain=0,M=!0),b.global_gain>255&&(b.global_gain=255,M=!0)}for(Fi(b.global_gain>=0),Fi(b.global_gain<256);w>h&&b.global_gain<255;)b.global_gain++,w=o.count_bits(g,x,b,null);return g.CurrentStep[S]=H-b.global_gain>=4?4:2,g.OldValue[S]=b.global_gain,b.part2_3_length=w,w}this.trancate_smallspectrums=function(g,b,h,S){var x=zi(_b.SFBMAX);if(!(!(g.substep_shaping&4)&&b.block_type==Tt.SHORT_TYPE||g.substep_shaping&128)){n.calc_noise(b,h,x,new bh,null);for(var I=0;I<576;I++){var w=0;b.l3_enc[I]!=0&&(w=Math.abs(b.xr[I])),S[I]=w}var I=0,M=8;b.block_type==Tt.SHORT_TYPE&&(M=6);do{var H,j,W,A,L=b.width[M];if(I+=L,!(x[M]>=1)&&(ca.sort(S,I-L,L),!BitStream.EQ(S[I-1],0))){H=(1-x[M])*h[M],j=0,A=0;do{var B;for(W=1;A+W<L&&!BitStream.NEQ(S[A+I-L],S[A+I+W-L]);W++);if(B=S[A+I-L]*S[A+I-L]*W,H<B){A!=0&&(j=S[A+I-L-1]);break}H-=B,A+=W}while(A<L);if(!BitStream.EQ(j,0))do Math.abs(b.xr[I-L])<=j&&(b.l3_enc[I-L]=0);while(--L>0)}}while(++M<b.psymax);b.part2_3_length=o.noquant_count_bits(g,b,null)}};function l(g){for(var b=0;b<g.sfbmax;b++)if(g.scalefac[b]+g.subblock_gain[g.window[b]]==0)return!1;return!0}function f(g){return vh.FAST_LOG10(.368+.632*g*g*g)}function d(g,b){for(var h=1e-37,S=0;S<b.psymax;S++)h+=f(g[S]);return Math.max(1e-20,h)}function m(g,b,h,S,x){var w;switch(g){default:case 9:{b.over_count>0?(w=h.over_SSD<=b.over_SSD,h.over_SSD==b.over_SSD&&(w=h.bits<b.bits)):w=h.max_noise<0&&h.max_noise*10+h.bits<=b.max_noise*10+b.bits;break}case 0:w=h.over_count<b.over_count||h.over_count==b.over_count&&h.over_noise<b.over_noise||h.over_count==b.over_count&&BitStream.EQ(h.over_noise,b.over_noise)&&h.tot_noise<b.tot_noise;break;case 8:h.max_noise=d(x,S);case 1:w=h.max_noise<b.max_noise;break;case 2:w=h.tot_noise<b.tot_noise;break;case 3:w=h.tot_noise<b.tot_noise&&h.max_noise<b.max_noise;break;case 4:w=h.max_noise<=0&&b.max_noise>.2||h.max_noise<=0&&b.max_noise<0&&b.max_noise>h.max_noise-.2&&h.tot_noise<b.tot_noise||h.max_noise<=0&&b.max_noise>0&&b.max_noise>h.max_noise-.2&&h.tot_noise<b.tot_noise+b.over_noise||h.max_noise>0&&b.max_noise>-.05&&b.max_noise>h.max_noise-.1&&h.tot_noise+h.over_noise<b.tot_noise+b.over_noise||h.max_noise>0&&b.max_noise>-.1&&b.max_noise>h.max_noise-.15&&h.tot_noise+h.over_noise+h.over_noise<b.tot_noise+b.over_noise+b.over_noise;break;case 5:w=h.over_noise<b.over_noise||BitStream.EQ(h.over_noise,b.over_noise)&&h.tot_noise<b.tot_noise;break;case 6:w=h.over_noise<b.over_noise||BitStream.EQ(h.over_noise,b.over_noise)&&(h.max_noise<b.max_noise||BitStream.EQ(h.max_noise,b.max_noise)&&h.tot_noise<=b.tot_noise);break;case 7:w=h.over_count<b.over_count||h.over_noise<b.over_noise;break}return b.over_count==0&&(w=w&&h.bits<b.bits),w}function v(g,b,h,S,x){var w=g.internal_flags,I;b.scalefac_scale==0?I=1.2968395546510096:I=1.6817928305074292;for(var M=0,H=0;H<b.sfbmax;H++)M<h[H]&&(M=h[H]);var j=w.noise_shaping_amp;switch(j==3&&(x?j=2:j=1),j){case 2:break;case 1:M>1?M=Math.pow(M,.5):M*=.95;break;case 0:default:M>1?M=1:M*=.95;break}for(var W=0,H=0;H<b.sfbmax;H++){var A=b.width[H],L;if(W+=A,!(h[H]<M)){if(w.substep_shaping&2&&(w.pseudohalf[H]=w.pseudohalf[H]==0?1:0,w.pseudohalf[H]==0&&w.noise_shaping_amp==2))return;for(b.scalefac[H]++,L=-A;L<0;L++)S[W+L]*=I,S[W+L]>b.xrpow_max&&(b.xrpow_max=S[W+L]);if(w.noise_shaping_amp==2)return}}}function _(g,b){for(var h=1.2968395546510096,S=0,x=0;x<g.sfbmax;x++){var w=g.width[x],I=g.scalefac[x];if(g.preflag!=0&&(I+=n.pretab[x]),S+=w,I&1){I++;for(var M=-w;M<0;M++)b[S+M]*=h,b[S+M]>g.xrpow_max&&(g.xrpow_max=b[S+M])}g.scalefac[x]=I>>1}g.preflag=0,g.scalefac_scale=1}function y(g,b,h){var S,x=b.scalefac;for(S=0;S<b.sfb_lmax;S++)if(x[S]>=16)return!0;for(var w=0;w<3;w++){var I=0,M=0;for(S=b.sfb_lmax+w;S<b.sfbdivide;S+=3)I<x[S]&&(I=x[S]);for(;S<b.sfbmax;S+=3)M<x[S]&&(M=x[S]);if(!(I<16&&M<8)){if(b.subblock_gain[w]>=7)return!0;b.subblock_gain[w]++;var H=g.scalefac_band.l[b.sfb_lmax];for(S=b.sfb_lmax+w;S<b.sfbmax;S+=3){var j,W=b.width[S],A=x[S];if(A=A-(4>>b.scalefac_scale),A>=0){x[S]=A,H+=W*3;continue}x[S]=0;{var L=210+(A<<b.scalefac_scale+1);j=n.IPOW20(L)}H+=W*(w+1);for(var B=-W;B<0;B++)h[H+B]*=j,h[H+B]>b.xrpow_max&&(b.xrpow_max=h[H+B]);H+=W*(3-w-1)}{var j=n.IPOW20(202);H+=b.width[S]*(w+1);for(var B=-b.width[S];B<0;B++)h[H+B]*=j,h[H+B]>b.xrpow_max&&(b.xrpow_max=h[H+B])}}}return!1}function k(g,b,h,S,x){var w=g.internal_flags;v(g,b,h,S,x);var I=l(b);return I?!1:(w.mode_gr==2?I=o.scale_bitcount(b):I=o.scale_bitcount_lsf(w,b),I?(w.noise_shaping>1&&(ca.fill(w.pseudohalf,0),b.scalefac_scale==0?(_(b,S),I=!1):b.block_type==Tt.SHORT_TYPE&&w.subblock_gain>0&&(I=y(w,b,S)||l(b))),I||(w.mode_gr==2?I=o.scale_bitcount(b):I=o.scale_bitcount_lsf(w,b)),!I):!0)}this.outer_loop=function(g,b,h,S,x,w){var I=g.internal_flags,M=new bb,H=zi(576),j=zi(_b.SFBMAX),W=new bh,A,L=new rV,B=9999999,P=!1,V=!1,U=0;if(c(I,b,w,x,S),I.noise_shaping==0)return 100;n.calc_noise(b,h,j,W,L),W.bits=b.part2_3_length,M.assign(b);var X=0;for(Lo.arraycopy(S,0,H,0,576);!P;){do{var te=new bh,Y,R=255;if(I.substep_shaping&2?Y=20:Y=3,I.sfb21_extra&&(j[M.sfbmax]>1||M.block_type==Tt.SHORT_TYPE&&(j[M.sfbmax+1]>1||j[M.sfbmax+2]>1))||!k(g,M,j,S,V))break;M.scalefac_scale!=0&&(R=254);var E=w-M.part2_length;if(E<=0)break;for(;(M.part2_3_length=o.count_bits(I,S,M,L))>E&&M.global_gain<=R;)M.global_gain++;if(M.global_gain>R)break;if(W.over_count==0){for(;(M.part2_3_length=o.count_bits(I,S,M,L))>B&&M.global_gain<=R;)M.global_gain++;if(M.global_gain>R)break}if(n.calc_noise(M,h,j,te,L),te.bits=M.part2_3_length,b.block_type!=Tt.SHORT_TYPE?A=g.quant_comp:A=g.quant_comp_short,A=m(A,W,te,M,j)?1:0,A!=0)B=b.part2_3_length,W=te,b.assign(M),X=0,Lo.arraycopy(S,0,H,0,576);else if(I.full_outer_loop==0&&(++X>Y&&W.over_count==0||I.noise_shaping_amp==3&&V&&X>30||I.noise_shaping_amp==3&&V&&M.global_gain-U>15))break}while(M.global_gain+M.scalefac_scale<255);I.noise_shaping_amp==3?V?P=!0:(M.assign(b),Lo.arraycopy(H,0,S,0,576),X=0,U=M.global_gain,V=!0):P=!0}return Fi(b.global_gain+b.scalefac_scale<=255),g.VBR==vb.vbr_rh||g.VBR==vb.vbr_mtrh?Lo.arraycopy(H,0,S,0,576):I.substep_shaping&1&&trancate_smallspectrums(I,b,h,S),W.over_count},this.iteration_finish_one=function(g,b,h){var S=g.l3_side,x=S.tt[b][h];o.best_scalefac_store(g,b,h,S),g.use_best_huffman==1&&o.best_huffman_divide(g,x),t.ResvAdjust(g,x)},this.VBR_encode_granule=function(g,b,h,S,x,w,I){var M=g.internal_flags,H=new bb,j=zi(576),W=I,A=I+1,L=(I+w)/2,B,P,V=0,U=M.sfb21_extra;Fi(W<=LameInternalFlags.MAX_BITS_PER_CHANNEL),ca.fill(H.l3_enc,0);do L>W-42?M.sfb21_extra=!1:M.sfb21_extra=U,P=outer_loop(g,b,h,S,x,L),P<=0?(V=1,A=b.part2_3_length,H.assign(b),Lo.arraycopy(S,0,j,0,576),I=A-32,B=I-w,L=(I+w)/2):(w=L+32,B=I-w,L=(I+w)/2,V!=0&&(V=2,b.assign(H),Lo.arraycopy(j,0,S,0,576)));while(B>12);M.sfb21_extra=U,V==2&&Lo.arraycopy(H.l3_enc,0,b.l3_enc,0,576),Fi(b.part2_3_length<=W)},this.get_framebits=function(g,b){var h=g.internal_flags;h.bitrate_index=h.VBR_min_bitrate;var S=e.getframebits(g);h.bitrate_index=1,S=e.getframebits(g);for(var x=1;x<=h.VBR_max_bitrate;x++){h.bitrate_index=x;var w=new MeanBits(S);b[x]=t.ResvFrameBegin(g,w),S=w.bits}},this.VBR_old_prepare=function(g,b,h,S,x,w,I,M,H){var j=g.internal_flags,W,A=0,L=1,B=0;j.bitrate_index=j.VBR_max_bitrate;var P=t.ResvFrameBegin(g,new MeanBits(0))/j.mode_gr;get_framebits(g,w);for(var V=0;V<j.mode_gr;V++){var U=n.on_pe(g,b,M[V],P,V,0);j.mode_ext==Tt.MPG_MD_MS_LR&&(ms_convert(j.l3_side,V),n.reduce_side(M[V],h[V],P,U));for(var X=0;X<j.channels_out;++X){var te=j.l3_side.tt[V][X];te.block_type!=Tt.SHORT_TYPE?(A=1.28/(1+Math.exp(3.5-b[V][X]/300))-.05,W=j.PSY.mask_adjust-A):(A=2.56/(1+Math.exp(3.5-b[V][X]/300))-.14,W=j.PSY.mask_adjust_short-A),j.masking_lower=Math.pow(10,W*.1),init_outer_loop(j,te),H[V][X]=n.calc_xmin(g,S[V][X],te,x[V][X]),H[V][X]!=0&&(L=0),I[V][X]=126,B+=M[V][X]}}for(var V=0;V<j.mode_gr;V++)for(var X=0;X<j.channels_out;X++)B>w[j.VBR_max_bitrate]&&(M[V][X]*=w[j.VBR_max_bitrate],M[V][X]/=B),I[V][X]>M[V][X]&&(I[V][X]=M[V][X]);return L},this.bitpressure_strategy=function(g,b,h,S){for(var x=0;x<g.mode_gr;x++)for(var w=0;w<g.channels_out;w++){for(var I=g.l3_side.tt[x][w],M=b[x][w],H=0,j=0;j<I.psy_lmax;j++)M[H++]*=1+.029*j*j/Tt.SBMAX_l/Tt.SBMAX_l;if(I.block_type==Tt.SHORT_TYPE)for(var j=I.sfb_smin;j<Tt.SBMAX_s;j++)M[H++]*=1+.029*j*j/Tt.SBMAX_s/Tt.SBMAX_s,M[H++]*=1+.029*j*j/Tt.SBMAX_s/Tt.SBMAX_s,M[H++]*=1+.029*j*j/Tt.SBMAX_s/Tt.SBMAX_s;S[x][w]=0|Math.max(h[x][w],.9*S[x][w])}},this.VBR_new_prepare=function(g,b,h,S,x,w){var I=g.internal_flags,M=1,H=0,j=0,W;if(g.free_format){I.bitrate_index=0;var A=new MeanBits(H);W=t.ResvFrameBegin(g,A),H=A.bits,x[0]=W}else{I.bitrate_index=I.VBR_max_bitrate;var A=new MeanBits(H);t.ResvFrameBegin(g,A),H=A.bits,get_framebits(g,x),W=x[I.VBR_max_bitrate]}for(var L=0;L<I.mode_gr;L++){n.on_pe(g,b,w[L],H,L,0),I.mode_ext==Tt.MPG_MD_MS_LR&&ms_convert(I.l3_side,L);for(var B=0;B<I.channels_out;++B){var P=I.l3_side.tt[L][B];I.masking_lower=Math.pow(10,I.PSY.mask_adjust*.1),init_outer_loop(I,P),n.calc_xmin(g,h[L][B],P,S[L][B])!=0&&(M=0),j+=w[L][B]}}for(var L=0;L<I.mode_gr;L++)for(var B=0;B<I.channels_out;B++)j>W&&(w[L][B]*=W,w[L][B]/=j);return M},this.calc_target_bits=function(g,b,h,S,x,w){var I=g.internal_flags,M=I.l3_side,H,j,W,A,L=0;I.bitrate_index=I.VBR_max_bitrate;var B=new MeanBits(L);for(w[0]=t.ResvFrameBegin(g,B),L=B.bits,I.bitrate_index=1,L=e.getframebits(g)-I.sideinfo_len*8,x[0]=L/(I.mode_gr*I.channels_out),L=g.VBR_mean_bitrate_kbps*g.framesize*1e3,I.substep_shaping&1&&(L*=1.09),L/=g.out_samplerate,L-=I.sideinfo_len*8,L/=I.mode_gr*I.channels_out,H=.93+.07*(11-g.compression_ratio)/(11-5.5),H<.9&&(H=.9),H>1&&(H=1),j=0;j<I.mode_gr;j++){var P=0;for(W=0;W<I.channels_out;W++){if(S[j][W]=int(H*L),b[j][W]>700){var V=int((b[j][W]-700)/1.4),U=M.tt[j][W];S[j][W]=int(H*L),U.block_type==Tt.SHORT_TYPE&&V<L/2&&(V=L/2),V>L*3/2?V=L*3/2:V<0&&(V=0),S[j][W]+=V}S[j][W]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(S[j][W]=LameInternalFlags.MAX_BITS_PER_CHANNEL),P+=S[j][W]}if(P>LameInternalFlags.MAX_BITS_PER_GRANULE)for(W=0;W<I.channels_out;++W)S[j][W]*=LameInternalFlags.MAX_BITS_PER_GRANULE,S[j][W]/=P}if(I.mode_ext==Tt.MPG_MD_MS_LR)for(j=0;j<I.mode_gr;j++)n.reduce_side(S[j],h[j],L*I.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(A=0,j=0;j<I.mode_gr;j++)for(W=0;W<I.channels_out;W++)S[j][W]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(S[j][W]=LameInternalFlags.MAX_BITS_PER_CHANNEL),A+=S[j][W];if(A>w[0])for(j=0;j<I.mode_gr;j++)for(W=0;W<I.channels_out;W++)S[j][W]*=w[0],S[j][W]/=A}}var sV=oV,aV=Zt,yb=aV.assert;function iV(){var e;this.setModules=function(t){e=t},this.ResvFrameBegin=function(t,n){var r=t.internal_flags,o,s=r.l3_side,a=e.getframebits(t);n.bits=(a-r.sideinfo_len*8)/r.mode_gr;var i=8*256*r.mode_gr-8;t.brate>320?o=8*int(t.brate*1e3/(t.out_samplerate/1152)/8+.5):(o=8*1440,t.strict_ISO&&(o=8*int(32e4/(t.out_samplerate/1152)/8+.5))),r.ResvMax=o-a,r.ResvMax>i&&(r.ResvMax=i),(r.ResvMax<0||t.disable_reservoir)&&(r.ResvMax=0);var c=n.bits*r.mode_gr+Math.min(r.ResvSize,r.ResvMax);return c>o&&(c=o),yb(r.ResvMax%8==0),yb(r.ResvMax>=0),s.resvDrain_pre=0,r.pinfo!=null&&(r.pinfo.mean_bits=n.bits/2,r.pinfo.resvsize=r.ResvSize),c},this.ResvMaxBits=function(t,n,r,o){var s=t.internal_flags,a,i=s.ResvSize,c=s.ResvMax;o!=0&&(i+=n),s.substep_shaping&1&&(c*=.9),r.bits=n,i*10>c*9?(a=i-c*9/10,r.bits+=a,s.substep_shaping|=128):(a=0,s.substep_shaping&=127,!t.disable_reservoir&&!(s.substep_shaping&1)&&(r.bits-=.1*n));var l=i<s.ResvMax*6/10?i:s.ResvMax*6/10;return l-=a,l<0&&(l=0),l},this.ResvAdjust=function(t,n){t.ResvSize-=n.part2_3_length+n.part2_length},this.ResvFrameEnd=function(t,n){var r,o=t.l3_side;t.ResvSize+=n*t.mode_gr;var s=0;o.resvDrain_post=0,o.resvDrain_pre=0,(r=t.ResvSize%8)!=0&&(s+=r),r=t.ResvSize-s-t.ResvMax,r>0&&(s+=r);{var a=Math.min(o.main_data_begin*8,s)/8;o.resvDrain_pre+=8*a,s-=8*a,t.ResvSize-=8*a,o.main_data_begin-=a}o.resvDrain_post+=s,t.ResvSize-=s}}var cV=iV;function lV(){var e="http://www.mp3dev.org/",t=3,n=98,r=4,o=0,s=93;this.getLameVersion=function(){return t+"."+n+"."+r},this.getLameShortVersion=function(){return t+"."+n+"."+r},this.getLameVeryShortVersion=function(){return"LAME"+t+"."+n+"r"},this.getPsyVersion=function(){return o+"."+s},this.getLameUrl=function(){return e},this.getLameOsBitness=function(){return"32bits"}}var uV=lV,Ci=Zt,dV=Ci.System,_h=Ci.VbrMode,Sb=Ci.ShortBlock,fV=Ci.Arrays,Dl=Ci.new_byte,hV=Ci.assert;Rc.NUMTOCENTRIES=100;Rc.MAXFRAMESIZE=2880;function Rc(){var e,t,n;this.setModules=function(L,B,P){e=L,t=B,n=P};var r=1,o=2,s=4,a=8,i=Rc.NUMTOCENTRIES,c=Rc.MAXFRAMESIZE,l=i+4+4+4+4+4,f=l+9+1+1+8+1+1+3+1+1+2+4+2+2,d=128,m=64,v=32,_=null,y="Xing",k="Info",g=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function b(L,B){if(L.nVbrNumFrames++,L.sum+=B,L.seen++,!(L.seen<L.want)&&(L.pos<L.size&&(L.bag[L.pos]=L.sum,L.pos++,L.seen=0),L.pos==L.size)){for(var P=1;P<L.size;P+=2)L.bag[P/2]=L.bag[P];L.want*=2,L.pos/=2}}function h(L,B){if(!(L.pos<=0))for(var P=1;P<i;++P){var V=P/i,U,X,te=0|Math.floor(V*L.pos);te>L.pos-1&&(te=L.pos-1),U=L.bag[te],X=L.sum;var Y=0|256*U/X;Y>255&&(Y=255),B[P]=255&Y}}this.addVbrFrame=function(L){var B=L.internal_flags,P=Tables.bitrate_table[L.version][B.bitrate_index];hV(B.VBR_seek_table.bag!=null),b(B.VBR_seek_table,P)};function S(L,B){var P=L[B+0]&255;return P<<=8,P|=L[B+1]&255,P<<=8,P|=L[B+2]&255,P<<=8,P|=L[B+3]&255,P}function x(L,B,P){L[B+0]=255&(P>>24&255),L[B+1]=255&(P>>16&255),L[B+2]=255&(P>>8&255),L[B+3]=255&(P&255)}function w(L,B,P){L[B+0]=255&(P>>8&255),L[B+1]=255&(P&255)}function I(L,B){return new String(L,B,y.length(),_).equals(y)||new String(L,B,k.length(),_).equals(k)}function M(L,B,P){return 255&(L<<B|P&~(-1<<B))}function H(L,B){var P=L.internal_flags;B[0]=M(B[0],8,255),B[1]=M(B[1],3,7),B[1]=M(B[1],1,L.out_samplerate<16e3?0:1),B[1]=M(B[1],1,L.version),B[1]=M(B[1],2,1),B[1]=M(B[1],1,L.error_protection?0:1),B[2]=M(B[2],4,P.bitrate_index),B[2]=M(B[2],2,P.samplerate_index),B[2]=M(B[2],1,0),B[2]=M(B[2],1,L.extension),B[3]=M(B[3],2,L.mode.ordinal()),B[3]=M(B[3],2,P.mode_ext),B[3]=M(B[3],1,L.copyright),B[3]=M(B[3],1,L.original),B[3]=M(B[3],2,L.emphasis),B[0]=255;var V=255&(B[1]&241),U;L.version==1?U=d:L.out_samplerate<16e3?U=v:U=m,L.VBR==_h.vbr_off&&(U=L.brate);var X;L.free_format?X=0:X=255&16*e.BitrateIndex(U,L.version,L.out_samplerate),L.version==1?(B[1]=255&(V|10),V=255&(B[2]&13),B[2]=255&(X|V)):(B[1]=255&(V|2),V=255&(B[2]&13),B[2]=255&(X|V))}this.getVbrTag=function(L){var B=new VBRTagData,P=0;B.flags=0;var V=L[P+1]>>3&1,U=L[P+2]>>2&3,X=L[P+3]>>6&3,te=L[P+2]>>4&15;if(te=Tables.bitrate_table[V][te],L[P+1]>>4==14?B.samprate=Tables.samplerate_table[2][U]:B.samprate=Tables.samplerate_table[V][U],V!=0?X!=3?P+=36:P+=21:X!=3?P+=21:P+=13,!I(L,P))return null;P+=4,B.hId=V;var Y=B.flags=S(L,P);if(P+=4,Y&r&&(B.frames=S(L,P),P+=4),Y&o&&(B.bytes=S(L,P),P+=4),Y&s){if(B.toc!=null)for(var R=0;R<i;R++)B.toc[R]=L[P+R];P+=i}B.vbrScale=-1,Y&a&&(B.vbrScale=S(L,P),P+=4),B.headersize=(V+1)*72e3*te/B.samprate,P+=21;var E=L[P+0]<<4;E+=L[P+1]>>4;var C=(L[P+1]&15)<<8;return C+=L[P+2]&255,(E<0||E>3e3)&&(E=-1),(C<0||C>3e3)&&(C=-1),B.encDelay=E,B.encPadding=C,B},this.InitVbrTag=function(L){var B=L.internal_flags,P;L.version==1?P=d:L.out_samplerate<16e3?P=v:P=m,L.VBR==_h.vbr_off&&(P=L.brate);var V=(L.version+1)*72e3*P/L.out_samplerate,U=B.sideinfo_len+f;if(B.VBR_seek_table.TotalFrameSize=V,V<U||V>c){L.bWriteVbrTag=!1;return}B.VBR_seek_table.nVbrNumFrames=0,B.VBR_seek_table.nBytesWritten=0,B.VBR_seek_table.sum=0,B.VBR_seek_table.seen=0,B.VBR_seek_table.want=1,B.VBR_seek_table.pos=0,B.VBR_seek_table.bag==null&&(B.VBR_seek_table.bag=new int[400],B.VBR_seek_table.size=400);var X=Dl(c);H(L,X);for(var te=B.VBR_seek_table.TotalFrameSize,Y=0;Y<te;++Y)t.add_dummy_byte(L,X[Y]&255,1)};function j(L,B){var P=B^L;return B=B>>8^g[P&255],B}this.updateMusicCRC=function(L,B,P,V){for(var U=0;U<V;++U)L[0]=j(B[P+U],L[0])};function W(L,B,P,V,U){var X=L.internal_flags,te=0,Y=L.encoder_delay,R=L.encoder_padding,E=100-10*L.VBR_q-L.quality,C=n.getLameVeryShortVersion(),O,$=0,ne,fe=[1,5,3,2,4,0,3],Z=0|(L.lowpassfreq/100+.5>255?255:L.lowpassfreq/100+.5),se=0,de=0,_e=0,Ie=L.internal_flags.noise_shaping,Ne=0,Re=0,Pe=0,je=0,Ee=0,Ge=(L.exp_nspsytune&1)!=0,T=(L.exp_nspsytune&2)!=0,D=!1,we=!1,ke=L.internal_flags.nogap_total,Be=L.internal_flags.nogap_current,He=L.ATHtype,Ue=0,Le;switch(L.VBR){case vbr_abr:Le=L.VBR_mean_bitrate_kbps;break;case vbr_off:Le=L.brate;break;default:Le=L.VBR_min_bitrate_kbps}switch(L.VBR.ordinal()<fe.length?O=fe[L.VBR.ordinal()]:O=0,ne=16*$+O,X.findReplayGain&&(X.RadioGain>510&&(X.RadioGain=510),X.RadioGain<-510&&(X.RadioGain=-510),de=8192,de|=3072,X.RadioGain>=0?de|=X.RadioGain:(de|=512,de|=-X.RadioGain)),X.findPeakSample&&(se=Math.abs(0|X.PeakSample/32767*Math.pow(2,23)+.5)),ke!=-1&&(Be>0&&(we=!0),Be<ke-1&&(D=!0)),Ue=He+((Ge?1:0)<<4)+((T?1:0)<<5)+((D?1:0)<<6)+((we?1:0)<<7),E<0&&(E=0),L.mode){case MONO:Ne=0;break;case STEREO:Ne=1;break;case DUAL_CHANNEL:Ne=2;break;case JOINT_STEREO:L.force_ms?Ne=4:Ne=3;break;case NOT_SET:default:Ne=7;break}L.in_samplerate<=32e3?Pe=0:L.in_samplerate==48e3?Pe=2:L.in_samplerate>48e3?Pe=3:Pe=1,(L.short_blocks==Sb.short_block_forced||L.short_blocks==Sb.short_block_dispensed||L.lowpassfreq==-1&&L.highpassfreq==-1||L.scale_left<L.scale_right||L.scale_left>L.scale_right||L.disable_reservoir&&L.brate<320||L.noATH||L.ATHonly||He==0||L.in_samplerate<=32e3)&&(Re=1),je=Ie+(Ne<<2)+(Re<<5)+(Pe<<6),Ee=X.nMusicCRC,x(P,V+te,E),te+=4;for(var et=0;et<9;et++)P[V+te+et]=255&C.charAt(et);te+=9,P[V+te]=255&ne,te++,P[V+te]=255&Z,te++,x(P,V+te,se),te+=4,w(P,V+te,de),te+=2,w(P,V+te,_e),te+=2,P[V+te]=255&Ue,te++,Le>=255?P[V+te]=255:P[V+te]=255&Le,te++,P[V+te]=255&Y>>4,P[V+te+1]=255&(Y<<4)+(R>>8),P[V+te+2]=255&R,te+=3,P[V+te]=255&je,te++,P[V+te++]=0,w(P,V+te,L.preset),te+=2,x(P,V+te,B),te+=4,w(P,V+te,Ee),te+=2;for(var Ze=0;Ze<te;Ze++)U=j(P[V+Ze],U);return w(P,V+te,U),te+=2,te}function A(L){L.seek(0);var B=Dl(10);L.readFully(B);var P;return new String(B,"ISO-8859-1").startsWith("ID3")?P=0:P=((B[6]&127)<<21|(B[7]&127)<<14|(B[8]&127)<<7|B[9]&127)+B.length,P}this.getLameTagFrame=function(L,B){var P=L.internal_flags;if(!L.bWriteVbrTag||P.Class_ID!=Lame.LAME_ID||P.VBR_seek_table.pos<=0)return 0;if(B.length<P.VBR_seek_table.TotalFrameSize)return P.VBR_seek_table.TotalFrameSize;fV.fill(B,0,P.VBR_seek_table.TotalFrameSize,0),H(L,B);var V=Dl(i);if(L.free_format)for(var U=1;U<i;++U)V[U]=255&255*U/100;else h(P.VBR_seek_table,V);var X=P.sideinfo_len;L.error_protection&&(X-=2),L.VBR==_h.vbr_off?(B[X++]=255&k.charAt(0),B[X++]=255&k.charAt(1),B[X++]=255&k.charAt(2),B[X++]=255&k.charAt(3)):(B[X++]=255&y.charAt(0),B[X++]=255&y.charAt(1),B[X++]=255&y.charAt(2),B[X++]=255&y.charAt(3)),x(B,X,r+o+s+a),X+=4,x(B,X,P.VBR_seek_table.nVbrNumFrames),X+=4;var te=P.VBR_seek_table.nBytesWritten+P.VBR_seek_table.TotalFrameSize;x(B,X,0|te),X+=4,dV.arraycopy(V,0,B,X,V.length),X+=V.length,L.error_protection&&t.CRC_writeheader(P,B);for(var Y=0,U=0;U<X;U++)Y=j(B[U],Y);return X+=W(L,te,B,X,Y),P.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(L,B){var P=L.internal_flags;if(P.VBR_seek_table.pos<=0||(B.seek(B.length()),B.length()==0))return-1;var V=A(B);B.seek(V);var U=Dl(c),X=getLameTagFrame(L,U);return X>U.length?-1:(X<1||B.write(U,0,X),0)}}var pV=Rc,Zw=Zt,kb=Zw.new_byte,mV=Zw.assert,gV=P1(),vV=K$,bV=Uw,_V=Kw(),yV=sV,SV=Yw(),kV=cV,wV=ll,xV=O1();zn();var CV=uV,TV=pV;function MV(){this.setModules=function(e,t){}}function EV(){this.setModules=function(e,t,n){}}function IV(){}function AV(){this.setModules=function(e,t){}}function RV(e,t,n){arguments.length!=3&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),e=1,t=44100,n=128);var r=new gV,o=new MV,s=new bV,a=new xV,i=new vV,c=new _V,l=new yV,f=new TV,d=new CV,m=new AV,v=new kV,_=new SV,y=new EV,k=new IV;r.setModules(s,a,i,c,l,f,d,m,k),a.setModules(s,k,d,f),m.setModules(a,d),i.setModules(r),l.setModules(a,v,c,_),c.setModules(_,v,r.enc.psy),v.setModules(a),_.setModules(c),f.setModules(r,a,d),o.setModules(y,k),y.setModules(d,m,i);var g=r.lame_init();g.num_channels=e,g.in_samplerate=t,g.brate=n,g.mode=wV.STEREO,g.quality=3,g.bWriteVbrTag=!1,g.disable_reservoir=!0,g.write_id3tag_automatic=!1,r.lame_init_params(g);var b=1152,h=0|1.25*b+7200,S=kb(h);this.encodeBuffer=function(x,w){e==1&&(w=x),mV(x.length==w.length),x.length>b&&(b=x.length,h=0|1.25*b+7200,S=kb(h));var I=r.lame_encode_buffer(g,x,w,x.length,S,0,h);return new Int8Array(S.subarray(0,I))},this.flush=function(){var x=r.lame_encode_flush(g,S,0,h);return new Int8Array(S.subarray(0,x))}}function Yr(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function uf(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}Yr.RIFF=uf("RIFF");Yr.WAVE=uf("WAVE");Yr.fmt_=uf("fmt ");Yr.data=uf("data");Yr.readHeader=function(e){var t=new Yr,n=e.getUint32(0,!1);if(Yr.RIFF==n&&(e.getUint32(4,!0),Yr.WAVE==e.getUint32(8,!1)&&Yr.fmt_==e.getUint32(12,!1))){var r=e.getUint32(16,!0),o=20;switch(r){case 16:case 18:t.channels=e.getUint16(o+2,!0),t.sampleRate=e.getUint32(o+4,!0);break;default:throw"extended fmt chunk not implemented"}o+=r;for(var s=Yr.data,a=0;s!=n&&(n=e.getUint32(o,!1),a=e.getUint32(o+4,!0),s!=n);)o+=a+8;return t.dataLen=a,t.dataOffset=o+8,t}};var OV=RV,Qw={exports:{}};(function(e){function t(i,c){if(c=c||{},i=r(i),i===null)throw new TypeError("Invalid AudioData");var l=!!(c.floatingPoint||c.float),f=l?32:c.bitDepth|0||16,d=f>>3,m=i.length*i.numberOfChannels*d,v=new DataView(new Uint8Array(44+m).buffer),_=a(v),y={floatingPoint:l,numberOfChannels:i.numberOfChannels,sampleRate:i.sampleRate,bitDepth:f};o(_,y,v.buffer.byteLength-8);var k=s(_,y,m,i,c);if(k instanceof Error)throw k;return v.buffer}function n(i,c){return new Promise(function(l){l(t(i,c))})}function r(i){var c={};return typeof i.sampleRate!="number"||!Array.isArray(i.channelData)||!(i.channelData[0]instanceof Float32Array)?null:(c.numberOfChannels=i.channelData.length,c.length=i.channelData[0].length|0,c.sampleRate=i.sampleRate|0,c.channelData=i.channelData,c)}function o(i,c,l){var f=c.bitDepth>>3;i.string("RIFF"),i.uint32(l),i.string("WAVE"),i.string("fmt "),i.uint32(16),i.uint16(c.floatingPoint?3:1),i.uint16(c.numberOfChannels),i.uint32(c.sampleRate),i.uint32(c.sampleRate*c.numberOfChannels*f),i.uint16(c.numberOfChannels*f),i.uint16(c.bitDepth)}function s(i,c,l,f,d){var m=c.bitDepth,v=c.floatingPoint?"f":d.symmetric?"s":"",_="pcm"+m+v;if(!i[_])return new TypeError("Not supported bit depth: "+m);var y=i[_].bind(i),k=c.numberOfChannels,g=f.channelData;i.string("data"),i.uint32(l);for(var b=0,h=f.length;b<h;b++)for(var S=0;S<k;S++)y(g[S][b])}function a(i){var c=0;return{int16:function(l){i.setInt16(c,l,!0),c+=2},uint16:function(l){i.setUint16(c,l,!0),c+=2},uint32:function(l){i.setUint32(c,l,!0),c+=4},string:function(l){for(var f=0,d=l.length;f<d;f++)i.setUint8(c++,l.charCodeAt(f))},pcm8:function(l){l=Math.max(-1,Math.min(l,1)),l=(l*.5+.5)*255,l=Math.round(l)|0,i.setUint8(c,l,!0),c+=1},pcm8s:function(l){l=Math.round(l*128)+128,l=Math.max(0,Math.min(l,255)),i.setUint8(c,l,!0),c+=1},pcm16:function(l){l=Math.max(-1,Math.min(l,1)),l=l<0?l*32768:l*32767,l=Math.round(l)|0,i.setInt16(c,l,!0),c+=2},pcm16s:function(l){l=Math.round(l*32768),l=Math.max(-32768,Math.min(l,32767)),i.setInt16(c,l,!0),c+=2},pcm24:function(l){l=Math.max(-1,Math.min(l,1)),l=l<0?16777216+l*8388608:l*8388607,l=Math.round(l)|0;var f=l>>0&255,d=l>>8&255,m=l>>16&255;i.setUint8(c+0,f),i.setUint8(c+1,d),i.setUint8(c+2,m),c+=3},pcm24s:function(l){l=Math.round(l*8388608),l=Math.max(-8388608,Math.min(l,8388607));var f=l>>0&255,d=l>>8&255,m=l>>16&255;i.setUint8(c+0,f),i.setUint8(c+1,d),i.setUint8(c+2,m),c+=3},pcm32:function(l){l=Math.max(-1,Math.min(l,1)),l=l<0?l*2147483648:l*2147483647,l=Math.round(l)|0,i.setInt32(c,l,!0),c+=4},pcm32s:function(l){l=Math.round(l*2147483648),l=Math.max(-2147483648,Math.min(l,2147483647)),i.setInt32(c,l,!0),c+=4},pcm32f:function(l){i.setFloat32(c,l,!0),c+=4}}}e.exports.encode=n,e.exports.encode.sync=t})(Qw);var PV=Qw.exports;const BV=async e=>{const t=new OV(e.numberOfChannels,e.sampleRate,128),n=[],[r,o]=[e.getChannelData(0),e.getChannelData(1)],s=new Int16Array(r.length),a=new Int16Array(o.length),i=Math.max(Qe.max(r.map(f=>Math.abs(f)))??0,Qe.max(o.map(f=>Math.abs(f)))??0);for(let f=0;f<r.length;f++)s[f]=r[f]/i*32767.5,a[f]=o[f]/i*32767.5;const c=1152;for(let f=0;f<s.length;f+=c){const d=s.subarray(f,f+c),m=a.subarray(f,f+c),v=t.encodeBuffer(d,m);v.length>0&&n.push(v)}const l=t.flush();return l.length>0&&n.push(l),DV(n)};function DV(e){const t=e.reduce((o,s)=>o+s.length,0),n=new Uint8Array(t);let r=0;for(const o of e)n.set(o,r),r+=o.length;return n}const NV=async e=>{const t=await PV.encode({sampleRate:e.sampleRate,channelData:[e.getChannelData(0),e.getChannelData(1)]});return new Uint8Array(t)};function B1(){return{get openExportProgressDialog(){return Oe(Cp)},get progress(){return Oe(Jw)},get exportSong(){return FV()},setOpenExportProgressDialog:xe(Cp),cancelExport:xe(LV)}}const Cp=me(!1),Jw=me(0),Tp=me(!1),LV=me(null,(e,t)=>{t(Tp,!0)}),zV=()=>new Promise(e=>window.requestAnimationFrame(()=>e())),FV=()=>{const{synth:e}=Ht(),{updateEndOfSong:t,getSong:n,timebase:r}=_t(),o=er(),s=A_(),a=xe(Cp),i=xe(Jw),c=xe(Tp),l=mr();return async f=>{var v;if(t(),!WV(n())){await s.show({title:o.export,message:o["export-error-too-short"],actions:[{title:"OK",key:"ok"}]});return}const d=(v=e.loadedSoundFont)==null?void 0:v.data;if(d===void 0)return;const m=44100;c(!1),a(!0),i(0);try{const _=await GA(d,n().allEvents,r,m,{bufferSize:128,cancel:()=>l.get(Tp),waitForEventLoop:zV,onProgress:(b,h)=>i(b/h)});i(1);const y=$V(f),k=await y.encode(_),g=new Blob([k],{type:y.mimeType});a(!1),US(g,"song."+y.ext)}catch(_){console.warn(_)}}},WV=e=>e.allEvents.some(t=>t.tick>=120),$V=e=>{switch(e){case"WAV":return{encode:NV,ext:"wav",mimeType:"audio/wav"};case"MP3":return{encode:BV,ext:"mp3",mimeType:"audio/mp3"}}},VV=J.progress`
  width: 100%;
  -moz-appearance: none;
  -webkit-appearance: none;
  background: var(--color-background-secondary);

  &::-webkit-progress-bar {
    background: var(--color-background-secondary);
    border-radius: 0.25rem;
    height: 0.5rem;
  }

  &::-webkit-progress-value {
    background: var(--color-theme);
    border-radius: 0.25rem;
    height: 100%;
  }

  /* Firefox */
  border: none;
  border-radius: 0.25rem;
  height: 0.5rem;
  box-sizing: border-box;

  &::-moz-progress-bar {
    background: var(--color-theme);
    border-radius: 0.25rem;
    height: 100%;
  }
`,jV=()=>{const{openExportProgressDialog:e,setOpenExportProgressDialog:t,progress:n,cancelExport:r}=B1(),o=p.useCallback(()=>{t(!1),r()},[t,r]);return G(hn,{open:e,style:{minWidth:"20rem"},children:[u(bn,{children:u(N,{name:"exporting-audio"})}),u(qt,{children:u(VV,{value:n,max:1})}),u(gn,{children:u(Et,{onClick:o,children:u(N,{name:"cancel"})})})]})},HV=()=>{const{filepath:e,name:t,isSaved:n}=_t(),r=p.useMemo(()=>e.length>0?e:t.length>0?t:"New song",[e,t]);return u(s5,{children:u("title",{children:`${r}${n?"":" *"} - signal`})})},UV=J.div`
  display: flex;
  align-items: center;
  margin-bottom: 0.5rem;

  span {
    margin: 0 0.3em;
  }
`,GV=J.div`
  display: inline-block;
  border: 1px solid white;
  border-radius: 4px;
  padding: 0.1em 0.5em 0.2em 0.5em;
  background: var(--color-text);
  color: var(--color-background);
  box-shadow: inset 0 -2px 0 0px #0000006b;
`,XV=J.div`
  margin-left: 1em;
`,jt=({hotKeys:e,text:t})=>G(UV,{children:[e.map((n,r)=>n.map((o,s)=>u(GV,{children:o},r*1e4+s)).reduce((o,s)=>[o,u("span",{children:"+"},"plus"),s])).reduce((n,r)=>[n,u("span",{children:"/"},"slash"),r]),u(XV,{children:t})]}),KV=()=>{const{openHelpDialog:e,setOpenHelpDialog:t}=Ln(),n=()=>t(!1);return G(hn,{open:e,onOpenChange:n,children:[u(bn,{children:u(N,{name:"help"})}),G(qt,{children:[u("h3",{children:u(N,{name:"keyboard-shortcut"})}),u(jt,{hotKeys:[[ut.altOrOption,"N"]],text:u(N,{name:"new-song"})}),u(jt,{hotKeys:[[ut.cmdOrCtrl,"O"]],text:u(N,{name:"open-song"})}),u(jt,{hotKeys:[[ut.cmdOrCtrl,"S"]],text:u(N,{name:"save-song"})}),u(jt,{hotKeys:[[ut.cmdOrCtrl,"Shift","S"]],text:u(N,{name:"save-as"})}),u(jt,{hotKeys:[["Space"]],text:u(N,{name:"play-pause"})}),u(jt,{hotKeys:[["Enter"]],text:u(N,{name:"stop"})}),u(jt,{hotKeys:[["A"],["D"]],text:u(N,{name:"forward-rewind"})}),u(jt,{hotKeys:[["R"]],text:u(N,{name:"start-stop-recording"})}),u(jt,{hotKeys:[["S"],["W"]],text:u(N,{name:"next-previous-track"})}),u(jt,{hotKeys:[["N"],["M"],[","]],text:u(N,{name:"solo-mute-ghost"})}),u(jt,{hotKeys:[["T"]],text:u(N,{name:"transpose"})}),u(jt,{hotKeys:[["1"]],text:u(N,{name:"pencil-tool"})}),u(jt,{hotKeys:[["2"]],text:u(N,{name:"selection-tool"})}),u(jt,{hotKeys:[[""],[""]],text:u(N,{name:"move-selection"})}),u(jt,{hotKeys:[[""],[""]],text:u(N,{name:"select-note"})}),u(jt,{hotKeys:[[ut.cmdOrCtrl,"1"],[ut.cmdOrCtrl,"2"],[ut.cmdOrCtrl,"3"]],text:u(N,{name:"switch-tab"})}),u(jt,{hotKeys:[[ut.cmdOrCtrl,""],[ut.cmdOrCtrl,""]],text:u(N,{name:"scroll-vertically"})}),u(jt,{hotKeys:[[ut.cmdOrCtrl,""],[ut.cmdOrCtrl,""]],text:u(N,{name:"scroll-horizontally"})}),u(jt,{hotKeys:[[ut.cmdOrCtrl,"Z"]],text:u(N,{name:"undo"})}),u(jt,{hotKeys:[[ut.cmdOrCtrl,"Y"],[ut.cmdOrCtrl,"Shift","Z"]],text:u(N,{name:"redo"})}),u(jt,{hotKeys:[[ut.cmdOrCtrl,"C"]],text:u(N,{name:"copy-selection"})}),u(jt,{hotKeys:[["Delete"],["Backspace"]],text:u(N,{name:"delete-selection"})}),u(jt,{hotKeys:[[ut.cmdOrCtrl,"X"]],text:u(N,{name:"cut-selection"})}),u(jt,{hotKeys:[[ut.cmdOrCtrl,"V"]],text:u(N,{name:"paste-selection"})}),u(jt,{hotKeys:[[ut.cmdOrCtrl,"A"]],text:u(N,{name:"select-all"})}),u(jt,{hotKeys:[["?"]],text:u(N,{name:"open-help"})})]}),u(gn,{children:u(Et,{onClick:n,children:u(N,{name:"close"})})})]})};function YV(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var ju=YV(p),qV=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ZV=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},wb=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=ZV(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return ju.createElement("svg",qV({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),ju.createElement("path",{d:"M17,12V3A1,1 0 0,0 16,2H3A1,1 0 0,0 2,3V17L6,13H16A1,1 0 0,0 17,12M21,6H19V15H6V17A1,1 0 0,0 7,18H18L22,22V7A1,1 0 0,0 21,6Z"}))},QV=ju.memo?ju.memo(wb):wb,JV=QV;const ej=yt(JV);function tj(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var Hu=tj(p),nj=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},rj=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},xb=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=rj(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return Hu.createElement("svg",nj({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),Hu.createElement("path",{d:"M15.07,11.25L14.17,12.17C13.45,12.89 13,13.5 13,15H11V14.5C11,13.39 11.45,12.39 12.17,11.67L13.41,10.41C13.78,10.05 14,9.55 14,9C14,7.89 13.1,7 12,7A2,2 0 0,0 10,9H8A4,4 0 0,1 12,5A4,4 0 0,1 16,9C16,9.88 15.64,10.67 15.07,11.25M13,19H11V17H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12C22,6.47 17.5,2 12,2Z"}))},oj=Hu.memo?Hu.memo(xb):xb,sj=oj;const aj=yt(sj);function ij(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var Uu=ij(p),cj=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},lj=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},Cb=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=lj(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return Uu.createElement("svg",cj({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),Uu.createElement("path",{d:"M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"}))},uj=Uu.memo?Uu.memo(Cb):Cb,dj=uj;const fj=yt(dj),hj=e=>p.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:128,height:128,...e},p.createElement("path",{fillRule:"evenodd",d:"M32 22.5h64c5.523 0 10 4.477 10 10v64c0 5.523-4.477 10-10 10H32c-5.523 0-10-4.477-10-10v-64c0-5.523 4.477-10 10-10m-16 10c0-8.837 7.163-16 16-16h64c8.837 0 16 7.163 16 16v64c0 8.837-7.163 16-16 16H32c-8.837 0-16-7.163-16-16zm57.694 28H54.306v8h19.388zM64 40.5h32v8H64zm0 40H32v8h32z",clipRule:"evenodd"})),pj=e=>p.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:128,height:128,...e},p.createElement("path",{fillRule:"evenodd",d:"M72 22H56v50h-4v34h26V72h-6zm12 50v34h12c5.523 0 10-4.477 10-10V32c0-5.523-4.477-10-10-10h-8v50zm0 40H32c-8.837 0-16-7.163-16-16V32c0-8.837 7.163-16 16-16h64c8.837 0 16 7.163 16 16v64c0 8.837-7.163 16-16 16zM40 72h6v34H32c-5.523 0-10-4.477-10-10V32c0-5.523 4.477-10 10-10h8z",clipRule:"evenodd"})),mj=e=>p.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:128,height:128,...e},p.createElement("path",{fillRule:"evenodd",d:"M106 64c0 23.196-18.804 42-42 42S22 87.196 22 64s18.804-42 42-42 42 18.804 42 42m6 0c0 26.51-21.49 48-48 48S16 90.51 16 64s21.49-48 48-48 48 21.49 48 48M67 40a3 3 0 1 0-6 0v25.243L77.879 82.12a3 3 0 1 0 4.242-4.242L67 62.757z",clipRule:"evenodd"})),gj=({trigger:e})=>{const{selectedNoteIds:t,setOpenTransposeDialog:n,setOpenVelocityDialog:r}=Me(),{hasUndo:o,hasRedo:s,undo:a,redo:i}=ht(),c=vi(),l=Vd(),f=bi(),d=jd(),m=Xm(),v=Um(),_=Gm(),y=Hd(),k=Zc(),g=t.length>0,[b,h]=p.useState(!1),S=p.useCallback(()=>h(!1),[]),x=p.useCallback(()=>{S(),a()},[S,a]),w=p.useCallback(()=>{S(),i()},[S,i]),I=p.useCallback(async()=>{S(),await c(),f()},[S,c,f]),M=p.useCallback(async()=>{S(),await c()},[S,c]),H=p.useCallback(async()=>{S(),await l()},[S,l]),j=p.useCallback(async()=>{S(),f()},[S,f]),W=p.useCallback(()=>{S(),m()},[S,m]),A=p.useCallback(()=>{S(),d()},[S,d]),L=p.useCallback(()=>{S(),v()},[S,v]),B=p.useCallback(()=>{S(),_()},[S,_]),P=p.useCallback(()=>{S(),y()},[S,y]),V=p.useCallback(()=>{S(),k(12)},[S,k]),U=p.useCallback(()=>{S(),k(-12)},[S,k]),X=p.useCallback(()=>{S(),n(!0)},[S,n]),te=p.useCallback(()=>{S(),r(!0)},[S,r]);return G(Qc,{open:b,onOpenChange:h,trigger:e,children:[G(We,{onClick:x,disabled:!o,children:[u(N,{name:"undo"}),G(yn,{children:[ut.cmdOrCtrl,"+Z"]})]}),G(We,{onClick:w,disabled:!s,children:[u(N,{name:"redo"}),G(yn,{children:[ut.cmdOrCtrl,"+Shift+Z"]})]}),u(qn,{}),G(We,{onClick:I,disabled:!g,children:[u(N,{name:"cut"}),G(yn,{children:[ut.cmdOrCtrl,"+X"]})]}),G(We,{onClick:M,disabled:!g,children:[u(N,{name:"copy"}),G(yn,{children:[ut.cmdOrCtrl,"+C"]})]}),G(We,{onClick:H,children:[u(N,{name:"paste"}),G(yn,{children:[ut.cmdOrCtrl,"+V"]})]}),G(We,{onClick:j,disabled:!g,children:[u(N,{name:"delete"}),u(yn,{children:"Delete"})]}),G(We,{onClick:A,disabled:!g,children:[u(N,{name:"duplicate"}),G(yn,{children:[ut.cmdOrCtrl,"+D"]})]}),u(qn,{}),G(We,{onClick:W,children:[u(N,{name:"select-all"}),G(yn,{children:[ut.cmdOrCtrl,"+A"]})]}),G(We,{onClick:L,disabled:!g,children:[u(N,{name:"select-next"}),u(yn,{children:""})]}),G(We,{onClick:B,disabled:!g,children:[u(N,{name:"select-previous"}),u(yn,{children:""})]}),u(qn,{}),G(We,{onClick:V,disabled:!g,children:[u(N,{name:"one-octave-up"}),u(yn,{children:"Shift+"})]}),G(We,{onClick:U,disabled:!g,children:[u(N,{name:"one-octave-down"}),u(yn,{children:"Shift+"})]}),G(We,{onClick:X,disabled:!g,children:[u(N,{name:"transpose"}),u(yn,{children:"T"})]}),u(qn,{}),G(We,{onClick:P,disabled:!g,children:[u(N,{name:"quantize"}),u(yn,{children:"Q"})]}),u(We,{onClick:te,disabled:!g,children:u(N,{name:"velocity"})})]})},vj=()=>u(gj,{trigger:G(qr,{id:"tab-edit",children:[u("span",{style:{marginLeft:"0.25rem"},children:u(N,{name:"edit"})}),u(o1,{style:{width:"1rem",marginLeft:"0.25rem"}})]})});function bj(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var Gu=bj(p),_j=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},yj=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},Tb=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=yj(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return Gu.createElement("svg",_j({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),Gu.createElement("path",{d:"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"}))},Sj=Gu.memo?Gu.memo(Tb):Tb,kj=Sj;const wj=yt(kj);function xj(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var Xu=xj(p),Cj=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Tj=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},Mb=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=Tj(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return Xu.createElement("svg",Cj({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),Xu.createElement("path",{d:"M6.5 20Q4.22 20 2.61 18.43 1 16.85 1 14.58 1 12.63 2.17 11.1 3.35 9.57 5.25 9.15 5.88 6.85 7.75 5.43 9.63 4 12 4 14.93 4 16.96 6.04 19 8.07 19 11 20.73 11.2 21.86 12.5 23 13.78 23 15.5 23 17.38 21.69 18.69 20.38 20 18.5 20M6.5 18H18.5Q19.55 18 20.27 17.27 21 16.55 21 15.5 21 14.45 20.27 13.73 19.55 13 18.5 13H17V11Q17 8.93 15.54 7.46 14.08 6 12 6 9.93 6 8.46 7.46 7 8.93 7 11H6.5Q5.05 11 4.03 12.03 3 13.05 3 14.5 3 15.95 4.03 17 5.05 18 6.5 18M12 12Z"}))},Mj=Xu.memo?Xu.memo(Mb):Mb,Ej=Mj;const Ij=yt(Ej),Aj=({close:e})=>{const{cloudSongId:t,isSaved:n}=_t(),r=t!==null,{createNewSong:o,openSong:s,saveSong:a,saveAsSong:i,renameSong:c,importSong:l,importSongLegacy:f,exportSong:d,publishSong:m}=nf();return G(Ke,{children:[u(We,{onClick:async()=>{e(),await o()},children:u(N,{name:"new-song"})}),u(qn,{}),u(We,{onClick:async()=>{e(),await s()},children:u(N,{name:"open-song"})}),u(We,{onClick:async()=>{e(),await a()},disabled:n,children:u(N,{name:"save-song"})}),u(We,{onClick:async()=>{e(),await i()},disabled:!r,children:u(N,{name:"save-as"})}),u(We,{onClick:async()=>{e(),await c()},disabled:!r,children:u(N,{name:"rename"})}),u(qn,{}),!Rr&&u(Zm,{onChange:async w=>{e(),await f(w)},children:u(We,{children:u(N,{name:"import-midi"})})}),Rr&&u(We,{onClick:async()=>{e(),await l()},children:u(N,{name:"import-midi"})}),u(We,{onClick:async()=>{e(),await d()},children:u(N,{name:"export-midi"})}),u(qn,{}),u(We,{onClick:async()=>{e(),await m()},disabled:!r,children:u(N,{name:"publish"})})]})},Rj=({close:e})=>{const{fileHandle:t}=_t(),{createNewSong:n,openSong:r,saveSong:o,saveAsSong:s,downloadSong:a}=Gd(),i=async()=>{e(),await n()},c=async()=>{e(),await r()},l=async()=>{e(),await o()},f=async()=>{e(),await s()},d=async()=>{e(),await a()};return G(Ke,{children:[G(We,{onClick:i,children:[u(N,{name:"new-song"}),G(yn,{children:[ut.altOrOption,"+N"]})]}),u(qn,{}),G(We,{onClick:c,children:[u(N,{name:"open-song"}),G(yn,{children:[ut.cmdOrCtrl,"+O"]})]}),G(We,{onClick:l,disabled:t===null,children:[u(N,{name:"save-song"}),G(yn,{children:[ut.cmdOrCtrl,"+S"]})]}),G(We,{onClick:f,children:[u(N,{name:"save-as"}),G(yn,{children:[ut.cmdOrCtrl,"+Shift+S"]})]}),u(We,{onClick:d,children:u(N,{name:"download-midi"})})]})},Oj=()=>{const{authUser:e}=Gc(),{setOpenSignInDialog:t}=Ln(),{exportSong:n}=B1(),r=$t(),[o,s]=p.useState(!1),a=p.useCallback(()=>s(!1),[]),i=p.useCallback(()=>{a(),n("WAV")},[a,n]),c=p.useCallback(()=>{a(),n("MP3")},[a,n]);return G(Qc,{open:o,onOpenChange:s,trigger:G(qr,{id:"tab-file",children:[u("span",{style:{marginLeft:"0.25rem"},children:u(N,{name:"file"})}),u(o1,{style:{width:"1rem",marginLeft:"0.25rem"}})]}),children:[e===null&&Rr&&u(Rj,{close:a}),e===null&&!Rr&&u(NP,{close:a}),e&&u(Aj,{close:a}),e===null&&G(Ke,{children:[u(qn,{}),G(We,{onClick:()=>{a(),t(!0)},children:[u(Ij,{style:{marginRight:"0.5em"}}),u(N,{name:"please-sign-up"})]})]}),u(qn,{}),G(DP,{trigger:G(We,{children:[u(N,{name:"export"}),u(wj,{style:{marginLeft:"auto",fill:r.tertiaryTextColor}})]}),children:[u(We,{onClick:i,children:"WAV"}),u(We,{onClick:c,children:"MP3"})]})]})},Pj=()=>{const{authUser:e,signOut:t}=Gc(),{setOpenSignInDialog:n,setOpenUserSettingsDialog:r}=Ln(),[o,s]=p.useState(!1),a=()=>{$n()?window.electronAPI.openAuthWindow():n(!0),s(!1)},i=async()=>{await t(),s(!1)},c=()=>{e!==null&&window.open(`https://signalmidi.app/users/${e.uid}`),s(!1)},l=()=>{r(!0)},f=$t(),d=p.useRef(null);return e===null?G(qr,{onClick:a,children:[u(a5,{style:Ho}),u(jo,{children:u(N,{name:"sign-in"})})]}):G(Qc,{open:o,onOpenChange:s,trigger:G(qr,{ref:d,children:[u("img",{style:{...Ho,borderRadius:"0.65rem",border:`1px solid ${f.dividerColor}`},src:e.photoURL??void 0}),u(jo,{children:e.displayName})]}),children:[u(We,{onClick:c,children:u(N,{name:"profile"})}),u(We,{onClick:l,children:u(N,{name:"user-settings"})}),u(We,{onClick:i,children:u(N,{name:"sign-out"})})]})},Bj=J.div`
  display: flex;
  flex-direction: row;
  background: var(--color-background-dark);
  height: 3rem;
  flex-shrink: 0;
  -webkit-app-region: drag;
  padding: ${()=>{if($n())switch(P6()){case"Windows":return"0 0 0 0";case"macOS":return"0 0 0 76px"}}};
`,qr=J.div`
  display: flex;
  flex-direction: row;
  align-items: center; 
  padding: 0.5rem 1rem;
  font-size: 0.75rem;
  border-top: solid 0.1rem transparent;
  color: var(--color-text-secondary);
  cursor: pointer;
  -webkit-app-region: none;

  &.active {
    color: var(--color-text);
    background: var(--color-background);
    border-top-color: var(--color-theme);
  }

  &:hover {
    background: var(--color-highlight);
  }

  a {
    color: inherit;
    text-decoration: none;
  }
}
`,jo=J.span`
  margin-left: 0.5rem;

  @media (max-width: 850px) {
    display: none;
  }
`,Dj=J.div`
  flex-grow: 1;
`,Ho={width:"1.3rem",height:"1.3rem",fill:"currentColor"},Nj=()=>{const{setOpenSettingDialog:e,setOpenHelpDialog:t}=Ln(),{path:n,setPath:r}=ds(),o=p.useCallback(l=>{l.preventDefault(),r("/track")},[r]),s=p.useCallback(l=>{l.preventDefault(),r("/arrange")},[r]),a=p.useCallback(l=>{l.preventDefault(),r("/tempo")},[r]),i=p.useCallback(l=>{l.preventDefault(),e(!0)},[e]),c=p.useCallback(l=>{l.preventDefault(),t(!0)},[t]);return G(Bj,{children:[!$n()&&u(Oj,{}),!$n()&&u(vj,{}),u(dr,{title:G(Ke,{children:[u(N,{name:"switch-tab"})," [",ut.cmdOrCtrl,"+1]"]}),delayDuration:500,children:G(qr,{className:n==="/track"?"active":void 0,onMouseDown:o,children:[u(pj,{style:Ho,viewBox:"0 0 128 128"}),u(jo,{children:u(N,{name:"piano-roll"})})]})}),u(dr,{title:G(Ke,{children:[u(N,{name:"switch-tab"})," [",ut.cmdOrCtrl,"+2]"]}),delayDuration:500,children:G(qr,{className:n==="/arrange"?"active":void 0,onMouseDown:s,children:[u(hj,{style:Ho,viewBox:"0 0 128 128"}),u(jo,{children:u(N,{name:"arrange"})})]})}),u(dr,{title:G(Ke,{children:[u(N,{name:"switch-tab"})," [",ut.cmdOrCtrl,"+3]"]}),delayDuration:500,children:G(qr,{className:n==="/tempo"?"active":void 0,onMouseDown:a,children:[u(mj,{style:Ho,viewBox:"0 0 128 128"}),u(jo,{children:u(N,{name:"tempo"})})]})}),u(Dj,{}),!$n()&&G(Ke,{children:[G(qr,{onClick:i,children:[u(fj,{style:Ho}),u(jo,{children:u(N,{name:"settings"})})]}),G(qr,{onClick:c,children:[u(aj,{style:Ho}),u(jo,{children:u(N,{name:"help"})})]}),G(qr,{children:[u(ej,{style:Ho}),u(jo,{children:u("a",{href:"",target:"_blank",rel:"noreferrer",children:"Discord"})})]})]}),u(Pj,{})]})},Lj=()=>{const{getSong:e}=_t(),t=er();return p.useEffect(()=>{const n=r=>{if(!e().isSaved){const o=t["confirm-close"];$n()?(r.returnValue=!1,r.preventDefault(),window.electronAPI.showMessageBox({type:"question",message:o,buttons:[t.close,t.cancel]}).then(s=>{s===0&&window.electronAPI.closeMainWindow()})):r.returnValue=o}};return window.addEventListener("beforeunload",n),()=>{window.removeEventListener("beforeunload",n)}},[]),u(Ke,{})},zj=({open:e,onClose:t})=>{const{restoreAutoSave:n,onUserExplicitAction:r,getLastSaveTime:o}=Ao(),s=o(),a=p.useCallback(()=>{n(),t()},[n,t]),i=p.useCallback(()=>{r(),t()},[r,t]);return G(hn,{open:e,onOpenChange:t,children:[u(bn,{children:u(N,{name:"auto-save-dialog-title"})}),G(qt,{children:[u(N,{name:"auto-save-dialog-description"}),s&&G("p",{children:[u(N,{name:"auto-save-dialog-last-save-time"})," ",(l=>l.toLocaleString())(s)]})]}),G(gn,{children:[u(Et,{onClick:i,children:u(N,{name:"auto-save-dialog-delete"})}),u(xo,{onClick:a,children:u(N,{name:"auto-save-dialog-restore"})})]})]})},Fj=({open:e,message:t,onClose:n})=>G(hn,{open:e,onOpenChange:n,children:[u(bn,{children:u(N,{name:"initialize-error"})}),u(qt,{children:t}),u(gn,{children:u(Et,{onClick:n,children:u(N,{name:"close"})})})]}),Wj=()=>{const e=Ht(),t=Ro(),n=yz(),[r,o]=p.useState(!1),[s,a]=p.useState(""),[i,c]=p.useState(!1),{show:l}=R_(),f=er(),{shouldShowAutoSaveDialog:d}=Ao(),m=async()=>{const k=l(f.initializing);try{await e.init()}catch(g){o(!0),a(g.message)}finally{k()}},v=async()=>{const g=new URLSearchParams(window.location.search).get("open");if(g){const b=l(f["loading-external-midi"]);try{const h=await n(g);t(h)}catch(h){o(!0),a(h.message)}finally{b()}}},_=async()=>{if(!$n())return;const k=l(f["loading-file"]);try{const g=await window.electronAPI.getArgument();if(g){const b=await window.electronAPI.readFile(g),h=ku(b,g);t(h)}}catch(g){o(!0),a(g.message)}finally{k()}},y=async()=>{if(!new URLSearchParams(window.location.search).get("open")){if($n())try{if(await window.electronAPI.getArgument())return}catch{}d()&&c(!0)}};return p.useEffect(()=>{(async()=>(await m(),await v(),await _(),await y()))()},[]),G(Ke,{children:[u(Fj,{open:r,message:s,onClose:()=>o(!1)}),u(zj,{open:i,onClose:()=>c(!1)})]})};function D1(){return{get events(){const{selectedTrackId:e,selectedNoteIds:t}=Me(),{events:n}=wt(e);return On(()=>t.length>0?n.filter(r=>t.indexOf(r.id)>=0):ks(n),[n,t],Qe.isEqual)},get isOpen(){return Oe(Eb)},setOpen:xe(Eb)}}const Eb=me(!1),Nl=24,$j=()=>{const{setMouseMode:e,scrollBy:t}=Me(),n=Xm(),r=KO(),o=YO(),s=qO(),a=ZO(),i=QO(),c=p.useMemo(()=>[{code:"ArrowUp",metaKey:!0,run:()=>t(0,Nl)},{code:"ArrowDown",metaKey:!0,run:()=>t(0,-Nl)},{code:"ArrowRight",metaKey:!0,run:()=>t(-Nl,0)},{code:"ArrowLeft",metaKey:!0,run:()=>t(Nl,0)},{code:"Digit1",run:()=>e("pencil")},{code:"Digit2",run:()=>e("selection")},{code:"KeyA",metaKey:!0,run:n},{code:"KeyS",run:r},{code:"KeyW",run:o},{code:"KeyN",run:s},{code:"KeyM",run:a},{code:"Comma",run:i}],[t,e,n,r,o,s,a,i]);return _i({actions:c})};function Ib(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Mp(e,t){return Mp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},Mp(e,t)}function Vj(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Mp(e,t)}var Ab=Number.isNaN||function(t){return typeof t=="number"&&t!==t};function jj(e,t){return!!(e===t||Ab(e)&&Ab(t))}function Hj(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!jj(e[n],t[n]))return!1;return!0}function yh(e,t){t===void 0&&(t=Hj);var n,r=[],o,s=!1;function a(){for(var i=[],c=0;c<arguments.length;c++)i[c]=arguments[c];return s&&n===this&&t(i,r)||(o=e.apply(this,i),s=!0,n=this,r=i),o}return a}var Uj=typeof performance=="object"&&typeof performance.now=="function",Rb=Uj?function(){return performance.now()}:function(){return Date.now()};function Ob(e){cancelAnimationFrame(e.id)}function Gj(e,t){var n=Rb();function r(){Rb()-n>=t?e.call(null):o.id=requestAnimationFrame(r)}var o={id:requestAnimationFrame(r)};return o}var Sh=-1;function Pb(e){if(e===void 0&&(e=!1),Sh===-1||e){var t=document.createElement("div"),n=t.style;n.width="50px",n.height="50px",n.overflow="scroll",document.body.appendChild(t),Sh=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return Sh}var la=null;function Bb(e){if(e===void 0&&(e=!1),la===null||e){var t=document.createElement("div"),n=t.style;n.width="50px",n.height="50px",n.overflow="scroll",n.direction="rtl";var r=document.createElement("div"),o=r.style;return o.width="100px",o.height="100px",t.appendChild(r),document.body.appendChild(t),t.scrollLeft>0?la="positive-descending":(t.scrollLeft=1,t.scrollLeft===0?la="negative":la="positive-ascending"),document.body.removeChild(t),la}return la}var Xj=150,Kj=function(t,n){return t};function Yj(e){var t,n=e.getItemOffset,r=e.getEstimatedTotalSize,o=e.getItemSize,s=e.getOffsetForIndexAndAlignment,a=e.getStartIndexForOffset,i=e.getStopIndexForStartIndex,c=e.initInstanceProps,l=e.shouldResetStyleCacheOnItemSizeChange,f=e.validateProps;return t=function(d){Vj(m,d);function m(_){var y;return y=d.call(this,_)||this,y._instanceProps=c(y.props,Ib(y)),y._outerRef=void 0,y._resetIsScrollingTimeoutId=null,y.state={instance:Ib(y),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof y.props.initialScrollOffset=="number"?y.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},y._callOnItemsRendered=void 0,y._callOnItemsRendered=yh(function(k,g,b,h){return y.props.onItemsRendered({overscanStartIndex:k,overscanStopIndex:g,visibleStartIndex:b,visibleStopIndex:h})}),y._callOnScroll=void 0,y._callOnScroll=yh(function(k,g,b){return y.props.onScroll({scrollDirection:k,scrollOffset:g,scrollUpdateWasRequested:b})}),y._getItemStyle=void 0,y._getItemStyle=function(k){var g=y.props,b=g.direction,h=g.itemSize,S=g.layout,x=y._getItemStyleCache(l&&h,l&&S,l&&b),w;if(x.hasOwnProperty(k))w=x[k];else{var I=n(y.props,k,y._instanceProps),M=o(y.props,k,y._instanceProps),H=b==="horizontal"||S==="horizontal",j=b==="rtl",W=H?I:0;x[k]=w={position:"absolute",left:j?void 0:W,right:j?W:void 0,top:H?0:I,height:H?"100%":M,width:H?M:"100%"}}return w},y._getItemStyleCache=void 0,y._getItemStyleCache=yh(function(k,g,b){return{}}),y._onScrollHorizontal=function(k){var g=k.currentTarget,b=g.clientWidth,h=g.scrollLeft,S=g.scrollWidth;y.setState(function(x){if(x.scrollOffset===h)return null;var w=y.props.direction,I=h;if(w==="rtl")switch(Bb()){case"negative":I=-h;break;case"positive-descending":I=S-b-h;break}return I=Math.max(0,Math.min(I,S-b)),{isScrolling:!0,scrollDirection:x.scrollOffset<I?"forward":"backward",scrollOffset:I,scrollUpdateWasRequested:!1}},y._resetIsScrollingDebounced)},y._onScrollVertical=function(k){var g=k.currentTarget,b=g.clientHeight,h=g.scrollHeight,S=g.scrollTop;y.setState(function(x){if(x.scrollOffset===S)return null;var w=Math.max(0,Math.min(S,h-b));return{isScrolling:!0,scrollDirection:x.scrollOffset<w?"forward":"backward",scrollOffset:w,scrollUpdateWasRequested:!1}},y._resetIsScrollingDebounced)},y._outerRefSetter=function(k){var g=y.props.outerRef;y._outerRef=k,typeof g=="function"?g(k):g!=null&&typeof g=="object"&&g.hasOwnProperty("current")&&(g.current=k)},y._resetIsScrollingDebounced=function(){y._resetIsScrollingTimeoutId!==null&&Ob(y._resetIsScrollingTimeoutId),y._resetIsScrollingTimeoutId=Gj(y._resetIsScrolling,Xj)},y._resetIsScrolling=function(){y._resetIsScrollingTimeoutId=null,y.setState({isScrolling:!1},function(){y._getItemStyleCache(-1,null)})},y}m.getDerivedStateFromProps=function(y,k){return qj(y,k),f(y),null};var v=m.prototype;return v.scrollTo=function(y){y=Math.max(0,y),this.setState(function(k){return k.scrollOffset===y?null:{scrollDirection:k.scrollOffset<y?"forward":"backward",scrollOffset:y,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},v.scrollToItem=function(y,k){k===void 0&&(k="auto");var g=this.props,b=g.itemCount,h=g.layout,S=this.state.scrollOffset;y=Math.max(0,Math.min(y,b-1));var x=0;if(this._outerRef){var w=this._outerRef;h==="vertical"?x=w.scrollWidth>w.clientWidth?Pb():0:x=w.scrollHeight>w.clientHeight?Pb():0}this.scrollTo(s(this.props,y,k,S,this._instanceProps,x))},v.componentDidMount=function(){var y=this.props,k=y.direction,g=y.initialScrollOffset,b=y.layout;if(typeof g=="number"&&this._outerRef!=null){var h=this._outerRef;k==="horizontal"||b==="horizontal"?h.scrollLeft=g:h.scrollTop=g}this._callPropsCallbacks()},v.componentDidUpdate=function(){var y=this.props,k=y.direction,g=y.layout,b=this.state,h=b.scrollOffset,S=b.scrollUpdateWasRequested;if(S&&this._outerRef!=null){var x=this._outerRef;if(k==="horizontal"||g==="horizontal")if(k==="rtl")switch(Bb()){case"negative":x.scrollLeft=-h;break;case"positive-ascending":x.scrollLeft=h;break;default:var w=x.clientWidth,I=x.scrollWidth;x.scrollLeft=I-w-h;break}else x.scrollLeft=h;else x.scrollTop=h}this._callPropsCallbacks()},v.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&Ob(this._resetIsScrollingTimeoutId)},v.render=function(){var y=this.props,k=y.children,g=y.className,b=y.direction,h=y.height,S=y.innerRef,x=y.innerElementType,w=y.innerTagName,I=y.itemCount,M=y.itemData,H=y.itemKey,j=H===void 0?Kj:H,W=y.layout,A=y.outerElementType,L=y.outerTagName,B=y.style,P=y.useIsScrolling,V=y.width,U=this.state.isScrolling,X=b==="horizontal"||W==="horizontal",te=X?this._onScrollHorizontal:this._onScrollVertical,Y=this._getRangeToRender(),R=Y[0],E=Y[1],C=[];if(I>0)for(var O=R;O<=E;O++)C.push(p.createElement(k,{data:M,key:j(O,M),index:O,isScrolling:P?U:void 0,style:this._getItemStyle(O)}));var $=r(this.props,this._instanceProps);return p.createElement(A||L||"div",{className:g,onScroll:te,ref:this._outerRefSetter,style:l4({position:"relative",height:h,width:V,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:b},B)},p.createElement(x||w||"div",{children:C,ref:S,style:{height:X?"100%":$,pointerEvents:U?"none":void 0,width:X?$:"100%"}}))},v._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var y=this.props.itemCount;if(y>0){var k=this._getRangeToRender(),g=k[0],b=k[1],h=k[2],S=k[3];this._callOnItemsRendered(g,b,h,S)}}if(typeof this.props.onScroll=="function"){var x=this.state,w=x.scrollDirection,I=x.scrollOffset,M=x.scrollUpdateWasRequested;this._callOnScroll(w,I,M)}},v._getRangeToRender=function(){var y=this.props,k=y.itemCount,g=y.overscanCount,b=this.state,h=b.isScrolling,S=b.scrollDirection,x=b.scrollOffset;if(k===0)return[0,0,0,0];var w=a(this.props,x,this._instanceProps),I=i(this.props,w,x,this._instanceProps),M=!h||S==="backward"?Math.max(1,g):1,H=!h||S==="forward"?Math.max(1,g):1;return[Math.max(0,w-M),Math.max(0,Math.min(k-1,I+H)),w,I]},m}(p.PureComponent),t.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},t}var qj=function(t,n){t.children,t.direction,t.height,t.layout,t.innerTagName,t.outerTagName,t.width,n.instance},Zj=Yj({getItemOffset:function(t,n){var r=t.itemSize;return n*r},getItemSize:function(t,n){var r=t.itemSize;return r},getEstimatedTotalSize:function(t){var n=t.itemCount,r=t.itemSize;return r*n},getOffsetForIndexAndAlignment:function(t,n,r,o,s,a){var i=t.direction,c=t.height,l=t.itemCount,f=t.itemSize,d=t.layout,m=t.width,v=i==="horizontal"||d==="horizontal",_=v?m:c,y=Math.max(0,l*f-_),k=Math.min(y,n*f),g=Math.max(0,n*f-_+f+a);switch(r==="smart"&&(o>=g-_&&o<=k+_?r="auto":r="center"),r){case"start":return k;case"end":return g;case"center":{var b=Math.round(g+(k-g)/2);return b<Math.ceil(_/2)?0:b>y+Math.floor(_/2)?y:b}case"auto":default:return o>=g&&o<=k?o:o<g?g:k}},getStartIndexForOffset:function(t,n){var r=t.itemCount,o=t.itemSize;return Math.max(0,Math.min(r-1,Math.floor(n/o)))},getStopIndexForStartIndex:function(t,n,r){var o=t.direction,s=t.height,a=t.itemCount,i=t.itemSize,c=t.layout,l=t.width,f=o==="horizontal"||c==="horizontal",d=n*i,m=f?l:s,v=Math.ceil((m+r-d)/i);return Math.max(0,Math.min(a-1,n+v-1))},initInstanceProps:function(t){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(t){t.itemSize}}),Qj=i5;function Jj(e,t){return Qj(e,t)}var eH=Jj;const Ep=yt(eH),tH=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function nH(e){const t=Math.floor(e/12)-1,n=e%12;return`${tH[n]}${t}`}function rH(e){return Ch[e]}function oH(e){switch(e.type){case"channel":switch(e.subtype){case"controller":return{name:rH(e.controllerType)??`CC${e.controllerType}`,value:{type:"number",value:e.value.toFixed(0),update:ua(0,127,t=>({value:t}))}};case"note":return{name:"Note",value:{type:"number",value:e.velocity.toFixed(0),update:ua(1,127,t=>({velocity:t}))},gate:{type:"number",value:e.duration.toFixed(0),update:ua(0,1/0,t=>({duration:t}))}};case"programChange":return{name:"Program Change",value:{type:"number",value:e.value.toFixed(0),update:ua(0,127,t=>({value:t}))}};case"pitchBend":return{name:"Pitch Bend",value:{type:"number",value:e.value.toFixed(0),update:ua(0,16384,t=>({value:t}))}};default:return{name:e.subtype}}case"meta":switch(e.subtype){case"trackName":return{name:"Track Name",value:{type:"text",value:e.text,update:t=>({text:t})}};case"midiChannelPrefix":return{name:"MIDI Channel Prefix",value:{type:"number",value:e.value.toFixed(0),update:ua(0,127,t=>({channel:t}))}};case"setTempo":return{name:"Tempo",value:{type:"number",value:fm(e.microsecondsPerBeat).toFixed(3),update:Qe.flow(parseInt,t3(1,512),$a,Math.floor,e3,n3(t=>({microsecondsPerBeat:t})))}};default:return{name:e.subtype}}case"dividedSysEx":case"sysEx":return{name:e.type};default:return{name:"Unknown"}}}const e3=e=>Number.isNaN(e)?null:e,t3=(e,t)=>n=>Qe.clamp(n,e,t),n3=e=>t=>t===null?null:e(t),ua=(e,t,n)=>Qe.flow(parseInt,t3(e,t),e3,n3(n)),sH=J.input`
  width: 100%;
  display: block;
  background: transparent;
  border: none;
  color: inherit;
  -webkit-appearance: none;
  font-size: inherit;
  font-family: var(--font-mono);
  outline: none;

  /* Hide spin button on Firefox */
  -moz-appearance: textfield;

  &::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
`,kh=({value:e,type:t,onChange:n})=>{const[r,o]=p.useState(!1),[s,a]=p.useState(""),i=p.useCallback(()=>{n(s)},[s,n]),c=p.useCallback(l=>{var f,d,m,v;if(l.key==="Enter"){const _=Array.from(((v=(m=(d=(f=l.currentTarget)==null?void 0:f.parentElement)==null?void 0:d.parentElement)==null?void 0:m.parentElement)==null?void 0:v.querySelectorAll("input"))??[]).filter(g=>!g.disabled),y=_.indexOf(l.currentTarget),k=_[y+1];k==null||k.focus(),k==null||k.select(),l.preventDefault()}l.key==="Escape"&&l.currentTarget.blur(),(l.key==="Enter"||l.key==="Tab")&&i()},[i]);return u(sH,{type:t,value:r?s:e,onFocus:p.useCallback(()=>{o(!0),a(e)},[e]),onBlur:p.useCallback(()=>{o(!1),i()},[i]),onChange:p.useCallback(l=>{r&&a(l.target.value)},[r]),disabled:e===null,onKeyDown:c})},aH=(e,t)=>Ep(e.item,t.item)&&Ep(e.style,t.style)&&e.onClick===t.onClick,iH=it.memo(({item:e,style:t,onClick:n})=>{const{selectedTrackId:r}=Me(),{removeEvent:o,updateEvent:s}=wt(r),a=oH(e),i=p.useCallback(d=>{o(d.id)},[o]),c=p.useCallback(d=>{const m=parseInt(d);isNaN(m)||s(e.id,{tick:Math.max(0,m)})},[s,e]),l=p.useCallback(d=>{if(a.gate===void 0)return;const m=a.gate.update(d);m!==null&&s(e.id,m)},[a,s,e]),f=p.useCallback(d=>{if(a.value===void 0)return;const m=a.value.update(d);m!==null&&s(e.id,m)},[a,s,e]);return G(r3,{style:t,onClick:p.useCallback(d=>n(d,e),[e,n]),onKeyDown:p.useCallback(d=>{d.target===d.currentTarget&&(d.key==="Delete"||d.key==="Backspace")&&(i(e),d.stopPropagation())},[e,i]),tabIndex:-1,children:[u(Xo,{children:u(kh,{value:e.tick.toFixed(0),type:"number",onChange:c})}),u(Xo,{style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:a.name}),u(Xo,{children:a.gate!==void 0&&u(kh,{...a.gate,onChange:l})}),u(Xo,{children:a.value!==void 0&&u(kh,{...a.value,onChange:f})})]})},aH),cH=J.div`
  width: 100%;
  height: 100%;
`,lH=J.div`
  height: var(--size-ruler-height);
  border-bottom: 1px solid var(--color-divider);
  /* scroll bar width */
  padding-right: 14px;
`,r3=J.div`
  display: grid;
  outline: none;
  grid-template-columns: 5em 1fr 5em 5em;

  &:focus {
    background: var(--color-highlight);
  }
`,Xo=J.div`
  padding: 0.5rem;

  &:focus-within {
    background: var(--color-highlight);
  }
`,uH=()=>{const{events:e}=D1(),t=p.useRef(null),n=zr(t);return G(cH,{ref:t,children:[u(lH,{children:G(r3,{children:[u(Xo,{children:u(N,{name:"tick"})}),u(Xo,{children:u(N,{name:"event"})}),u(Xo,{children:u(N,{name:"duration"})}),u(Xo,{children:u(N,{name:"value"})})]})}),u(Zj,{height:n.height-Vt.rulerHeight,itemCount:e.length,itemSize:35,width:n.width,itemData:{events:e},itemKey:r=>e[r].id,children:dH})]})},dH=({index:e,style:t,data:n})=>{const{events:r,setSelectedEventIds:o}=n,s=r[e],a=p.useCallback((i,c)=>{i.ctrlKey||i.metaKey?o==null||o(l=>[...l,c.id]):o==null||o([c.id])},[o]);return u(iH,{style:t,item:s,onClick:a},s.id)},ul=e=>Math.floor(e/8),N1=["","","","","","","","","","","","","","","",""];function L1(){const{selectedTrackId:e}=Me(),[t,n]=em(fH),r=xe(Db),{isRhythmTrack:o,channel:s,setChannel:a}=wt(e),{isPlaying:i,sendEvent:c}=Lt(),l=jO(e),{tracks:f}=_t(),{previewNoteOn:d}=$d(),m=p.useCallback(y=>{if(y!==o){if(y)a(9);else if(o){const k=Qe.range(16),g=f.filter(h=>h.id!==e).map(h=>h.channel),b=Math.min(...Qe.difference(k,g).filter(Mo))||0;a(b)}n({programNumber:0,isRhythmTrack:y}),l(0)}},[o,e,a,f,n,l]),v=p.useCallback(()=>{l(t.programNumber),r(!1)},[l,t,r]),_=o?0:ul(t.programNumber);return{setting:t,setSetting:n,get isOpen(){return Oe(Db)},setOpen:r,selectedCategoryIndex:_,get categoryFirstProgramEvents(){return p.useMemo(()=>t.isRhythmTrack?[0]:Qe.range(0,127,8),[t.isRhythmTrack])},get categoryInstruments(){return p.useMemo(()=>{if(t.isRhythmTrack)return[0,8,16,24,25,32,40,48,56];const y=_*8;return Qe.range(y,y+8)},[_,t.isRhythmTrack])},onChangeInstrument:p.useCallback(y=>{s!==void 0&&(c(xd(0,s,y)),i||(t.isRhythmTrack?d(38,500):d(64,500)),n({programNumber:y,isRhythmTrack:t.isRhythmTrack}))},[n,t,s,d,c,i]),onChangeRhythmTrack:p.useCallback(y=>{m(y)},[m]),onClickOK:v}}const Db=me(!1),fH=me({isRhythmTrack:!1,programNumber:0}),hH=({programNumber:e})=>{switch(e){case 0:return u(N,{name:"Acoustic Grand Piano"});case 1:return u(N,{name:"Bright Acoustic Piano"});case 2:return u(N,{name:"Electric Grand Piano"});case 3:return u(N,{name:"Honky-tonk Piano"});case 4:return u(N,{name:"Electric Piano 1"});case 5:return u(N,{name:"Electric Piano 2"});case 6:return u(N,{name:"Harpsichord"});case 7:return u(N,{name:"Clavinet"});case 8:return u(N,{name:"Celesta"});case 9:return u(N,{name:"Glockenspiel"});case 10:return u(N,{name:"Music Box"});case 11:return u(N,{name:"Vibraphone"});case 12:return u(N,{name:"Marimba"});case 13:return u(N,{name:"Xylophone"});case 14:return u(N,{name:"Tubular Bells"});case 15:return u(N,{name:"Dulcimer"});case 16:return u(N,{name:"Drawbar Organ"});case 17:return u(N,{name:"Percussive Organ"});case 18:return u(N,{name:"Rock Organ"});case 19:return u(N,{name:"Church Organ"});case 20:return u(N,{name:"Reed Organ"});case 21:return u(N,{name:"Accordion"});case 22:return u(N,{name:"Harmonica"});case 23:return u(N,{name:"Tango Accordion"});case 24:return u(N,{name:"Acoustic Guitar (nylon)"});case 25:return u(N,{name:"Acoustic Guitar (steel)"});case 26:return u(N,{name:"Electric Guitar (jazz)"});case 27:return u(N,{name:"Electric Guitar (clean)"});case 28:return u(N,{name:"Electric Guitar (muted)"});case 29:return u(N,{name:"Overdriven Guitar"});case 30:return u(N,{name:"Distortion Guitar"});case 31:return u(N,{name:"Guitar Harmonics"});case 32:return u(N,{name:"Acoustic Bass"});case 33:return u(N,{name:"Electric Bass (finger)"});case 34:return u(N,{name:"Electric Bass (pick)"});case 35:return u(N,{name:"Fretless Bass"});case 36:return u(N,{name:"Slap Bass 1"});case 37:return u(N,{name:"Slap Bass 2"});case 38:return u(N,{name:"Synth Bass 1"});case 39:return u(N,{name:"Synth Bass 2"});case 40:return u(N,{name:"Violin"});case 41:return u(N,{name:"Viola"});case 42:return u(N,{name:"Cello"});case 43:return u(N,{name:"Contrabass"});case 44:return u(N,{name:"Tremolo Strings"});case 45:return u(N,{name:"Pizzicato Strings"});case 46:return u(N,{name:"Orchestral Harp"});case 47:return u(N,{name:"Timpani"});case 48:return u(N,{name:"String Ensemble 1"});case 49:return u(N,{name:"String Ensemble 2"});case 50:return u(N,{name:"Synth Strings 1"});case 51:return u(N,{name:"Synth Strings 2"});case 52:return u(N,{name:"Choir Aahs"});case 53:return u(N,{name:"Voice Oohs"});case 54:return u(N,{name:"Synth Choir"});case 55:return u(N,{name:"Orchestra Hit"});case 56:return u(N,{name:"Trumpet"});case 57:return u(N,{name:"Trombone"});case 58:return u(N,{name:"Tuba"});case 59:return u(N,{name:"Muted Trumpet"});case 60:return u(N,{name:"French Horn"});case 61:return u(N,{name:"Brass Section"});case 62:return u(N,{name:"Synth Brass 1"});case 63:return u(N,{name:"Synth Brass 2"});case 64:return u(N,{name:"Soprano Sax"});case 65:return u(N,{name:"Alto Sax"});case 66:return u(N,{name:"Tenor Sax"});case 67:return u(N,{name:"Baritone Sax"});case 68:return u(N,{name:"Oboe"});case 69:return u(N,{name:"English Horn"});case 70:return u(N,{name:"Bassoon"});case 71:return u(N,{name:"Clarinet"});case 72:return u(N,{name:"Piccolo"});case 73:return u(N,{name:"Flute"});case 74:return u(N,{name:"Recorder"});case 75:return u(N,{name:"Pan Flute"});case 76:return u(N,{name:"Blown Bottle"});case 77:return u(N,{name:"Shakuhachi"});case 78:return u(N,{name:"Whistle"});case 79:return u(N,{name:"Ocarina"});case 80:return u(N,{name:"Lead 1 (square)"});case 81:return u(N,{name:"Lead 2 (sawtooth)"});case 82:return u(N,{name:"Lead 3 (calliope)"});case 83:return u(N,{name:"Lead 4 (chiff)"});case 84:return u(N,{name:"Lead 5 (charang)"});case 85:return u(N,{name:"Lead 6 (voice)"});case 86:return u(N,{name:"Lead 7 (fifths)"});case 87:return u(N,{name:"Lead 8 (bass + lead)"});case 88:return u(N,{name:"Pad 1 (new age)"});case 89:return u(N,{name:"Pad 2 (warm)"});case 90:return u(N,{name:"Pad 3 (polysynth)"});case 91:return u(N,{name:"Pad 4 (choir)"});case 92:return u(N,{name:"Pad 5 (bowed)"});case 93:return u(N,{name:"Pad 6 (metallic)"});case 94:return u(N,{name:"Pad 7 (halo)"});case 95:return u(N,{name:"Pad 8 (sweep)"});case 96:return u(N,{name:"FX 1 (rain)"});case 97:return u(N,{name:"FX 2 (soundtrack)"});case 98:return u(N,{name:"FX 3 (crystal)"});case 99:return u(N,{name:"FX 4 (atmosphere)"});case 100:return u(N,{name:"FX 5 (brightness)"});case 101:return u(N,{name:"FX 6 (goblins)"});case 102:return u(N,{name:"FX 7 (echoes)"});case 103:return u(N,{name:"FX 8 (sci-fi)"});case 104:return u(N,{name:"Sitar"});case 105:return u(N,{name:"Banjo"});case 106:return u(N,{name:"Shamisen"});case 107:return u(N,{name:"Koto"});case 108:return u(N,{name:"Kalimba"});case 109:return u(N,{name:"Bagpipe"});case 110:return u(N,{name:"Fiddle"});case 111:return u(N,{name:"Shanai"});case 112:return u(N,{name:"Tinkle Bell"});case 113:return u(N,{name:"Agogo"});case 114:return u(N,{name:"Steel Drums"});case 115:return u(N,{name:"Woodblock"});case 116:return u(N,{name:"Taiko Drum"});case 117:return u(N,{name:"Melodic Tom"});case 118:return u(N,{name:"Synth Drum"});case 119:return u(N,{name:"Reverse Cymbal"});case 120:return u(N,{name:"Guitar Fret Noise"});case 121:return u(N,{name:"Breath Noise"});case 122:return u(N,{name:"Seashore"});case 123:return u(N,{name:"Bird Tweet"});case 124:return u(N,{name:"Telephone Ring"});case 125:return u(N,{name:"Helicopter"});case 126:return u(N,{name:"Applause"});case 127:return u(N,{name:"Gunshot"})}return u(Ke,{})},pH=({programNumber:e})=>{switch(e){case 0:return u(N,{name:"Standard Drum Kit"});case 8:return u(N,{name:"Room Drum Kit"});case 16:return u(N,{name:"Power Drum Kit"});case 24:return u(N,{name:"Electronic Drum Kit"});case 25:return u(N,{name:"Analog Drum Kit"});case 32:return u(N,{name:"Jazz Drum Kit"});case 40:return u(N,{name:"Brush Drum Kit"});case 48:return u(N,{name:"Orchestra Drum Kit"});case 56:return u(N,{name:"SFX Drum Kit"});default:return u(Ke,{})}},z1=({isRhythmTrack:e,programNumber:t})=>e?u(pH,{programNumber:t}):u(hH,{programNumber:t}),mH=({programNumber:e})=>{switch(ul(e)){case 0:return u(N,{name:"Piano"});case 1:return u(N,{name:"Chromatic Percussion"});case 2:return u(N,{name:"Organ"});case 3:return u(N,{name:"Guitar"});case 4:return u(N,{name:"Bass"});case 5:return u(N,{name:"Strings"});case 6:return u(N,{name:"Ensemble"});case 7:return u(N,{name:"Brass"});case 8:return u(N,{name:"Reed"});case 9:return u(N,{name:"Pipe"});case 10:return u(N,{name:"Synth Lead"});case 11:return u(N,{name:"Synth Pad"});case 12:return u(N,{name:"Synth Effects"});case 13:return u(N,{name:"Ethnic"});case 14:return u(N,{name:"Percussive"});case 15:return u(N,{name:"Sound Effects"})}return u(Ke,{})},gH=({programNumber:e})=>{const t=N1[ul(e)];return G(Ke,{children:[t," ",u(mH,{programNumber:e})]})},vH=()=>G(Ke,{children:[" ",u(N,{name:"Drum Kits"})]}),bH=J.div`
  overflow: auto;
  background-color: var(--color-background-dark);
  border: 1px solid var(--color-divider);
  max-height: 22rem;
  flex-grow: 1;
  display: flex;
  flex-direction: column;

  &:focus {
    outline: var(--color-theme) 1px solid;
  }
`,_H=J.div`
  padding: 0.5em 1em;
  flex-shrink: 0;
  font-size: 0.9rem;
  height: 2rem;
  box-sizing: border-box;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  user-select: none;

  &.checked {
    background: var(--color-theme);
  }
`,yH=({checked:e,onClick:t,children:n})=>u(_H,{className:e?"checked":"",onClick:t,children:n}),Nb=({items:e,selectedValue:t,onChange:n})=>u(bH,{onKeyDown:o=>{const s=e.findIndex(a=>a.value===t);switch(o.key){case"ArrowUp":s>0&&n(e[s-1].value),o.preventDefault(),o.stopPropagation();break;case"ArrowDown":s<e.length-1&&n(e[s+1].value),o.preventDefault(),o.stopPropagation();break}},tabIndex:0,children:e.map((o,s)=>u(yH,{checked:o.value===t,onClick:()=>n(o.value),children:o.label},s))}),SH=J.div`
  display: flex;
`,kH=J.div`
  width: 15rem;
  display: flex;
  flex-direction: column;
`,wH=J.div`
  width: 21rem;
  display: flex;
  flex-direction: column;
  overflow: hidden;
`,xH=J.div`
  margin-top: 1rem;
`,CH=()=>{const{isOpen:e,setOpen:t,setting:{programNumber:n,isRhythmTrack:r},selectedCategoryIndex:o,categoryFirstProgramEvents:s,categoryInstruments:a,onChangeInstrument:i,onClickOK:c,onChangeRhythmTrack:l}=L1(),f=s.map((m,v)=>({value:v,label:r?u(vH,{}):u(gH,{programNumber:m})})),d=a.map(m=>({value:m,label:u(z1,{programNumber:m,isRhythmTrack:r})}));return G(hn,{open:e,onOpenChange:t,children:[G(qt,{className:"InstrumentBrowser",children:[G(SH,{children:[G(kH,{children:[u(so,{style:{marginBottom:"0.5rem"},children:u(N,{name:"categories"})}),u(Nb,{items:f,selectedValue:o,onChange:m=>i(m*8)})]}),G(wH,{children:[u(so,{style:{marginBottom:"0.5rem"},children:u(N,{name:"instruments"})}),u(Nb,{items:d,selectedValue:n,onChange:i})]})]}),u(xH,{children:u(wc,{checked:r,onCheckedChange:m=>l(m===!0),label:u(N,{name:"rhythm-track"})})})]}),G(gn,{children:[u(Et,{onClick:()=>t(!1),children:u(N,{name:"cancel"})}),u(xo,{onClick:c,children:u(N,{name:"ok"})})]})]})};function TH(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var Ku=TH(p),MH=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},EH=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},Lb=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=EH(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return Ku.createElement("svg",MH({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),Ku.createElement("path",{d:"M14,7L9,12L14,17V7Z"}))},IH=Ku.memo?Ku.memo(Lb):Lb,AH=IH;const RH=yt(AH),OH=J.button`
  -webkit-appearance: none;
  border: none;
  outline: none;
  height: 2rem;
  background: none;
  color: inherit;
  cursor: pointer;

  &:hover {
    background: none;
    color: var(--color-text-secondary);
  }
`,PH=({isOpen:e})=>u(RH,{style:{transition:"transform 0.1s ease",transform:`scale(1.4) rotateZ(${e?"0deg":"-90deg"})`}}),BH=()=>{const{isOpen:e,setOpen:t}=Ud(),n=p.useCallback(()=>t(o=>!o),[t]),r=p.useRef(null);return u(Ke,{children:u(OH,{ref:r,tabIndex:-1,onMouseDown:o=>{o.preventDefault(),n()},children:u(PH,{isOpen:e})})})};function DH(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var Yu=DH(p),NH=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},LH=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},zb=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=LH(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return Yu.createElement("svg",NH({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),Yu.createElement("path",{d:"M7,5H21V7H7V5M7,13V11H21V13H7M4,4.5A1.5,1.5 0 0,1 5.5,6A1.5,1.5 0 0,1 4,7.5A1.5,1.5 0 0,1 2.5,6A1.5,1.5 0 0,1 4,4.5M4,10.5A1.5,1.5 0 0,1 5.5,12A1.5,1.5 0 0,1 4,13.5A1.5,1.5 0 0,1 2.5,12A1.5,1.5 0 0,1 4,10.5M7,19V17H21V19H7M4,16.5A1.5,1.5 0 0,1 5.5,18A1.5,1.5 0 0,1 4,19.5A1.5,1.5 0 0,1 2.5,18A1.5,1.5 0 0,1 4,16.5Z"}))},zH=Yu.memo?Yu.memo(zb):zb,FH=zH;const WH=yt(FH),$H=()=>{const{setOpen:e,isOpen:t}=D1();return u(dr,{title:u(N,{name:"event-list"}),children:u(t1,{selected:t,onMouseDown:p.useCallback(n=>{n.preventDefault(),e(r=>!r)},[e]),children:u(WH,{style:{width:"1.2rem",fill:"currentColor"}})})})},VH=()=>{const{selectedTrackId:e}=Me(),{isRhythmTrack:t,programNumber:n}=wt(e),{setSetting:r,setOpen:o}=L1(),s=p.useCallback(()=>{r({isRhythmTrack:t,programNumber:n}),o(!0)},[t,n,o,r]),a=t?"":N1[ul(n??0)];return G(t1,{onMouseDown:i=>{i.preventDefault(),s()},children:[u("span",{style:{marginRight:"0.5rem"},children:a}),u("span",{children:u(z1,{programNumber:n,isRhythmTrack:t})})]})},Fb=64;function jH(){const{selectedTrack:e,selectedTrackId:t}=Me(),{position:n,sendEvent:r}=Lt(),{pushHistory:o}=ht(),{setPan:s,channel:a}=wt(t),[i,c]=p.useState(!1),l=On(()=>e==null?void 0:e.getPan(n),[e,n]),f=p.useCallback(d=>{i||o(),s(d,n),a!==void 0&&r(xy(0,a,d))},[o,s,n,r,a,i]);return{value:l??Fb,setValue:f,defaultValue:Fb,onPointerDown:p.useCallback(()=>{o(),c(!0)},[o]),onPointerUp:p.useCallback(()=>{c(!1)},[])}}function o3(e,[t,n]){return Math.min(n,Math.max(t,e))}var s3=["PageUp","PageDown"],a3=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],i3={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Ti="Slider",[Ip,HH,UH]=c5(Ti),[c3]=fd(Ti,[UH]),[GH,df]=c3(Ti),l3=p.forwardRef((e,t)=>{const{name:n,min:r=0,max:o=100,step:s=1,orientation:a="horizontal",disabled:i=!1,minStepsBetweenThumbs:c=0,defaultValue:l=[r],value:f,onValueChange:d=()=>{},onValueCommit:m=()=>{},inverted:v=!1,form:_,...y}=e,k=p.useRef(new Set),g=p.useRef(0),h=a==="horizontal"?XH:KH,[S=[],x]=pd({prop:f,defaultProp:l,onChange:W=>{var L;(L=[...k.current][g.current])==null||L.focus(),d(W)}}),w=p.useRef(S);function I(W){const A=JH(S,W);j(W,A)}function M(W){j(W,g.current)}function H(){const W=w.current[g.current];S[g.current]!==W&&m(S)}function j(W,A,{commit:L}={commit:!1}){const B=rU(s),P=oU(Math.round((W-r)/s)*s+r,B),V=o3(P,[r,o]);x((U=[])=>{const X=ZH(U,V,A);if(nU(X,c*s)){g.current=X.indexOf(V);const te=String(X)!==String(U);return te&&L&&m(X),te?X:U}else return U})}return Fe.jsx(GH,{scope:e.__scopeSlider,name:n,disabled:i,min:r,max:o,valueIndexToChangeRef:g,thumbs:k.current,values:S,orientation:a,form:_,children:Fe.jsx(Ip.Provider,{scope:e.__scopeSlider,children:Fe.jsx(Ip.Slot,{scope:e.__scopeSlider,children:Fe.jsx(h,{"aria-disabled":i,"data-disabled":i?"":void 0,...y,ref:t,onPointerDown:Jt(y.onPointerDown,()=>{i||(w.current=S)}),min:r,max:o,inverted:v,onSlideStart:i?void 0:I,onSlideMove:i?void 0:M,onSlideEnd:i?void 0:H,onHomeKeyDown:()=>!i&&j(r,0,{commit:!0}),onEndKeyDown:()=>!i&&j(o,S.length-1,{commit:!0}),onStepKeyDown:({event:W,direction:A})=>{if(!i){const P=s3.includes(W.key)||W.shiftKey&&a3.includes(W.key)?10:1,V=g.current,U=S[V],X=s*P*A;j(U+X,V,{commit:!0})}}})})})})});l3.displayName=Ti;var[u3,d3]=c3(Ti,{startEdge:"left",endEdge:"right",size:"width",direction:1}),XH=p.forwardRef((e,t)=>{const{min:n,max:r,dir:o,inverted:s,onSlideStart:a,onSlideMove:i,onSlideEnd:c,onStepKeyDown:l,...f}=e,[d,m]=p.useState(null),v=tr(t,h=>m(h)),_=p.useRef(void 0),y=l5(o),k=y==="ltr",g=k&&!s||!k&&s;function b(h){const S=_.current||d.getBoundingClientRect(),x=[0,S.width],I=F1(x,g?[n,r]:[r,n]);return _.current=S,I(h-S.left)}return Fe.jsx(u3,{scope:e.__scopeSlider,startEdge:g?"left":"right",endEdge:g?"right":"left",direction:g?1:-1,size:"width",children:Fe.jsx(f3,{dir:y,"data-orientation":"horizontal",...f,ref:v,style:{...f.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:h=>{const S=b(h.clientX);a==null||a(S)},onSlideMove:h=>{const S=b(h.clientX);i==null||i(S)},onSlideEnd:()=>{_.current=void 0,c==null||c()},onStepKeyDown:h=>{const x=i3[g?"from-left":"from-right"].includes(h.key);l==null||l({event:h,direction:x?-1:1})}})})}),KH=p.forwardRef((e,t)=>{const{min:n,max:r,inverted:o,onSlideStart:s,onSlideMove:a,onSlideEnd:i,onStepKeyDown:c,...l}=e,f=p.useRef(null),d=tr(t,f),m=p.useRef(void 0),v=!o;function _(y){const k=m.current||f.current.getBoundingClientRect(),g=[0,k.height],h=F1(g,v?[r,n]:[n,r]);return m.current=k,h(y-k.top)}return Fe.jsx(u3,{scope:e.__scopeSlider,startEdge:v?"bottom":"top",endEdge:v?"top":"bottom",size:"height",direction:v?1:-1,children:Fe.jsx(f3,{"data-orientation":"vertical",...l,ref:d,style:{...l.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:y=>{const k=_(y.clientY);s==null||s(k)},onSlideMove:y=>{const k=_(y.clientY);a==null||a(k)},onSlideEnd:()=>{m.current=void 0,i==null||i()},onStepKeyDown:y=>{const g=i3[v?"from-bottom":"from-top"].includes(y.key);c==null||c({event:y,direction:g?-1:1})}})})}),f3=p.forwardRef((e,t)=>{const{__scopeSlider:n,onSlideStart:r,onSlideMove:o,onSlideEnd:s,onHomeKeyDown:a,onEndKeyDown:i,onStepKeyDown:c,...l}=e,f=df(Ti,n);return Fe.jsx(pr.span,{...l,ref:t,onKeyDown:Jt(e.onKeyDown,d=>{d.key==="Home"?(a(d),d.preventDefault()):d.key==="End"?(i(d),d.preventDefault()):s3.concat(a3).includes(d.key)&&(c(d),d.preventDefault())}),onPointerDown:Jt(e.onPointerDown,d=>{const m=d.target;m.setPointerCapture(d.pointerId),d.preventDefault(),f.thumbs.has(m)?m.focus():r(d)}),onPointerMove:Jt(e.onPointerMove,d=>{d.target.hasPointerCapture(d.pointerId)&&o(d)}),onPointerUp:Jt(e.onPointerUp,d=>{const m=d.target;m.hasPointerCapture(d.pointerId)&&(m.releasePointerCapture(d.pointerId),s(d))})})}),h3="SliderTrack",p3=p.forwardRef((e,t)=>{const{__scopeSlider:n,...r}=e,o=df(h3,n);return Fe.jsx(pr.span,{"data-disabled":o.disabled?"":void 0,"data-orientation":o.orientation,...r,ref:t})});p3.displayName=h3;var Ap="SliderRange",m3=p.forwardRef((e,t)=>{const{__scopeSlider:n,...r}=e,o=df(Ap,n),s=d3(Ap,n),a=p.useRef(null),i=tr(t,a),c=o.values.length,l=o.values.map(m=>b3(m,o.min,o.max)),f=c>1?Math.min(...l):0,d=100-Math.max(...l);return Fe.jsx(pr.span,{"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,...r,ref:i,style:{...e.style,[s.startEdge]:f+"%",[s.endEdge]:d+"%"}})});m3.displayName=Ap;var Rp="SliderThumb",g3=p.forwardRef((e,t)=>{const n=HH(e.__scopeSlider),[r,o]=p.useState(null),s=tr(t,i=>o(i)),a=p.useMemo(()=>r?n().findIndex(i=>i.ref.current===r):-1,[n,r]);return Fe.jsx(YH,{...e,ref:s,index:a})}),YH=p.forwardRef((e,t)=>{const{__scopeSlider:n,index:r,name:o,...s}=e,a=df(Rp,n),i=d3(Rp,n),[c,l]=p.useState(null),f=tr(t,b=>l(b)),d=c?a.form||!!c.closest("form"):!0,m=E_(c),v=a.values[r],_=v===void 0?0:b3(v,a.min,a.max),y=QH(r,a.values.length),k=m==null?void 0:m[i.size],g=k?eU(k,_,i.direction):0;return p.useEffect(()=>{if(c)return a.thumbs.add(c),()=>{a.thumbs.delete(c)}},[c,a.thumbs]),Fe.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[i.startEdge]:`calc(${_}% + ${g}px)`},children:[Fe.jsx(Ip.ItemSlot,{scope:e.__scopeSlider,children:Fe.jsx(pr.span,{role:"slider","aria-label":e["aria-label"]||y,"aria-valuemin":a.min,"aria-valuenow":v,"aria-valuemax":a.max,"aria-orientation":a.orientation,"data-orientation":a.orientation,"data-disabled":a.disabled?"":void 0,tabIndex:a.disabled?void 0:0,...s,ref:f,style:v===void 0?{display:"none"}:e.style,onFocus:Jt(e.onFocus,()=>{a.valueIndexToChangeRef.current=r})})}),d&&Fe.jsx(v3,{name:o??(a.name?a.name+(a.values.length>1?"[]":""):void 0),form:a.form,value:v},r)]})});g3.displayName=Rp;var qH="RadioBubbleInput",v3=p.forwardRef(({__scopeSlider:e,value:t,...n},r)=>{const o=p.useRef(null),s=tr(o,r),a=xk(t);return p.useEffect(()=>{const i=o.current;if(!i)return;const c=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(c,"value").set;if(a!==t&&f){const d=new Event("input",{bubbles:!0});f.call(i,t),i.dispatchEvent(d)}},[a,t]),Fe.jsx(pr.input,{style:{display:"none"},...n,ref:s,defaultValue:t})});v3.displayName=qH;function ZH(e=[],t,n){const r=[...e];return r[n]=t,r.sort((o,s)=>o-s)}function b3(e,t,n){const s=100/(n-t)*(e-t);return o3(s,[0,100])}function QH(e,t){return t>2?`Value ${e+1} of ${t}`:t===2?["Minimum","Maximum"][e]:void 0}function JH(e,t){if(e.length===1)return 0;const n=e.map(o=>Math.abs(o-t)),r=Math.min(...n);return n.indexOf(r)}function eU(e,t,n){const r=e/2,s=F1([0,50],[0,r]);return(r-s(t)*n)*n}function tU(e){return e.slice(0,-1).map((t,n)=>e[n+1]-t)}function nU(e,t){if(t>0){const n=tU(e);return Math.min(...n)>=t}return!0}function F1(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const r=(t[1]-t[0])/(e[1]-e[0]);return t[0]+r*(n-e[0])}}function rU(e){return(String(e).split(".")[1]||"").length}function oU(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}var sU=l3,aU=p3,iU=m3,cU=g3;const lU=J(sU)`
  position: relative;
  display: flex;
  flex-grow: 1;
  align-items: center;
  user-select: none;
  touch-action: none;
  height: 2rem;
`,uU=J(aU)`
  background-color: var(--color-text-tertiary);
  position: relative;
  flex-grow: 1;
  border-radius: 9999px;
  height: 0.1rem;
`,dU=J(iU)`
  position: absolute;
  background-color: var(--color-text);
  border-radius: 9999px;
  height: 100%;
`,fU=J(cU)`
  display: block;
  width: 0.75rem;
  height: 0.75rem;
  background-color: var(--color-text);
  box-shadow: 0 0.1rem 1rem var(--color-shadow);
  border-radius: 999px;

  &:hover {
    background-color: var(--color-text-secondary);
  }

  &:focus {
    outline: none;
  }
`,hU=J.div`
  width: 0.1rem;
  height: 100%;
  position: absolute;
  background-color: var(--color-text);
`,_3=({value:e,onChange:t,defaultValue:n,marks:r,...o})=>G(lU,{value:[e],defaultValue:n!==void 0?[n]:void 0,onValueChange:s=>t(s[0]),...o,children:[G(uU,{children:[u(dU,{}),r==null?void 0:r.map((s,a)=>u(hU,{style:{left:`${s/(o.max??100)*100}%`}},a))]}),u(fU,{tabIndex:-1})]}),pU=J.div`
  display: flex;
  flex-grow: 1;
  max-width: 8rem;
  min-width: 5rem;
  margin-left: 1rem;
  margin-right: 2rem;
`,mU=J.div`
  display: flex;
  align-items: center;
  margin-right: 0.5rem;
  color: var(--color-text-secondary);
`,gU=()=>{const{value:e,setValue:t,defaultValue:n,onPointerDown:r,onPointerUp:o}=jH();return G(pU,{children:[u(mU,{children:u(N,{name:"pan"})}),u(_3,{value:e,onChange:t,onDoubleClick:()=>t(n),onPointerDown:r,onPointerUp:o,min:0,max:127,defaultValue:n,minStepsBetweenThumbs:1,marks:[n]})]})},vU=e=>p.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:128,height:128,...e},p.createElement("path",{fillRule:"evenodd",d:"M92.656 25.247c.328-.33 1.39-.625 2.395.387l7.591 7.635c.994 1 .708 2.05.381 2.38l-9.994 10.069-10.385-10.385zM78.417 39.592 33.55 84.793l-3.97 13.979 14.34-3.58 44.882-45.216zm20.89-18.188c-2.875-2.892-7.785-3.532-10.91-.384l-59.65 60.095-.546.55-.211.744-5.598 19.71-1.416 4.985 5.029-1.255 20.182-5.039.812-.203.59-.594 59.692-60.137c3.094-3.116 2.466-7.97-.384-10.837z",clipRule:"evenodd"})),bU=e=>p.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:128,height:128,...e},p.createElement("path",{fillRule:"evenodd",d:"M27 21h-6v6h6zm10 0h6v6h-6zm22 0h-6v6h6zm16 0h-6v6h6zm16 0h-6v6h6zm10 0h6v6h-6zm0 16h6v6h-6zm-74 0h-6v6h6zm74 16h6v6h-6zm-74 0h-6v6h6zm74 16h6v6h-6zm-74 0h-6v6h6zm74 16h6v6h-6zm-74 0h-6v6h6zm42 16h6v6h-6zm22 0h-6v6h6zm10 0h6v6h-6zm-42 0h-6v6h6zm-22 0h6v6h-6zm-10 0h-6v6h6z",clipRule:"evenodd"})),_U=J(dk)`
  background-color: transparent;
  margin-right: 1rem;
`,Wb=J.div`
  display: flex;
`,y3=({mouseMode:e,onSelect:t})=>G(_U,{children:[u(Tu,{onMouseDown:p.useCallback(()=>t("pencil"),[t]),selected:e==="pencil",children:u(dr,{title:G(Ke,{children:[u(N,{name:"pencil-tool"})," [1]"]}),children:u(Wb,{children:u(vU,{style:{width:"1.3rem",height:"1.3rem",fill:"currentColor"},viewBox:"0 0 128 128"})})})}),u(Tu,{onMouseDown:p.useCallback(()=>t("selection"),[t]),selected:e==="selection",children:u(dr,{title:G(Ke,{children:[u(N,{name:"selection-tool"})," [2]"]}),children:u(Wb,{children:u(bU,{style:{width:"1.3rem",height:"1.3rem",fill:"currentColor"},viewBox:"0 0 128 128"})})})})]}),yU=()=>{const{mouseMode:e,setMouseMode:t}=Me();return u(y3,{mouseMode:e,onSelect:t})},SU=J.span`
  font-weight: bold;
  margin-right: 2em;
  font-size: 1rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 14rem;
  min-width: 3em;
`,kU=J.input`
  font-size: inherit;
  font-family: inherit;
  border: var(--color-divider) 1px solid;
  color: inherit;
  height: 2rem;
  padding: 0 0.5rem;
  box-sizing: border-box;
  border-radius: 4px;
  margin-right: 1em;
  background: #00000017;
  outline: none;
`,wU=()=>{const{selectedTrackId:e}=Me(),{name:t,setName:n}=wt(e),[r,o]=p.useState(!1);return u(Ke,{children:r?u(kU,{defaultValue:t,ref:s=>s==null?void 0:s.focus(),onKeyPress:s=>{s.key==="Enter"&&(n(s.currentTarget.value),o(!1))},onKeyDown:s=>{s.key==="Escape"&&o(!1)},onBlur:()=>o(!1)}):u(SU,{onDoubleClick:()=>o(!0),children:u(Jd,{trackId:e})})})};function xU(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var qu=xU(p),CU=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},TU=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},$b=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=TU(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return qu.createElement("svg",CU({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),qu.createElement("path",{d:"M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.84 14,18.7V20.77C18,19.86 21,16.28 21,12C21,7.72 18,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16C15.5,15.29 16.5,13.76 16.5,12M3,9V15H7L12,20V4L7,9H3Z"}))},MU=qu.memo?qu.memo($b):$b,EU=MU;const S3=yt(EU),IU=100;function AU(){const{selectedTrack:e,selectedTrackId:t}=Me(),{position:n,sendEvent:r}=Lt(),{pushHistory:o}=ht(),{setVolume:s,channel:a}=wt(t),[i,c]=p.useState(!1),l=On(()=>e==null?void 0:e.getVolume(n),[e,n]),f=p.useCallback(d=>{i||o(),s(d,n),a!==void 0&&r(wy(0,a,d))},[o,s,n,r,a,i]);return{value:l??IU,setValue:f,onPointerDown:p.useCallback(()=>{o(),c(!0)},[o]),onPointerUp:p.useCallback(()=>{c(!1)},[])}}const RU=J.div`
  display: flex;
  flex-grow: 1;
  max-width: 8rem;
  min-width: 5rem;
  margin-left: 1rem;
  margin-right: 1rem;
  align-items: center;
`,OU=J(S3)`
  width: 1.3rem;
  height: 2rem;
  color: var(--color-text-secondary);
  margin-right: 0.5rem;
`,PU=()=>{const{value:e,setValue:t,onPointerDown:n,onPointerUp:r}=AU();return G(RU,{children:[u(OU,{}),u(_3,{value:e,onChange:t,onPointerDown:n,onPointerUp:r,max:127,minStepsBetweenThumbs:1})]})},BU=J.div`
  width: 1rem;
`,DU=J.div`
  flex-grow: 1;
`,NU=()=>G(a1,{children:[u(BH,{}),u(wU,{}),u($H,{}),u(BU,{}),u(VH,{}),u(CH,{}),u(PU,{}),u(gU,{}),u(DU,{}),u(yU,{}),u(s1,{}),u(n1,{})]}),LU=J.div`
  display: flex;
  padding: 0.5rem 1rem;
  align-items: center;
  justify-content: center;
  color: var(--color-text-secondary);
  border-radius: 0.5rem;
  margin: 0.5rem;

  &:hover {
    background: var(--color-highlight);
  }
`,zU=J(l1)`
  min-width: auto;
  margin-right: 0.5em;
  color: inherit;
`,FU=J.div`
  font-size: 0.875rem;
`,WU=()=>{const e=ZS();return G(LU,{onClick:e,children:[u(zU,{}),u(FU,{children:u(N,{name:"add-track"})})]})};function $U(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var Zu=$U(p),VU=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},jU=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},Vb=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=jU(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return Zu.createElement("svg",VU({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),Zu.createElement("path",{d:"M12,1C7,1 3,5 3,10V17A3,3 0 0,0 6,20H9V12H5V10A7,7 0 0,1 12,3A7,7 0 0,1 19,10V12H15V20H18A3,3 0 0,0 21,17V10C21,5 16.97,1 12,1Z"}))},HU=Zu.memo?Zu.memo(Vb):Vb,UU=HU;const GU=yt(UU);function XU(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var Qu=XU(p),KU=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},YU=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},jb=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=YU(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return Qu.createElement("svg",KU({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),Qu.createElement("path",{d:"M12,16L19.36,10.27L21,9L12,2L3,9L4.63,10.27M12,18.54L4.62,12.81L3,14.07L12,21.07L21,14.07L19.37,12.8L12,18.54Z"}))},qU=Qu.memo?Qu.memo(jb):jb,ZU=qU;const QU=yt(ZU);function JU(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var Ju=JU(p),eG=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},tG=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},Hb=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=tG(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return Ju.createElement("svg",eG({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),Ju.createElement("path",{d:"M12,4L9.91,6.09L12,8.18M4.27,3L3,4.27L7.73,9H3V15H7L12,20V13.27L16.25,17.53C15.58,18.04 14.83,18.46 14,18.7V20.77C15.38,20.45 16.63,19.82 17.68,18.96L19.73,21L21,19.73L12,10.73M19,12C19,12.94 18.8,13.82 18.46,14.64L19.97,16.15C20.62,14.91 21,13.5 21,12C21,7.72 18,4.14 14,3.23V5.29C16.89,6.15 19,8.83 19,12M16.5,12C16.5,10.23 15.5,8.71 14,7.97V10.18L16.45,12.63C16.5,12.43 16.5,12.21 16.5,12Z"}))},nG=Ju.memo?Ju.memo(Hb):Hb,rG=nG;const oG=yt(rG),k3=({trackId:e,open:t,onClose:n})=>{const{name:r,channel:o,setName:s,setChannel:a}=wt(e),[i,c]=p.useState(r),[l,f]=p.useState(o);return p.useEffect(()=>{t&&(c(r),f(o))},[e,t]),G(hn,{open:t,onOpenChange:n,style:{minWidth:"20rem"},children:[G(bn,{children:[u(N,{name:"track"}),": ",u(Jd,{trackId:e})]}),G(qt,{children:[u(so,{children:u(N,{name:"track-name"})}),u(Ld,{type:"text",value:i,onChange:d=>c(d.target.value),style:{width:"100%",marginBottom:"1rem"}}),u(so,{children:u(N,{name:"channel"})}),u(Za,{value:l,onChange:d=>f(parseInt(d.target.value)),children:Qe.range(0,16).map(d=>G("option",{value:d.toString(),children:[d+1,d===9?G(Ke,{children:[" ","(",u(N,{name:"rhythm-track"}),")"]}):""]},d))})]}),G(gn,{children:[u(Et,{autoFocus:!0,onClick:n,children:u(N,{name:"cancel"})}),u(xo,{onClick:()=>{s(i??""),a(l),n()},children:u(N,{name:"ok"})})]})]})},sG=J.div`
  height: 2rem;

  &:hover {
    z-index: 2;
    box-shadow: 0 0 0 2px white;
  }
`,aG=J.div`
  display: grid;
  padding: 2px;
  grid-template-columns: repeat(8, 2rem);
`,iG=({open:e,onSelect:t,onClose:n})=>{const r=c=>{t(c),n()},o=[-5,25,45,155,190,230,260,335],s=70,a=[65,55,39],i=Th(0,a.length).flatMap(c=>Th(0,o.length).map(l=>`hsl(
          ${o[l].toFixed()}deg
          ${s}%
          ${a[c].toFixed()}%
        )`));return G(hn,{open:e,onOpenChange:n,children:[u(qt,{children:u(aG,{children:i.map(c=>u(sG,{style:{backgroundColor:c},onClick:()=>r(c)},c))})}),G(gn,{children:[u(Et,{onClick:()=>r(null),children:u(N,{name:"reset"})}),u(Et,{onClick:n,children:u(N,{name:"close"})})]})]})},cG=({trackId:e,...t})=>{const{setColor:n}=wt(e),r=ZS(),o=QS(),{handleClose:s}=t,[a,i]=p.useState(!1),[c,l]=p.useState(!1),f=r,d=p.useCallback(()=>o(e),[e,o]),m=()=>i(!0),v=()=>l(!0),_=y=>{if(y===null){n(null);return}const k=gt(y);n({red:Math.floor(k.red()),green:Math.floor(k.green()),blue:Math.floor(k.blue()),alpha:255})};return G(Ke,{children:[G(ea,{...t,children:[u(We,{onClick:y=>{y.stopPropagation(),f(),s()},children:u(N,{name:"add-track"})}),u(We,{onClick:y=>{y.stopPropagation(),d(),s()},children:u(N,{name:"delete-track"})}),u(We,{onClick:y=>{y.stopPropagation(),m(),s()},children:u(N,{name:"property"})}),u(We,{onClick:y=>{y.stopPropagation(),v(),s()},children:u(N,{name:"change-track-color"})})]}),u(k3,{trackId:e,open:a,onClose:()=>i(!1)}),u(iG,{open:c,onSelect:_,onClose:()=>l(!1)})]})},lG=J.div`
  background-color: transparent;
  border: 1px solid;
  border-color: transparent;
  display: flex;
  align-items: center;
  padding: 0.5rem 0.5rem;
  border-radius: 0.5rem;
  margin: 0.5rem;
  outline: none;

  &:hover {
    background: var(--color-highlight);
  }

  &[data-selected="true"] {
    background-color: var(--color-highlight);
    border-color: var(--color-divider);
  }
`,uG=J.div`
  display: flex;
  padding-bottom: 0.3em;
  align-items: baseline;
`,dG=J.div`
  color: var(--color-text-secondary);
  font-size: 0.75rem;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
`,fG=J.div`
  font-weight: 600;
  color: var(--color-text-secondary);
  padding-right: 0.5em;
  font-size: 0.875rem;
  text-overflow: ellipsis;
  white-space: nowrap;

  &[data-selected="true"] {
    color: var(--color-text);
  }
`,hG=J.div`
  display: flex;
  align-items: center;
`,pG=J.div`
  flex-shrink: 0;
  color: var(--color-text-secondary);
  font-size: 0.625rem;
  display: flex;
  align-items: center;
  border: 1px solid var(--color-divider);
  padding: 0 0.25rem;
  cursor: pointer;
  height: 1.25rem;
  margin-left: 0.25rem;

  &:hover {
    background: var(--color-highlight);
  }
`,mG=J.div`
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  width: 2.6rem;
  height: 2.6rem;
  border-radius: 1.3rem;
  margin-right: 0.5rem;
  flex-shrink: 0;
  background: var(--color-background-secondary);
  border: 2px solid;
  box-sizing: border-box;

  &[data-selected="true"] {
    background: var(--color-background);
  }
`,gG=J.div`
  opacity: 0.5;

  &[data-selected="true"] {
    opacity: 1;
  }
`,wh=J.div`
  width: 1.9rem;
  height: 1.9rem;
  margin-right: 0.25rem;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 999px;
  color: var(--color-text-secondary);
  cursor: pointer;
  outline: none;

  &:hover {
    background: var(--color-highlight);
  }

  svg {
    width: 1.1rem;
    height: 1.1rem;
  }

  &[data-active="true"] {
    color: var(--color-text);
  }
`,vG=({trackId:e})=>{const{selectedTrackId:t,notGhostTrackIds:n}=Me(),{channel:r,isConductorTrack:o,programNumber:s,isRhythmTrack:a,color:i,isMuted:c,isSolo:l}=wt(e),{setPath:f}=ds(),{setSetting:d,setOpen:m}=L1(),{toggleMute:v,toggleSolo:_}=Xa(),y=LS(),k=HO(),g=JS(),b=e===t,h=!n.has(e),{onContextMenu:S,menuProps:x}=Ks(),[w,I]=p.useState(!1),M=p.useCallback(()=>{o||(m(!0),d({programNumber:s,isRhythmTrack:a}))},[d,s,a,m,o]),H=p.useCallback(V=>{V.stopPropagation(),v(e)},[e,v]),j=p.useCallback(V=>{V.stopPropagation(),_(e)},[e,_]),W=p.useCallback(V=>{V.stopPropagation(),V.nativeEvent.altKey?k():y(e)},[e,k,y]),A=p.useCallback(()=>{f("/track"),g(e)},[e,g,f]),L=p.useCallback(()=>{I(!0)},[]),B=a?"":N1[ul(s??0)],P=i!==void 0?Ky(i):"transparent";return G(Ke,{children:[G(lG,{"data-selected":b,onMouseDown:A,onContextMenu:S,tabIndex:-1,children:[u(mG,{"data-selected":b,style:{borderColor:P},onDoubleClick:M,children:u(gG,{"data-selected":b,children:B})}),G("div",{children:[G(uG,{children:[u(fG,{"data-selected":b,children:u(Jd,{trackId:e})}),u(dG,{children:u(z1,{programNumber:s,isRhythmTrack:a})})]}),G(hG,{children:[u(wh,{"data-active":l,onMouseDown:j,tabIndex:-1,children:u(GU,{})}),u(wh,{"data-active":c,onMouseDown:H,tabIndex:-1,children:c?u(oG,{}):u(S3,{})}),u(wh,{"data-active":h,onMouseDown:W,tabIndex:-1,children:u(QU,{})}),r!==void 0&&G(pG,{onClick:L,children:["CH ",r+1]})]})]})]}),u(cG,{...x,trackId:e}),u(k3,{trackId:e,open:w,onClose:()=>I(!1)})]})},bG=J.div`
  overflow-y: auto;
  background: var(--color-background);
  min-width: 14rem;
  flex-grow: 1;
`,_G=()=>{const{moveTrack:e,trackIds:t}=Ud();return G(bG,{children:[u(Iw,{items:t,getItemId:n=>n,onItemMoved:e,render:n=>u(vG,{trackId:n},n)}),u(WU,{})]})},yG=()=>{const{openTransposeDialog:e,setOpenTransposeDialog:t}=Me(),n=Zc(),r=p.useCallback(()=>t(!1),[t]),o=p.useCallback(s=>{n(s),t(!1)},[t,n]);return u(Ak,{open:e,onClose:r,onClickOK:o})},SG=()=>{const{openVelocityDialog:e,newNoteVelocity:t,setOpenVelocityDialog:n}=Me(),r=XO(),o=p.useCallback(()=>n(!1),[n]),s=p.useCallback((a,i)=>{r({type:i,value:a}),n(!1)},[n,r]);return u(Wk,{open:e,value:t,onClickOK:s,onClose:o})},kG=()=>{const e=Um(),t=Gm(),n=vi(),r=bi(),o=Vd(),s=rP(),a=jd(),i=Hd(),c=Zc(),{mouseMode:l,resetSelection:f}=Me(),{setOpenTransposeDialog:d}=Me(),m=p.useMemo(()=>[{code:"KeyC",metaKey:!0,run:n},{code:"KeyV",metaKey:!0,run:()=>o()},{code:"KeyX",metaKey:!0,run:s},{code:"KeyD",metaKey:!0,run:a},{code:"KeyQ",run:i},{code:"KeyT",run:()=>d(!0)},{code:"Delete",run:r},{code:"Backspace",run:r},{code:"ArrowUp",shiftKey:!0,run:()=>c(12)},{code:"ArrowUp",run:()=>c(1)},{code:"ArrowDown",shiftKey:!0,run:()=>c(-12)},{code:"ArrowDown",run:()=>c(-1)},{code:"ArrowRight",run:e,enabled:()=>l==="pencil"},{code:"ArrowLeft",run:t,enabled:()=>l==="pencil"},{code:"Escape",run:f}],[l,d,r,a,i,c,e,t,f,n,o,s]);return _i({actions:m,onCopy:n,onPaste:o,onCut:s})},wG=()=>{const{selectedTrackId:e}=Me(),{getEventById:t,updateEvent:n,createOrUpdate:r}=wt(e),{position:o}=Lt(),{pushHistory:s}=ht(),{selectedEventIds:a}=Yt();return p.useCallback(i=>{s();const c=a.map(l=>t(l)).filter(Mo);c.length>0?c.forEach(l=>n(l.id,{value:i.value})):r({...i,tick:o})},[a,t,n,r,o,s])},ff=()=>{const{selectedTrackId:e}=Me(),{removeEvents:t}=wt(e),{pushHistory:n}=ht(),{selectedEventIds:r,setSelection:o}=Yt();return p.useCallback(()=>{r.length!==0&&(n(),t(r),o(null))},[r,t,n,o])},dl=()=>{const{selectedTrackId:e}=Me(),{selectedEventIds:t}=Yt(),n=an();return p.useCallback(async()=>{if(t.length===0)return;const r=n.control.getClipboardDataForSelection(e,t);r&&await zd(r)},[t,n,e])},W1=()=>{const{selectedTrackId:e}=Me(),{position:t}=Lt(),{pushHistory:n}=ht(),r=an();return p.useCallback(async o=>{const s=o?Fd(o):await Yc(),{data:a}=by.safeParse(s);a&&(n(),r.control.pasteClipboardDataAtPosition(e,a,t))},[r,t,n,e])},xG=()=>{const e=dl(),t=ff();return p.useCallback(()=>{e(),t()},[e,t])},w3=()=>{const{selectedTrackId:e}=Me(),{pushHistory:t}=ht(),{selectedEventIds:n,setSelectedEventIds:r}=Yt(),o=an();return p.useCallback(()=>{if(n.length===0)return;t();const s=o.track.duplicateEvents(e,n);r(s)},[n,t,r,o,e])},CG=()=>{const{resetSelection:e}=Yt(),t=ff(),n=dl(),r=w3(),o=W1(),s=xG(),a=p.useMemo(()=>[{code:"Escape",run:e},{code:"Backspace",run:t},{code:"Delete",run:t},{code:"KeyC",metaKey:!0,run:n},{code:"KeyV",metaKey:!0,run:()=>o()},{code:"KeyX",metaKey:!0,run:s},{code:"KeyD",metaKey:!0,run:()=>r()}],[e,t,r,n,o,s]);return _i({actions:a,onCopy:n,onPaste:o,onCut:s})};function TG(){const{controlMode:e}=Yt(),{transform:t,scrollLeft:n}=kt(),{selectedTrackId:r}=Me(),o=Od(),{events:s}=wt(r),a=p.useMemo(()=>{switch(e.type){case"velocity":throw new Error("don't use this method for velocity");case"pitchBend":return lm;case"controller":return ui(e.controllerType)}},[e]),i=p.useMemo(()=>o.filter(a),[o,a]),c=p.useMemo(()=>{const f=s.filter(a),d=t.getTick(n);return Qe.maxBy(f.filter(m=>m.tick<d),m=>m.tick)},[a,n,t,s]);return p.useMemo(()=>[c,...i].filter(Mo),[i,c])}const MG=J.div`
  text-align: right;
  padding-right: 0.3em;
  box-sizing: border-box;
`,EG=J.div`
  position: relative;
  height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
`,IG=J.div`
  padding: 0.3em;
  font-size: 90%;
  color: var(--color-text-secondary);

  &:hover {
    background: var(--color-highlight);
    cursor: default;
  }
`,x3=it.memo(({width:e,values:t,valueFormatter:n=o=>o.toString(),onClick:r})=>u(MG,{style:{width:e},children:u(EG,{children:t.slice().reverse().map(o=>u(IG,{className:"AxisValue",onClick:()=>r(o),children:n(o)},o))})}));class AG{constructor(t,n,r,o){this.transform=t,this.maxValue=n,this.height=r,this.lineWidth=o}getX(t){return this.transform.getX(t)}getTick(t){return Math.floor(this.transform.getTick(t))}getY(t){return(1-t/this.maxValue)*(this.height-this.lineWidth*2)+this.lineWidth}getValue(t){return Math.floor((1-(t-this.lineWidth)/(this.height-this.lineWidth*2))*this.maxValue)}toPosition(t,n){return{x:Math.round(this.getX(t)),y:Math.round(this.getY(n))}}fromPosition(t){return{tick:this.getTick(t.x),value:this.getValue(t.y)}}transformSelection(t){const n=this.getX(t.fromTick);return{x:n,y:0,width:this.getX(t.toTick)-n,height:this.height}}}const RG=e=>{const{handleClose:t}=e,{selectedEventIds:n}=Yt(),r=n.length>0,o=dl(),s=ff(),a=w3(),i=W1(),c=p.useCallback(()=>{o(),s(),t()},[o,s,t]),l=p.useCallback(()=>{o(),t()},[o,t]),f=p.useCallback(()=>{i(),t()},[i,t]),d=p.useCallback(()=>{a(),t()},[a,t]),m=p.useCallback(()=>{s(),t()},[s,t]);return G(ea,{...e,children:[G(We,{onClick:c,disabled:!r,children:[u(N,{name:"cut"}),G(nn,{children:[ut.cmdOrCtrl,"+X"]})]}),G(We,{onClick:l,disabled:!r,children:[u(N,{name:"copy"}),G(nn,{children:[ut.cmdOrCtrl,"+C"]})]}),G(We,{onClick:f,children:[u(N,{name:"paste"}),G(nn,{children:[ut.cmdOrCtrl,"+V"]})]}),G(We,{onClick:d,disabled:!r,children:[u(N,{name:"duplicate"}),G(nn,{children:[ut.cmdOrCtrl,"+D"]})]}),G(We,{onClick:m,disabled:!r,children:[u(N,{name:"delete"}),u(nn,{children:"Del"})]})]})},OG=()=>{const{setSelection:e,setSelectedNoteIds:t}=Me(),{isPlaying:n,setPosition:r}=Lt(),{setSelectedEventIds:o,setSelection:s}=Yt();let{selection:a}=Yt();const{quantizeRound:i}=Nn();return{onMouseDown(c,l,f,d){o([]);const m=i(f.getTick(l.x));e(null),t([]),n||r(m),a={fromTick:m,toTick:m},s(a),us(c,{onMouseMove:(v,_)=>{const y=on.add(l,_),k=i(f.getTick(y.x));a={fromTick:Math.min(m,k),toTick:Math.max(m,k)},s(a)},onMouseUp:()=>{o(a?d(a):[]),s(null)}})}}},PG=e=>{const{setSelection:t,setSelectedNoteIds:n}=Me(),{setSelectedEventIds:r,setSelection:o}=Yt(),s=$O(),{pushHistory:a}=ht(),i=VO(e),c=Xs.getEventFactory(e);return{onMouseDown(l,f,d){a(),r([]),o(null),t(null),n([]);const m=Qn(l),v=d.fromPosition(f),_=c(v.value);s(_,v.tick);let y=v.tick,k=v.value;jr({onMouseMove:g=>{const b=Qn(g),h=on.sub(b,m),S=on.add(f,h),x=Math.max(0,Math.min(d.maxValue,d.fromPosition(S).value)),w=d.getTick(S.x);i(k,x,y,w),y=w,k=x}})}}},BG=()=>{const{selectedTrackId:e}=Me(),{getEvents:t,updateEvents:n}=wt(e),{pushHistory:r}=ht(),{selectedEventIds:o,setSelectedEventIds:s}=Yt(),{quantizeRound:a}=Nn(),i=an();return{onMouseDown:p.useCallback((c,l,f,d)=>{r();let m=o;m.includes(l)||(s([l]),m=[l]);const v=t().filter(k=>m.includes(k.id)).map(k=>({...k})),_=v.find(k=>k.id===l);if(_===void 0)return;const y=d.getValue(f.y);us(c,{onMouseMove:(k,g)=>{const b=d.getTick(g.x),h=_.tick+b-a(_.tick+b),S=b-h,w=d.getValue(f.y+g.y)-y;n(v.map(I=>({id:I.id,tick:Math.max(0,Math.floor(I.tick+S)),value:Math.min(d.maxValue,Math.max(0,Math.floor(I.value+w)))})))},onMouseUp:()=>{i.track.removeRedundantEventsForEventIds(e,m)}})},[r,e,o,s,t,n,i,a])}},C3=({width:e,scrollLeft:t,items:n,selectedEventIds:r,controlPoints:o,lineWidth:s,zIndex:a,onMouseDownItem:i})=>{const c=$t(),l=t+e,f=n.map(_=>({..._,id:_.id})),d=DG(f,s,l),[m,v]=Qe.partition(o,_=>r.includes(_.id));return G(Ke,{children:[u(os,{rects:d,color:St(gt(c.themeColor)),zIndex:a}),u(Ev,{rects:v,zIndex:a+.1,strokeColor:St(gt(c.themeColor)),fillColor:St(gt(c.themeColor))}),u(Ev,{rects:m,zIndex:a+.2,strokeColor:St(gt(c.themeColor)),fillColor:St(gt(c.onSurfaceColor))}),o.map(_=>u(NG,{bounds:_,itemId:_.id,zIndex:a,onMouseDown:i},_.id))]})},DG=(e,t,n)=>{const r=e.map(({x:o,y:s},a)=>{const i=e[a+1],c=i?i.x:n;return{x:o,y:s-t/2,width:c-o,height:t}});return tP(r,(o,s)=>{const a=Math.min(o.y,s.y),i=Math.abs(o.y-s.y)+t;return{x:s.x-t/2,y:a,width:t,height:i}})},NG=({bounds:e,itemId:t,zIndex:n,onMouseDown:r})=>{const o=p.useCallback(s=>{r==null||r(s,t)},[t,r]);return u(Nr,{bounds:e,zIndex:n,onMouseDown:o})},LG=({items:e,zIndex:t,width:n,lineWidth:r,circleRadius:o,controlTransform:s})=>{const{selectedEventIds:a}=Yt(),{mouseMode:i}=Me(),{scrollLeft:c}=kt(),l=BG(),f=e.map(v=>({...Sc.fromPointWithSize(v,o*2),id:v.id})),d=p.useCallback(v=>({x:v.offsetX+c,y:v.offsetY}),[c]),m=p.useCallback((v,_)=>{if(i!=="selection")return;v.stopPropagation();const y=d(v);l.onMouseDown(v,_,y,s)},[i,l,d,s]);return u(C3,{scrollLeft:c,width:n,items:e,selectedEventIds:a,controlPoints:f,lineWidth:r,zIndex:t,onMouseDownItem:m})},zG=({zIndex:e,transform:t})=>{const{selection:n}=Yt(),r=n!==null?t.transformSelection(n):null;return G(Ke,{children:[u(tf,{rect:r,zIndex:e}),r&&u(Nr,{bounds:r,zIndex:e})]})},FG=({width:e,height:t,maxValue:n,eventType:r,events:o,lineWidth:s=2,circleRadius:a=4})=>{const{mouseMode:i}=Me(),c=hi(),l=$t(),{cursorX:f,transform:d,scrollLeft:m}=kt(),v=PG(r),_=OG(),{onContextMenu:y,menuProps:k}=Ks(),g=i==="pencil"?'url("./cursor-pencil.svg") 0 20, pointer':"auto",b=p.useMemo(()=>new AG(d,n,t,s),[d,n,t,s]),h=o.map(j=>({id:j.id,...b.toPosition(j.tick,j.value)})),S=p.useMemo(()=>_o(-Math.floor(m),0),[m]),x=p.useCallback(j=>({x:j.offsetX+m,y:j.offsetY}),[m]),w=p.useCallback(j=>{const W=x(j.nativeEvent);v.onMouseDown(j.nativeEvent,W,b)},[b,v,x]),I=p.useCallback(j=>{const W=x(j.nativeEvent);_.onMouseDown(j.nativeEvent,W,b,A=>o.filter(js(Ft.create(A.fromTick,A.toTick))).map(L=>L.id))},[b,o,_,x]),M=i==="pencil"?w:I,H=p.useMemo(()=>({backgroundColor:l.editorBackgroundColor}),[l]);return G(Ke,{children:[u(tl,{width:e,height:t,onMouseDown:M,onContextMenu:y,style:H,cursor:g,children:G(bo,{matrix:S,children:[u(rl,{height:t,beats:c,zIndex:0}),u(LG,{width:e,items:h,lineWidth:s,circleRadius:a,zIndex:1,controlTransform:b}),u(zG,{zIndex:2,transform:b}),u(ol,{x:f,height:t,zIndex:3})]})}),u(RG,{...k})]})},WG=({maxValue:e,events:t,eventType:n,width:r,height:o,lineWidth:s=2,circleRadius:a=4,axis:i,axisWidth:c,axisLabelFormatter:l=f=>f.toString()})=>{const f=wG(),d=p.useCallback(m=>{const v=Xs.getEventFactory(n)(m);f(v)},[n,f]);return G("div",{style:{display:"flex"},children:[u(x3,{width:c,values:i,valueFormatter:l,onClick:d}),u(FG,{width:r,height:o,maxValue:e,lineWidth:s,circleRadius:a,events:t,eventType:n})]})},$G=it.memo(WG),VG=e=>{switch(e.type){case"controller":return[0,32,64,96,127];case"pitchBend":return[0,4096,8192,12288,16383]}},jG=e=>{switch(e.type){case"controller":return 127;case"pitchBend":return 16384}},HG=e=>{switch(e.type){case"controller":switch(e.controllerType){case Zr.MSB_PAN:return t=>(t-64).toString();default:return t=>t.toString()}case"pitchBend":return t=>(t-8192).toString();default:return t=>t.toString()}},UG=it.memo(({width:e,height:t,type:n,axisWidth:r})=>{const o=TG(),s=p.useMemo(()=>VG(n),[n]),a=p.useMemo(()=>jG(n),[n]),i=p.useMemo(()=>HG(n),[n]);return u($G,{width:e,height:t,maxValue:a,events:o,axis:s,axisWidth:r,eventType:n,axisLabelFormatter:i})});class GG{constructor(t){this.height=t}get maxHeight(){return this.height}getHeight(t){return t/127*this.height}getY(t){return this.height-this.getHeight(t)}getVelocity(t){return Math.max(1,Math.round(Math.max(0,Math.min(1,1-t/this.height))*127))}}const XG=({rects:e})=>{const t=$t(),n=St(gt(t.themeColor));return u(os,{rects:e,color:n})};class KG{constructor(t){ee(this,"_instanceCount",0);ee(this,"boundsBuffer",new Float32Array(0));ee(this,"stateBuffer",new Float32Array(0));this.vertexArray=t,this.vertexArray.updateBuffer("position",new Float32Array(Cr({x:0,y:0,width:1,height:1})))}update(t){(this.boundsBuffer.length<t.length*4||this.stateBuffer.length<t.length*2)&&(this.boundsBuffer=new Float32Array(t.length*4),this.stateBuffer=new Float32Array(t.length*2));for(let n=0;n<t.length;n++){const r=t[n];this.boundsBuffer[n*4+0]=r.x,this.boundsBuffer[n*4+1]=r.y,this.boundsBuffer[n*4+2]=r.width,this.boundsBuffer[n*4+3]=r.height,this.stateBuffer[n*2+0]=r.isSelected?1:0}this.vertexArray.updateBuffer("bounds",this.boundsBuffer.subarray(0,t.length*4)),this.vertexArray.updateBuffer("state",this.stateBuffer.subarray(0,t.length*2)),this._instanceCount=t.length}get vertexCount(){return 6}get instanceCount(){return this._instanceCount}}const YG=e=>new Po(e,`#version 300 es
      precision lowp float;

      uniform mat4 projectionMatrix;

      in vec4 position;
      in vec4 bounds;  // [x, y, width, height]
      in vec2 state; // [isSelected, <not used>]

      out vec4 vBounds;
      out vec2 vPosition;
      out vec2 vState;

      void main() {
        vec4 transformedPosition = vec4((position.xy * bounds.zw + bounds.xy), position.zw);
        gl_Position = projectionMatrix * transformedPosition;
        vBounds = bounds;
        vPosition = transformedPosition.xy;
        vState = state;
      }
    `,`#version 300 es
      precision lowp float;

      uniform vec4 strokeColor;
      uniform vec4 selectedColor;
      uniform vec4 activeColor;

      in vec4 vBounds;
      in vec2 vPosition;
      in vec2 vState;

      out vec4 outColor;

      void main() {
        float border = 1.0;
        float localX = vPosition.x - vBounds.x;
        float localY = vPosition.y - vBounds.y;

        float outlineTop = step(border, localY);
        float outlineBottom = step(localY, vBounds.w - border);
        float outlineLeft = step(border, localX);
        float outlineRight = step(localX, vBounds.z - border);
        
        float isOutline = outlineTop * outlineBottom * outlineLeft * outlineRight;
    
        if (isOutline < 1.0) {
          // draw outline
          outColor = strokeColor;
        } else {
          // if selected, draw selected color
          outColor = mix(activeColor, selectedColor, vState.x);
        }
      }
    `,{position:{size:2,type:e.FLOAT},bounds:{size:4,type:e.FLOAT,divisor:1},state:{size:2,type:e.FLOAT,divisor:1}},{projectionMatrix:Oo(),strokeColor:fn(),activeColor:fn(),selectedColor:fn()},t=>new KG(t)),qG=({velocityTransform:e,...t})=>{const{selectedNoteIds:n}=Me(),{transform:r}=kt(),o=Od(),s=WO(),a=p.useMemo(()=>o.filter(en).map(c=>{const l=r.getX(c.tick);return{id:c.id,x:l,y:e.getY(c.velocity),width:5,height:e.getHeight(c.velocity),isSelected:n.includes(c.id)}}),[o,e,r,n]),i=p.useCallback((c,l)=>{const f=c.clientY-c.offsetY,d=m=>{const v=m.clientY-f;return e.getVelocity(v)};c.stopPropagation(),s([l],d(c)),jr({onMouseMove:m=>s([l],d(m))})},[s,e]);return G(Ke,{children:[u(nl,{component:ZG,fallback:XG,rects:a,...t}),a.map(c=>u(QG,{rect:c,height:e.maxHeight,zIndex:t.zIndex||0,onMouseDown:i},c.id))]})},ZG=({rects:e,zIndex:t})=>{const n=nr(),r=$t(),o=gt(r.themeColor),s=St(rw(o,r.isLightContent,.3)),a=p.useMemo(()=>St(o),[o]),i=p.useMemo(()=>St(o.lighten(.7)),[o]);return u(Tr,{shader:YG,uniforms:{projectionMatrix:n,strokeColor:s,activeColor:a,selectedColor:i},buffer:e,zIndex:t})},QG=({rect:e,height:t,zIndex:n,onMouseDown:r})=>{const o=p.useCallback(a=>{a.stopPropagation(),r(a,e.id)},[r,e.id]),s=p.useMemo(()=>({x:e.x,y:0,width:e.width,height:t}),[e.x,e.width,t]);return u(Nr,{bounds:s,zIndex:n,onMouseDown:o})},JG=({velocityTransform:e})=>{const{transform:t}=kt(),{scrollLeft:n}=kt(),{selectedTrackId:r,selectedNoteIds:o}=Me(),s=an();return{onMouseDown:p.useCallback(a=>{const i=a.nativeEvent,c={x:i.offsetX+n,y:i.offsetY},l=i.clientY-i.offsetY,f=v=>{const _=v.clientY-l;return e.getVelocity(_)};let d=t.getTick(c.x),m=f(i);us(i,{onMouseMove:(v,_)=>{const y=on.add(c,_),k=t.getTick(y.x),g=f(v);s.track.updateVelocitiesInRange(r,o,d,m,k,g),d=k,m=g}})},[n,s,r,o,t,e])}},eX=({width:e,height:t})=>{const n=hi(),{cursorX:r,scrollLeft:o}=kt(),s=$t(),a=p.useMemo(()=>new GG(t),[t]),i=JG({velocityTransform:a}),c=p.useMemo(()=>_o(-o,0),[o]),l=p.useMemo(()=>({backgroundColor:s.editorBackgroundColor}),[s]);return u(tl,{width:e,height:t,style:l,onMouseDown:i.onMouseDown,children:G(bo,{matrix:c,children:[u(qG,{velocityTransform:a,zIndex:1}),u(rl,{height:t,beats:n,zIndex:2}),u(ol,{x:r,height:t,zIndex:4})]})})},tX=J.div`
  display: flex;
  position: absolute;
  top: 0;
  left: 0;
`,nX=({width:e,height:t,axisWidth:n})=>G(tX,{children:[u(x3,{width:n,values:[1,32,64,96,127],onClick:()=>{}}),u(eX,{width:e,height:t})]}),rX=it.memo(nX),T3=J.div`
  background: transparent;
  -webkit-appearance: none;
  padding: 0.5em 0.8em;
  color: var(--color-text-secondary);
  outline: none;
  font-size: 0.75rem;
  cursor: default;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;

  &:hover {
    background: var(--color-highlight);
  }
`,oX=J(T3)`
  width: 7rem;
  overflow: hidden;
  border-bottom: 1px solid;
  border-color: transparent;
  color: var(--color-text-secondary);

  &[data-selected="true"] {
    border-color: var(--color-theme);
    color: var(--color-text);
  }
`,sX=J.span`
  text-overflow: ellipsis;
  overflow: hidden;
  white-space: nowrap;
`,aX=J.div`
  box-sizing: border-box;
  display: flex;
  height: 2rem;
  flex-shrink: 0;
  overflow-x: auto;

  &::-webkit-scrollbar {
    display: none;
  }
`,iX=it.memo(({onSelect:e,selectedMode:t})=>{const{setOpenControlSettingDialog:n}=Ln(),{controlModes:r}=Yt();return G(aX,{children:[r.map((o,s)=>u(oX,{"data-selected":ji(t,o),onMouseDown:()=>e(o),children:u(sX,{children:u(xp,{mode:o})})},s)),u(T3,{onClick:()=>n(!0),children:u(cw,{style:{width:"1rem"}})})]})}),cX=J.div`
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  background: var(--color-background-dark);
  outline: none;
`,lX=J.div`
  flex-grow: 1;
  position: relative;

  > canvas,
  > .LineGraph {
    position: absolute;
    top: 0;
    left: 0;
  }
`,uX=J.div`
  position: relative;
`,dX=30,fX=1,hX=({axisWidth:e})=>{const t=p.useRef(null),n=zr(t),{setActivePane:r}=Me(),{controlMode:o,setControlMode:s}=Yt(),a=CG(),i=p.useCallback(()=>r("control"),[r]),c=p.useCallback(()=>r(null),[r]),l={width:n.width-e-fX,height:n.height-dX,axisWidth:e},f=(()=>{switch(o.type){case"velocity":return u(rX,{...l});default:return u(UG,{...l,type:o})}})();return G(cX,{ref:t,...a,tabIndex:0,onFocus:i,onBlur:c,children:[u(uX,{style:{paddingLeft:e},children:u(iX,{onSelect:s,selectedMode:o})}),u(lX,{children:f})]})},pX=["major","minor","harmonicMajor","harmonicMinor","melodicMinor","ionian","dorian","phrygian","lydian","mixolydian","aeolian","locrian","majorPentatonic","minorPentatonic","majorBlues","minorBlues","halfWholeDiminished","wholeHalfDiminished","wholeTone"];var ed;(e=>{e.values=pX,e.getIntegerNotation=t=>{switch(t){case"major":return[0,2,4,5,7,9,11];case"minor":return[0,2,3,5,7,8,10];case"harmonicMinor":return[0,2,3,5,7,8,11];case"harmonicMajor":return[0,2,4,5,7,8,11];case"melodicMinor":return[0,2,3,5,7,9,11];case"ionian":return[0,2,4,5,7,9,11];case"dorian":return[0,2,3,5,7,9,10];case"phrygian":return[0,1,3,5,7,8,10];case"lydian":return[0,2,4,6,7,9,11];case"mixolydian":return[0,2,4,5,7,9,10];case"aeolian":return[0,2,3,5,7,8,10];case"locrian":return[0,1,3,5,6,8,10];case"majorPentatonic":return[0,2,4,7,9];case"minorPentatonic":return[0,3,5,7,10];case"majorBlues":return[0,2,3,4,7,9];case"minorBlues":return[0,3,5,6,7,10];case"halfWholeDiminished":return[0,1,3,4,6,7,9,10];case"wholeHalfDiminished":return[0,2,3,5,6,8,9,11];case"wholeTone":return[0,2,4,6,8,10]}}})(ed||(ed={}));var Oc;(e=>{e.getIntervals=t=>ed.getIntegerNotation(t.scale).map(r=>(r+t.key)%12)})(Oc||(Oc={}));function M3(){const{keySignature:e,transform:{numberOfKeys:t,pixelsPerKey:n},previewingNoteNumbers:r,selectedTrackId:o}=Me(),[s,a]=p.useState(new Set),{previewNoteOn:i,previewNoteOff:c}=$d(),{synth:l}=Ht(),{programNumber:f,isRhythmTrack:d}=wt(o),m=p.useMemo(()=>new Set([...s,...r]),[s,r]),v=p.useCallback(g=>{i(g),a(new Set([g]))},[i]),_=p.useCallback(g=>{c(),i(g),a(new Set([g]))},[c,i]),y=p.useCallback(()=>{c(),a(new Set)},[c]),k=p.useMemo(()=>{if(!d||!l.loadedSoundFont)return null;const g=l.loadedSoundFont.getDrumKitPresets().get(f);return g?mX(g.samples,b=>{var h;return(h=b[0])==null?void 0:h.name}):null},[l.loadedSoundFont,d,f]);return{selectedKeys:m,onMouseDownKey:v,onMouseMoveKey:_,onMouseUpKey:y,keySignature:e,numberOfKeys:t,keyHeight:n,keyNames:k}}function mX(e,t){const n=new Map;for(const[r,o]of e.entries()){const s=t(o,r);s!==void 0&&n.set(r,s)}return n}const gX=({scale:e})=>{const t=er();switch(e){case"major":return t["scale-major"];case"minor":return t["scale-minor"];case"harmonicMinor":return t["scale-harmonic-minor"];case"harmonicMajor":return t["scale-harmonic-major"];case"melodicMinor":return t["scale-melodic-minor"];case"ionian":return t["scale-ionian"];case"dorian":return t["scale-dorian"];case"phrygian":return t["scale-phrygian"];case"lydian":return t["scale-lydian"];case"mixolydian":return t["scale-mixolydian"];case"aeolian":return t["scale-aeolian"];case"locrian":return t["scale-locrian"];case"majorPentatonic":return t["scale-major-pentatonic"];case"minorPentatonic":return t["scale-minor-pentatonic"];case"majorBlues":return t["scale-major-blues"];case"minorBlues":return t["scale-minor-blues"];case"halfWholeDiminished":return t["scale-half-whole-diminished"];case"wholeHalfDiminished":return t["scale-whole-half-diminished"];case"wholeTone":return t["scale-whole-tone"]}},vX=Array.from({length:12},(e,t)=>["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][t]),bX=J.div`
  display: flex;
  flex-direction: row;
`,Ub=J.div`
  display: flex;
  flex-direction: column;
`,_X=({open:e,onOpenChange:t})=>{const{keySignature:n,setKeySignature:r}=Me(),o=()=>t(!1);return G(hn,{open:e,onOpenChange:o,style:{minWidth:"20rem"},children:[u(bn,{children:u(N,{name:"scale"})}),u(qt,{children:G(bX,{style:{gap:"1rem"},children:[G(Ub,{style:{gap:"0.5rem",minWidth:"5rem"},children:[u(so,{children:u(N,{name:"key"})}),u(Za,{value:n==null?void 0:n.key,onChange:s=>{const a=parseInt(s.target.value);r({scale:(n==null?void 0:n.scale)??"major",key:a})},children:vX.map((s,a)=>u("option",{value:a,children:s},a))})]}),G(Ub,{style:{gap:"0.5rem",minWidth:"5rem"},children:[u(so,{children:u(N,{name:"scale"})}),u(Za,{value:n==null?void 0:n.scale,onChange:s=>{const a=s.target.value;r({key:(n==null?void 0:n.key)??0,scale:a})},children:ed.values.map((s,a)=>u("option",{value:s,children:u(gX,{scale:s})},a))})]})]})}),u(gn,{children:u(Et,{onClick:o,children:u(N,{name:"close"})})})]})},yX=e=>{const{handleClose:t}=e,{keySignature:n,setKeySignature:r}=Me(),[o,s]=p.useState(!1);return G(Ke,{children:[G(ea,{...e,children:[u(We,{onClick:()=>{n===null&&r({scale:"major",key:0}),s(!0),t()},children:u(N,{name:"show-scale"})}),u(We,{onClick:()=>{r(null),t()},disabled:n===null,children:u(N,{name:"hide-scale"})})]}),u(_X,{open:o,onOpenChange:s})]})},Xr=[0,1,0,1,0,0,1,0,1,0,1,0];function SX(e,t){const n=e.createLinearGradient(0,0,t,0);return n.addColorStop(0,"rgba(33, 33, 33, 1.000)"),n.addColorStop(.895,"rgba(96, 93, 93, 1.000)"),n.addColorStop(.924,"rgba(48, 48, 48, 1.000)"),n.addColorStop(1,"rgba(0, 0, 0, 1.000)"),n}function E3(e,t,n){e.lineWidth=1,e.strokeStyle=n,e.beginPath(),e.moveTo(0,0),e.lineTo(t,0),e.closePath(),e.stroke()}function kX(e,t,n,r,o,s,a){o&&(e.fillStyle=r.themeColor,e.fillRect(0,.5,t,n)),s&&(e.fillStyle=r.themeColor,e.fillRect(t-4,.5,4,n)),a&&E3(e,t,r.dividerColor)}function wX(e,t,n,r,o,s,a,i){const c=Math.round(r/2);e.fillStyle=a,e.fillRect(0,.5,t,r),s&&(e.fillStyle=o.themeColor,e.fillRect(t-4,.5,4,r)),e.lineWidth=1,e.strokeStyle=i,e.beginPath(),e.moveTo(t,c),e.lineTo(n,c),e.closePath(),e.stroke()}function xX(e,t,n,r,o,s){const a=t-5;e.textAlign="right",e.textBaseline="middle",e.font=`12px ${o}`,e.fillStyle=s,e.fillText(r,a,n/2)}function CX(e,t,n,r,o,s,a,i){e.save(),e.translate(0,.5),e.fillStyle=s.pianoKeyWhite,e.fillRect(0,0,n,r*o);const c=[...Array(o).keys()],l=c.filter(_=>Xr[_%Xr.length]===0),f=c.filter(_=>Xr[_%Xr.length]===1);E3(e,n,s.dividerColor);for(const _ of l){let y=(o-_-1)*r;const k=a.has(_),g=i.includes(_%12),b=_%12===4||_%12===11,h=Xr[(_-1)%Xr.length]===1,S=Xr[(_+1)%Xr.length]===1;let x=r;h&&(x+=.5*r),S&&(y-=.5*r,x+=.5*r),e.save(),e.translate(0,y),kX(e,n,x,s,k,g,b),e.restore()}const d=SX(e,t),m=gt(s.dividerColor).alpha(.3).string();for(const _ of f){const y=(o-_-1)*r,k=a.has(_),g=i.includes(_%12);e.save(),e.translate(0,y),wX(e,t,n,r,s,g,k?s.themeColor:d,m),e.restore()}const v=new Map(c.filter(_=>_%12===0).map(_=>[_,nH(_)]));for(const[_,y]of v){const k=(o-_-1)*r;e.save(),e.translate(0,k),xX(e,n,r,y,s.canvasFont,s.secondaryTextColor),e.restore()}e.restore()}const TX=J.div``,MX=J.div`
  border-right: 1px solid var(--color-divider);
  pointer-events: none;
`,EX=J.div`
  position: absolute;
  left: 0;
  width: ${Vt.drumKeysWidth}px;
  display: flex;
  align-items: center;
  color: var(--color-text-secondary);
  font-size: 0.75rem;
  border-bottom: 1px solid rgb(from var(--color-divider) r g b / 40%);
  padding-left: 0.25rem;

  &:last-child {
    border-top: 1px solid var(--color-divider);
  }

  &[data-highlighted="true"] {
    border-bottom: 1px solid var(--color-divider);
  }
`,IX=({noteNumber:e,name:t})=>{const{transform:n}=vo(),r=p.useMemo(()=>({top:n.getY(e),height:n.pixelsPerKey}),[e,n]);return u(EX,{style:r,"data-highlighted":e%12===0,children:t})},AX=({width:e,keyNames:t})=>{const n=Array.from(t.entries()),r=p.useMemo(()=>({width:e-1}),[e]);return u(MX,{style:r,children:n.map(([o,s])=>u(IX,{noteNumber:o,name:s},o))})},RX=({style:e})=>{const t=$t(),n=Vt.keyWidth*Vt.blackKeyWidthRatio,{keySignature:r,keyHeight:o,numberOfKeys:s,selectedKeys:a}=M3(),i=p.useCallback(c=>{const l=r!==null?Oc.getIntervals(r):[];CX(c,n,Vt.keyWidth,o,s,t,a,l)},[s,t,a,r,o,n]);return u(Vk,{draw:i,width:Vt.keyWidth,height:o*s,style:e})},OX=({width:e})=>{const t=Vt.keyWidth*Vt.blackKeyWidthRatio,{onContextMenu:n,menuProps:r}=Ks(),{keyHeight:o,numberOfKeys:s,keyNames:a,onMouseDownKey:i,onMouseMoveKey:c,onMouseUpKey:l}=M3(),f=p.useCallback(v=>{if(v.button!==0)return;const _=a?Vt.drumKeysWidth+t:t;function y(b,h){const S=s-h/o,x=Math.floor(S),w=Xr[x%Xr.length]!==0;return b>_&&w?Math.round(S)-Math.floor(S)?x+1:x-1:x}const k={x:v.nativeEvent.offsetX,y:v.nativeEvent.offsetY};let g=y(k.x,k.y);i(g),us(v.nativeEvent,{onMouseMove(b,h){const S=on.add(k,h),x=y(S.x,S.y);x!==g&&(c(x),g=x)},onMouseUp(){l()}})},[s,o,t,i,c,l,a]),d=p.useMemo(()=>({width:e,height:o*s}),[e,o,s]),m=p.useMemo(()=>({position:"absolute",top:0,left:a?Vt.drumKeysWidth:0,pointerEvents:"none"}),[a]);return G(Ke,{children:[G(TX,{onMouseDown:f,onContextMenu:n,style:d,children:[a&&u(AX,{width:Vt.drumKeysWidth,keyNames:a}),u(RX,{style:m})]}),u(yX,{...r})]})},PX=()=>{const{toggleTool:e}=Me();return{onMouseDown(){e()}}},BX=()=>{const{scrollBy:e}=Me(),{setAutoScroll:t}=kt();return{onMouseDown(){jr({onMouseMove:n=>{e(n.movementX,n.movementY),t(!1)}})}}};var Go;(e=>{e.clamp=o=>({tick:Math.max(0,o.tick),noteNumber:hc.clamp(o.noteNumber)});function t(o,s){return o.tick===s.tick&&o.noteNumber===s.noteNumber}e.equals=t;function n(o,s){return{tick:o.tick-s.tick,noteNumber:o.noteNumber-s.noteNumber}}e.sub=n;function r(o,s){return{tick:o.tick+s.tick,noteNumber:o.noteNumber+s.noteNumber}}e.add=r})(Go||(Go={}));function DX(){const{getSelection:e,getSelectedTrack:t,getSelectedNoteIds:n,setSelection:r}=Me();return{getDraggablePosition:p.useCallback(o=>{const s=e(),a=t();switch(o.type){case"note":{if(a===void 0)return null;const i=a.getEventById(o.noteId);if(i===void 0||!en(i))return null;switch(o.position){case"center":return i;case"left":return i;case"right":return{tick:i.tick+i.duration,noteNumber:i.noteNumber}}break}case"selection":{if(s===null)return null;switch(o.position){case"center":return Fn.getFrom(s);case"left":return Fn.getFrom(s);case"right":return Fn.getTo(s)}break}}},[t,e]),updateDraggable:p.useCallback((o,s)=>{const a=e(),i=t();switch(o.type){case"note":{if(i===void 0)return;const c=i.getEventById(o.noteId);if(c===void 0||!en(c))return;switch(o.position){case"center":{i.updateEvent(c.id,s);break}case"left":{if(s.tick===void 0)return;i.updateEvent(c.id,{tick:s.tick,duration:c.duration+c.tick-s.tick});break}case"right":{if(s.tick===void 0)return;i.updateEvent(c.id,{duration:s.tick-c.tick});break}}break}case"selection":{if(a===null)return;switch(o.position){case"center":{const c=Fn.getFrom(a),l={...c,...s},f=Go.sub(l,c);r(Fn.moved(a,f.tick,f.noteNumber));break}case"left":{if(s.tick===void 0)return;r({...a,fromTick:s.tick});break}case"right":{if(s.tick===void 0)return;r({...a,toTick:s.tick});break}}break}}},[e,t,r]),getDraggableArea:p.useCallback((o,s=0)=>{const a=n(),i=t();if(i===void 0)return null;switch(o.type){case"note":{const c=i.getEventById(o.noteId);if(c===void 0||!en(c))return null;const l=a.map(m=>i.getEventById(m)).filter(Mo).filter(en),f=Qe.min(l.map(m=>m.tick))??0,d=c.tick-f;switch(o.position){case"center":{const m=Qe.max(l.map(k=>k.noteNumber))??0,v=Qe.min(l.map(k=>k.noteNumber))??0,_=c.noteNumber-v,y=Ma-(m-c.noteNumber);return{tickRange:Ft.create(d,1/0),noteNumberRange:Ft.create(_,y)}}case"left":return{tickRange:Ft.create(d,c.tick+c.duration-s),noteNumberRange:Ft.point(c.noteNumber)};case"right":return{tickRange:Ft.create(c.tick+s,1/0),noteNumberRange:Ft.point(c.noteNumber)}}break}case"selection":{const c=e(),l=n();if(c===null)return null;const f=l.map(v=>i.getEventById(v)).filter(Mo).filter(en),d=Qe.min(f.map(v=>v.tick))??0,m=c.fromTick-d;switch(o.position){case"center":{const v=c.fromNoteNumber-c.toNoteNumber;return{tickRange:Ft.create(m,1/0),noteNumberRange:Ft.create(v-1,Ma+1)}}case"left":{const v=Qe.max(f.map(k=>k.duration))??0,_=c.toTick-s,y=c.fromTick+(v-s);return{tickRange:Ft.create(m,Math.min(_,y)),noteNumberRange:Ft.point(c.fromNoteNumber)}}case"right":{const v=Qe.max(f.map(k=>k.duration))??0,_=c.fromTick+s,y=c.toTick-(v-s);return{tickRange:Ft.create(Math.max(_,y),1/0),noteNumberRange:Ft.point(c.fromNoteNumber)}}}}}},[e,n,t])}}const NX=10,Gb=(e,t)=>({tick:t.tickRange!==void 0?Ft.clamp(t.tickRange,e.tick):e.tick,noteNumber:t.noteNumberRange!==void 0?Ft.clamp(t.noteNumberRange,e.noteNumber):e.noteNumber}),hf=()=>{const{transform:e,getLocal:t}=Me(),{isQuantizeEnabled:n,quantize:r,quantizeRound:o}=Nn(),{getDraggablePosition:s,getDraggableArea:a,updateDraggable:i}=DX(),{pushHistory:c}=ht();return{onMouseDown(l,f,d=[],m={}){const v=s(f);if(v===null)return;let _=!1;const y=t(l),k=e.getNotePoint(y),g=Go.sub(v,k),b=d.map(h=>s(h));us(l,{onMouseMove:(h,S)=>{var A;const x=!h.shiftKey&&n,w=x?r:NX,I=a(f,w);if(I===null)return;const M=s(f);if(M===null)return;const H=(()=>{const L=on.add(y,S),B=Go.add(e.getNotePoint(L),g),P=x?{tick:o(B.tick),noteNumber:B.noteNumber}:B;return Gb(P,I)})();if(Go.equals(H,M))return;const j=Go.sub(H,v),W=d.map((L,B)=>{const P=b[B];if(P===null)return null;const V=a(L,w);if(V===null)return null;const U=Go.add(P,j);return Gb(U,V)});_||(_=!0,c()),Mn(()=>{i(f,H),d.forEach((L,B)=>{const P=W[B];P===null||P===null||i(L,P)})}),(A=m==null?void 0:m.onChange)==null||A.call(m,h,{oldPosition:M,newPosition:H})},onMouseUp:h=>{var S;(S=m==null?void 0:m.onMouseUp)==null||S.call(m,h)},onClick:h=>{var S;(S=m==null?void 0:m.onClick)==null||S.call(m,h)}})}}},$1=e=>()=>{const{selectedTrackId:t,selectedNoteIds:n,setLastNoteDuration:r}=Me(),{channel:o,getEventById:s}=wt(t),a=jS(),i=hf(),{previewNoteOn:c,previewNoteOff:l}=$d();return{onMouseDown(f,d){if(o===void 0)return;const m=s(d);if(m==null||!en(m))return;const v=n.includes(d);v||a(d);const _=v?n:[d];c(m.noteNumber),i.onMouseDown(f,{type:"note",position:e,noteId:d},_.filter(y=>y!==d).map(y=>({type:"note",position:e,noteId:y})),{onChange(y,{oldPosition:k,newPosition:g}){const b=s(d);b==null||!en(b)||(k.tick!==g.tick&&r(b.duration),k.noteNumber!==g.noteNumber&&(l(),c(b.noteNumber)))},onMouseUp(){l()},onClick(y){y.shiftKey||a(d)}})}}},LX=$1("left"),zX=$1("right"),I3=$1("center"),FX=()=>{const{transform:e,selectedTrackId:t,newNoteVelocity:n,lastNoteDuration:r,getLocal:o}=Me(),{quantizeRound:s,quantizeFloor:a,quantizeUnit:i}=Nn(),{channel:c,isRhythmTrack:l,addEvent:f}=wt(t),{timebase:d}=_t(),{pushHistory:m}=ht(),v=I3();return{onMouseDown:p.useCallback(_=>{if(_.shiftKey)return;const y=o(_),{tick:k,noteNumber:g}=e.getNotePoint(y);if(c==null||!hc.isValid(g))return;m();const b=l?s(k):a(k),h=l?d/8:r??i,S=f({type:"channel",subtype:"note",noteNumber:g,tick:b,velocity:n,duration:h});S!==void 0&&v.onMouseDown(_,S.id)},[e,o,c,l,s,a,i,d,n,r,f,m,v])}},WX=()=>{const{transform:e,getLocal:t,setSelection:n,selectedTrackId:r,setSelectedNoteIds:o}=Me(),{quantizeRound:s}=Nn();let{selection:a}=Me();const{getEvents:i}=wt(r),{isPlaying:c,setPosition:l}=Lt(),{setSelectedEventIds:f}=Yt();return{onMouseDown(d){const m=t(d),v=e.getNotePoint(m),_=m;c||l(s(v.tick)),f([]),a=Fn.fromPoints(v,v),n(a),us(d,{onMouseMove:(y,k)=>{const g=on.add(_,k),b=e.getNotePoint(g);a=Fn.fromPoints(v,b),n(a)},onMouseUp:()=>{a!==null&&(o(VS(i(),a).map(y=>y.id)),n(null))}})}}},$X=()=>{const e=FX(),t=WX();return{onMouseDown(n){switch(n.button){case 0:return n.shiftKey||n.metaKey?t.onMouseDown(n):e.onMouseDown(n);default:return null}}}},VX=()=>{const{transform:e,selectedTrackId:t,getLocal:n,setSelection:r,setSelectedNoteIds:o}=Me(),{quantizeRound:s}=Nn(),{selection:a}=Me(),{getEvents:i}=wt(t),{isPlaying:c,setPosition:l}=Lt(),{setSelectedEventIds:f}=Yt();return{onMouseDown:p.useCallback(d=>{let m=a;const v=n(d),_=e.getNotePointFractional(v),y=v;c||l(s(_.tick)),f([]),m=Fn.fromPoints(_,_),r(m),us(d,{onMouseMove:(k,g)=>{const b=on.add(y,g),h=e.getNotePointFractional(b);m=Fn.fromPoints({..._,tick:s(_.tick)},{...h,tick:s(h.tick)}),r(m)},onMouseUp:()=>{if(m!==null){if(Fn.isEmpty(m)){r(null),o([]);return}o(VS(i(),m).map(k=>k.id))}}})},[n,r,o,a,i,c,l,e,s,f])}},jX=()=>{const e=VX();return{onMouseDown(t){return t.relatedTarget?null:t.button===0?e.onMouseDown(t):null}}},HX=()=>{const{mouseMode:e}=Me(),t=$X(),n=jX(),r=p.useMemo(()=>{switch(e){case"pencil":return t;case"selection":return n}},[e,t,n]),o=BX(),s=PX(),a=p.useCallback(i=>i.button===1?o:i.button===2&&i.detail%2===0?s:r,[s,r,o]);return{onMouseDown:p.useCallback(i=>{const c=i.nativeEvent;a(c).onMouseDown(c)},[a])}},UX=it.memo(e=>{const{handleClose:t}=e,{selectedNoteIds:n,setOpenTransposeDialog:r,setOpenVelocityDialog:o}=Me(),s=n.length>0,a=vi(),i=bi(),c=Vd(),l=jd(),f=Hd(),d=Zc(),m=()=>{a(),i(),t()},v=()=>{a(),t()},_=()=>{c(),t()},y=()=>{l(),t()},k=()=>{i(),t()},g=()=>{d(12),t()},b=()=>{d(-12),t()},h=()=>{f(),t()},S=()=>{r(!0),t()},x=()=>{o(!0),t()};return G(ea,{...e,children:[G(We,{onClick:m,disabled:!s,children:[u(N,{name:"cut"}),G(nn,{children:[ut.cmdOrCtrl,"+X"]})]}),G(We,{onClick:v,disabled:!s,children:[u(N,{name:"copy"}),G(nn,{children:[ut.cmdOrCtrl,"+C"]})]}),G(We,{onClick:_,children:[u(N,{name:"paste"}),G(nn,{children:[ut.cmdOrCtrl,"+V"]})]}),G(We,{onClick:y,disabled:!s,children:[u(N,{name:"duplicate"}),G(nn,{children:[ut.cmdOrCtrl,"+D"]})]}),G(We,{onClick:k,disabled:!s,children:[u(N,{name:"delete"}),u(nn,{children:"Del"})]}),u(qn,{}),G(We,{onClick:g,disabled:!s,children:[u(N,{name:"one-octave-up"}),u(nn,{children:"Shift+"})]}),G(We,{onClick:b,disabled:!s,children:[u(N,{name:"one-octave-down"}),u(nn,{children:"Shift+"})]}),G(We,{onClick:S,disabled:!s,children:[u(N,{name:"transpose"}),u(nn,{children:"T"})]}),u(qn,{}),G(We,{onClick:h,disabled:!s,children:[u(N,{name:"quantize"}),u(nn,{children:"Q"})]}),u(We,{onClick:x,disabled:!s,children:u(N,{name:"velocity"})})]})}),A3=e=>{const t=$t(),{color:n}=wt(e),r=St(gt(t.ghostNoteColor)),o=dL(Qa()),s=n!==void 0?J9(n):null,a=s!==null?uL(Qa(),s,r,.7):r;return{inactiveColor:o,activeColor:a,selectedColor:a,strokeColor:o}};function R3(e){const{transform:t}=Me(),{isRhythmTrack:n}=wt(e),r=_S(e),o=Od(r);Om(r);const s=p.useMemo(()=>o.filter(en),[o]),a=p.useCallback(c=>n?t.getDrumRect(c):t.getRect(c),[t,n]);return{notes:p.useMemo(()=>s.map(c=>({...a(c),id:c.id,velocity:127,noteNumber:c.noteNumber,isSelected:!1})),[s,a]),isRhythmTrack:n}}class Rs{constructor(t,n,r,o,s=t.FLOAT){ee(this,"gl");ee(this,"position");ee(this,"size");ee(this,"type");if(this.gl=t,this.position=t.getAttribLocation(n,r),this.position<0)throw new Error(`failed to getAttribLocation ${r}`);this.size=o,this.type=s}upload(t){const{gl:n}=this;n.bindBuffer(n.ARRAY_BUFFER,t),n.vertexAttribPointer(this.position,this.size,this.type,!1,0,0),n.enableVertexAttribArray(this.position)}}function GX(e,t,n){const r=Xb(e,e.VERTEX_SHADER,t),o=Xb(e,e.FRAGMENT_SHADER,n),s=e.createProgram();if(e.attachShader(s,r),e.attachShader(s,o),e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS)){const a=e.getProgramInfoLog(s);throw e.deleteProgram(s),new Error("Unable to initialize the shader program: "+a)}return s}function Xb(e,t,n){const r=e.createShader(t);if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){const o=e.getShaderInfoLog(r);throw e.deleteShader(r),new Error("An error occurred compiling the shaders: "+o)}return r}class V1{constructor(t,n,r,o,s,a){ee(this,"gl");ee(this,"bufferFactory");ee(this,"program");ee(this,"attributes");ee(this,"uniforms");this.gl=t,this.bufferFactory=a;const i=GX(t,n,r);this.program=i,this.attributes=o(i),this.uniforms=s(i)}setUniforms(t){for(let n in t)this.uniforms[n].value=t[n]}draw(t){if(t.vertexCount===0)return;const{gl:n}=this;Object.keys(this.attributes).forEach(r=>this.attributes[r].upload(t.buffers[r])),n.useProgram(this.program),Object.values(this.uniforms).forEach(r=>r.upload(n)),n.drawArrays(n.TRIANGLES,0,t.vertexCount)}createBuffer(){return this.bufferFactory(this.gl)}}class j1{constructor(t,n=(r,o)=>r===o){ee(this,"_isDirty");ee(this,"_value");ee(this,"isEqual");this._value=t,this._isDirty=!0,this.isEqual=n}get isDirty(){return this._isDirty}set value(t){this.isEqual(this._value,t)||(this._isDirty=!0,this._value=t)}get value(){return this._value}mark(){this._isDirty=!1}}class H1{constructor(t,n,r,o,s){ee(this,"location");ee(this,"prop");ee(this,"uploadFunc");const a=t.getUniformLocation(n,r);if(a===null)throw new Error(`failed to getUniformLocation ${r}`);this.location=a,this.prop=o,this.uploadFunc=s}set value(t){this.prop.value=t}get value(){return this.prop.value}upload(t){this.prop.isDirty&&(this.uploadFunc(t,this.location,this.prop.value),this.prop.mark())}}const U1=(e,t,n,r=ta())=>new H1(e,t,n,new j1(r,u1),(o,s,a)=>o.uniformMatrix4fv(s,!1,a)),Zi=(e,t,n,r=Qa())=>new H1(e,t,n,new j1(r,d1),(o,s,a)=>o.uniform4fv(s,a)),XX=(e,t,n,r=0)=>new H1(e,t,n,new j1(r),(o,s,a)=>o.uniform1f(s,a));let O3=class{constructor(t){ee(this,"gl");ee(this,"buffers");ee(this,"_vertexCount",0);this.gl=t,this.buffers={position:t.createBuffer(),bounds:t.createBuffer(),color:t.createBuffer()}}update(t){const{gl:n}=this,r=t.flatMap(Cr);n.bindBuffer(n.ARRAY_BUFFER,this.buffers.position),n.bufferData(n.ARRAY_BUFFER,new Float32Array(r),n.DYNAMIC_DRAW);const o=t.flatMap(p1);n.bindBuffer(n.ARRAY_BUFFER,this.buffers.bounds),n.bufferData(n.ARRAY_BUFFER,new Float32Array(o),n.DYNAMIC_DRAW);const s=t.flatMap(a=>Array.from(Array(6)).flatMap(()=>Array.from(a.color)));n.bindBuffer(n.ARRAY_BUFFER,this.buffers.color),n.bufferData(n.ARRAY_BUFFER,new Float32Array(s),n.DYNAMIC_DRAW),this._vertexCount=t.length*6}get vertexCount(){return this._vertexCount}};const KX=e=>new V1(e,`
      precision lowp float;
      attribute vec4 aVertexPosition;

      // XYZW -> X, Y, Width, Height
      attribute vec4 aBounds;
      attribute vec4 aColor;

      uniform mat4 uProjectionMatrix;
      varying vec4 vBounds;
      varying vec2 vPosition;
      varying vec4 vColor;

      void main() {
        gl_Position = uProjectionMatrix * aVertexPosition;
        vBounds = aBounds;
        vPosition = aVertexPosition.xy;
        vColor = aColor;
      }
    `,`
      precision lowp float;

      uniform vec4 uStrokeColor;
      varying vec4 vBounds;
      varying vec2 vPosition;
      varying vec4 vColor;

      void main() {
        float border = 1.0;
        float localX = vPosition.x - vBounds.x;
        float localY = vPosition.y - vBounds.y;

        if ((localX < border) || (localX >= (vBounds.z - border)) || (localY < border) || (localY > (vBounds.w - border))) {
          // draw outline
          gl_FragColor = uStrokeColor;
        } else {
          gl_FragColor = vColor;
        }
      }
    `,t=>({position:new Rs(e,t,"aVertexPosition",2),bounds:new Rs(e,t,"aBounds",4),color:new Rs(e,t,"aColor",4)}),t=>({projectionMatrix:U1(e,t,"uProjectionMatrix"),strokeColor:Zi(e,t,"uStrokeColor")}),t=>new O3(t)),YX=e=>new V1(e,`
      precision lowp float;
      attribute vec4 aVertexPosition;

      // XYZW -> X, Y, Width, Height
      attribute vec4 aBounds;
      attribute vec4 aColor;

      uniform mat4 uProjectionMatrix;
      varying vec4 vBounds;
      varying vec2 vPosition;
      varying vec4 vColor;

      void main() {
        gl_Position = uProjectionMatrix * aVertexPosition;
        vBounds = aBounds;
        vPosition = aVertexPosition.xy;
        vColor = aColor;
      }
    `,`
      precision lowp float;

      uniform vec4 uFillColor;
      uniform vec4 uStrokeColor;

      varying vec4 vBounds;
      varying vec2 vPosition;
      varying vec4 vColor;

      void main() {
        float border = 1.0;
        
        float r = vBounds.w / 2.0;
        vec2 center = vBounds.xy + vBounds.zw / 2.0;
        float len = length(vPosition - center);

        if (len < r - border) {
          gl_FragColor = vColor;
        } else if (len < r) {
          gl_FragColor = uStrokeColor;
        }
      }
    `,t=>({position:new Rs(e,t,"aVertexPosition",2),bounds:new Rs(e,t,"aBounds",4),color:new Rs(e,t,"aColor",4)}),t=>({projectionMatrix:U1(e,t,"uProjectionMatrix"),strokeColor:Zi(e,t,"uStrokeColor")}),t=>new O3(t)),P3=({rects:e,strokeColor:t,zIndex:n})=>{const r=nr();return u(Tr,{shader:null,shaderFallback:YX,uniforms:{projectionMatrix:r,strokeColor:t},buffer:e,zIndex:n})},B3=({rects:e,strokeColor:t,zIndex:n})=>{const r=nr();return u(Tr,{shader:null,shaderFallback:KX,uniforms:{projectionMatrix:r,strokeColor:t},buffer:e,zIndex:n})},qX=({zIndex:e,trackId:t})=>{const n=A3(t),{notes:r,isRhythmTrack:o}=R3(t),s=a=>({...a,color:n.activeColor});return o?u(P3,{strokeColor:n.strokeColor,rects:r.map(s),zIndex:e}):u(B3,{strokeColor:n.strokeColor,rects:r.map(s),zIndex:e+.1})};class D3{constructor(t){ee(this,"_instanceCount",0);ee(this,"boundsBuffer",new Float32Array(0));ee(this,"stateBuffer",new Float32Array(0));this.vertexArray=t,this.vertexArray.updateBuffer("position",new Float32Array(Cr({x:0,y:0,width:1,height:1})))}update(t){(this.boundsBuffer.length<t.length*4||this.stateBuffer.length<t.length*2)&&(this.boundsBuffer=new Float32Array(t.length*4),this.stateBuffer=new Float32Array(t.length*2));for(let n=0;n<t.length;n++){const r=t[n];this.boundsBuffer[n*4+0]=r.x,this.boundsBuffer[n*4+1]=r.y,this.boundsBuffer[n*4+2]=r.width,this.boundsBuffer[n*4+3]=r.height,this.stateBuffer[n*2+0]=r.velocity/127,this.stateBuffer[n*2+1]=r.isSelected?1:0}this.vertexArray.updateBuffer("bounds",this.boundsBuffer.subarray(0,t.length*4)),this.vertexArray.updateBuffer("state",this.stateBuffer.subarray(0,t.length*2)),this._instanceCount=t.length}get vertexCount(){return 6}get instanceCount(){return this._instanceCount}}const ZX=e=>new Po(e,`#version 300 es
      precision lowp float;

      uniform mat4 projectionMatrix;

      in vec4 position;
      in vec4 bounds;  // [x, y, width, height]
      in vec2 state; // [velocity, isSelected]

      out vec4 vBounds;
      out vec2 vPosition;
      out vec2 vState;

      void main() {
        vec4 transformedPosition = vec4((position.xy * bounds.zw + bounds.xy), position.zw);
        gl_Position = projectionMatrix * transformedPosition;
        vBounds = bounds;
        vPosition = transformedPosition.xy;
        vState = state;
      }
    `,`#version 300 es
      precision lowp float;

      uniform vec4 strokeColor;
      uniform vec4 selectedColor;
      uniform vec4 inactiveColor;
      uniform vec4 activeColor;

      in vec4 vBounds;
      in vec2 vPosition;
      in vec2 vState;

      out vec4 outColor;

      void main() {
        float border = 1.0;
        float localX = vPosition.x - vBounds.x;
        float localY = vPosition.y - vBounds.y;

        float outlineTop = step(border, localY);
        float outlineBottom = step(localY, vBounds.w - border);
        float outlineLeft = step(border, localX);
        float outlineRight = step(localX, vBounds.z - border);
        
        float isOutline = outlineTop * outlineBottom * outlineLeft * outlineRight;
    
        if (isOutline < 1.0) {
          // draw outline
          outColor = strokeColor;
        } else {
          // if selected, draw selected color
          // otherwise, draw color based on velocity by mixing active and inactive color
          outColor = mix(mix(inactiveColor, activeColor, vState.x), selectedColor, vState.y);
        }
      }
    `,{position:{size:2,type:e.FLOAT},bounds:{size:4,type:e.FLOAT,divisor:1},state:{size:2,type:e.FLOAT,divisor:1}},{projectionMatrix:Oo(),strokeColor:fn(),inactiveColor:fn(),activeColor:fn(),selectedColor:fn()},t=>new D3(t)),QX=e=>new Po(e,`#version 300 es
      precision lowp float;

      uniform mat4 projectionMatrix;

      in vec4 position;
      in vec4 bounds;  // [x, y, width, height]
      in vec2 state; // [velocity, isSelected]

      out vec4 vBounds;
      out vec2 vPosition;
      out vec2 vState;

      void main() {
        vec4 transformedPosition = vec4((position.xy * bounds.zw + bounds.xy), position.zw);
        gl_Position = projectionMatrix * transformedPosition;
        vBounds = bounds;
        vPosition = transformedPosition.xy;
        vState = state;
      }
    `,`#version 300 es
      precision lowp float;

      uniform vec4 strokeColor;
      uniform vec4 selectedColor;
      uniform vec4 inactiveColor;
      uniform vec4 activeColor;

      in vec4 vBounds;
      in vec2 vPosition;
      in vec2 vState;

      out vec4 outColor;

      void main() {
        float border = 1.0;
        
        float r = vBounds.w / 2.0;
        vec2 center = vBounds.xy + vBounds.zw / 2.0;
        float len = length(vPosition - center);

        if (len < r - border) {
          // if selected, draw selected color
          // otherwise, draw color based on velocity by mixing active and inactive color
          outColor = mix(mix(inactiveColor, activeColor, vState.x), selectedColor, vState.y);
        } else if (len < r) {
          outColor = strokeColor;
        }
      }
    `,{position:{size:2,type:e.FLOAT},bounds:{size:4,type:e.FLOAT,divisor:1},state:{size:2,type:e.FLOAT,divisor:1}},{projectionMatrix:Oo(),strokeColor:fn(),inactiveColor:fn(),activeColor:fn(),selectedColor:fn()},t=>new D3(t)),N3=({rects:e,strokeColor:t,selectedColor:n,inactiveColor:r,activeColor:o,zIndex:s})=>{const a=nr();return u(Tr,{shader:QX,uniforms:{projectionMatrix:a,strokeColor:t,selectedColor:n,inactiveColor:r,activeColor:o},buffer:e,zIndex:s})},L3=({rects:e,strokeColor:t,inactiveColor:n,activeColor:r,selectedColor:o,zIndex:s})=>{const a=nr();return u(Tr,{shader:ZX,uniforms:{projectionMatrix:a,strokeColor:t,selectedColor:o,inactiveColor:n,activeColor:r},buffer:e,zIndex:s})},JX=e=>u(nl,{component:eK,fallback:qX,...e}),eK=({zIndex:e,trackId:t})=>{const{notes:n,isRhythmTrack:r}=R3(t),o=A3(t);return r?u(N3,{rects:n,zIndex:e,...o}):u(L3,{rects:n,zIndex:e+.1,...o})};let tK=class{constructor(t){this.vertexArray=t}update(t){const n=Cr(t);this.vertexArray.updateBuffer("position",new Float32Array(n))}get vertexCount(){return 6}};const nK=e=>new Po(e,`#version 300 es
      precision lowp float;

      uniform mat4 projectionMatrix;
      in vec4 position;
      out vec4 vPosition;

      void main() {
        gl_Position = projectionMatrix * position;
        vPosition = position;
      }
    `,`#version 300 es
      precision lowp float;

      uniform vec4 color;
      uniform vec4 highlightedColor;
      uniform vec4 laneColors[12];
      uniform float height;
      
      in vec4 vPosition;

      out vec4 outColor;
      
      void main() {
        float screenHeight = height * 128.0;
        float modY = mod(screenHeight - vPosition.y, height * 12.0);
        float lineWidth = 1.0;

        if (modY < height - lineWidth) {
          outColor = laneColors[0];
        } else if (modY < height) {
          outColor = color;
        } else if (modY < height * 2.0 - lineWidth) {
          outColor = laneColors[1];
        } else if (modY < height * 2.0) {
          outColor = color;
        } else if (modY < height * 3.0 - lineWidth) {
          outColor = laneColors[2];
        } else if (modY < height * 3.0) {
          outColor = color;
        } else if (modY < height * 4.0 - lineWidth) {
          outColor = laneColors[3];
        } else if (modY < height * 4.0) {
          outColor = color;
        } else if (modY < height * 5.0 - lineWidth) {
          outColor = laneColors[4];
        } else if (modY < height * 5.0) {
          outColor = color;
        } else if (modY < height * 6.0 - lineWidth) {
          outColor = laneColors[5];
        } else if (modY < height * 6.0) {
          outColor = color;
        } else if (modY < height * 7.0 - lineWidth) {
          outColor = laneColors[6];
        } else if (modY < height * 7.0) {
          outColor = color;
        } else if (modY < height * 8.0 - lineWidth) {
          outColor = laneColors[7];
        } else if (modY < height * 8.0) {
          outColor = color;
        } else if (modY < height * 9.0 - lineWidth) {
          outColor = laneColors[8];
        } else if (modY < height * 9.0) {
          outColor = color;
        } else if (modY < height * 10.0 - lineWidth) {
          outColor = laneColors[9];
        } else if (modY < height * 10.0) {
          outColor = color;
        } else if (modY < height * 11.0 - lineWidth) {
          outColor = laneColors[10];
        } else if (modY < height * 11.0) {
          outColor = color;
        } else if (modY < height * 12.0 - lineWidth) {
          outColor = laneColors[11];
        } else if (modY < height * 12.0) {
          outColor = highlightedColor;
        }
      }
    `,{position:{size:2,type:e.FLOAT}},{projectionMatrix:Oo(),color:fn(),highlightedColor:fn(),laneColors:{initialValue:new Float32Array(4*12),isEqual:Ep,upload:(t,n,r)=>t.uniform4fv(n,r,0,4*12)},height:mp()},t=>new tK(t)),rK=({rect:e,color:t,highlightedColor:n,laneColors:r,height:o,zIndex:s})=>{const a=nr();return u(Tr,{shader:nK,uniforms:{projectionMatrix:a,color:t,highlightedColor:n,laneColors:r,height:o},buffer:e,zIndex:s})};class oK{constructor(t){ee(this,"gl");ee(this,"buffers");this.gl=t,this.buffers={position:t.createBuffer()}}update(t){const{gl:n}=this,r=Cr(t);n.bindBuffer(n.ARRAY_BUFFER,this.buffers.position),n.bufferData(n.ARRAY_BUFFER,new Float32Array(r),n.DYNAMIC_DRAW)}get vertexCount(){return 6}}const sK=e=>new V1(e,`
      precision lowp float;
      attribute vec4 aVertexPosition;
      uniform mat4 uProjectionMatrix;
      varying vec4 vPosition;

      void main() {
        gl_Position = uProjectionMatrix * aVertexPosition;
        vPosition = aVertexPosition;
      }
    `,`
      precision lowp float;
      uniform vec4 uColor;
      uniform vec4 uHighlightedColor;
      uniform vec4 uBlackLaneColor;
      uniform float uHeight;
      varying vec4 vPosition;

      float step2(float x) {
        return step(0.0, x) * step(x, 1.0);
      }
      
      void main() {
        const float eps = 0.1;
        float y = vPosition.y;
        float border = 1.0;
        float index = 128.0 - y / uHeight;
        float key = mod(index, 12.0);

        // draw border
        if (abs(key) < eps || abs(key - 5.0) < eps) {
          vec4 color = mix(uHighlightedColor, uColor, step(0.1, key));
          gl_FragColor = step(fract(index) * uHeight, border) * color;
        }

        // draw black lane
        gl_FragColor += (
          step2(key - 1.0) + 
          step2(key - 3.0) + 
          step2(key - 6.0) + 
          step2(key - 8.0) + 
          step2(key - 10.0)
        ) * uBlackLaneColor;
      }
    `,t=>({position:new Rs(e,t,"aVertexPosition",2)}),t=>({projectionMatrix:U1(e,t,"uProjectionMatrix"),color:Zi(e,t,"uColor"),highlightedColor:Zi(e,t,"uHighlightedColor"),blackLaneColor:Zi(e,t,"uBlackLaneColor"),height:XX(e,t,"uHeight")}),t=>new oK(t)),aK=({rect:e,color:t,highlightedColor:n,blackLaneColor:r,height:o,zIndex:s})=>{const a=nr();return u(Tr,{shader:null,shaderFallback:sK,uniforms:{projectionMatrix:a,color:t,highlightedColor:n,blackLaneColor:r,height:o},buffer:e,zIndex:s})},iK=({zIndex:e})=>{const t=$t(),{scrollTop:n,canvasHeight:r,scaleY:o}=vo(),{canvasWidth:s}=kt(),a=p.useMemo(()=>St(gt(t.pianoLaneEdgeColor)),[t]),i=p.useMemo(()=>St(gt(t.editorGridColor)),[t]),c=St(gt(t.pianoBlackKeyLaneColor));return u(aK,{rect:{x:0,y:n,width:s,height:r},color:a,highlightedColor:i,blackLaneColor:c,height:o*Vt.keyHeight,zIndex:e})};function cK(e){const t=Oc.getIntervals(e);return new Array(12).fill(!1).map((n,r)=>t.includes(r%12))}const lK=e=>u(nl,{component:uK,fallback:iK,...e}),uK=({zIndex:e})=>{const t=$t(),{keySignature:n}=Me(),{canvasWidth:r}=kt(),{scrollTop:o,canvasHeight:s,scaleY:a}=vo(),i=p.useMemo(()=>{const f=St(gt(t.pianoWhiteKeyLaneColor)),d=St(gt(t.pianoBlackKeyLaneColor));if(n===null)return Float32Array.from(Array(12).fill(0).map((y,k)=>Oc.getIntervals({scale:"major",key:0}).includes(k)?f:d).flat());const m=cK(n),v=St(gt(t.pianoHighlightedLaneColor)),_=m.map(y=>y?v:f);return Float32Array.from(_.flat())},[t,n]),c=p.useMemo(()=>St(gt(t.pianoLaneEdgeColor)),[t]),l=p.useMemo(()=>St(gt(t.editorGridColor)),[t]);return u(rK,{rect:{x:0,y:o,width:r,height:s},color:c,highlightedColor:l,laneColors:i,height:a*Vt.keyHeight,zIndex:e})};function z3(){const{selectedTrackId:e}=Me(),{color:t}=wt(e),n=$t(),r=gt(t!==void 0?Ky(t):n.themeColor);return{baseColor:r,backgroundColor:gt(n.backgroundColor),selectedColor:St(r.lighten(.7)),borderColor:St(rw(r,n.isLightContent,.3)),inactiveColor:St(gt(n.backgroundColor)),activeColor:St(r)}}function dK(){const{transform:e,selectedTrack:t,selectedNoteIds:n}=Me(),r=Od().filter(en),o=p.useCallback(a=>t!=null&&t.isRhythmTrack?e.getDrumRect(a):e.getRect(a),[e,t==null?void 0:t.isRhythmTrack]);return p.useMemo(()=>r.map(a=>{const i=o(a),c=n.includes(a.id);return{...i,id:a.id,velocity:a.velocity,noteNumber:a.noteNumber,isSelected:c}}),[r,o,n])}const fK=()=>{const{selectedNoteIds:e,setSelectedNoteIds:t}=Me();return{onMouseDown(n,r){t([...e,r])}}},hK=()=>{const{selectedNoteIds:e,setSelectedNoteIds:t}=Me();return{onMouseDown(n,r){e.length!==0&&t(e.filter(o=>o!==r))}}},pK=({zIndex:e,notes:t})=>{const{selectedTrackId:n}=Me(),{isRhythmTrack:r}=wt(n),{borderColor:o,selectedColor:s,baseColor:a,backgroundColor:i}=z3(),c=l=>({...l,color:l.isSelected?s:St(a.mix(i,1-l.velocity/127))});return r?u(P3,{strokeColor:o,rects:t.map(c),zIndex:e}):u(B3,{strokeColor:o,rects:t.map(c),zIndex:e+.1})},mK="../midi/assets/font-atlas-BrcwQ_Sl.png";class gK{constructor(t){ee(this,"_instanceCount",0);ee(this,"bounds",new Float32Array(0));ee(this,"noteNumbers",new Float32Array(0));ee(this,"state",new Float32Array(0));this.vertexArray=t,this.vertexArray.updateBuffer("position",new Float32Array(Cr({x:0,y:0,width:1,height:1})))}update(t){this.bounds.length<t.length*4&&(this.bounds=new Float32Array(t.length*4)),this.noteNumbers.length<t.length&&(this.noteNumbers=new Float32Array(t.length)),this.state.length<t.length*2&&(this.state=new Float32Array(t.length*2));for(let n=0;n<t.length;n++){const r=t[n];this.bounds.set([r.x,r.y,r.width,r.height],n*4),this.noteNumbers[n]=r.noteNumber,this.state[n*2]=r.velocity/127,this.state[n*2+1]=r.isSelected?1:0}this.vertexArray.updateBuffer("bounds",this.bounds.subarray(0,t.length*4)),this.vertexArray.updateBuffer("a_noteNumber",this.noteNumbers.subarray(0,t.length)),this.vertexArray.updateBuffer("state",this.state.subarray(0,t.length*2)),this._instanceCount=t.length}get vertexCount(){return 6}get instanceCount(){return this._instanceCount}}const vK=e=>new Po(e,`#version 300 es
      precision highp float;

      in float a_noteNumber;
      in vec4 position;
      in vec4 bounds; // x, y, width, height
      in vec2 state; // [velocity, isSelected]

      uniform mat4 projectionMatrix;

      out vec2 v_uv;
      out vec2 v_state;
      out float v_drawX;
      out float v_clipBoundsR;

      void main() {
        const float scale = 0.7;
        const float border = 1.0;
        const float atlasCols = 16.0;
        const float atlasRows = 8.0;
        // Calculate label size (3 glyphs width, scaled)
        vec2 size = vec2(bounds.w * 3.0, bounds.w) * scale;
        // Center vertically, add border offset
        vec2 offset = vec2(border, border + (bounds.w - size.y) * 0.5);
        vec2 labelPos = position.xy * size + bounds.xy + offset;
        vec4 transformedPosition = vec4(labelPos, position.zw);
        gl_Position = projectionMatrix * transformedPosition;

        // Calculate clip bounds
        vec2 rectRB = bounds.xy + bounds.zw;
        vec4 clipBounds = projectionMatrix * vec4(rectRB, 0.0, 1.0);
        v_clipBoundsR = clipBounds.x;
        v_drawX = gl_Position.x;

        // Calculate atlas UV
        float col = mod(a_noteNumber, atlasCols);
        float row = floor(a_noteNumber / atlasCols);
        vec2 glyphUVOffset = vec2(col, row) / vec2(atlasCols, atlasRows);
        vec2 glyphUVSize = 1.0 / vec2(atlasCols, atlasRows);
        v_uv = glyphUVOffset + position.xy * glyphUVSize;

        v_state = state;
      }
    `,`#version 300 es
      precision highp float;

      in vec2 v_uv;
      in vec2 v_state;
      in float v_drawX;
      in float v_clipBoundsR;

      uniform sampler2D u_font;
      uniform vec4 color;
      uniform vec4 selectedColor;

      out vec4 outColor;

      void main() {
        // Clip if out of bounds
        if (v_drawX > v_clipBoundsR) {
            discard;
        }
    
        // Sample font atlas
        vec4 tex = texture(u_font, v_uv);
        float alpha = tex.a;
        alpha = smoothstep(0.3, 0.7, alpha);
        vec4 outCol = mix(color, selectedColor, v_state.y);
        outColor = vec4(outCol.rgb, alpha * outCol.a);
      }
    `,{a_noteNumber:{size:1,type:e.FLOAT,divisor:1},position:{size:2,type:e.FLOAT},bounds:{size:4,type:e.FLOAT,divisor:1},state:{size:2,type:e.FLOAT,divisor:1}},{u_font:bK(),projectionMatrix:Oo(),color:fn(),selectedColor:fn()},t=>new gK(t));function bK(e=null){return{initialValue:e,isEqual:(t,n)=>t===n,upload:(t,n,r)=>{t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r),t.uniform1i(n,0)}}}const _K=({rects:e,zIndex:t})=>{const n=Qk(),[r,o]=p.useState(null),s=nr();p.useEffect(()=>{const l=n.gl;return r||!l||!(l instanceof WebGL2RenderingContext)?void 0:((async()=>{const d=await yK(l,mK);o(d)})(),()=>{r&&l.deleteTexture(r)})},[n.gl]);const a=$t(),i=p.useMemo(()=>St(gt(a.onSurfaceColor)),[a.onSurfaceColor]),c=p.useMemo(()=>a.isLightContent?St(gt(a.backgroundColor)):St(gt(a.textColor)),[a.textColor,a.backgroundColor,a.isLightContent]);return u(Tr,{shader:vK,buffer:e,zIndex:t,uniforms:{u_font:r,projectionMatrix:s,color:i,selectedColor:c}})};async function yK(e,t){const n=new Image;n.src=t,await n.decode();const r=e.createTexture();if(!r)throw new Error("Failed to create texture");return e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.generateMipmap(e.TEXTURE_2D),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),r}const SK=e=>{const{mouseMode:t}=Me(),n=dK();return G(Ke,{children:[u(kK,{notes:n,...e}),t==="pencil"&&u(xK,{notes:n,zIndex:e.zIndex})]})},kK=e=>u(nl,{component:wK,fallback:pK,...e}),wK=({zIndex:e,notes:t})=>{const{selectedTrackId:n}=Me(),{isRhythmTrack:r}=wt(n),{borderColor:o,inactiveColor:s,activeColor:a,selectedColor:i}=z3(),{showNoteLabels:c}=gi();return G(Ke,{children:[r&&u(N3,{strokeColor:o,rects:t,inactiveColor:s,activeColor:a,selectedColor:i,zIndex:e}),!r&&G(Ke,{children:[u(L3,{strokeColor:o,inactiveColor:s,activeColor:a,selectedColor:i,rects:t,zIndex:e+.1}),c&&u(_K,{rects:t,zIndex:e+.2})]})]})},xK=({zIndex:e,notes:t})=>{const{selectedNoteIds:n,selectedTrackId:r}=Me(),{removeEvent:o}=wt(r),s=I3(),a=LX(),i=zX(),c=hK(),l=fK(),f=p.useCallback((m,v,_)=>{m.stopPropagation();const y=n.includes(v.id);switch(m.button){case 0:{if(m.shiftKey)y?c.onMouseDown(m,v.id):l.onMouseDown(m,v.id);else switch(_){case"center":return s.onMouseDown(m,v.id);case"left":return a.onMouseDown(m,v.id);case"right":return i.onMouseDown(m,v.id)}break}case 2:o(v.id);break;default:return null}},[n,o,s,a,i,c,l]),d=p.useCallback((m,v)=>{m.buttons===2&&(m.stopPropagation(),o(v.id))},[o]);return u(Ke,{children:t.flatMap(m=>u(CK,{note:m,zIndex:e,onMouseDown:f,onMouseMove:d},m.id))})},CK=it.memo(({note:e,zIndex:t,onMouseDown:n,onMouseMove:r})=>{const o=Math.min(e.width/3,8),s=p.useMemo(()=>({x:e.x,y:e.y,width:o,height:e.height}),[e.x,e.y,e.height,o]),a=p.useMemo(()=>({x:e.x+e.width-o,y:e.y,width:o,height:e.height}),[e.x,e.y,e.width,e.height,o]),i=p.useMemo(()=>({x:e.x+o,y:e.y,width:e.width-o*2,height:e.height}),[e.x,e.y,e.width,e.height,o]),c=p.useCallback(m=>n(m,e,"left"),[n,e]),l=p.useCallback(m=>n(m,e,"center"),[n,e]),f=p.useCallback(m=>n(m,e,"right"),[n,e]),d=p.useCallback(m=>{r==null||r(m,e)},[r,e]);return G(Ke,{children:[u(Nr,{bounds:s,cursor:"w-resize",zIndex:t,onMouseDown:c,onMouseMove:d},e.id+"-left"),u(Nr,{bounds:i,cursor:"move",zIndex:t,onMouseDown:l,onMouseMove:d},e.id+"-center"),u(Nr,{bounds:a,cursor:"e-resize",zIndex:t,onMouseDown:f,onMouseMove:d},e.id+"-right")]})}),TK=()=>{const e=hf();return{onMouseDown(t,n){e.onMouseDown(t,{type:"selection",position:"left"},n.map(r=>({type:"note",position:"left",noteId:r})))}}},MK=()=>{const e=hf();return{onMouseDown(t,n){e.onMouseDown(t,{type:"selection",position:"right"},n.map(r=>({type:"note",position:"right",noteId:r})))}}},EK=()=>{const e=hf(),t=nP(),{getSelectedNoteIds:n}=Me();return{onMouseDown(r){return(r.metaKey||r.ctrlKey)&&t(),e.onMouseDown(r,{type:"selection",position:"center"},n().map(s=>({type:"note",position:"center",noteId:s})))}}},IK=({zIndex:e})=>{const{selection:t,transform:n}=Me(),r=p.useMemo(()=>t===null?null:Fn.getBounds(t,n),[t,n]);return r===null?u(Ke,{}):u(AK,{rect:r,zIndex:e})},AK=({rect:e,zIndex:t})=>{const{selectedNoteIds:n}=Me(),r=EK(),o=TK(),s=MK(),a=Math.min(e.width/3,8),i=p.useMemo(()=>({x:e.x,y:e.y,width:a,height:e.height}),[e.x,e.y,e.height,a]),c=p.useMemo(()=>({x:e.x+a,y:e.y,width:e.width-a*2,height:e.height}),[e.x,e.y,e.width,e.height,a]),l=p.useMemo(()=>({x:e.x+e.width-a,y:e.y,width:a,height:e.height}),[e.x,e.y,e.width,e.height,a]);return G(Ke,{children:[u(tf,{rect:e,zIndex:t}),u(Nr,{bounds:i,zIndex:t,cursor:"w-resize",onMouseDown:v=>{v.stopPropagation(),o.onMouseDown(v,n)}}),u(Nr,{bounds:c,zIndex:t,cursor:"move",onMouseDown:v=>{v.stopPropagation(),r.onMouseDown(v)}}),u(Nr,{bounds:l,zIndex:t,cursor:"e-resize",onMouseDown:v=>{v.stopPropagation(),s.onMouseDown(v,n)}})]})},RK=({width:e,height:t})=>{const{ghostTrackIds:n,mouseMode:r}=Me(),o=hi(),{cursorX:s,setCanvasWidth:a,scrollLeft:i}=kt(),{scrollTop:c,setCanvasHeight:l}=vo(),f=HX(),{onContextMenu:d,menuProps:m}=Ks(),v=$t(),_=p.useCallback(h=>{if(!h.ctrlKey&&r==="selection"){h.stopPropagation(),d(h);return}},[r,d]);p.useEffect(()=>{a(e)},[e,a]),p.useEffect(()=>{l(t)},[t,l]);const y=p.useMemo(()=>_o(-i,0),[i]),k=p.useMemo(()=>_o(0,-c),[c]),g=p.useMemo(()=>_o(-i,-c),[i,c]),b=p.useMemo(()=>({backgroundColor:v.editorBackgroundColor}),[v]);return G(Ke,{children:[G(tl,{width:e,height:t,cursor:r==="pencil"?"auto":"crosshair",style:b,onContextMenu:_,onMouseDown:f.onMouseDown,onMouseMove:f.onMouseMove,onMouseUp:f.onMouseUp,children:[u(bo,{matrix:k,children:u(lK,{zIndex:0})}),G(bo,{matrix:y,children:[u(rl,{height:t,beats:o,zIndex:1}),u(ol,{x:s,height:t,zIndex:5})]}),G(bo,{matrix:g,children:[n.map(h=>u(JX,{trackId:h,zIndex:2},h)),u(SK,{zIndex:3}),u(IK,{zIndex:4})]})]}),u(UX,{...m})]})},OK=J.div``,F3=J(qa)`
  height: var(--size-ruler-height);
  background: var(--color-background);
  border-bottom: 1px solid var(--color-divider);
`,PK=J(F3)``,BK=({width:e,height:t,keyWidth:n})=>{const{scrollTop:r}=vo();return G(OK,{children:[u(qa,{top:Vt.rulerHeight,left:n,children:u(RK,{width:e,height:t-Vt.rulerHeight})}),u(qa,{top:-r+Vt.rulerHeight,children:u(OX,{width:n})}),u(PK,{width:n}),u(F3,{left:n,children:u(c1,{})})]})};var W3={exports:{}},DK="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",NK=DK,LK=NK;function $3(){}function V3(){}V3.resetWarningCache=$3;var zK=function(){function e(r,o,s,a,i,c){if(c!==LK){var l=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw l.name="Invariant Violation",l}}e.isRequired=e;function t(){return e}var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:V3,resetWarningCache:$3};return n.PropTypes=n,n};W3.exports=zK();var j3=W3.exports;const dt=yt(j3);var G1={exports:{}},FK=["alignContent","MozAlignContent","WebkitAlignContent","MSAlignContent","OAlignContent","alignItems","MozAlignItems","WebkitAlignItems","MSAlignItems","OAlignItems","alignSelf","MozAlignSelf","WebkitAlignSelf","MSAlignSelf","OAlignSelf","all","MozAll","WebkitAll","MSAll","OAll","animation","MozAnimation","WebkitAnimation","MSAnimation","OAnimation","animationDelay","MozAnimationDelay","WebkitAnimationDelay","MSAnimationDelay","OAnimationDelay","animationDirection","MozAnimationDirection","WebkitAnimationDirection","MSAnimationDirection","OAnimationDirection","animationDuration","MozAnimationDuration","WebkitAnimationDuration","MSAnimationDuration","OAnimationDuration","animationFillMode","MozAnimationFillMode","WebkitAnimationFillMode","MSAnimationFillMode","OAnimationFillMode","animationIterationCount","MozAnimationIterationCount","WebkitAnimationIterationCount","MSAnimationIterationCount","OAnimationIterationCount","animationName","MozAnimationName","WebkitAnimationName","MSAnimationName","OAnimationName","animationPlayState","MozAnimationPlayState","WebkitAnimationPlayState","MSAnimationPlayState","OAnimationPlayState","animationTimingFunction","MozAnimationTimingFunction","WebkitAnimationTimingFunction","MSAnimationTimingFunction","OAnimationTimingFunction","backfaceVisibility","MozBackfaceVisibility","WebkitBackfaceVisibility","MSBackfaceVisibility","OBackfaceVisibility","background","MozBackground","WebkitBackground","MSBackground","OBackground","backgroundAttachment","MozBackgroundAttachment","WebkitBackgroundAttachment","MSBackgroundAttachment","OBackgroundAttachment","backgroundBlendMode","MozBackgroundBlendMode","WebkitBackgroundBlendMode","MSBackgroundBlendMode","OBackgroundBlendMode","backgroundClip","MozBackgroundClip","WebkitBackgroundClip","MSBackgroundClip","OBackgroundClip","backgroundColor","MozBackgroundColor","WebkitBackgroundColor","MSBackgroundColor","OBackgroundColor","backgroundImage","MozBackgroundImage","WebkitBackgroundImage","MSBackgroundImage","OBackgroundImage","backgroundOrigin","MozBackgroundOrigin","WebkitBackgroundOrigin","MSBackgroundOrigin","OBackgroundOrigin","backgroundPosition","MozBackgroundPosition","WebkitBackgroundPosition","MSBackgroundPosition","OBackgroundPosition","backgroundRepeat","MozBackgroundRepeat","WebkitBackgroundRepeat","MSBackgroundRepeat","OBackgroundRepeat","backgroundSize","MozBackgroundSize","WebkitBackgroundSize","MSBackgroundSize","OBackgroundSize","blockSize","MozBlockSize","WebkitBlockSize","MSBlockSize","OBlockSize","border","MozBorder","WebkitBorder","MSBorder","OBorder","borderBlockEnd","MozBorderBlockEnd","WebkitBorderBlockEnd","MSBorderBlockEnd","OBorderBlockEnd","borderBlockEndColor","MozBorderBlockEndColor","WebkitBorderBlockEndColor","MSBorderBlockEndColor","OBorderBlockEndColor","borderBlockEndStyle","MozBorderBlockEndStyle","WebkitBorderBlockEndStyle","MSBorderBlockEndStyle","OBorderBlockEndStyle","borderBlockEndWidth","MozBorderBlockEndWidth","WebkitBorderBlockEndWidth","MSBorderBlockEndWidth","OBorderBlockEndWidth","borderBlockStart","MozBorderBlockStart","WebkitBorderBlockStart","MSBorderBlockStart","OBorderBlockStart","borderBlockStartColor","MozBorderBlockStartColor","WebkitBorderBlockStartColor","MSBorderBlockStartColor","OBorderBlockStartColor","borderBlockStartStyle","MozBorderBlockStartStyle","WebkitBorderBlockStartStyle","MSBorderBlockStartStyle","OBorderBlockStartStyle","borderBlockStartWidth","MozBorderBlockStartWidth","WebkitBorderBlockStartWidth","MSBorderBlockStartWidth","OBorderBlockStartWidth","borderBottom","MozBorderBottom","WebkitBorderBottom","MSBorderBottom","OBorderBottom","borderBottomColor","MozBorderBottomColor","WebkitBorderBottomColor","MSBorderBottomColor","OBorderBottomColor","borderBottomLeftRadius","MozBorderBottomLeftRadius","WebkitBorderBottomLeftRadius","MSBorderBottomLeftRadius","OBorderBottomLeftRadius","borderBottomRightRadius","MozBorderBottomRightRadius","WebkitBorderBottomRightRadius","MSBorderBottomRightRadius","OBorderBottomRightRadius","borderBottomStyle","MozBorderBottomStyle","WebkitBorderBottomStyle","MSBorderBottomStyle","OBorderBottomStyle","borderBottomWidth","MozBorderBottomWidth","WebkitBorderBottomWidth","MSBorderBottomWidth","OBorderBottomWidth","borderCollapse","MozBorderCollapse","WebkitBorderCollapse","MSBorderCollapse","OBorderCollapse","borderColor","MozBorderColor","WebkitBorderColor","MSBorderColor","OBorderColor","borderImage","MozBorderImage","WebkitBorderImage","MSBorderImage","OBorderImage","borderImageOutset","MozBorderImageOutset","WebkitBorderImageOutset","MSBorderImageOutset","OBorderImageOutset","borderImageRepeat","MozBorderImageRepeat","WebkitBorderImageRepeat","MSBorderImageRepeat","OBorderImageRepeat","borderImageSlice","MozBorderImageSlice","WebkitBorderImageSlice","MSBorderImageSlice","OBorderImageSlice","borderImageSource","MozBorderImageSource","WebkitBorderImageSource","MSBorderImageSource","OBorderImageSource","borderImageWidth","MozBorderImageWidth","WebkitBorderImageWidth","MSBorderImageWidth","OBorderImageWidth","borderInlineEnd","MozBorderInlineEnd","WebkitBorderInlineEnd","MSBorderInlineEnd","OBorderInlineEnd","borderInlineEndColor","MozBorderInlineEndColor","WebkitBorderInlineEndColor","MSBorderInlineEndColor","OBorderInlineEndColor","borderInlineEndStyle","MozBorderInlineEndStyle","WebkitBorderInlineEndStyle","MSBorderInlineEndStyle","OBorderInlineEndStyle","borderInlineEndWidth","MozBorderInlineEndWidth","WebkitBorderInlineEndWidth","MSBorderInlineEndWidth","OBorderInlineEndWidth","borderInlineStart","MozBorderInlineStart","WebkitBorderInlineStart","MSBorderInlineStart","OBorderInlineStart","borderInlineStartColor","MozBorderInlineStartColor","WebkitBorderInlineStartColor","MSBorderInlineStartColor","OBorderInlineStartColor","borderInlineStartStyle","MozBorderInlineStartStyle","WebkitBorderInlineStartStyle","MSBorderInlineStartStyle","OBorderInlineStartStyle","borderInlineStartWidth","MozBorderInlineStartWidth","WebkitBorderInlineStartWidth","MSBorderInlineStartWidth","OBorderInlineStartWidth","borderLeft","MozBorderLeft","WebkitBorderLeft","MSBorderLeft","OBorderLeft","borderLeftColor","MozBorderLeftColor","WebkitBorderLeftColor","MSBorderLeftColor","OBorderLeftColor","borderLeftStyle","MozBorderLeftStyle","WebkitBorderLeftStyle","MSBorderLeftStyle","OBorderLeftStyle","borderLeftWidth","MozBorderLeftWidth","WebkitBorderLeftWidth","MSBorderLeftWidth","OBorderLeftWidth","borderRadius","MozBorderRadius","WebkitBorderRadius","MSBorderRadius","OBorderRadius","borderRight","MozBorderRight","WebkitBorderRight","MSBorderRight","OBorderRight","borderRightColor","MozBorderRightColor","WebkitBorderRightColor","MSBorderRightColor","OBorderRightColor","borderRightStyle","MozBorderRightStyle","WebkitBorderRightStyle","MSBorderRightStyle","OBorderRightStyle","borderRightWidth","MozBorderRightWidth","WebkitBorderRightWidth","MSBorderRightWidth","OBorderRightWidth","borderSpacing","MozBorderSpacing","WebkitBorderSpacing","MSBorderSpacing","OBorderSpacing","borderStyle","MozBorderStyle","WebkitBorderStyle","MSBorderStyle","OBorderStyle","borderTop","MozBorderTop","WebkitBorderTop","MSBorderTop","OBorderTop","borderTopColor","MozBorderTopColor","WebkitBorderTopColor","MSBorderTopColor","OBorderTopColor","borderTopLeftRadius","MozBorderTopLeftRadius","WebkitBorderTopLeftRadius","MSBorderTopLeftRadius","OBorderTopLeftRadius","borderTopRightRadius","MozBorderTopRightRadius","WebkitBorderTopRightRadius","MSBorderTopRightRadius","OBorderTopRightRadius","borderTopStyle","MozBorderTopStyle","WebkitBorderTopStyle","MSBorderTopStyle","OBorderTopStyle","borderTopWidth","MozBorderTopWidth","WebkitBorderTopWidth","MSBorderTopWidth","OBorderTopWidth","borderWidth","MozBorderWidth","WebkitBorderWidth","MSBorderWidth","OBorderWidth","bottom","MozBottom","WebkitBottom","MSBottom","OBottom","boxDecorationBreak","MozBoxDecorationBreak","WebkitBoxDecorationBreak","MSBoxDecorationBreak","OBoxDecorationBreak","boxShadow","MozBoxShadow","WebkitBoxShadow","MSBoxShadow","OBoxShadow","boxSizing","MozBoxSizing","WebkitBoxSizing","MSBoxSizing","OBoxSizing","breakAfter","MozBreakAfter","WebkitBreakAfter","MSBreakAfter","OBreakAfter","breakBefore","MozBreakBefore","WebkitBreakBefore","MSBreakBefore","OBreakBefore","breakInside","MozBreakInside","WebkitBreakInside","MSBreakInside","OBreakInside","captionSide","MozCaptionSide","WebkitCaptionSide","MSCaptionSide","OCaptionSide","caretColor","MozCaretColor","WebkitCaretColor","MSCaretColor","OCaretColor","ch","MozCh","WebkitCh","MSCh","OCh","clear","MozClear","WebkitClear","MSClear","OClear","clip","MozClip","WebkitClip","MSClip","OClip","clipPath","MozClipPath","WebkitClipPath","MSClipPath","OClipPath","cm","MozCm","WebkitCm","MSCm","OCm","color","MozColor","WebkitColor","MSColor","OColor","columnCount","MozColumnCount","WebkitColumnCount","MSColumnCount","OColumnCount","columnFill","MozColumnFill","WebkitColumnFill","MSColumnFill","OColumnFill","columnGap","MozColumnGap","WebkitColumnGap","MSColumnGap","OColumnGap","columnRule","MozColumnRule","WebkitColumnRule","MSColumnRule","OColumnRule","columnRuleColor","MozColumnRuleColor","WebkitColumnRuleColor","MSColumnRuleColor","OColumnRuleColor","columnRuleStyle","MozColumnRuleStyle","WebkitColumnRuleStyle","MSColumnRuleStyle","OColumnRuleStyle","columnRuleWidth","MozColumnRuleWidth","WebkitColumnRuleWidth","MSColumnRuleWidth","OColumnRuleWidth","columnSpan","MozColumnSpan","WebkitColumnSpan","MSColumnSpan","OColumnSpan","columnWidth","MozColumnWidth","WebkitColumnWidth","MSColumnWidth","OColumnWidth","columns","MozColumns","WebkitColumns","MSColumns","OColumns","content","MozContent","WebkitContent","MSContent","OContent","counterIncrement","MozCounterIncrement","WebkitCounterIncrement","MSCounterIncrement","OCounterIncrement","counterReset","MozCounterReset","WebkitCounterReset","MSCounterReset","OCounterReset","cursor","MozCursor","WebkitCursor","MSCursor","OCursor","deg","MozDeg","WebkitDeg","MSDeg","ODeg","direction","MozDirection","WebkitDirection","MSDirection","ODirection","display","MozDisplay","WebkitDisplay","MSDisplay","ODisplay","dpcm","MozDpcm","WebkitDpcm","MSDpcm","ODpcm","dpi","MozDpi","WebkitDpi","MSDpi","ODpi","dppx","MozDppx","WebkitDppx","MSDppx","ODppx","em","MozEm","WebkitEm","MSEm","OEm","emptyCells","MozEmptyCells","WebkitEmptyCells","MSEmptyCells","OEmptyCells","ex","MozEx","WebkitEx","MSEx","OEx","filter","MozFilter","WebkitFilter","MSFilter","OFilter","flexBasis","MozFlexBasis","WebkitFlexBasis","MSFlexBasis","OFlexBasis","flexDirection","MozFlexDirection","WebkitFlexDirection","MSFlexDirection","OFlexDirection","flexFlow","MozFlexFlow","WebkitFlexFlow","MSFlexFlow","OFlexFlow","flexGrow","MozFlexGrow","WebkitFlexGrow","MSFlexGrow","OFlexGrow","flexShrink","MozFlexShrink","WebkitFlexShrink","MSFlexShrink","OFlexShrink","flexWrap","MozFlexWrap","WebkitFlexWrap","MSFlexWrap","OFlexWrap","float","MozFloat","WebkitFloat","MSFloat","OFloat","font","MozFont","WebkitFont","MSFont","OFont","fontFamily","MozFontFamily","WebkitFontFamily","MSFontFamily","OFontFamily","fontFeatureSettings","MozFontFeatureSettings","WebkitFontFeatureSettings","MSFontFeatureSettings","OFontFeatureSettings","fontKerning","MozFontKerning","WebkitFontKerning","MSFontKerning","OFontKerning","fontLanguageOverride","MozFontLanguageOverride","WebkitFontLanguageOverride","MSFontLanguageOverride","OFontLanguageOverride","fontSize","MozFontSize","WebkitFontSize","MSFontSize","OFontSize","fontSizeAdjust","MozFontSizeAdjust","WebkitFontSizeAdjust","MSFontSizeAdjust","OFontSizeAdjust","fontStretch","MozFontStretch","WebkitFontStretch","MSFontStretch","OFontStretch","fontStyle","MozFontStyle","WebkitFontStyle","MSFontStyle","OFontStyle","fontSynthesis","MozFontSynthesis","WebkitFontSynthesis","MSFontSynthesis","OFontSynthesis","fontVariant","MozFontVariant","WebkitFontVariant","MSFontVariant","OFontVariant","fontVariantAlternates","MozFontVariantAlternates","WebkitFontVariantAlternates","MSFontVariantAlternates","OFontVariantAlternates","fontVariantCaps","MozFontVariantCaps","WebkitFontVariantCaps","MSFontVariantCaps","OFontVariantCaps","fontVariantEastAsian","MozFontVariantEastAsian","WebkitFontVariantEastAsian","MSFontVariantEastAsian","OFontVariantEastAsian","fontVariantLigatures","MozFontVariantLigatures","WebkitFontVariantLigatures","MSFontVariantLigatures","OFontVariantLigatures","fontVariantNumeric","MozFontVariantNumeric","WebkitFontVariantNumeric","MSFontVariantNumeric","OFontVariantNumeric","fontVariantPosition","MozFontVariantPosition","WebkitFontVariantPosition","MSFontVariantPosition","OFontVariantPosition","fontWeight","MozFontWeight","WebkitFontWeight","MSFontWeight","OFontWeight","fr","MozFr","WebkitFr","MSFr","OFr","grad","MozGrad","WebkitGrad","MSGrad","OGrad","grid","MozGrid","WebkitGrid","MSGrid","OGrid","gridArea","MozGridArea","WebkitGridArea","MSGridArea","OGridArea","gridAutoColumns","MozGridAutoColumns","WebkitGridAutoColumns","MSGridAutoColumns","OGridAutoColumns","gridAutoFlow","MozGridAutoFlow","WebkitGridAutoFlow","MSGridAutoFlow","OGridAutoFlow","gridAutoRows","MozGridAutoRows","WebkitGridAutoRows","MSGridAutoRows","OGridAutoRows","gridColumn","MozGridColumn","WebkitGridColumn","MSGridColumn","OGridColumn","gridColumnEnd","MozGridColumnEnd","WebkitGridColumnEnd","MSGridColumnEnd","OGridColumnEnd","gridColumnGap","MozGridColumnGap","WebkitGridColumnGap","MSGridColumnGap","OGridColumnGap","gridColumnStart","MozGridColumnStart","WebkitGridColumnStart","MSGridColumnStart","OGridColumnStart","gridGap","MozGridGap","WebkitGridGap","MSGridGap","OGridGap","gridRow","MozGridRow","WebkitGridRow","MSGridRow","OGridRow","gridRowEnd","MozGridRowEnd","WebkitGridRowEnd","MSGridRowEnd","OGridRowEnd","gridRowGap","MozGridRowGap","WebkitGridRowGap","MSGridRowGap","OGridRowGap","gridRowStart","MozGridRowStart","WebkitGridRowStart","MSGridRowStart","OGridRowStart","gridTemplate","MozGridTemplate","WebkitGridTemplate","MSGridTemplate","OGridTemplate","gridTemplateAreas","MozGridTemplateAreas","WebkitGridTemplateAreas","MSGridTemplateAreas","OGridTemplateAreas","gridTemplateColumns","MozGridTemplateColumns","WebkitGridTemplateColumns","MSGridTemplateColumns","OGridTemplateColumns","gridTemplateRows","MozGridTemplateRows","WebkitGridTemplateRows","MSGridTemplateRows","OGridTemplateRows","height","MozHeight","WebkitHeight","MSHeight","OHeight","hyphens","MozHyphens","WebkitHyphens","MSHyphens","OHyphens","hz","MozHz","WebkitHz","MSHz","OHz","imageOrientation","MozImageOrientation","WebkitImageOrientation","MSImageOrientation","OImageOrientation","imageRendering","MozImageRendering","WebkitImageRendering","MSImageRendering","OImageRendering","imageResolution","MozImageResolution","WebkitImageResolution","MSImageResolution","OImageResolution","imeMode","MozImeMode","WebkitImeMode","MSImeMode","OImeMode","in","MozIn","WebkitIn","MSIn","OIn","inherit","MozInherit","WebkitInherit","MSInherit","OInherit","initial","MozInitial","WebkitInitial","MSInitial","OInitial","inlineSize","MozInlineSize","WebkitInlineSize","MSInlineSize","OInlineSize","isolation","MozIsolation","WebkitIsolation","MSIsolation","OIsolation","justifyContent","MozJustifyContent","WebkitJustifyContent","MSJustifyContent","OJustifyContent","khz","MozKhz","WebkitKhz","MSKhz","OKhz","left","MozLeft","WebkitLeft","MSLeft","OLeft","letterSpacing","MozLetterSpacing","WebkitLetterSpacing","MSLetterSpacing","OLetterSpacing","lineBreak","MozLineBreak","WebkitLineBreak","MSLineBreak","OLineBreak","lineHeight","MozLineHeight","WebkitLineHeight","MSLineHeight","OLineHeight","listStyle","MozListStyle","WebkitListStyle","MSListStyle","OListStyle","listStyleImage","MozListStyleImage","WebkitListStyleImage","MSListStyleImage","OListStyleImage","listStylePosition","MozListStylePosition","WebkitListStylePosition","MSListStylePosition","OListStylePosition","listStyleType","MozListStyleType","WebkitListStyleType","MSListStyleType","OListStyleType","margin","MozMargin","WebkitMargin","MSMargin","OMargin","marginBlockEnd","MozMarginBlockEnd","WebkitMarginBlockEnd","MSMarginBlockEnd","OMarginBlockEnd","marginBlockStart","MozMarginBlockStart","WebkitMarginBlockStart","MSMarginBlockStart","OMarginBlockStart","marginBottom","MozMarginBottom","WebkitMarginBottom","MSMarginBottom","OMarginBottom","marginInlineEnd","MozMarginInlineEnd","WebkitMarginInlineEnd","MSMarginInlineEnd","OMarginInlineEnd","marginInlineStart","MozMarginInlineStart","WebkitMarginInlineStart","MSMarginInlineStart","OMarginInlineStart","marginLeft","MozMarginLeft","WebkitMarginLeft","MSMarginLeft","OMarginLeft","marginRight","MozMarginRight","WebkitMarginRight","MSMarginRight","OMarginRight","marginTop","MozMarginTop","WebkitMarginTop","MSMarginTop","OMarginTop","mask","MozMask","WebkitMask","MSMask","OMask","maskClip","MozMaskClip","WebkitMaskClip","MSMaskClip","OMaskClip","maskComposite","MozMaskComposite","WebkitMaskComposite","MSMaskComposite","OMaskComposite","maskImage","MozMaskImage","WebkitMaskImage","MSMaskImage","OMaskImage","maskMode","MozMaskMode","WebkitMaskMode","MSMaskMode","OMaskMode","maskOrigin","MozMaskOrigin","WebkitMaskOrigin","MSMaskOrigin","OMaskOrigin","maskPosition","MozMaskPosition","WebkitMaskPosition","MSMaskPosition","OMaskPosition","maskRepeat","MozMaskRepeat","WebkitMaskRepeat","MSMaskRepeat","OMaskRepeat","maskSize","MozMaskSize","WebkitMaskSize","MSMaskSize","OMaskSize","maskType","MozMaskType","WebkitMaskType","MSMaskType","OMaskType","maxHeight","MozMaxHeight","WebkitMaxHeight","MSMaxHeight","OMaxHeight","maxWidth","MozMaxWidth","WebkitMaxWidth","MSMaxWidth","OMaxWidth","minBlockSize","MozMinBlockSize","WebkitMinBlockSize","MSMinBlockSize","OMinBlockSize","minHeight","MozMinHeight","WebkitMinHeight","MSMinHeight","OMinHeight","minInlineSize","MozMinInlineSize","WebkitMinInlineSize","MSMinInlineSize","OMinInlineSize","minWidth","MozMinWidth","WebkitMinWidth","MSMinWidth","OMinWidth","mixBlendMode","MozMixBlendMode","WebkitMixBlendMode","MSMixBlendMode","OMixBlendMode","mm","MozMm","WebkitMm","MSMm","OMm","ms","MozMs","WebkitMs","MSMs","OMs","objectFit","MozObjectFit","WebkitObjectFit","MSObjectFit","OObjectFit","objectPosition","MozObjectPosition","WebkitObjectPosition","MSObjectPosition","OObjectPosition","offsetBlockEnd","MozOffsetBlockEnd","WebkitOffsetBlockEnd","MSOffsetBlockEnd","OOffsetBlockEnd","offsetBlockStart","MozOffsetBlockStart","WebkitOffsetBlockStart","MSOffsetBlockStart","OOffsetBlockStart","offsetInlineEnd","MozOffsetInlineEnd","WebkitOffsetInlineEnd","MSOffsetInlineEnd","OOffsetInlineEnd","offsetInlineStart","MozOffsetInlineStart","WebkitOffsetInlineStart","MSOffsetInlineStart","OOffsetInlineStart","opacity","MozOpacity","WebkitOpacity","MSOpacity","OOpacity","order","MozOrder","WebkitOrder","MSOrder","OOrder","orphans","MozOrphans","WebkitOrphans","MSOrphans","OOrphans","outline","MozOutline","WebkitOutline","MSOutline","OOutline","outlineColor","MozOutlineColor","WebkitOutlineColor","MSOutlineColor","OOutlineColor","outlineOffset","MozOutlineOffset","WebkitOutlineOffset","MSOutlineOffset","OOutlineOffset","outlineStyle","MozOutlineStyle","WebkitOutlineStyle","MSOutlineStyle","OOutlineStyle","outlineWidth","MozOutlineWidth","WebkitOutlineWidth","MSOutlineWidth","OOutlineWidth","overflow","MozOverflow","WebkitOverflow","MSOverflow","OOverflow","overflowWrap","MozOverflowWrap","WebkitOverflowWrap","MSOverflowWrap","OOverflowWrap","overflowX","MozOverflowX","WebkitOverflowX","MSOverflowX","OOverflowX","overflowY","MozOverflowY","WebkitOverflowY","MSOverflowY","OOverflowY","padding","MozPadding","WebkitPadding","MSPadding","OPadding","paddingBlockEnd","MozPaddingBlockEnd","WebkitPaddingBlockEnd","MSPaddingBlockEnd","OPaddingBlockEnd","paddingBlockStart","MozPaddingBlockStart","WebkitPaddingBlockStart","MSPaddingBlockStart","OPaddingBlockStart","paddingBottom","MozPaddingBottom","WebkitPaddingBottom","MSPaddingBottom","OPaddingBottom","paddingInlineEnd","MozPaddingInlineEnd","WebkitPaddingInlineEnd","MSPaddingInlineEnd","OPaddingInlineEnd","paddingInlineStart","MozPaddingInlineStart","WebkitPaddingInlineStart","MSPaddingInlineStart","OPaddingInlineStart","paddingLeft","MozPaddingLeft","WebkitPaddingLeft","MSPaddingLeft","OPaddingLeft","paddingRight","MozPaddingRight","WebkitPaddingRight","MSPaddingRight","OPaddingRight","paddingTop","MozPaddingTop","WebkitPaddingTop","MSPaddingTop","OPaddingTop","pageBreakAfter","MozPageBreakAfter","WebkitPageBreakAfter","MSPageBreakAfter","OPageBreakAfter","pageBreakBefore","MozPageBreakBefore","WebkitPageBreakBefore","MSPageBreakBefore","OPageBreakBefore","pageBreakInside","MozPageBreakInside","WebkitPageBreakInside","MSPageBreakInside","OPageBreakInside","pc","MozPc","WebkitPc","MSPc","OPc","perspective","MozPerspective","WebkitPerspective","MSPerspective","OPerspective","perspectiveOrigin","MozPerspectiveOrigin","WebkitPerspectiveOrigin","MSPerspectiveOrigin","OPerspectiveOrigin","pointerEvents","MozPointerEvents","WebkitPointerEvents","MSPointerEvents","OPointerEvents","position","MozPosition","WebkitPosition","MSPosition","OPosition","pt","MozPt","WebkitPt","MSPt","OPt","px","MozPx","WebkitPx","MSPx","OPx","q","MozQ","WebkitQ","MSQ","OQ","quotes","MozQuotes","WebkitQuotes","MSQuotes","OQuotes","rad","MozRad","WebkitRad","MSRad","ORad","rem","MozRem","WebkitRem","MSRem","ORem","resize","MozResize","WebkitResize","MSResize","OResize","revert","MozRevert","WebkitRevert","MSRevert","ORevert","right","MozRight","WebkitRight","MSRight","ORight","rubyAlign","MozRubyAlign","WebkitRubyAlign","MSRubyAlign","ORubyAlign","rubyMerge","MozRubyMerge","WebkitRubyMerge","MSRubyMerge","ORubyMerge","rubyPosition","MozRubyPosition","WebkitRubyPosition","MSRubyPosition","ORubyPosition","s","MozS","WebkitS","MSS","OS","scrollBehavior","MozScrollBehavior","WebkitScrollBehavior","MSScrollBehavior","OScrollBehavior","scrollSnapCoordinate","MozScrollSnapCoordinate","WebkitScrollSnapCoordinate","MSScrollSnapCoordinate","OScrollSnapCoordinate","scrollSnapDestination","MozScrollSnapDestination","WebkitScrollSnapDestination","MSScrollSnapDestination","OScrollSnapDestination","scrollSnapType","MozScrollSnapType","WebkitScrollSnapType","MSScrollSnapType","OScrollSnapType","shapeImageThreshold","MozShapeImageThreshold","WebkitShapeImageThreshold","MSShapeImageThreshold","OShapeImageThreshold","shapeMargin","MozShapeMargin","WebkitShapeMargin","MSShapeMargin","OShapeMargin","shapeOutside","MozShapeOutside","WebkitShapeOutside","MSShapeOutside","OShapeOutside","tabSize","MozTabSize","WebkitTabSize","MSTabSize","OTabSize","tableLayout","MozTableLayout","WebkitTableLayout","MSTableLayout","OTableLayout","textAlign","MozTextAlign","WebkitTextAlign","MSTextAlign","OTextAlign","textAlignLast","MozTextAlignLast","WebkitTextAlignLast","MSTextAlignLast","OTextAlignLast","textCombineUpright","MozTextCombineUpright","WebkitTextCombineUpright","MSTextCombineUpright","OTextCombineUpright","textDecoration","MozTextDecoration","WebkitTextDecoration","MSTextDecoration","OTextDecoration","textDecorationColor","MozTextDecorationColor","WebkitTextDecorationColor","MSTextDecorationColor","OTextDecorationColor","textDecorationLine","MozTextDecorationLine","WebkitTextDecorationLine","MSTextDecorationLine","OTextDecorationLine","textDecorationStyle","MozTextDecorationStyle","WebkitTextDecorationStyle","MSTextDecorationStyle","OTextDecorationStyle","textEmphasis","MozTextEmphasis","WebkitTextEmphasis","MSTextEmphasis","OTextEmphasis","textEmphasisColor","MozTextEmphasisColor","WebkitTextEmphasisColor","MSTextEmphasisColor","OTextEmphasisColor","textEmphasisPosition","MozTextEmphasisPosition","WebkitTextEmphasisPosition","MSTextEmphasisPosition","OTextEmphasisPosition","textEmphasisStyle","MozTextEmphasisStyle","WebkitTextEmphasisStyle","MSTextEmphasisStyle","OTextEmphasisStyle","textIndent","MozTextIndent","WebkitTextIndent","MSTextIndent","OTextIndent","textOrientation","MozTextOrientation","WebkitTextOrientation","MSTextOrientation","OTextOrientation","textOverflow","MozTextOverflow","WebkitTextOverflow","MSTextOverflow","OTextOverflow","textRendering","MozTextRendering","WebkitTextRendering","MSTextRendering","OTextRendering","textShadow","MozTextShadow","WebkitTextShadow","MSTextShadow","OTextShadow","textTransform","MozTextTransform","WebkitTextTransform","MSTextTransform","OTextTransform","textUnderlinePosition","MozTextUnderlinePosition","WebkitTextUnderlinePosition","MSTextUnderlinePosition","OTextUnderlinePosition","top","MozTop","WebkitTop","MSTop","OTop","touchAction","MozTouchAction","WebkitTouchAction","MSTouchAction","OTouchAction","transform","MozTransform","WebkitTransform","msTransform","OTransform","transformBox","MozTransformBox","WebkitTransformBox","MSTransformBox","OTransformBox","transformOrigin","MozTransformOrigin","WebkitTransformOrigin","MSTransformOrigin","OTransformOrigin","transformStyle","MozTransformStyle","WebkitTransformStyle","MSTransformStyle","OTransformStyle","transition","MozTransition","WebkitTransition","MSTransition","OTransition","transitionDelay","MozTransitionDelay","WebkitTransitionDelay","MSTransitionDelay","OTransitionDelay","transitionDuration","MozTransitionDuration","WebkitTransitionDuration","MSTransitionDuration","OTransitionDuration","transitionProperty","MozTransitionProperty","WebkitTransitionProperty","MSTransitionProperty","OTransitionProperty","transitionTimingFunction","MozTransitionTimingFunction","WebkitTransitionTimingFunction","MSTransitionTimingFunction","OTransitionTimingFunction","turn","MozTurn","WebkitTurn","MSTurn","OTurn","unicodeBidi","MozUnicodeBidi","WebkitUnicodeBidi","MSUnicodeBidi","OUnicodeBidi","unset","MozUnset","WebkitUnset","MSUnset","OUnset","verticalAlign","MozVerticalAlign","WebkitVerticalAlign","MSVerticalAlign","OVerticalAlign","vh","MozVh","WebkitVh","MSVh","OVh","visibility","MozVisibility","WebkitVisibility","MSVisibility","OVisibility","vmax","MozVmax","WebkitVmax","MSVmax","OVmax","vmin","MozVmin","WebkitVmin","MSVmin","OVmin","vw","MozVw","WebkitVw","MSVw","OVw","whiteSpace","MozWhiteSpace","WebkitWhiteSpace","MSWhiteSpace","OWhiteSpace","widows","MozWidows","WebkitWidows","MSWidows","OWidows","width","MozWidth","WebkitWidth","MSWidth","OWidth","willChange","MozWillChange","WebkitWillChange","MSWillChange","OWillChange","wordBreak","MozWordBreak","WebkitWordBreak","MSWordBreak","OWordBreak","wordSpacing","MozWordSpacing","WebkitWordSpacing","MSWordSpacing","OWordSpacing","wordWrap","MozWordWrap","WebkitWordWrap","MSWordWrap","OWordWrap","writingMode","MozWritingMode","WebkitWritingMode","MSWritingMode","OWritingMode","zIndex","MozZIndex","WebkitZIndex","MSZIndex","OZIndex","fontSize","MozFontSize","WebkitFontSize","MSFontSize","OFontSize","flex","MozFlex","WebkitFlex","MSFlex","OFlex","fr","MozFr","WebkitFr","MSFr","OFr","overflowScrolling","MozOverflowScrolling","WebkitOverflowScrolling","MSOverflowScrolling","OOverflowScrolling","userSelect","MozUserSelect","WebkitUserSelect","MSUserSelect","OUserSelect"];G1.exports;(function(e){var t=FK,n=j3;e.exports=function(r,o,s){var a=r[o];if(a){var i=[];if(Object.keys(a).forEach(function(c){t.indexOf(c)===-1&&i.push(c)}),i.length)throw new Error("Prop "+o+" passed to "+s+". Has invalid keys "+i.join(", "))}},e.exports.isRequired=function(r,o,s){if(!r[o])throw new Error("Prop "+o+" passed to "+s+" is required");return e.exports(r,o,s)},e.exports.supportingArrays=n.oneOfType([n.arrayOf(e.exports),e.exports])})(G1);var WK=G1.exports;const Ss=yt(WK);function H3(){var e=this.constructor.getDerivedStateFromProps(this.props,this.state);e!=null&&this.setState(e)}function U3(e){function t(n){var r=this.constructor.getDerivedStateFromProps(e,n);return r??null}this.setState(t.bind(this))}function G3(e,t){try{var n=this.props,r=this.state;this.props=e,this.state=t,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(n,r)}finally{this.props=n,this.state=r}}H3.__suppressDeprecationWarning=!0;U3.__suppressDeprecationWarning=!0;G3.__suppressDeprecationWarning=!0;function $K(e){var t=e.prototype;if(!t||!t.isReactComponent)throw new Error("Can only polyfill class components");if(typeof e.getDerivedStateFromProps!="function"&&typeof t.getSnapshotBeforeUpdate!="function")return e;var n=null,r=null,o=null;if(typeof t.componentWillMount=="function"?n="componentWillMount":typeof t.UNSAFE_componentWillMount=="function"&&(n="UNSAFE_componentWillMount"),typeof t.componentWillReceiveProps=="function"?r="componentWillReceiveProps":typeof t.UNSAFE_componentWillReceiveProps=="function"&&(r="UNSAFE_componentWillReceiveProps"),typeof t.componentWillUpdate=="function"?o="componentWillUpdate":typeof t.UNSAFE_componentWillUpdate=="function"&&(o="UNSAFE_componentWillUpdate"),n!==null||r!==null||o!==null){var s=e.displayName||e.name,a=typeof e.getDerivedStateFromProps=="function"?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error(`Unsafe legacy lifecycles will not be called for components using new component APIs.

`+s+" uses "+a+" but also contains the following legacy lifecycles:"+(n!==null?`
  `+n:"")+(r!==null?`
  `+r:"")+(o!==null?`
  `+o:"")+`

The above lifecycles should be removed. Learn more about this warning here:
https://fb.me/react-async-component-lifecycle-hooks`)}if(typeof e.getDerivedStateFromProps=="function"&&(t.componentWillMount=H3,t.componentWillReceiveProps=U3),typeof t.getSnapshotBeforeUpdate=="function"){if(typeof t.componentDidUpdate!="function")throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");t.componentWillUpdate=G3;var i=t.componentDidUpdate;t.componentDidUpdate=function(l,f,d){var m=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:d;i.call(this,l,f,m)}}return e}function X1(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Kb(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function K1(e,t,n){return t&&Kb(e.prototype,t),n&&Kb(e,n),e}function X3(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Yb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function xh(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Yb(Object(n),!0).forEach(function(r){X3(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yb(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Y1(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Op(e,t)}function td(e){return td=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},td(e)}function Op(e,t){return Op=Object.setPrototypeOf||function(r,o){return r.__proto__=o,r},Op(e,t)}function VK(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function ha(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jK(e,t){return t&&(typeof t=="object"||typeof t=="function")?t:ha(e)}function q1(e){return function(){var t=td(e),n;if(VK()){var r=td(this).constructor;n=Reflect.construct(t,arguments,r)}else n=t.apply(this,arguments);return jK(this,n)}}var nd=function(e){Y1(n,e);var t=q1(n);function n(){return X1(this,n),t.apply(this,arguments)}return K1(n,[{key:"render",value:function(){var o=this.props,s=o.children,a=o.className,i=o.split,c=o.style,l=o.size,f=o.eleRef,d=["Pane",i,a],m={flex:1,position:"relative",outline:"none"};return l!==void 0&&(i==="vertical"?m.width=l:(m.height=l,m.display="flex"),m.flex="none"),m=Object.assign({},m,c||{}),it.createElement("div",{ref:f,className:d.join(" "),style:m},s)}}]),n}(it.PureComponent);nd.propTypes={className:dt.string.isRequired,children:dt.node.isRequired,size:dt.oneOfType([dt.string,dt.number]),split:dt.oneOf(["vertical","horizontal"]),style:Ss,eleRef:dt.func};nd.defaultProps={};var K3="Resizer",Z1=function(e){Y1(n,e);var t=q1(n);function n(){return X1(this,n),t.apply(this,arguments)}return K1(n,[{key:"render",value:function(){var o=this.props,s=o.className,a=o.onClick,i=o.onDoubleClick,c=o.onMouseDown,l=o.onTouchEnd,f=o.onTouchStart,d=o.resizerClassName,m=o.split,v=o.style,_=[d,m,s];return it.createElement("span",{role:"presentation",className:_.join(" "),style:v,onMouseDown:function(k){return c(k)},onTouchStart:function(k){k.preventDefault(),f(k)},onTouchEnd:function(k){k.preventDefault(),l(k)},onClick:function(k){a&&(k.preventDefault(),a(k))},onDoubleClick:function(k){i&&(k.preventDefault(),i(k))}})}}]),n}(it.Component);Z1.propTypes={className:dt.string.isRequired,onClick:dt.func,onDoubleClick:dt.func,onMouseDown:dt.func.isRequired,onTouchStart:dt.func.isRequired,onTouchEnd:dt.func.isRequired,split:dt.oneOf(["vertical","horizontal"]),style:Ss,resizerClassName:dt.string.isRequired};Z1.defaultProps={resizerClassName:K3};function qb(e,t){if(e.selection)e.selection.empty();else try{t.getSelection().removeAllRanges()}catch{}}function Zb(e,t,n,r){if(typeof r=="number"){var o=typeof t=="number"?t:0,s=typeof n=="number"&&n>=0?n:1/0;return Math.max(o,Math.min(s,r))}return e!==void 0?e:t}function HK(e){return it.Children.toArray(e).filter(function(t){return t})}var pf=function(e){Y1(n,e);var t=q1(n);function n(r){var o;X1(this,n),o=t.call(this,r),o.onMouseDown=o.onMouseDown.bind(ha(o)),o.onTouchStart=o.onTouchStart.bind(ha(o)),o.onMouseMove=o.onMouseMove.bind(ha(o)),o.onTouchMove=o.onTouchMove.bind(ha(o)),o.onMouseUp=o.onMouseUp.bind(ha(o));var s=r.size,a=r.defaultSize,i=r.minSize,c=r.maxSize,l=r.primary,f=s!==void 0?s:Zb(a,i,c,null);return o.state={active:!1,resized:!1,pane1Size:l==="first"?f:void 0,pane2Size:l==="second"?f:void 0,instanceProps:{size:s}},o}return K1(n,[{key:"componentDidMount",value:function(){document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("touchmove",this.onTouchMove),this.setState(n.getSizeUpdate(this.props,this.state))}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("touchmove",this.onTouchMove)}},{key:"onMouseDown",value:function(o){var s=Object.assign({},o,{touches:[{clientX:o.clientX,clientY:o.clientY}]});this.onTouchStart(s)}},{key:"onTouchStart",value:function(o){var s=this.props,a=s.allowResize,i=s.onDragStarted,c=s.split;if(a){qb(document,window);var l=c==="vertical"?o.touches[0].clientX:o.touches[0].clientY;typeof i=="function"&&i(),this.setState({active:!0,position:l})}}},{key:"onMouseMove",value:function(o){var s=Object.assign({},o,{touches:[{clientX:o.clientX,clientY:o.clientY}]});this.onTouchMove(s)}},{key:"onTouchMove",value:function(o){var s=this.props,a=s.allowResize,i=s.maxSize,c=s.minSize,l=s.onChange,f=s.split,d=s.step,m=this.state,v=m.active,_=m.position;if(a&&v){qb(document,window);var y=this.props.primary==="first",k=y?this.pane1:this.pane2,g=y?this.pane2:this.pane1;if(k){var b=k,h=g;if(b.getBoundingClientRect){var S=b.getBoundingClientRect().width,x=b.getBoundingClientRect().height,w=f==="vertical"?o.touches[0].clientX:o.touches[0].clientY,I=f==="vertical"?S:x,M=_-w;if(d){if(Math.abs(M)<d)return;M=~~(M/d)*d}var H=y?M:-M,j=parseInt(window.getComputedStyle(b).order),W=parseInt(window.getComputedStyle(h).order);j>W&&(H=-H);var A=i;if(i!==void 0&&i<=0){var L=this.splitPane;f==="vertical"?A=L.getBoundingClientRect().width+i:A=L.getBoundingClientRect().height+i}var B=I-H,P=_-M;B<c?B=c:i!==void 0&&B>A?B=A:this.setState({position:P,resized:!0}),l&&l(B),this.setState(X3({draggedSize:B},y?"pane1Size":"pane2Size",B))}}}}},{key:"onMouseUp",value:function(){var o=this.props,s=o.allowResize,a=o.onDragFinished,i=this.state,c=i.active,l=i.draggedSize;s&&c&&(typeof a=="function"&&a(l),this.setState({active:!1}))}},{key:"render",value:function(){var o=this,s=this.props,a=s.allowResize,i=s.children,c=s.className,l=s.onResizerClick,f=s.onResizerDoubleClick,d=s.paneClassName,m=s.pane1ClassName,v=s.pane2ClassName,_=s.paneStyle,y=s.pane1Style,k=s.pane2Style,g=s.resizerClassName,b=s.resizerStyle,h=s.split,S=s.style,x=this.state,w=x.pane1Size,I=x.pane2Size,M=a?"":"disabled",H=g&&"".concat(g," ").concat(K3),j=HK(i),W=xh({display:"flex",flex:1,height:"100%",position:"absolute",outline:"none",overflow:"hidden",MozUserSelect:"text",WebkitUserSelect:"text",msUserSelect:"text",userSelect:"text"},S);h==="vertical"?Object.assign(W,{flexDirection:"row",left:0,right:0}):Object.assign(W,{bottom:0,flexDirection:"column",minHeight:"100%",top:0,width:"100%"});var A=["SplitPane",c,h,M],L=xh({},_,{},y),B=xh({},_,{},k),P=["Pane1",d,m].join(" "),V=["Pane2",d,v].join(" ");return it.createElement("div",{className:A.join(" "),ref:function(X){o.splitPane=X},style:W},it.createElement(nd,{className:P,key:"pane1",eleRef:function(X){o.pane1=X},size:w,split:h,style:L},j[0]),it.createElement(Z1,{className:M,onClick:l,onDoubleClick:f,onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,onTouchEnd:this.onMouseUp,key:"resizer",resizerClassName:H,split:h,style:b||{}}),it.createElement(nd,{className:V,key:"pane2",eleRef:function(X){o.pane2=X},size:I,split:h,style:B},j[1]))}}],[{key:"getDerivedStateFromProps",value:function(o,s){return n.getSizeUpdate(o,s)}},{key:"getSizeUpdate",value:function(o,s){var a={},i=s.instanceProps;if(i.size===o.size&&o.size!==void 0)return{};var c=o.size!==void 0?o.size:Zb(o.defaultSize,o.minSize,o.maxSize,s.draggedSize);o.size!==void 0&&(a.draggedSize=c);var l=o.primary==="first";return a[l?"pane1Size":"pane2Size"]=c,a[l?"pane2Size":"pane1Size"]=void 0,a.instanceProps={size:o.size},a}}]),n}(it.Component);pf.propTypes={allowResize:dt.bool,children:dt.arrayOf(dt.node).isRequired,className:dt.string,primary:dt.oneOf(["first","second"]),minSize:dt.oneOfType([dt.string,dt.number]),maxSize:dt.oneOfType([dt.string,dt.number]),defaultSize:dt.oneOfType([dt.string,dt.number]),size:dt.oneOfType([dt.string,dt.number]),split:dt.oneOf(["vertical","horizontal"]),onDragStarted:dt.func,onDragFinished:dt.func,onChange:dt.func,onResizerClick:dt.func,onResizerDoubleClick:dt.func,style:Ss,resizerStyle:Ss,paneClassName:dt.string,pane1ClassName:dt.string,pane2ClassName:dt.string,paneStyle:Ss,pane1Style:Ss,pane2Style:Ss,resizerClassName:dt.string,step:dt.number};pf.defaultProps={allowResize:!0,minSize:50,primary:"first",split:"vertical",paneClassName:"",pane1ClassName:"",pane2ClassName:""};$K(pf);const Y3=J(pf)`
  .Resizer {
    background: #000;
    opacity: 0.2;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    -moz-background-clip: padding;
    -webkit-background-clip: padding;
    background-clip: padding-box;
  }

  .Resizer:hover {
    transition: all 0.2s ease;
  }

  .Resizer.horizontal {
    height: 11px;
    margin: -5px 0;
    border-top: 5px solid rgba(255, 255, 255, 0);
    border-bottom: 5px solid rgba(255, 255, 255, 0);
    cursor: row-resize;
    width: 100%;
  }

  .Resizer.horizontal:hover {
    border-top: 5px solid rgba(255, 255, 255, 0.5);
    border-bottom: 5px solid rgba(255, 255, 255, 0.5);
  }

  .Resizer.vertical {
    width: 11px;
    margin: 0 -5px;
    border-left: 5px solid rgba(255, 255, 255, 0);
    border-right: 5px solid rgba(255, 255, 255, 0);
    cursor: col-resize;
  }

  .Resizer.vertical:hover {
    border-left: 5px solid rgba(255, 255, 255, 0.5);
    border-right: 5px solid rgba(255, 255, 255, 0.5);
  }

  .Resizer.disabled {
    cursor: not-allowed;
  }

  .Resizer.disabled:hover {
    border-color: transparent;
  }
`,UK=J.div`
  flex-grow: 1;
  background: var(--color-background);
  position: relative;
`,GK=J.div`
  flex-grow: 1;
  position: relative;
  outline: none;
`,XK=J.div`
  border-top: 1px solid var(--color-divider);
  height: calc(100% - 17px);
`,KK=()=>{const{transform:e,scrollBy:t,selectedTrackId:n,setActivePane:r}=Me(),{isRhythmTrack:o}=wt(n),{contentHeight:s,scrollTop:a,scaleAroundPointY:i,setScrollTopInPixels:c,setScaleY:l}=vo(),{scrollLeft:f,contentWidth:d,scaleAroundPointX:m,setAutoScroll:v,setScrollLeftInPixels:_,setScaleX:y}=kt(),k=kG(),g=p.useRef(null),b=zr(g),h=p.useRef(null),{height:S=0}=zr(h),x=o?Vt.keyWidth+Vt.drumKeysWidth:Vt.keyWidth,w=p.useCallback(()=>m(.2,0),[m]),I=p.useCallback(()=>m(-.2,0),[m]),M=p.useCallback(()=>y(1),[y]),H=p.useCallback(()=>i(.2,0),[i]),j=p.useCallback(()=>i(-.2,0),[i]),W=p.useCallback(()=>l(1),[l]),A=p.useCallback(V=>{if(V.shiftKey&&(V.altKey||V.ctrlKey)){let U=xa(V.nativeEvent)?.02*V.deltaY:.01*V.deltaX;U=Qe.clamp(U,-.15,.15),i(U,V.nativeEvent.offsetY)}else if(V.altKey||V.ctrlKey){const U=xa(V.nativeEvent)?.01:-.01,X=Qe.clamp(V.deltaY*U,-.15,.15);m(X,V.nativeEvent.offsetX)}else{const U=xa(V.nativeEvent)?1:e.pixelsPerKey*__,X=V.deltaY*U;t(-V.deltaX,-X)}},[t,e,m,i]),L=p.useCallback(()=>{c(a)},[c,a]),B=p.useCallback(()=>r("notes"),[r]),P=p.useCallback(()=>r(null),[r]);return p.useEffect(()=>()=>{r(null)},[r]),G(UK,{ref:g,children:[G(Y3,{split:"horizontal",minSize:50,defaultSize:"60%",onChange:L,children:[G(GK,{onWheel:A,ref:h,...k,onFocus:B,onBlur:P,tabIndex:0,children:[u(BK,{width:b.width,height:S,keyWidth:x}),u(Kk,{scrollOffset:a,contentLength:s,onScroll:c,onClickScaleUp:H,onClickScaleDown:j,onClickScaleReset:W})]}),u(XK,{children:u(hX,{axisWidth:x})})]}),u(Xk,{scrollOffset:f,contentLength:d,onScroll:p.useCallback(V=>{_(V),v(!1)},[_,v]),onClickScaleUp:w,onClickScaleDown:I,onClickScaleReset:M})]})},YK=J.div`
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  outline: none;
`,Qb=({isShow:e,pane:t,children:n,...r})=>e?G(Y3,{...r,children:[t,n]}):u(Ke,{children:n}),qK=()=>{const{isOpen:e}=Ud(),{isOpen:t}=D1();return u("div",{style:{display:"flex",flexGrow:1,position:"relative"},children:u(Qb,{split:"vertical",minSize:280,pane1Style:{display:"flex"},pane2Style:{display:"flex"},isShow:e,pane:u(_G,{}),children:u(Qb,{split:"vertical",minSize:240,pane1Style:{display:"flex"},pane2Style:{display:"flex"},isShow:t,pane:u(uH,{}),children:u(KK,{})})})})},ZK=()=>{const e=$j(),t=Qm();return G(AA,{children:[G(YK,{...e,tabIndex:0,ref:t,children:[u(NU,{}),u(qK,{})]}),u(yG,{}),u(SG,{})]})};function QK(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var rd=QK(p),JK=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},eY=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},Jb=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=eY(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return rd.createElement("svg",JK({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),rd.createElement("path",{d:"M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z"}))},tY=rd.memo?rd.memo(Jb):Jb,nY=tY;const rY=yt(nY),oY=J.div`
  background: var(--color-background-secondary);
  display: flex;
  padding: 1rem;
  border-radius: 0.5rem;
  line-height: 1.5;
`,sY=({severity:e,...t})=>{switch(e){case"info":return u(P_,{...t});case"warning":return u(O_,{...t})}},aY=J.div`
  flex-grow: 1;
  display: flex;
  align-items: center;
`,mf=({children:e,severity:t,...n})=>G(oY,{...n,children:[u(sY,{severity:t,style:{marginRight:"1rem",flexShrink:"0"}}),u(aY,{children:e})]}),iY=J.div`
  display: flex;
  flex-grow: 1;
`,cY=J.input`
  flex-grow: 1;
  border: none;
  border-radius: 0.2rem;
  padding: 0.5rem 1rem;
  font-size: 0.8rem;
  outline: none;
  margin-right: 0.5rem;
`,lY=J.div``,uY=({text:e})=>{const t=Io(),n=er(),r=p.useCallback(()=>{navigator.clipboard.writeText(e),t.success(n.copied)},[e,t,n]);return G(iY,{children:[u(cY,{type:"text",value:e,readOnly:!0,onFocus:o=>{o.target.select()}}),u(lY,{children:u(xo,{onClick:r,children:u(N,{name:"copy"})})})]})},dY=J.div`
  margin-top: 1rem;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(32px, 1fr));
  grid-gap: 0.5rem;

  & > button:hover {
    opacity: 0.8;
  }
`,fY=({url:e,text:t})=>G(Ke,{children:[u(uY,{text:e}),G(dY,{children:[u(d5,{url:e,title:t,children:u(u5,{size:32,round:!0})}),u(h5,{url:e,children:u(f5,{size:32,round:!0})}),u(m5,{url:e,title:t,children:u(p5,{size:32,round:!0})}),u(v5,{url:e,title:t,children:u(g5,{size:32,round:!0})}),u(_5,{url:e,title:t,children:u(b5,{size:32,round:!0})}),u(S5,{url:e,subject:"Check out this song on signal",children:u(y5,{size:32,round:!0})})]})]}),hY=()=>{const{openPublishDialog:e,setOpenPublishDialog:t}=Ln(),{cloudSongId:n,getSong:r}=_t(),o=Sz(),s=kz(),[a,i]=p.useState("notPublishable"),[c,l]=p.useState(!0),f=Io(),d=$t(),m=er();p.useEffect(()=>{(async()=>{if(e){if(l(!0),n===null){i("notPublishable"),l(!1);return}const k=await Js.get(n);i(k!=null&&k.isPublic?"published":"publishable"),l(!1)}})()},[e]);const v=p.useCallback(()=>t(!1),[t]),_=async()=>{try{l(!0),await o(r()),i("published"),f.success(m["song-published"])}catch(k){f.error(k.message)}finally{l(!1)}},y=async()=>{try{l(!0),await s(r()),i("publishable"),f.success(m["song-unpublished"])}catch(k){f.error(k.message)}finally{l(!1)}};return G(hn,{open:e,onOpenChange:v,style:{minWidth:"20rem"},children:[u(bn,{children:u(N,{name:"publish-song"})}),G(qt,{children:[a==="publishable"&&G(Ke,{children:[u("div",{style:{marginBottom:"1rem"},children:u(N,{name:"publish-notice"})}),u(mf,{severity:"warning",children:u(N,{name:"publish-rules"})})]}),a==="published"&&n!==null&&G(Ke,{children:[G(pY,{href:e_(n),target:"_blank",children:[u(N,{name:"published-notice"}),u(rY,{color:d.secondaryTextColor,size:"1rem"})]}),u(fY,{url:e_(n),text:m["share-my-song-text"]}),u(mY,{})]})]}),G(gn,{children:[u(Et,{onClick:v,children:u(N,{name:"close"})}),a==="publishable"&&u(xo,{onClick:_,disabled:c,children:u(N,{name:"publish"})}),a==="published"&&u(xo,{onClick:y,disabled:c,children:u(N,{name:"unpublish"})})]})]})},pY=J.a`
  display: flex;
  align-items: center;
  color: var(--color-text);
  text-decoration: none;
  margin-bottom: 1rem;

  &:hover {
    opacity: 0.8;
  }
`,mY=J.div`
  margin: 1rem 0 0 0;
  height: 1px;
  background: var(--color-divider);
`,e_=e=>`${window.location.origin}/songs/${e}`,gY=({themeType:e})=>{switch(e){case"dark":return"Dark";case"light":return"Light";default:return"Unknown"}},vY=()=>{const{language:e,setLanguage:t}=gi(),n=m4();return G(so,{children:[u(N,{name:"language"}),u(Za,{value:e??n,onChange:o=>t(o.target.value),style:{marginTop:"0.5rem"},children:[{label:"English",language:"en"},{label:"French",language:"fr"},{label:"Japanese",language:"ja"},{label:"Slovak",language:"sk"},{label:"Chinese (Simplified)",language:"zh-Hans"},{label:"Chinese (Traditional)",language:"zh-Hant"}].map(o=>u("option",{value:o.language,children:o.label},o.language))})]})},bY=()=>{const{themeType:e,setThemeType:t}=gi();return G(so,{children:[u(N,{name:"theme"}),u(Za,{value:e,onChange:n=>t(n.target.value),style:{marginTop:"0.5rem"},children:Object.keys(b_).map(n=>u("option",{value:n,children:u(gY,{themeType:n})},n))})]})},_Y=()=>{const{showNoteLabels:e,setShowNoteLabels:t}=gi(),n=p.useCallback(r=>{t(r)},[t]);return u(wc,{checked:e,onCheckedChange:n,label:u(N,{name:"show-note-labels"})})},yY=J.div`
  display: flex;
  flex-direction: column;
  gap: 1rem;
`,SY=J.div`
  font-weight: bold;
  margin: 1rem 0;
`,kY=J.div`
  display: flex;
  flex-direction: column;
`,wY=()=>G(Ke,{children:[u(bn,{children:u(N,{name:"general"})}),u(qt,{children:G(yY,{children:[u(vY,{}),u(bY,{}),G(kY,{children:[u(SY,{children:u(N,{name:"appearance"})}),u(_Y,{})]})]})})]});function xY(){const{midiDeviceStore:e}=Ht(),t=bt(e,"inputs"),n=bt(e,"outputs"),r=bt(e,"enabledInputs"),o=bt(e,"enabledOutputs"),s=bt(e,"isFactorySoundEnabled"),a=t.map(c=>({id:c.id,name:t_(c),isConnected:c.state==="connected",isEnabled:r[c.id]})),i=[{...n_,isEnabled:s},...n.map(c=>({id:c.id,name:t_(c),isConnected:c.state==="connected",isEnabled:o[c.id]}))];return{inputDevices:a,outputDevices:i,get isLoading(){return bt(e,"isLoading")},get requestError(){return bt(e,"requestError")},requestMIDIAccess:e.requestMIDIAccess,setInputEnable:e.setInputEnable,setOutputEnable:p.useCallback((c,l)=>{c===n_.id?e.isFactorySoundEnabled=l:e.setOutputEnable(c,l)},[e])}}const t_=e=>{var t;return((e==null?void 0:e.name)??"")+((((t=e.manufacturer)==null?void 0:t.length)??0)>0?`(${e.manufacturer})`:"")},n_={id:"signal-midi-app",name:"Signal Factory Sound",isConnected:!0},CY=()=>{const{midiDeviceStore:e}=Ht(),t=bt(e,"enabledInputs");return Object.values(t).filter(n=>n).length>0},r_=({device:e,onCheck:t})=>u(so,{style:{display:"flex",alignItems:"center",marginBottom:"1rem"},children:u(wc,{checked:e.isEnabled,onCheckedChange:n=>t(n===!0),style:{marginRight:"0.5rem"},label:G(Ke,{children:[e.name,!e.isConnected&&" (disconnected)"]})})}),o_=J.div``,TY=J.div`
  color: var(--color-text-secondary);
`,s_=J.div`
  height: 2rem;
`,a_=J.div`
  font-weight: bold;
  margin: 1rem 0;
`,MY=()=>{const{inputDevices:e,outputDevices:t,isLoading:n,requestError:r,setInputEnable:o,setOutputEnable:s}=xY();return G(Ke,{children:[u(bn,{children:u(N,{name:"midi-settings"})}),G(qt,{children:[n&&u(Kc,{}),r&&G(Ke,{children:[u(mf,{severity:"warning",children:r.message}),u(s_,{})]}),!n&&G(Ke,{children:[u(a_,{children:u(N,{name:"inputs"})}),G(o_,{children:[e.length===0&&u(TY,{children:u(N,{name:"no-inputs"})}),e.map(a=>u(r_,{device:a,onCheck:i=>o(a.id,i)},a.id))]}),G(Ke,{children:[u(s_,{}),u(a_,{children:u(N,{name:"outputs"})}),u(o_,{children:t.map(a=>u(r_,{device:a,onCheck:i=>s(a.id,i)},a.id))})]})]})]})]})},EY=["general","midi","soundfont"],IY=J(Et)`
  display: flex;
  font-size: 0.875rem;
  align-items: center;
  margin-bottom: 0.5rem;

  &[data-selected="true"] {
    background: var(--color-highlight);
  }
`,AY=J.div`
  display: flex;
  flex-direction: column;
  min-width: 12em;
  margin-right: 2rem;
`,RY=({route:e})=>{switch(e){case"general":return u(N,{name:"general"});case"midi":return u(N,{name:"midi"});case"soundfont":return u(N,{name:"soundfont"})}},OY=({route:e,onChange:t})=>u(AY,{children:EY.map(n=>u(IY,{"data-selected":e===n,onClick:()=>t(n),children:u(RY,{route:n},n)},n))});function gf(){const{soundFontStore:e}=Ht();return{get files(){return bt(e,"files")},get selectedSoundFontId(){return bt(e,"selectedSoundFontId")},get scanPaths(){return bt(e,"scanPaths")},get isLoading(){return bt(e,"isLoading")},load:e.load,addSoundFont:e.addSoundFont,removeSoundFont:e.removeSoundFont,scanSoundFonts:e.scanSoundFonts,removeScanPath:e.removeScanPath,addScanPath:e.addScanPath}}function PY(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var od=PY(p),BY=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},DY=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},i_=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=DY(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return od.createElement("svg",BY({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),od.createElement("path",{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"}))},NY=od.memo?od.memo(i_):i_,LY=NY;const q3=yt(LY),zY=J.div`
  display: flex;
  flex-direction: column;
  margin-bottom: 1rem;
  overflow-y: auto;
`,FY=J.div`
  position: absolute;
  display: flex;
  align-items: center;
  justify-content: center;
  top: 0;
  left: 0;
  background-color: ${({theme:e})=>gt(e.backgroundColor).alpha(.5).toString()};
  color: var(--color-text);
  width: 100%;
  height: 100%;
  z-index: 1;
`,WY=()=>{const{files:e,selectedSoundFontId:t,load:n,removeSoundFont:r}=gf(),[o,s]=p.useState(!1),a=Io();return G(zY,{children:[e.map(i=>u(jY,{isSelected:i.id===t,item:i,onClick:async()=>{s(!0);try{await n(i.id)}catch(c){a.error(c.message)}finally{s(!1)}},onClickDelete:async()=>{await r(i.id)}},i.id)),o&&u(FY,{children:u(Kc,{})})]})},$Y=J(q3)`
  width: 1rem;
  color: var(--color-text-secondary);
`,VY=J.div`
  display: flex;
  align-items: center;
`,jY=({item:e,isSelected:t,onClick:n,onClickDelete:r})=>G(VY,{children:[u(Hl,{label:e.name,isSelected:t,onClick:n}),e.id>=0&&u(Et,{style:{marginLeft:"auto",display:"flex",alignItems:"center"},onClick:r,children:u($Y,{})})]}),HY=J.div`
  display: flex;
  justify-content: flex-end;
  margin-top: 1rem;
`,UY=()=>{const{scanPaths:e,addScanPath:t,removeScanPath:n,scanSoundFonts:r}=gf(),o=async()=>{const s=await window.electronAPI.showOpenDirectoryDialog();s&&t(s)};return G(Ke,{children:[e.length===0&&u("p",{children:u("i",{children:"No scan paths"})}),e.map(s=>u(YY,{path:s,onClickDelete:()=>n(s)},s)),G(HY,{children:[u(Et,{onClick:o,children:u(N,{name:"add"})}),u(Et,{onClick:r,children:u(N,{name:"scan"})})]})]})},GY=J.span`
  font-size: 0.8rem;
  color: var(--color-text-secondary);
`,XY=J(q3)`
  width: 1rem;
  color: var(--color-text-secondary);
`,KY=J.div`
  display: flex;
  align-items: center;
`,YY=({path:e,onClickDelete:t})=>G(KY,{children:[u(GY,{children:e}),u(Et,{style:{marginLeft:"auto",display:"flex",alignItems:"center"},onClick:t,children:u(XY,{})})]}),qY=J(Et)`
  display: inline-flex;
  align-items: center;
`,ZY=J.div`
  font-weight: bold;
  margin: 1rem 0;
`,QY=()=>{const{addSoundFont:e}=gf(),t=async n=>{var o;n.preventDefault();const r=(o=n.currentTarget.files)==null?void 0:o.item(0);if(r){const s=await r.arrayBuffer();e({type:"local",data:s},{name:r.name})}};return G(Ke,{children:[u(bn,{children:u(N,{name:"soundfont"})}),G(qt,{children:[u(WY,{}),!$n()&&G(Ke,{children:[u(Zm,{onChange:t,accept:".sf2",children:u(qY,{as:"div",children:u(N,{name:"add"})})}),u(mf,{severity:"info",style:{marginTop:"1rem"},children:u(N,{name:"soundfont-save-notice"})})]}),$n()&&G(Ke,{children:[u(ZY,{children:u(N,{name:"soundfont-location"})}),u(UY,{})]})]})]})},JY=({route:e})=>{switch(e){case"general":return u(wY,{});case"midi":return u(MY,{});case"soundfont":return u(QY,{})}},eq=J.div`
  flex-grow: 1;
  min-height: 24rem;
`,tq=()=>{const{openSettingDialog:e,setOpenSettingDialog:t}=Ln(),[n,r]=p.useState("general"),o=p.useCallback(()=>t(!1),[t]);return G(hn,{open:e,onOpenChange:o,style:{minWidth:"32rem"},children:[u(bn,{children:u(N,{name:"settings"})}),G(qt,{style:{display:"flex",flexDirection:"row"},children:[u(OY,{route:n,onChange:r}),u(eq,{children:u(JY,{route:n})})]}),u(gn,{children:u(Et,{onClick:o,children:u(N,{name:"close"})})})]})},nq=J.span`
  border: 1px solid currentColor;
  font-size: 0.8rem;
  padding: 0.1rem 0.4rem;
  margin-left: 1em;
  color: var(--color-text-secondary);
`,rq=J.div`
  margin: 1rem 0 2rem 0;
  line-height: 1.5;
`,oq=({open:e,onClose:t,onSuccess:n,onFailure:r})=>G(hn,{open:e,onOpenChange:t,style:{minWidth:"20rem"},children:[G(bn,{children:[u(N,{name:"sign-in"}),u(nq,{children:"Beta"})]}),G(qt,{children:[u(mf,{severity:"info",children:u(N,{name:"cloud-beta-warning"})}),u(rq,{children:u(N,{name:"cloud-description"})}),u(g4,{uiConfig:{signInOptions:[g_.PROVIDER_ID,v_.PROVIDER_ID,"apple.com"],callbacks:{signInSuccessWithAuthResult(){return n(),!1},signInFailure:r},signInFlow:"popup"},firebaseAuth:Ja})]}),u(gn,{children:u(Et,{onClick:t,children:u(N,{name:"close"})})})]}),sq=()=>{const{openSignInDialog:e,setOpenSignInDialog:t}=Ln(),n=Io(),r=er(),o=p.useCallback(()=>t(!1),[t]);return u(oq,{open:e,onClose:o,onSuccess:async()=>{t(!1),n.success(r["success-sign-in"])},onFailure:i=>{console.warn(i)}})},Q1=()=>{const{removeEvents:e}=io(),{pushHistory:t}=ht(),{selectedEventIds:n,setSelection:r}=Jn();return()=>{n.length!==0&&(t(),e(n),r(null))}},vf=()=>{const{selectedEventIds:e}=Jn(),t=an();return async()=>{const n=t.conductorTrack.copyTempoEvents(e);n&&await zd(n)}},Z3=()=>{const{position:e}=Lt(),t=an(),{pushHistory:n}=ht();return async r=>{const o=r?Fd(r):await Yc(),{data:s}=S9.safeParse(o);s&&(n(),t.conductorTrack.pasteTempoEventsAt(s,e))}},aq=()=>{const e=vf(),t=Q1();return p.useCallback(()=>{e(),t()},[e,t])},iq=()=>{const{pushHistory:e}=ht(),{selectedEventIds:t,setSelectedEventIds:n}=Jn(),r=an();return()=>{if(t.length===0)return;e();const o=r.conductorTrack.duplicateEvents(t);n(o)}},cq=()=>{const{setMouseMode:e}=Jn(),{resetSelection:t}=Jn(),n=Q1(),r=vf(),o=aq(),s=iq(),a=Z3(),i=p.useMemo(()=>[{code:"Digit1",run:()=>e("pencil")},{code:"Digit2",run:()=>e("selection")},{code:"Escape",run:t},{code:"Backspace",run:n},{code:"Delete",run:n},{code:"KeyC",metaKey:!0,run:r},{code:"KeyV",metaKey:!0,run:()=>a()},{code:"KeyX",metaKey:!0,run:o},{code:"KeyD",metaKey:!0,run:s}],[e,t,n,r,s,a,o]),c=p.useCallback(()=>{r(),n()},[r,n]);return _i({actions:i,onCopy:r,onPaste:a,onCut:c})},lq=()=>{const{mouseMode:e,setMouseMode:t}=Jn();return u(y3,{mouseMode:e,onSelect:t})},uq=J.span`
  font-weight: bold;
  margin-right: 2em;
  font-size: 1rem;
  margin-left: 0.5rem;
`,dq=J.div`
  flex-grow: 1;
`,fq=()=>G(a1,{children:[u(uq,{children:u(N,{name:"tempo"})}),u(dq,{}),u(lq,{}),u(s1,{}),u(n1,{})]}),hq=J(qa)`
  height: 100%;
  background: var(--color-background);
  pointer-events: none;
  border-right: 1px solid var(--color-divider);
  box-shadow: 0px 0px 5px 0 rgba(0, 0, 0, 0.1);
`,pq=J.div`
  position: relative;

  & > div {
    position: absolute;
    text-align: right;
    width: 100%;
    padding-right: 1em;
    box-sizing: border-box;
    font-size: 90%;
    margin-top: -0.5em;
  }
`,mq=({width:e,transform:t,offset:n})=>u(hq,{width:e,top:n,children:u(pq,{children:Th(30,t.maxBPM,30).map(r=>{const o=Math.round(t.getY(r));return u(qa,{top:o,children:r},r)})})}),gq=()=>{const{setSelectedEventIds:e,setSelection:t}=Jn(),{getEvents:n}=io();let r=null;return{onMouseDown(o,s,a){const i=a.fromPosition(s),c=Qn(o);e([]),r={fromTick:i.tick,toTick:i.tick},t(r),jr({onMouseMove:l=>{const f=Qn(l),d=on.sub(f,c),m=on.add(s,d),v=a.fromPosition(m);r={fromTick:Math.min(i.tick,v.tick),toTick:Math.max(i.tick,v.tick)},t(r)},onMouseUp:()=>{r!==null&&(e(n().filter(li).filter(js(Ft.create(r.fromTick,r.toTick))).map(l=>l.id)),t(null))}})}}},vq=()=>{const{pushHistory:e}=ht(),{quantizeRound:t}=Nn(),{id:n,createOrUpdate:r}=io(),o=NS(n,li,s=>fu(0,$a(s)));return{onMouseDown(s,a,i){e();const c=Qn(s),l=i.fromPosition(a),f=$a(l.bpm),d={...fu(0,Math.round(f)),tick:t(l.tick)};r(d);let m=l.tick,v=l.bpm;jr({onMouseMove:_=>{const y=Qn(_),k=on.sub(y,c),g=on.add(a,k),b=Math.max(0,Math.min(i.maxBPM,i.fromPosition(g).bpm)),h=i.getTick(g.x);o(v,b,m,h),m=h,v=b}})}}},bq=({width:e,zIndex:t})=>{const{transform:n}=Jn(),r=$t(),o=i=>({x:0,y:i,width:e,height:1}),s=Qe.range(30,n.maxBPM,30).map(i=>n.getY(i)).map(o),a=St(gt(r.dividerColor));return u(os,{rects:s,color:a,zIndex:t})};var Pp;(e=>{e.getBounds=(t,n)=>{const r=n.getX(t.fromTick),o=n.getX(t.toTick);return{x:r,y:0,width:o-r,height:n.height}}})(Pp||(Pp={}));const _q=({zIndex:e})=>{const{transform:t,selection:n}=Jn(),r=p.useMemo(()=>n!=null?Pp.getBounds(n,t):null,[n,t]);return u(tf,{rect:r,zIndex:e})},yq=(e,t,n)=>{const r=e.sort((o,s)=>o.tick-s.tick).map(o=>{const s=6e7/o.microsecondsPerBeat;return{id:o.id,x:Math.round(t.getX(o.tick)),y:Math.round(t.getY(s)),microsecondsPerBeat:o.microsecondsPerBeat}});return r.map((o,s)=>{const a=s+1<r.length?r[s+1].x:n;return{id:o.id,bounds:{x:o.x,y:o.y,width:a-o.x,height:t.height-o.y+1},microsecondsPerBeat:o.microsecondsPerBeat}})};function Sq(){const{transform:e}=Jn(),{tempoEvents:t}=io(),{canvasWidth:n,scrollLeft:r}=kt();return{items:p.useMemo(()=>yq(t,e,n+r),[t,e,n,r])}}const kq=()=>{const{getEventById:e}=io(),{pushHistory:t}=ht(),{setSelectedEventIds:n,transform:r,getLocal:o,selectedEventIds:s}=Jn(),{quantizeRound:a}=Nn(),i=an();return{onMouseDown:p.useCallback((c,l)=>{t();const f=o(c);let d=s;d.includes(l)||(d=[l],n(d));const v=d.map(b=>e(b)).filter(Mo).map(b=>({...b})).find(b=>b.id===l);if(v===void 0)return;const _=r.fromPosition(f),y=Qn(c);let k=0,g=0;jr({onMouseMove:b=>{const h=Qn(b),S=on.sub(h,y),x=on.add(f,S),w=r.fromPosition(x),I=w.tick-_.tick,M=v.tick+I-a(v.tick+I),H=I-M,j=w.bpm-_.bpm;i.conductorTrack.moveTempoEvents(d,H-k,j-g,r.maxBPM),k=H,g=j},onMouseUp:()=>{i.conductorTrack.removeRedundantEventsForEventIds(d)}})},[t,o,s,r,n,e,a,i.conductorTrack])}},wq=4,xq=({width:e,zIndex:t})=>{const{mouseMode:n,selectedEventIds:r}=Jn(),{items:o}=Sq(),{scrollLeft:s}=kt(),a=kq(),i=FO(),c=p.useMemo(()=>o.map(d=>({...Sc.fromPointWithSize(d.bounds,wq*2),id:d.id,original:d})),[o]),l=p.useCallback((d,m)=>{n==="selection"&&(d.stopPropagation(),a.onMouseDown(d,m))},[n,a]),f=p.useCallback((d,m)=>{const v=o.filter(k=>k.id===m.id)[0],_=d.deltaY>0?-1:1,y=fm(v.microsecondsPerBeat);i(v.id,Math.floor($a(y+_)))},[o,i]);return G(Ke,{children:[u(C3,{width:e,items:o.map(d=>({...d.bounds,id:d.id})),selectedEventIds:r,controlPoints:c,scrollLeft:s,lineWidth:2,zIndex:t,onMouseDownItem:l}),o.map(d=>u(Cq,{bounds:d.bounds,item:d,zIndex:t,onWheel:f},d.id))]})},Cq=({bounds:e,item:t,zIndex:n,onWheel:r})=>{const o=p.useCallback(a=>{r(a,t)},[r,t]),s=p.useMemo(()=>({x:e.x,y:0,width:e.width,height:Number.MAX_SAFE_INTEGER}),[e.x,e.width]);return u(Nr,{bounds:s,zIndex:n,onWheel:o})},Tq=({width:e,height:t,style:n,className:r})=>{const{transform:o,mouseMode:s}=Jn(),a=hi(),{cursorX:i,scrollLeft:c}=kt(),l=vq(),f=gq(),d=Math.floor(c),m=p.useCallback(g=>({x:g.offsetX+d,y:g.offsetY}),[d]),v=s==="pencil"?l:f,_=p.useCallback(g=>{if(g.button!==0)return;const b=m(g.nativeEvent);v.onMouseDown(g.nativeEvent,b,o)},[v,o,m]),y=p.useMemo(()=>_o(-d,0),[d]),k=p.useMemo(()=>s==="pencil"?'url("./cursor-pencil.svg") 0 20, pointer':"auto",[s]);return G(tl,{width:e,height:t,onMouseDown:_,style:n,className:r,cursor:k,children:[u(bq,{width:e,zIndex:0}),G(bo,{matrix:y,children:[u(rl,{height:t,beats:a,zIndex:1}),u(xq,{width:e,zIndex:2}),u(_q,{zIndex:3}),u(ol,{x:i,height:t,zIndex:4})]})]})},Mq=J.div`
  position: relative;
  flex-grow: 1;
  background: var(--color-background);
  color: var(--color-text-secondary);
`,J1=64,Eq=J(c1)`
  position: absolute;
  left: ${J1}px;
  top: 0;
  background: var(--color-background);
  border-bottom: 1px solid var(--color-divider);
  box-sizing: border-box;
`,Iq=J(Tq)`
  position: absolute;
  top: ${Vt.rulerHeight}px;
  left: ${J1}px;
  background-color: var(--color-editor-background);
`,Aq=()=>{const{transform:e,setCanvasHeight:t}=Jn(),{contentWidth:n,scrollLeft:r,setCanvasWidth:o,setScrollLeftInPixels:s,setAutoScroll:a}=kt(),i=p.useRef(null),c=zr(i),l=p.useCallback(_=>{s(_),a(!1)},[s,a]),f=Math.floor(r),d=c.width,v=c.height-Vt.rulerHeight-cr;return p.useEffect(()=>{o(d),t(v)},[d,v,o,t]),G(Mq,{ref:i,children:[u(Eq,{}),u(Iq,{width:d,height:v}),u(mq,{width:J1,offset:Vt.rulerHeight,transform:e}),u(oA,{scrollOffset:f,contentLength:n,onScroll:l})]})},Rq=J.div`
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  overflow: hidden;
  outline: none;
`,Oq=()=>{const e=cq(),t=Qm();return G(Rq,{...e,tabIndex:0,ref:t,children:[u(fq,{}),u(Aq,{})]})},Pq=()=>u(jA,{children:u(Oq,{})});function Bq(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var sd=Bq(p),Dq=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Nq=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},c_=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=Nq(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return sd.createElement("svg",Dq({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),sd.createElement("path",{d:"M13,6V18L21.5,12M4,18L12.5,12L4,6V18Z"}))},Lq=sd.memo?sd.memo(c_):c_,zq=Lq;const Fq=yt(zq);function Wq(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var ad=Wq(p),$q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Vq=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},l_=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=Vq(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return ad.createElement("svg",$q({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),ad.createElement("path",{d:"M11.5,12L20,18V6M11,18V6L2.5,12L11,18Z"}))},jq=ad.memo?ad.memo(l_):l_,Hq=jq;const Uq=yt(Hq);function Gq(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var id=Gq(p),Xq=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Kq=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},u_=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=Kq(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return id.createElement("svg",Xq({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),id.createElement("path",{d:"M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"}))},Yq=id.memo?id.memo(u_):u_,qq=Yq;const Zq=yt(qq);function Qq(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var cd=Qq(p),Jq=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},eZ=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},d_=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=eZ(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return cd.createElement("svg",Jq({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),cd.createElement("path",{d:"M12,1.75L8.57,2.67L4.06,19.53C4.03,19.68 4,19.84 4,20C4,21.11 4.89,22 6,22H18C19.11,22 20,21.11 20,20C20,19.84 19.97,19.68 19.94,19.53L18.58,14.42L17,16L17.2,17H13.41L16.25,14.16L14.84,12.75L10.59,17H6.8L10.29,4H13.71L15.17,9.43L16.8,7.79L15.43,2.67L12,1.75M11.25,5V14.75L12.75,13.25V5H11.25M19.79,7.8L16.96,10.63L16.25,9.92L14.84,11.34L17.66,14.16L19.08,12.75L18.37,12.04L21.2,9.21L19.79,7.8Z"}))},tZ=cd.memo?cd.memo(d_):d_,nZ=tZ;const rZ=yt(nZ);function oZ(e){return e&&typeof e=="object"&&"default"in e?e.default:e}var ld=oZ(p),sZ=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},aZ=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},f_=function(t){var n=t.color,r=n===void 0?"currentColor":n,o=t.size,s=o===void 0?24:o;t.children;var a=aZ(t,["color","size","children"]),i="mdi-icon "+(a.className||"");return ld.createElement("svg",sZ({},a,{className:i,width:s,height:s,fill:r,viewBox:"0 0 24 24"}),ld.createElement("path",{d:"M18,18H6V6H18V18Z"}))},iZ=ld.memo?ld.memo(f_):f_,cZ=iZ;const lZ=yt(cZ);function Q3(){const{songStore:e,player:t,synthGroup:n,midiRecorder:r}=Ht(),o=CY(),{isPlaying:s,loop:a,playOrPause:i,toggleEnableLoop:c}=Lt();return{play:i,stop:zS(),rewindOneBar:FS(),fastForwardOneBar:WS(),toggleRecording:$S(),toggleEnableLoop:c,toggleMetronome:p.useCallback(()=>{n.isMetronomeEnabled=!n.isMetronomeEnabled},[n]),isPlaying:s,isLoopEnabled:a!==null,isLoopActive:(a==null?void 0:a.enabled)??!1,canRecording:o,get isRecording(){return bt(r,"isRecording")},get isMetronomeEnabled(){return bt(n,"isMetronomeEnabled")},get currentMBTTime(){return On(()=>to.getMBTString(e.song.measures,t.position,e.song.timebase),[e,t])}}}const Os=J.div`
  --webkit-appearance: none;
  outline: none;
  border: none;
  border-radius: 100%;
  margin: 0.25rem;
  padding: 0.4rem;
  color: var(--color-text);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;

  &:hover {
    background: var(--color-highlight);
  }

  svg {
    width: 1.2rem;
    height: 1.2rem;
  }
`,uZ=J(Os)`
  color: var(--color-on-surface);
  background: var(--color-theme);

  &:hover {
    background: var(--color-theme);
    opacity: 0.8;
  }

  &.active {
    background: var(--color-theme);
  }
`,dZ=({onMouseDown:e,isPlaying:t})=>u(dr,{title:G(Ke,{children:[u(N,{name:"play-pause"})," [space]"]}),side:"top",children:u(uZ,{id:"button-play",onMouseDown:e,className:t?"active":void 0,children:t?u(k5,{}):u(w5,{})})}),fZ=J(Fk)`
  background: transparent;
  -webkit-appearance: none;
  border: none;
  color: inherit;
  font-size: inherit;
  font-family: inherit;
  width: 5em;
  text-align: center;
  outline: none;
  font-family: var(--font-mono);
  font-size: 1rem;
  padding: 0.3rem 0;

  &::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
`,hZ=J.div`
  display: flex;
  align-items: center;
  border: 1px solid transparent;
  padding-left: 0.75rem;
  border-radius: 0.25rem;

  label {
    font-size: 0.6rem;
    color: var(--color-text-secondary);
  }

  &:focus-within {
    border: 1px solid var(--color-divider);
    background: #ffffff14;
  }
`,pZ=()=>{const{position:e,setCurrentTempo:t}=Lt(),{currentTempo:n,setTempo:r}=io(),o=n??x5,s=a=>{r(a,e),t(a)};return G(hZ,{children:[u("label",{htmlFor:"tempo-input",children:"BPM"}),u(fZ,{id:"tempo-input",min:1,max:512,value:Math.round(o*100)/100,step:1,onChange:s})]})},mZ=J.div`
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0.25rem 1rem;
  background: var(--color-background);
  border-top: 1px solid var(--color-divider);
  height: 3rem;
  box-sizing: border-box;
`,gZ=J(Os)`
  &[data-active="true"] {
    color: var(--color-record);
  }
`,vZ=J(Os)`
  &[data-active="true"] {
    color: var(--color-theme);
  }
`,bZ=J(Os)`
  color: var(--color-text-secondary);

  &[data-active="true"] {
    color: var(--color-theme);
  }
`,_Z=J.div`
  font-family: var(--font-mono);
  font-size: 0.9rem;
  color: var(--color-text-secondary);
`,yZ=()=>{const{currentMBTTime:e}=Q3();return u(_Z,{children:e})},h_=J.div`
  background: var(--color-divider);
  margin: 0.4em 1em;
  width: 1px;
  height: 1rem;
`,SZ=J.div`
  position: absolute;
  right: 1em;
`,kZ=()=>{const{rewindOneBar:e,fastForwardOneBar:t,stop:n,play:r,isPlaying:o,isRecording:s,toggleRecording:a,toggleEnableLoop:i,toggleMetronome:c,isLoopEnabled:l,isLoopActive:f,isMetronomeEnabled:d,canRecording:m}=Q3(),{isLoading:v}=gf();return G(mZ,{children:[u(dr,{title:u(N,{name:"rewind"}),side:"top",children:u(Os,{onMouseDown:e,children:u(Uq,{})})}),u(dr,{title:u(N,{name:"stop"}),side:"top",children:u(Os,{onMouseDown:n,children:u(lZ,{})})}),u(dZ,{onMouseDown:r,isPlaying:o}),m&&u(dr,{title:u(N,{name:"record"}),side:"top",children:u(gZ,{onMouseDown:a,"data-active":s,children:u(Yd,{})})}),u(dr,{title:u(N,{name:"fast-forward"}),side:"top",children:u(Os,{onMouseDown:t,children:u(Fq,{})})}),l&&u(vZ,{onMouseDown:i,"data-active":f,children:u(Zq,{})}),u(h_,{}),u(bZ,{onMouseDown:c,"data-active":d,children:u(rZ,{})}),u(pZ,{}),u(h_,{}),u(yZ,{}),v&&u(SZ,{children:u(Kc,{size:"1rem"})})]})},wZ=()=>{const{openDeleteAccountDialog:e,setOpenDeleteAccountDialog:t}=Ln();return G(hn,{open:e,children:[u(B_,{children:u(N,{name:"delete-account"})}),u(qt,{children:u(N,{name:"delete-account-description"})}),G(gn,{children:[u(xo,{onClick:async()=>{try{await Rm.delete(),t(!1)}catch(o){alert(`Failed to delete account: ${o}`)}},children:u(N,{name:"delete"})}),u(Et,{onClick:()=>{t(!1)},children:u(N,{name:"cancel"})})]})]})},xZ=J.img`
  width: 3rem;
  height: 3rem;
  border-radius: 1.5rem;
  border: 2px solid var(--color-divider);
  box-sizing: border-box;
`,CZ=J.div`
  display: flex;
  align-items: center;
  gap: 1rem;
`,TZ=()=>{const{authUser:e}=Gc();return e===null?u(Ke,{}):G(CZ,{children:[u(xZ,{src:e.photoURL??void 0}),u("p",{children:e.displayName})]})},MZ=J.div`
  display: flex;
  flex-direction: column;
  gap: 1rem;
`,EZ=J(Et)`
  color: var(--color-red);
`,IZ=()=>{const{openUserSettingsDialog:e,setOpenUserSettingsDialog:t,setOpenDeleteAccountDialog:n}=Ln(),{authUser:r}=Gc();return G(hn,{open:e,style:{minWidth:"30rem"},children:[u(B_,{children:u(N,{name:"user-settings"})}),u(qt,{children:G(MZ,{children:[u(TZ,{}),u(Et,{onClick:()=>{r!==null&&window.open(`https://signalmidi.app/users/${r.uid}`)},children:u(N,{name:"profile"})}),u(EZ,{onClick:async()=>{t(!1),n(!0)},children:u(N,{name:"delete-account"})})]})}),u(gn,{children:u(Et,{onClick:()=>{t(!1)},children:u(N,{name:"cancel"})})})]})},AZ=J.div`
  height: 100%;
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  overflow: hidden;
`,RZ=({children:e})=>{const{isSaved:t}=_t(),n=er(),r=Ro(),o=p.useCallback(a=>{a.preventDefault()},[]),s=p.useCallback(async a=>{a.preventDefault();const i=a.dataTransfer.files[0];if(!(i.type!=="audio/midi"&&i.type!=="audio/mid")&&(t||confirm(n["confirm-open"]))){const c=await Km(i);r(c)}},[t,r,n]);return u(AZ,{onDrop:s,onDragOver:o,children:e})},OZ=J.div`
  height: 100%;
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  overflow: hidden;
`,PZ=J.div`
  height: 100%;
  display: flex;
  flex-grow: 1;
  flex-direction: column;
  outline: none;
`,BZ=()=>{const{path:e}=ds();return G(Ke,{children:[e==="/track"&&u(ZK,{}),e==="/tempo"&&u(Pq,{}),e==="/arrange"&&u(rz,{})]})},DZ=()=>{const e=zP();return bO(),gO(),vO(),G(Ke,{children:[u(RZ,{children:G(PZ,{...e,tabIndex:0,children:[u(Nj,{}),G(OZ,{children:[u(BZ,{}),u(kZ,{}),u(oz,{})]})]})}),u(KV,{}),u(jV,{}),u(HV,{}),u(sq,{}),u(Uz,{}),u(tq,{}),u(ZW,{}),u(Wj,{}),u(Lj,{}),u(hY,{}),u(IZ,{}),u(wZ,{})]})},NZ=ss`
  from {
    opacity: 0;
    transform: translate(0, 0.5rem) scale(0.96);
  }
  to {
    opacity: 1;
    transform: translate(0, 0) scale(1);
  }
`,LZ=ss`
  from {
    opacity: 1;
    transform: translate(0, 0) scale(1);
  }
  to {
    opacity: 0;
    transform: translate(0, 0.5rem) scale(0.96);
  }
`,zZ=J(I_)`
  position: fixed;
  bottom: 2rem;
  left: 0;
  right: 0;
  display: flex;
`,FZ=J.div`
  margin: 0 auto;
  background: var(--color-background-secondary);
  padding: 1rem;
  border-radius: 0.5rem;
  font-size: 0.8rem;
  box-shadow: 0 0.5rem 3rem var(--color-shadow);
  display: flex;
  align-items: center;

  animation: ${({show:e})=>e?NZ:LZ}
    500ms cubic-bezier(0.16, 1, 0.3, 1) forwards;
`,WZ=({severity:e})=>{const t=$t(),n=VZ(e,t);switch(e){case"error":return u(T5,{style:{fill:n}});case"info":return u(P_,{style:{fill:n}});case"success":return u(C5,{style:{fill:n}});case"warning":return u(O_,{style:{fill:n}})}},p_=5e3,$Z=({message:e,severity:t,onExited:n})=>{const[r,o]=p.useState(!0);return p.useEffect(()=>{const s=setTimeout(()=>o(!1),p_-500),a=setTimeout(n,p_);return()=>{clearTimeout(s),clearTimeout(a)}}),u(zZ,{children:G(FZ,{show:r,children:[u(WZ,{severity:t}),u("div",{style:{width:"0.5rem"}}),e]})})},VZ=(e,t)=>{switch(e){case"error":return t.redColor;case"info":return t.textColor;case"success":return t.greenColor;case"warning":return t.yellowColor}},jZ=()=>{const{selectedNoteIds:e}=Me(),{path:t}=ds(),{selectedEventIds:n}=Yt(),r=vi(),o=qc(),s=vf(),a=dl();return()=>{switch(t){case"/track":e.length>0?r():n.length>0&&a();break;case"/arrange":o();break;case"/tempo":s();break}}},HZ=()=>{const{selectedNoteIds:e}=Me(),{path:t}=ds(),{selectedEventIds:n}=Yt(),r=vi(),o=bi(),s=qc(),a=Wd(),i=vf(),c=Q1(),l=dl(),f=ff();return()=>{switch(t){case"/track":e.length>0?(r(),o()):n.length>0&&(l(),f());break;case"/arrange":s(),a();break;case"/tempo":i(),c();break}}},UZ=()=>{const{path:e}=ds(),t=Vd(),n=Hm(),r=Z3(),o=W1();return async()=>{switch(e){case"/track":{const s=await Yc();if(!s)return;vy.safeParse(s).success?t():by.safeParse(s).success&&o();break}case"/arrange":n();break;case"/tempo":r()}}},GZ=({onNewFile:e,onClickOpenFile:t,onOpenFile:n,onSaveFile:r,onSaveFileAs:o,onRename:s,onImport:a,onExportWav:i,onExportMp3:c,onUndo:l,onRedo:f,onCut:d,onCopy:m,onPaste:v,onDuplicate:_,onDelete:y,onSelectAll:k,onSelectNextNote:g,onSelectPreviousNote:b,onTransposeUpOctave:h,onTransposeDownOctave:S,onTranspose:x,onQuantize:w,onVelocity:I,onOpenSetting:M,onOpenHelp:H,onBrowserSignInCompleted:j})=>{const[W,A]=p.useState(!1);return p.useEffect(()=>window.electronAPI.onNewFile(e),[e]),p.useEffect(()=>window.electronAPI.onClickOpenFile(t),[t]),p.useEffect(()=>window.electronAPI.onOpenFile(n),[n]),p.useEffect(()=>window.electronAPI.onSaveFile(r),[r]),p.useEffect(()=>window.electronAPI.onSaveFileAs(o),[o]),p.useEffect(()=>window.electronAPI.onRename(s),[s]),p.useEffect(()=>window.electronAPI.onImport(a),[a]),p.useEffect(()=>window.electronAPI.onExportWav(i),[i]),p.useEffect(()=>window.electronAPI.onExportMp3(c),[c]),p.useEffect(()=>window.electronAPI.onUndo(l),[l]),p.useEffect(()=>window.electronAPI.onRedo(f),[f]),p.useEffect(()=>window.electronAPI.onCut(d),[d]),p.useEffect(()=>window.electronAPI.onCopy(m),[m]),p.useEffect(()=>window.electronAPI.onPaste(v),[v]),p.useEffect(()=>window.electronAPI.onDuplicate(_),[_]),p.useEffect(()=>window.electronAPI.onDelete(y),[y]),p.useEffect(()=>window.electronAPI.onSelectAll(k),[k]),p.useEffect(()=>window.electronAPI.onSelectNextNote(g),[g]),p.useEffect(()=>window.electronAPI.onSelectPreviousNote(b),[b]),p.useEffect(()=>window.electronAPI.onTransposeUpOctave(h),[h]),p.useEffect(()=>window.electronAPI.onTransposeDownOctave(S),[S]),p.useEffect(()=>window.electronAPI.onTranspose(x),[x]),p.useEffect(()=>window.electronAPI.onQuantize(w),[w]),p.useEffect(()=>window.electronAPI.onVelocity(I),[I]),p.useEffect(()=>window.electronAPI.onOpenSetting(M),[M]),p.useEffect(()=>window.electronAPI.onOpenHelp(H),[H]),p.useEffect(()=>window.electronAPI.onBrowserSignInCompleted(j),[j]),p.useEffect(()=>{W||(A(!0),window.electronAPI.ready())},[]),u(Ke,{})},XZ=()=>{const{isSaved:e,filepath:t,getSong:n,setSaved:r,setFilepath:o}=_t(),{isLoggedIn:s}=Gc(),{setOpenSettingDialog:a,setOpenHelpDialog:i}=Ln(),{setOpenTransposeDialog:c,setOpenVelocityDialog:l}=Me(),f=er(),d=Gd(),m=nf(),v=Io(),_=HZ(),y=jZ(),k=UZ(),g=bi(),b=jd(),h=Xm(),S=Um(),x=Gm(),w=Hd(),I=Zc(),{undo:M,redo:H}=ht(),j=Ro(),{exportSong:W}=B1(),A=async()=>{try{const L=await window.electronAPI.showSaveDialog();if(L===null)return;const{path:B}=L,P=rs(n()).buffer;o(B),r(!0),await window.electronAPI.saveFile(B,P),window.electronAPI.addRecentDocument(B)}catch(L){alert(L.message)}};return u(GZ,{onNewFile:async()=>{s?await m.createNewSong():await d.createNewSong()},onClickOpenFile:async()=>{if(s)await m.openSong();else try{if(e||confirm(f["confirm-open"])){const L=await window.electronAPI.showOpenDialog();if(L===null)return;const{path:B,content:P}=L,V=ku(P,B);j(V),window.electronAPI.addRecentDocument(B)}}catch(L){alert(L.message)}},onOpenFile:async({filePath:L})=>{try{if(e||confirm(f["confirm-open"])){const B=await window.electronAPI.readFile(L),P=ku(B,L);j(P),window.electronAPI.addRecentDocument(L)}}catch(B){alert(B.message)}},onSaveFile:async()=>{if(s)await m.saveSong();else try{if(t){const L=rs(n()).buffer;await window.electronAPI.saveFile(t,L),r(!0)}else await A()}catch(L){alert(L.message)}},onSaveFileAs:async()=>{s?await m.saveAsSong():await A()},onRename:async()=>{await m.renameSong()},onImport:async()=>{await m.importSong()},onExportWav:()=>{W("WAV")},onExportMp3:()=>{W("MP3")},onUndo:M,onRedo:H,onCut:_,onCopy:y,onPaste:k,onDuplicate:b,onDelete:g,onSelectAll:h,onSelectNextNote:S,onSelectPreviousNote:x,onTransposeUpOctave:()=>I(12),onTransposeDownOctave:()=>I(-12),onTranspose:()=>{c(!0)},onQuantize:w,onVelocity:()=>{l(!0)},onOpenSetting:()=>{a(!0)},onOpenHelp:()=>{i(!0)},onBrowserSignInCompleted:async({credential:L})=>{const B=KZ(L);try{await u4(Ja,B)}catch{v.error("Failed to sign in")}}})};function KZ(e){switch(e.providerId){case"google.com":return g_.credential(e.idToken,e.accessToken);case"github.com":return v_.credential(e.accessToken);case"apple.com":return new d4("apple.com").credential({idToken:e.idToken,accessToken:e.accessToken});default:throw new Error("Invalid provider")}}const YZ=({children:e})=>{const{language:t}=gi();return u(v4.Provider,{value:{language:t},children:e})},qZ=new RR;function ZZ(){return u(it.StrictMode,{children:u(oS.Provider,{value:qZ,children:u(dO,{children:u(M5,{children:u(E5,{component:$Z,children:u(I5,{component:mO,children:u(A5,{component:O6,children:u(R5,{component:pO,children:u(YZ,{children:u(SA,{children:u(EA,{children:u(fA,{children:G(VA,{children:[u(b4,{}),$n()&&u(XZ,{}),u(DZ,{})]})})})})})})})})})})})})})}var m_={};f6({dsn:m_.SENTRY_DSN,environment:m_.VERCEL_ENV,integrations:[w6()],tracesSampleRate:1});f4({enforceActions:"never"});const QZ=h4(document.querySelector("#root"));QZ.render(u(ZZ,{}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{const e="/midi/";navigator.serviceWorker.register(`${e}service-worker.js`,{scope:`${e}edit`}).then(t=>{console.log("SW registered: ",t)}).catch(t=>{console.log("SW registration failed: ",t)})});
